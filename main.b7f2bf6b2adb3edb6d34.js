!function(t){function e(e){for(var r,i,s=e[0],o=e[1],a=0,u=[];a<s.length;a++)i=s[a],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&u.push(n[i][0]),n[i]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);for(c&&c(e);u.length;)u.shift()()}var r={},n={0:0,1:0};function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(t){var e=[],r=n[t];if(0!==r)if(r)e.push(r[2]);else{var s=new Promise((function(e,i){r=n[t]=[e,i]}));e.push(r[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(t){return i.p+""+({2:"vendors~dat-gui"}[t]||t)+"."+{2:"bd4eea268457aa1a723f"}[t]+".js"}(t);var c=new Error;o=function(e){a.onerror=a.onload=null,clearTimeout(u);var r=n[t];if(0!==r){if(r){var i=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",c.name="ChunkLoadError",c.type=i,c.request=s,r[1](c)}n[t]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(e)},i.m=t,i.c=r,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=e,s=s.slice();for(var a=0;a<s.length;a++)e(s[a]);var c=o;i(i.s=99)}([function(t,e,r){"use strict";function n(t,e=""){if(!t){const t=new Error(`Assert fail: ${e}`);throw console.error(t.stack),t}}function i(t,e){if(null!=t)return t;throw new Error(o(e,"Missing object"))}function s(t){return null!=t}function o(t,e){return null!=t?t:e}function a(t,e){const r=t.indexOf(e);return n(r>=0),t.splice(r,1),r}r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return o})),r.d(e,"a",(function(){return a}))},function(t,e,r){"use strict";r.d(e,"p",(function(){return n})),r.d(e,"q",(function(){return i})),r.d(e,"r",(function(){return s})),r.d(e,"o",(function(){return o})),r.d(e,"f",(function(){return a})),r.d(e,"m",(function(){return c})),r.d(e,"k",(function(){return u})),r.d(e,"i",(function(){return h})),r.d(e,"j",(function(){return l})),r.d(e,"d",(function(){return f})),r.d(e,"g",(function(){return d})),r.d(e,"c",(function(){return p})),r.d(e,"a",(function(){return m})),r.d(e,"n",(function(){return g})),r.d(e,"e",(function(){return y})),r.d(e,"b",(function(){return b})),r.d(e,"h",(function(){return v})),r.d(e,"l",(function(){return w}));const n=16,i=64,s=16,o=0;var a,c,u,h,l,f,d,p,m,g,y,b,v;function w(t){switch(t){case c.Float:return 4;case c.Float2:return 8;case c.Float3:return 12;case c.Float4:return 16;case c.Int:return 4;case c.Int2:return 8;case c.Int3:return 12;case c.Int4:return 16;case c.Uint:return 4;case c.Uint2:return 8;case c.Uint3:return 12;case c.Uint4:return 16;case c.Short:return 2;case c.Short2:return 4;case c.Short3:return 6;case c.Short4:return 8;case c.Ushort:return 2;case c.Ushort2:return 4;case c.Ushort3:return 6;case c.Ushort4:return 8;case c.Char:return 1;case c.Char2:return 2;case c.Char3:return 3;case c.Char4:return 4;case c.Uchar:return 1;case c.Uchar2:return 2;case c.Uchar3:return 3;case c.Uchar4:return 4;case c.Half:return 2;case c.Half2:return 4;case c.Half3:return 6;case c.Half4:return 8;case c.Float3x3:return 36;case c.Float4x4:return 64;default:throw new Error(`Unsupported type: ${t}`)}}!function(t){t[t.VertexArrayObject=1]="VertexArrayObject",t[t.TextureFloat=2]="TextureFloat",t[t.TextureHalf=4]="TextureHalf",t[t.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",t[t.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",t[t.TextureWrite=32]="TextureWrite",t[t.ShaderDerivatives=64]="ShaderDerivatives",t[t.Instancing=128]="Instancing",t[t.AnistropicFiltering=256]="AnistropicFiltering",t[t.ShaderGlsl100=512]="ShaderGlsl100",t[t.ShaderGlsl300=1024]="ShaderGlsl300"}(a||(a={})),function(t){t[t.Undefined=0]="Undefined",t[t.Float=1]="Float",t[t.Float2=2]="Float2",t[t.Float3=3]="Float3",t[t.Float4=4]="Float4",t[t.Int=5]="Int",t[t.Int2=6]="Int2",t[t.Int3=7]="Int3",t[t.Int4=8]="Int4",t[t.Uint=9]="Uint",t[t.Uint2=10]="Uint2",t[t.Uint3=11]="Uint3",t[t.Uint4=12]="Uint4",t[t.Short=13]="Short",t[t.Short2=14]="Short2",t[t.Short3=15]="Short3",t[t.Short4=16]="Short4",t[t.Ushort=17]="Ushort",t[t.Ushort2=18]="Ushort2",t[t.Ushort3=19]="Ushort3",t[t.Ushort4=20]="Ushort4",t[t.Char=21]="Char",t[t.Char2=22]="Char2",t[t.Char3=23]="Char3",t[t.Char4=24]="Char4",t[t.Uchar=25]="Uchar",t[t.Uchar2=26]="Uchar2",t[t.Uchar3=27]="Uchar3",t[t.Uchar4=28]="Uchar4",t[t.Half=29]="Half",t[t.Half2=30]="Half2",t[t.Half3=31]="Half3",t[t.Half4=32]="Half4",t[t.Float3x3=33]="Float3x3",t[t.Float3x4=34]="Float3x4",t[t.Float4x4=35]="Float4x4",t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube",t[t.Short_Norm=256]="Short_Norm",t[t.Short2_Norm=257]="Short2_Norm",t[t.Short3_Norm=258]="Short3_Norm",t[t.Short4_Norm=259]="Short4_Norm",t[t.Ushort_Norm=260]="Ushort_Norm",t[t.Ushort2_Norm=261]="Ushort2_Norm",t[t.Ushort3_Norm=262]="Ushort3_Norm",t[t.Ushort4_Norm=263]="Ushort4_Norm",t[t.Char_Norm=264]="Char_Norm",t[t.Char2_Norm=265]="Char2_Norm",t[t.Char3_Norm=266]="Char3_Norm",t[t.Char4_Norm=267]="Char4_Norm",t[t.Uchar_Norm=268]="Uchar_Norm",t[t.Uchar2_Norm=269]="Uchar2_Norm",t[t.Uchar3_Norm=270]="Uchar3_Norm",t[t.Uchar4_Norm=271]="Uchar4_Norm"}(c||(c={})),function(t){t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube"}(u||(u={})),function(t){t[t.Undefined=0]="Undefined",t[t.U565=1]="U565",t[t.U8=2]="U8",t[t.U8_sRGB=3]="U8_sRGB",t[t.U8x2=4]="U8x2",t[t.U8x2_sRGB=5]="U8x2_sRGB",t[t.U8x3=6]="U8x3",t[t.U8x3_sRGB=7]="U8x3_sRGB",t[t.U8x4=8]="U8x4",t[t.U8x4_sRGB=9]="U8x4_sRGB",t[t.U10_10_10_2=10]="U10_10_10_2",t[t.F11_11_10=11]="F11_11_10",t[t.F16=12]="F16",t[t.F16x2=13]="F16x2",t[t.F16x3=14]="F16x3",t[t.F16x4=15]="F16x4",t[t.F32x2=16]="F32x2",t[t.F32x3=17]="F32x3",t[t.F32x4=18]="F32x4",t[t.Depth32=19]="Depth32",t[t.Depth24Stencil8=20]="Depth24Stencil8"}(h||(h={})),function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(l||(l={})),function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"}(f||(f={})),function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"}(d||(d={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uniform=1]="Uniform",t[t.Vertex=2]="Vertex",t[t.Index=3]="Index",t[t.Readback=4]="Readback"}(p||(p={})),function(t){t[t.Undefined=0]="Undefined",t[t.UniformBuffer=1]="UniformBuffer",t[t.Texture=2]="Texture"}(m||(m={})),function(t){t[t.None=0]="None",t[t.Static=1]="Static",t[t.Dynamic=2]="Dynamic"}(g||(g={})),function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Front=2]="Front"}(y||(y={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Source=2]="Source",t[t.OneMinusSource=3]="OneMinusSource"}(b||(b={})),function(t){t[t.Vertex=0]="Vertex",t[t.Instance=1]="Instance"}(v||(v={}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return s})),r.d(e,"e",(function(){return o}));var n={};r.r(n),r.d(n,"create",(function(){return l})),r.d(n,"fromMat4",(function(){return f})),r.d(n,"clone",(function(){return d})),r.d(n,"copy",(function(){return p})),r.d(n,"fromValues",(function(){return m})),r.d(n,"set",(function(){return g})),r.d(n,"identity",(function(){return y})),r.d(n,"transpose",(function(){return b})),r.d(n,"invert",(function(){return v})),r.d(n,"adjoint",(function(){return w})),r.d(n,"determinant",(function(){return x})),r.d(n,"multiply",(function(){return _})),r.d(n,"translate",(function(){return M})),r.d(n,"rotate",(function(){return C})),r.d(n,"scale",(function(){return A})),r.d(n,"fromTranslation",(function(){return S})),r.d(n,"fromRotation",(function(){return k})),r.d(n,"fromScaling",(function(){return T})),r.d(n,"fromMat2d",(function(){return F})),r.d(n,"fromQuat",(function(){return O})),r.d(n,"normalFromMat4",(function(){return E})),r.d(n,"projection",(function(){return j})),r.d(n,"str",(function(){return B})),r.d(n,"frob",(function(){return I})),r.d(n,"add",(function(){return R})),r.d(n,"subtract",(function(){return U})),r.d(n,"multiplyScalar",(function(){return D})),r.d(n,"multiplyScalarAndAdd",(function(){return P})),r.d(n,"exactEquals",(function(){return L})),r.d(n,"equals",(function(){return N})),r.d(n,"mul",(function(){return z})),r.d(n,"sub",(function(){return V}));var i={};r.r(i),r.d(i,"create",(function(){return q})),r.d(i,"clone",(function(){return W})),r.d(i,"copy",(function(){return H})),r.d(i,"fromValues",(function(){return G})),r.d(i,"set",(function(){return Y})),r.d(i,"identity",(function(){return X})),r.d(i,"transpose",(function(){return $})),r.d(i,"invert",(function(){return K})),r.d(i,"adjoint",(function(){return J})),r.d(i,"determinant",(function(){return Z})),r.d(i,"multiply",(function(){return Q})),r.d(i,"translate",(function(){return tt})),r.d(i,"scale",(function(){return et})),r.d(i,"rotate",(function(){return rt})),r.d(i,"rotateX",(function(){return nt})),r.d(i,"rotateY",(function(){return it})),r.d(i,"rotateZ",(function(){return st})),r.d(i,"fromTranslation",(function(){return ot})),r.d(i,"fromScaling",(function(){return at})),r.d(i,"fromRotation",(function(){return ct})),r.d(i,"fromXRotation",(function(){return ut})),r.d(i,"fromYRotation",(function(){return ht})),r.d(i,"fromZRotation",(function(){return lt})),r.d(i,"fromRotationTranslation",(function(){return ft})),r.d(i,"fromQuat2",(function(){return dt})),r.d(i,"getTranslation",(function(){return pt})),r.d(i,"getScaling",(function(){return mt})),r.d(i,"getRotation",(function(){return gt})),r.d(i,"fromRotationTranslationScale",(function(){return yt})),r.d(i,"fromRotationTranslationScaleOrigin",(function(){return bt})),r.d(i,"fromQuat",(function(){return vt})),r.d(i,"frustum",(function(){return wt})),r.d(i,"perspective",(function(){return xt})),r.d(i,"perspectiveFromFieldOfView",(function(){return _t})),r.d(i,"ortho",(function(){return Mt})),r.d(i,"lookAt",(function(){return Ct})),r.d(i,"targetTo",(function(){return At})),r.d(i,"str",(function(){return St})),r.d(i,"frob",(function(){return kt})),r.d(i,"add",(function(){return Tt})),r.d(i,"subtract",(function(){return Ft})),r.d(i,"multiplyScalar",(function(){return Ot})),r.d(i,"multiplyScalarAndAdd",(function(){return Et})),r.d(i,"exactEquals",(function(){return jt})),r.d(i,"equals",(function(){return Bt})),r.d(i,"mul",(function(){return It})),r.d(i,"sub",(function(){return Rt}));var s={};r.r(s),r.d(s,"create",(function(){return Ut})),r.d(s,"clone",(function(){return Dt})),r.d(s,"length",(function(){return Pt})),r.d(s,"fromValues",(function(){return Lt})),r.d(s,"copy",(function(){return Nt})),r.d(s,"set",(function(){return zt})),r.d(s,"add",(function(){return Vt})),r.d(s,"subtract",(function(){return qt})),r.d(s,"multiply",(function(){return Wt})),r.d(s,"divide",(function(){return Ht})),r.d(s,"ceil",(function(){return Gt})),r.d(s,"floor",(function(){return Yt})),r.d(s,"min",(function(){return Xt})),r.d(s,"max",(function(){return $t})),r.d(s,"round",(function(){return Kt})),r.d(s,"scale",(function(){return Jt})),r.d(s,"scaleAndAdd",(function(){return Zt})),r.d(s,"distance",(function(){return Qt})),r.d(s,"squaredDistance",(function(){return te})),r.d(s,"squaredLength",(function(){return ee})),r.d(s,"negate",(function(){return re})),r.d(s,"inverse",(function(){return ne})),r.d(s,"normalize",(function(){return ie})),r.d(s,"dot",(function(){return se})),r.d(s,"cross",(function(){return oe})),r.d(s,"lerp",(function(){return ae})),r.d(s,"hermite",(function(){return ce})),r.d(s,"bezier",(function(){return ue})),r.d(s,"random",(function(){return he})),r.d(s,"transformMat4",(function(){return le})),r.d(s,"transformMat3",(function(){return fe})),r.d(s,"transformQuat",(function(){return de})),r.d(s,"rotateX",(function(){return pe})),r.d(s,"rotateY",(function(){return me})),r.d(s,"rotateZ",(function(){return ge})),r.d(s,"angle",(function(){return ye})),r.d(s,"zero",(function(){return be})),r.d(s,"str",(function(){return ve})),r.d(s,"exactEquals",(function(){return we})),r.d(s,"equals",(function(){return xe})),r.d(s,"sub",(function(){return Me})),r.d(s,"mul",(function(){return Ce})),r.d(s,"div",(function(){return Ae})),r.d(s,"dist",(function(){return Se})),r.d(s,"sqrDist",(function(){return ke})),r.d(s,"len",(function(){return Te})),r.d(s,"sqrLen",(function(){return Fe})),r.d(s,"forEach",(function(){return Oe}));var o={};r.r(o),r.d(o,"create",(function(){return Ee})),r.d(o,"clone",(function(){return je})),r.d(o,"fromValues",(function(){return Be})),r.d(o,"copy",(function(){return Ie})),r.d(o,"set",(function(){return Re})),r.d(o,"add",(function(){return Ue})),r.d(o,"subtract",(function(){return De})),r.d(o,"multiply",(function(){return Pe})),r.d(o,"divide",(function(){return Le})),r.d(o,"ceil",(function(){return Ne})),r.d(o,"floor",(function(){return ze})),r.d(o,"min",(function(){return Ve})),r.d(o,"max",(function(){return qe})),r.d(o,"round",(function(){return We})),r.d(o,"scale",(function(){return He})),r.d(o,"scaleAndAdd",(function(){return Ge})),r.d(o,"distance",(function(){return Ye})),r.d(o,"squaredDistance",(function(){return Xe})),r.d(o,"length",(function(){return $e})),r.d(o,"squaredLength",(function(){return Ke})),r.d(o,"negate",(function(){return Je})),r.d(o,"inverse",(function(){return Ze})),r.d(o,"normalize",(function(){return Qe})),r.d(o,"dot",(function(){return tr})),r.d(o,"cross",(function(){return er})),r.d(o,"lerp",(function(){return rr})),r.d(o,"random",(function(){return nr})),r.d(o,"transformMat4",(function(){return ir})),r.d(o,"transformQuat",(function(){return sr})),r.d(o,"zero",(function(){return or})),r.d(o,"str",(function(){return ar})),r.d(o,"exactEquals",(function(){return cr})),r.d(o,"equals",(function(){return ur})),r.d(o,"sub",(function(){return hr})),r.d(o,"mul",(function(){return lr})),r.d(o,"div",(function(){return fr})),r.d(o,"dist",(function(){return dr})),r.d(o,"sqrDist",(function(){return pr})),r.d(o,"len",(function(){return mr})),r.d(o,"sqrLen",(function(){return gr})),r.d(o,"forEach",(function(){return yr}));var a={};r.r(a),r.d(a,"create",(function(){return br})),r.d(a,"identity",(function(){return vr})),r.d(a,"setAxisAngle",(function(){return wr})),r.d(a,"getAxisAngle",(function(){return xr})),r.d(a,"getAngle",(function(){return _r})),r.d(a,"multiply",(function(){return Mr})),r.d(a,"rotateX",(function(){return Cr})),r.d(a,"rotateY",(function(){return Ar})),r.d(a,"rotateZ",(function(){return Sr})),r.d(a,"calculateW",(function(){return kr})),r.d(a,"exp",(function(){return Tr})),r.d(a,"ln",(function(){return Fr})),r.d(a,"pow",(function(){return Or})),r.d(a,"slerp",(function(){return Er})),r.d(a,"random",(function(){return jr})),r.d(a,"invert",(function(){return Br})),r.d(a,"conjugate",(function(){return Ir})),r.d(a,"fromMat3",(function(){return Rr})),r.d(a,"fromEuler",(function(){return Ur})),r.d(a,"str",(function(){return Dr})),r.d(a,"clone",(function(){return Wr})),r.d(a,"fromValues",(function(){return Hr})),r.d(a,"copy",(function(){return Gr})),r.d(a,"set",(function(){return Yr})),r.d(a,"add",(function(){return Xr})),r.d(a,"mul",(function(){return $r})),r.d(a,"scale",(function(){return Kr})),r.d(a,"dot",(function(){return Jr})),r.d(a,"lerp",(function(){return Zr})),r.d(a,"length",(function(){return Qr})),r.d(a,"len",(function(){return tn})),r.d(a,"squaredLength",(function(){return en})),r.d(a,"sqrLen",(function(){return rn})),r.d(a,"normalize",(function(){return nn})),r.d(a,"exactEquals",(function(){return sn})),r.d(a,"equals",(function(){return on})),r.d(a,"rotationTo",(function(){return an})),r.d(a,"sqlerp",(function(){return cn})),r.d(a,"setAxes",(function(){return un}));var c=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,h=Math.random;Math.PI;function l(){var t=new u(9);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function f(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function d(t){var e=new u(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function p(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function m(t,e,r,n,i,s,o,a,c){var h=new u(9);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=i,h[5]=s,h[6]=o,h[7]=a,h[8]=c,h}function g(t,e,r,n,i,s,o,a,c,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=c,t[8]=u,t}function y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function b(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function v(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=h*o-a*u,f=-h*s+a*c,d=u*s-o*c,p=r*l+n*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-h*n+i*u)*p,t[2]=(a*n-i*o)*p,t[3]=f*p,t[4]=(h*r-i*c)*p,t[5]=(-a*r+i*s)*p,t[6]=d*p,t[7]=(-u*r+n*c)*p,t[8]=(o*r-n*s)*p,t):null}function w(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8];return t[0]=o*h-a*u,t[1]=i*u-n*h,t[2]=n*a-i*o,t[3]=a*c-s*h,t[4]=r*h-i*c,t[5]=i*s-r*a,t[6]=s*u-o*c,t[7]=n*c-r*u,t[8]=r*o-n*s,t}function x(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8];return e*(u*s-o*c)+r*(-u*i+o*a)+n*(c*i-s*a)}function _(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=r[0],d=r[1],p=r[2],m=r[3],g=r[4],y=r[5],b=r[6],v=r[7],w=r[8];return t[0]=f*n+d*o+p*u,t[1]=f*i+d*a+p*h,t[2]=f*s+d*c+p*l,t[3]=m*n+g*o+y*u,t[4]=m*i+g*a+y*h,t[5]=m*s+g*c+y*l,t[6]=b*n+v*o+w*u,t[7]=b*i+v*a+w*h,t[8]=b*s+v*c+w*l,t}function M(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=f*n+d*o+u,t[7]=f*i+d*a+h,t[8]=f*s+d*c+l,t}function C(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*o,t[1]=d*i+f*a,t[2]=d*s+f*c,t[3]=d*o-f*n,t[4]=d*a-f*i,t[5]=d*c-f*s,t[6]=u,t[7]=h,t[8]=l,t}function A(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function S(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function k(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function T(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function F(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function O(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,c=i+i,u=r*o,h=n*o,l=n*a,f=i*o,d=i*a,p=i*c,m=s*o,g=s*a,y=s*c;return t[0]=1-l-p,t[3]=h-y,t[6]=f+g,t[1]=h+y,t[4]=1-u-p,t[7]=d-m,t[2]=f-g,t[5]=d+m,t[8]=1-u-l,t}function E(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],b=r*a-n*o,v=r*c-i*o,w=r*u-s*o,x=n*c-i*a,_=n*u-s*a,M=i*u-s*c,C=h*m-l*p,A=h*g-f*p,S=h*y-d*p,k=l*g-f*m,T=l*y-d*m,F=f*y-d*g,O=b*F-v*T+w*k+x*S-_*A+M*C;return O?(O=1/O,t[0]=(a*F-c*T+u*k)*O,t[1]=(c*S-o*F-u*A)*O,t[2]=(o*T-a*S+u*C)*O,t[3]=(i*T-n*F-s*k)*O,t[4]=(r*F-i*S+s*A)*O,t[5]=(n*S-r*T-s*C)*O,t[6]=(m*M-g*_+y*x)*O,t[7]=(g*w-p*M-y*v)*O,t[8]=(p*_-m*w+y*b)*O,t):null}function j(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function B(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function I(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function R(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function U(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function D(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function P(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function L(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function N(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],h=t[7],l=t[8],f=e[0],d=e[1],p=e[2],m=e[3],g=e[4],y=e[5],b=e[6],v=e[7],w=e[8];return Math.abs(r-f)<=c*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-d)<=c*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=c*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-m)<=c*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-g)<=c*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-y)<=c*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=c*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=c*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-w)<=c*Math.max(1,Math.abs(l),Math.abs(w))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var z=_,V=U;function q(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function W(t){var e=new u(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function H(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function G(t,e,r,n,i,s,o,a,c,h,l,f,d,p,m,g){var y=new u(16);return y[0]=t,y[1]=e,y[2]=r,y[3]=n,y[4]=i,y[5]=s,y[6]=o,y[7]=a,y[8]=c,y[9]=h,y[10]=l,y[11]=f,y[12]=d,y[13]=p,y[14]=m,y[15]=g,y}function Y(t,e,r,n,i,s,o,a,c,u,h,l,f,d,p,m,g){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=c,t[8]=u,t[9]=h,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g,t}function X(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function K(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],b=r*a-n*o,v=r*c-i*o,w=r*u-s*o,x=n*c-i*a,_=n*u-s*a,M=i*u-s*c,C=h*m-l*p,A=h*g-f*p,S=h*y-d*p,k=l*g-f*m,T=l*y-d*m,F=f*y-d*g,O=b*F-v*T+w*k+x*S-_*A+M*C;return O?(O=1/O,t[0]=(a*F-c*T+u*k)*O,t[1]=(i*T-n*F-s*k)*O,t[2]=(m*M-g*_+y*x)*O,t[3]=(f*_-l*M-d*x)*O,t[4]=(c*S-o*F-u*A)*O,t[5]=(r*F-i*S+s*A)*O,t[6]=(g*w-p*M-y*v)*O,t[7]=(h*M-f*w+d*v)*O,t[8]=(o*T-a*S+u*C)*O,t[9]=(n*S-r*T-s*C)*O,t[10]=(p*_-m*w+y*b)*O,t[11]=(l*w-h*_-d*b)*O,t[12]=(a*A-o*k-c*C)*O,t[13]=(r*k-n*A+i*C)*O,t[14]=(m*v-p*x-g*b)*O,t[15]=(h*x-l*v+f*b)*O,t):null}function J(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15];return t[0]=a*(f*y-d*g)-l*(c*y-u*g)+m*(c*d-u*f),t[1]=-(n*(f*y-d*g)-l*(i*y-s*g)+m*(i*d-s*f)),t[2]=n*(c*y-u*g)-a*(i*y-s*g)+m*(i*u-s*c),t[3]=-(n*(c*d-u*f)-a*(i*d-s*f)+l*(i*u-s*c)),t[4]=-(o*(f*y-d*g)-h*(c*y-u*g)+p*(c*d-u*f)),t[5]=r*(f*y-d*g)-h*(i*y-s*g)+p*(i*d-s*f),t[6]=-(r*(c*y-u*g)-o*(i*y-s*g)+p*(i*u-s*c)),t[7]=r*(c*d-u*f)-o*(i*d-s*f)+h*(i*u-s*c),t[8]=o*(l*y-d*m)-h*(a*y-u*m)+p*(a*d-u*l),t[9]=-(r*(l*y-d*m)-h*(n*y-s*m)+p*(n*d-s*l)),t[10]=r*(a*y-u*m)-o*(n*y-s*m)+p*(n*u-s*a),t[11]=-(r*(a*d-u*l)-o*(n*d-s*l)+h*(n*u-s*a)),t[12]=-(o*(l*g-f*m)-h*(a*g-c*m)+p*(a*f-c*l)),t[13]=r*(l*g-f*m)-h*(n*g-i*m)+p*(n*f-i*l),t[14]=-(r*(a*g-c*m)-o*(n*g-i*m)+p*(n*c-i*a)),t[15]=r*(a*f-c*l)-o*(n*f-i*l)+h*(n*c-i*a),t}function Z(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8],h=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15];return(e*o-r*s)*(l*g-f*m)-(e*a-n*s)*(h*g-f*p)+(e*c-i*s)*(h*m-l*p)+(r*a-n*o)*(u*g-f*d)-(r*c-i*o)*(u*m-l*d)+(n*c-i*a)*(u*p-h*d)}function Q(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],b=e[15],v=r[0],w=r[1],x=r[2],_=r[3];return t[0]=v*n+w*a+x*l+_*m,t[1]=v*i+w*c+x*f+_*g,t[2]=v*s+w*u+x*d+_*y,t[3]=v*o+w*h+x*p+_*b,v=r[4],w=r[5],x=r[6],_=r[7],t[4]=v*n+w*a+x*l+_*m,t[5]=v*i+w*c+x*f+_*g,t[6]=v*s+w*u+x*d+_*y,t[7]=v*o+w*h+x*p+_*b,v=r[8],w=r[9],x=r[10],_=r[11],t[8]=v*n+w*a+x*l+_*m,t[9]=v*i+w*c+x*f+_*g,t[10]=v*s+w*u+x*d+_*y,t[11]=v*o+w*h+x*p+_*b,v=r[12],w=r[13],x=r[14],_=r[15],t[12]=v*n+w*a+x*l+_*m,t[13]=v*i+w*c+x*f+_*g,t[14]=v*s+w*u+x*d+_*y,t[15]=v*o+w*h+x*p+_*b,t}function tt(t,e,r){var n,i,s,o,a,c,u,h,l,f,d,p,m=r[0],g=r[1],y=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=u,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+a*g+l*y+e[12],t[13]=i*m+c*g+f*y+e[13],t[14]=s*m+u*g+d*y+e[14],t[15]=o*m+h*g+p*y+e[15]),t}function et(t,e,r){var n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rt(t,e,r,n){var i,s,o,a,u,h,l,f,d,p,m,g,y,b,v,w,x,_,M,C,A,S,k,T,F=n[0],O=n[1],E=n[2],j=Math.hypot(F,O,E);return j<c?null:(F*=j=1/j,O*=j,E*=j,i=Math.sin(r),o=1-(s=Math.cos(r)),a=e[0],u=e[1],h=e[2],l=e[3],f=e[4],d=e[5],p=e[6],m=e[7],g=e[8],y=e[9],b=e[10],v=e[11],w=F*F*o+s,x=O*F*o+E*i,_=E*F*o-O*i,M=F*O*o-E*i,C=O*O*o+s,A=E*O*o+F*i,S=F*E*o+O*i,k=O*E*o-F*i,T=E*E*o+s,t[0]=a*w+f*x+g*_,t[1]=u*w+d*x+y*_,t[2]=h*w+p*x+b*_,t[3]=l*w+m*x+v*_,t[4]=a*M+f*C+g*A,t[5]=u*M+d*C+y*A,t[6]=h*M+p*C+b*A,t[7]=l*M+m*C+v*A,t[8]=a*S+f*k+g*T,t[9]=u*S+d*k+y*T,t[10]=h*S+p*k+b*T,t[11]=l*S+m*k+v*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function nt(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[4],o=e[5],a=e[6],c=e[7],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*n,t[5]=o*i+h*n,t[6]=a*i+l*n,t[7]=c*i+f*n,t[8]=u*i-s*n,t[9]=h*i-o*n,t[10]=l*i-a*n,t[11]=f*i-c*n,t}function it(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],c=e[3],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*n,t[1]=o*i-h*n,t[2]=a*i-l*n,t[3]=c*i-f*n,t[8]=s*n+u*i,t[9]=o*n+h*i,t[10]=a*n+l*i,t[11]=c*n+f*i,t}function st(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],c=e[3],u=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*n,t[1]=o*i+h*n,t[2]=a*i+l*n,t[3]=c*i+f*n,t[4]=u*i-s*n,t[5]=h*i-o*n,t[6]=l*i-a*n,t[7]=f*i-c*n,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function at(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ct(t,e,r){var n,i,s,o=r[0],a=r[1],u=r[2],h=Math.hypot(o,a,u);return h<c?null:(o*=h=1/h,a*=h,u*=h,n=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=a*o*s+u*n,t[2]=u*o*s-a*n,t[3]=0,t[4]=o*a*s-u*n,t[5]=a*a*s+i,t[6]=u*a*s+o*n,t[7]=0,t[8]=o*u*s+a*n,t[9]=a*u*s-o*n,t[10]=u*u*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ut(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ht(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ft(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=n+n,c=i+i,u=s+s,h=n*a,l=n*c,f=n*u,d=i*c,p=i*u,m=s*u,g=o*a,y=o*c,b=o*u;return t[0]=1-(d+m),t[1]=l+b,t[2]=f-y,t[3]=0,t[4]=l-b,t[5]=1-(h+m),t[6]=p+g,t[7]=0,t[8]=f+y,t[9]=p-g,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function dt(t,e){var r=new u(3),n=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],f=n*n+i*i+s*s+o*o;return f>0?(r[0]=2*(a*o+l*n+c*s-h*i)/f,r[1]=2*(c*o+l*i+h*n-a*s)/f,r[2]=2*(h*o+l*s+a*i-c*n)/f):(r[0]=2*(a*o+l*n+c*s-h*i),r[1]=2*(c*o+l*i+h*n-a*s),r[2]=2*(h*o+l*s+a*i-c*n)),ft(t,e,r),t}function pt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function mt(t,e){var r=e[0],n=e[1],i=e[2],s=e[4],o=e[5],a=e[6],c=e[8],u=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(c,u,h),t}function gt(t,e){var r=new u(3);mt(r,e);var n=1/r[0],i=1/r[1],s=1/r[2],o=e[0]*n,a=e[1]*i,c=e[2]*s,h=e[4]*n,l=e[5]*i,f=e[6]*s,d=e[8]*n,p=e[9]*i,m=e[10]*s,g=o+l+m,y=0;return g>0?(y=2*Math.sqrt(g+1),t[3]=.25*y,t[0]=(f-p)/y,t[1]=(d-c)/y,t[2]=(a-h)/y):o>l&&o>m?(y=2*Math.sqrt(1+o-l-m),t[3]=(f-p)/y,t[0]=.25*y,t[1]=(a+h)/y,t[2]=(d+c)/y):l>m?(y=2*Math.sqrt(1+l-o-m),t[3]=(d-c)/y,t[0]=(a+h)/y,t[1]=.25*y,t[2]=(f+p)/y):(y=2*Math.sqrt(1+m-o-l),t[3]=(a-h)/y,t[0]=(d+c)/y,t[1]=(f+p)/y,t[2]=.25*y),t}function yt(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3],c=i+i,u=s+s,h=o+o,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=o*h,y=a*c,b=a*u,v=a*h,w=n[0],x=n[1],_=n[2];return t[0]=(1-(p+g))*w,t[1]=(f+v)*w,t[2]=(d-b)*w,t[3]=0,t[4]=(f-v)*x,t[5]=(1-(l+g))*x,t[6]=(m+y)*x,t[7]=0,t[8]=(d+b)*_,t[9]=(m-y)*_,t[10]=(1-(l+p))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function bt(t,e,r,n,i){var s=e[0],o=e[1],a=e[2],c=e[3],u=s+s,h=o+o,l=a+a,f=s*u,d=s*h,p=s*l,m=o*h,g=o*l,y=a*l,b=c*u,v=c*h,w=c*l,x=n[0],_=n[1],M=n[2],C=i[0],A=i[1],S=i[2],k=(1-(m+y))*x,T=(d+w)*x,F=(p-v)*x,O=(d-w)*_,E=(1-(f+y))*_,j=(g+b)*_,B=(p+v)*M,I=(g-b)*M,R=(1-(f+m))*M;return t[0]=k,t[1]=T,t[2]=F,t[3]=0,t[4]=O,t[5]=E,t[6]=j,t[7]=0,t[8]=B,t[9]=I,t[10]=R,t[11]=0,t[12]=r[0]+C-(k*C+O*A+B*S),t[13]=r[1]+A-(T*C+E*A+I*S),t[14]=r[2]+S-(F*C+j*A+R*S),t[15]=1,t}function vt(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,c=i+i,u=r*o,h=n*o,l=n*a,f=i*o,d=i*a,p=i*c,m=s*o,g=s*a,y=s*c;return t[0]=1-l-p,t[1]=h+y,t[2]=f-g,t[3]=0,t[4]=h-y,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wt(t,e,r,n,i,s,o){var a=1/(r-e),c=1/(i-n),u=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*c,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(i+n)*c,t[10]=(o+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*u,t[15]=0,t}function xt(t,e,r,n,i){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t}function _t(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+a),u=2/(i+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(o-a)*c*.5,t[9]=(i-s)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Mt(t,e,r,n,i,s,o){var a=1/(e-r),c=1/(n-i),u=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*c,t[14]=(o+s)*u,t[15]=1,t}function Ct(t,e,r,n){var i,s,o,a,u,h,l,f,d,p,m=e[0],g=e[1],y=e[2],b=n[0],v=n[1],w=n[2],x=r[0],_=r[1],M=r[2];return Math.abs(m-x)<c&&Math.abs(g-_)<c&&Math.abs(y-M)<c?X(t):(l=m-x,f=g-_,d=y-M,i=v*(d*=p=1/Math.hypot(l,f,d))-w*(f*=p),s=w*(l*=p)-b*d,o=b*f-v*l,(p=Math.hypot(i,s,o))?(i*=p=1/p,s*=p,o*=p):(i=0,s=0,o=0),a=f*o-d*s,u=d*i-l*o,h=l*s-f*i,(p=Math.hypot(a,u,h))?(a*=p=1/p,u*=p,h*=p):(a=0,u=0,h=0),t[0]=i,t[1]=a,t[2]=l,t[3]=0,t[4]=s,t[5]=u,t[6]=f,t[7]=0,t[8]=o,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*m+s*g+o*y),t[13]=-(a*m+u*g+h*y),t[14]=-(l*m+f*g+d*y),t[15]=1,t)}function At(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=n[0],c=n[1],u=n[2],h=i-r[0],l=s-r[1],f=o-r[2],d=h*h+l*l+f*f;d>0&&(h*=d=1/Math.sqrt(d),l*=d,f*=d);var p=c*f-u*l,m=u*h-a*f,g=a*l-c*h;return(d=p*p+m*m+g*g)>0&&(p*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=l*g-f*m,t[5]=f*p-h*g,t[6]=h*m-l*p,t[7]=0,t[8]=h,t[9]=l,t[10]=f,t[11]=0,t[12]=i,t[13]=s,t[14]=o,t[15]=1,t}function St(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function kt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Tt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Ot(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Et(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function jt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Bt(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],h=t[7],l=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],y=t[14],b=t[15],v=e[0],w=e[1],x=e[2],_=e[3],M=e[4],C=e[5],A=e[6],S=e[7],k=e[8],T=e[9],F=e[10],O=e[11],E=e[12],j=e[13],B=e[14],I=e[15];return Math.abs(r-v)<=c*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-w)<=c*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(i-x)<=c*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-_)<=c*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-M)<=c*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-C)<=c*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(u-A)<=c*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-S)<=c*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(l-k)<=c*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(f-T)<=c*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(d-F)<=c*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-O)<=c*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-E)<=c*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(g-j)<=c*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(y-B)<=c*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(b-I)<=c*Math.max(1,Math.abs(b),Math.abs(I))}var It=Q,Rt=Ft;function Ut(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dt(t){var e=new u(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Pt(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Lt(t,e,r){var n=new u(3);return n[0]=t,n[1]=e,n[2]=r,n}function Nt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function Vt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function qt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Wt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Ht(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Gt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Yt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Xt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function $t(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Kt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Jt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Zt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Qt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function te(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function ee(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function re(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ne(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ie(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function se(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function oe(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],c=r[2];return t[0]=i*c-s*a,t[1]=s*o-n*c,t[2]=n*a-i*o,t}function ae(t,e,r,n){var i=e[0],s=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t}function ce(t,e,r,n,i,s){var o=s*s,a=o*(2*s-3)+1,c=o*(s-2)+s,u=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+r[0]*c+n[0]*u+i[0]*h,t[1]=e[1]*a+r[1]*c+n[1]*u+i[1]*h,t[2]=e[2]*a+r[2]*c+n[2]*u+i[2]*h,t}function ue(t,e,r,n,i,s){var o=1-s,a=o*o,c=s*s,u=a*o,h=3*s*a,l=3*c*o,f=c*s;return t[0]=e[0]*u+r[0]*h+n[0]*l+i[0]*f,t[1]=e[1]*u+r[1]*h+n[1]*l+i[1]*f,t[2]=e[2]*u+r[2]*h+n[2]*l+i[2]*f,t}function he(t,e){e=e||1;var r=2*h()*Math.PI,n=2*h()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t}function le(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,t}function fe(t,e,r){var n=e[0],i=e[1],s=e[2];return t[0]=n*r[0]+i*r[3]+s*r[6],t[1]=n*r[1]+i*r[4]+s*r[7],t[2]=n*r[2]+i*r[5]+s*r[8],t}function de(t,e,r){var n=r[0],i=r[1],s=r[2],o=r[3],a=e[0],c=e[1],u=e[2],h=i*u-s*c,l=s*a-n*u,f=n*c-i*a,d=i*f-s*l,p=s*h-n*f,m=n*l-i*h,g=2*o;return h*=g,l*=g,f*=g,d*=2,p*=2,m*=2,t[0]=a+h+d,t[1]=c+l+p,t[2]=u+f+m,t}function pe(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function me(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ge(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ye(t,e){var r=t[0],n=t[1],i=t[2],s=e[0],o=e[1],a=e[2],c=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(s*s+o*o+a*a),u=c&&se(t,e)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function be(t){return t[0]=0,t[1]=0,t[2]=0,t}function ve(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function we(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function xe(t,e){var r=t[0],n=t[1],i=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(r-s)<=c*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=c*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))}var _e,Me=qt,Ce=Wt,Ae=Ht,Se=Qt,ke=te,Te=Pt,Fe=ee,Oe=(_e=Ut(),function(t,e,r,n,i,s){var o,a;for(e||(e=3),r||(r=0),a=n?Math.min(n*e+r,t.length):t.length,o=r;o<a;o+=e)_e[0]=t[o],_e[1]=t[o+1],_e[2]=t[o+2],i(_e,_e,s),t[o]=_e[0],t[o+1]=_e[1],t[o+2]=_e[2];return t});function Ee(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function je(t){var e=new u(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Be(t,e,r,n){var i=new u(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function Ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Re(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function Ue(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function De(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Pe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Le(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Ne(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function ze(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Ve(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function qe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function We(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function He(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Ge(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Ye(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,n,i,s)}function Xe(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return r*r+n*n+i*i+s*s}function $e(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function Ke(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function Je(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Ze(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Qe(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*r+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=s*o,t}function tr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function er(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],h=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*u-f*c+d*a,t[1]=-h*u+f*o-d*s,t[2]=h*c-l*o+d*i,t[3]=-h*a+l*s-f*i,t}function rr(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t[3]=a+n*(r[3]-a),t}function nr(t,e){var r,n,i,s,o,a;e=e||1;do{o=(r=2*h()-1)*r+(n=2*h()-1)*n}while(o>=1);do{a=(i=2*h()-1)*i+(s=2*h()-1)*s}while(a>=1);var c=Math.sqrt((1-o)/a);return t[0]=e*r,t[1]=e*n,t[2]=e*i*c,t[3]=e*s*c,t}function ir(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,t}function sr(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],c=r[2],u=r[3],h=u*n+a*s-c*i,l=u*i+c*n-o*s,f=u*s+o*i-a*n,d=-o*n-a*i-c*s;return t[0]=h*u+d*-o+l*-c-f*-a,t[1]=l*u+d*-a+f*-o-h*-c,t[2]=f*u+d*-c+h*-a-l*-o,t[3]=e[3],t}function or(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function ar(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function cr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function ur(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],o=e[0],a=e[1],u=e[2],h=e[3];return Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=c*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-u)<=c*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-h)<=c*Math.max(1,Math.abs(s),Math.abs(h))}var hr=De,lr=Pe,fr=Le,dr=Ye,pr=Xe,mr=$e,gr=Ke,yr=function(){var t=Ee();return function(e,r,n,i,s,o){var a,c;for(r||(r=4),n||(n=0),c=i?Math.min(i*r+n,e.length):e.length,a=n;a<c;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function br(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function wr(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function xr(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>c?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function _r(t,e){var r=Jr(t,e);return Math.acos(2*r*r-1)}function Mr(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=r[0],c=r[1],u=r[2],h=r[3];return t[0]=n*h+o*a+i*u-s*c,t[1]=i*h+o*c+s*a-n*u,t[2]=s*h+o*u+n*c-i*a,t[3]=o*h-n*a-i*c-s*u,t}function Cr(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);return t[0]=n*c+o*a,t[1]=i*c+s*a,t[2]=s*c-i*a,t[3]=o*c-n*a,t}function Ar(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);return t[0]=n*c-s*a,t[1]=i*c+o*a,t[2]=s*c+n*a,t[3]=o*c-i*a,t}function Sr(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*a,t[1]=i*c-n*a,t[2]=s*c+o*a,t[3]=o*c-s*a,t}function kr(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function Tr(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=Math.sqrt(r*r+n*n+i*i),a=Math.exp(s),c=o>0?a*Math.sin(o)/o:0;return t[0]=r*c,t[1]=n*c,t[2]=i*c,t[3]=a*Math.cos(o),t}function Fr(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=Math.sqrt(r*r+n*n+i*i),a=o>0?Math.atan2(o,s)/o:0;return t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=.5*Math.log(r*r+n*n+i*i+s*s),t}function Or(t,e,r){return Fr(t,e),Kr(t,t,r),Tr(t,t),t}function Er(t,e,r,n){var i,s,o,a,u,h=e[0],l=e[1],f=e[2],d=e[3],p=r[0],m=r[1],g=r[2],y=r[3];return(s=h*p+l*m+f*g+d*y)<0&&(s=-s,p=-p,m=-m,g=-g,y=-y),1-s>c?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(a=1-n,u=n),t[0]=a*h+u*p,t[1]=a*l+u*m,t[2]=a*f+u*g,t[3]=a*d+u*y,t}function jr(t){var e=h(),r=h(),n=h(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*r),t[1]=i*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*n),t[3]=s*Math.cos(2*Math.PI*n),t}function Br(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*r+n*n+i*i+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-n*a,t[2]=-i*a,t[3]=s*a,t}function Ir(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Rr(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+i]+e[3*i+s])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}function Ur(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),c=Math.cos(r),u=Math.sin(n),h=Math.cos(n);return t[0]=s*c*h-o*a*u,t[1]=o*a*h+s*c*u,t[2]=o*c*u-s*a*h,t[3]=o*c*h+s*a*u,t}function Dr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Pr,Lr,Nr,zr,Vr,qr,Wr=je,Hr=Be,Gr=Ie,Yr=Re,Xr=Ue,$r=Mr,Kr=He,Jr=tr,Zr=rr,Qr=$e,tn=Qr,en=Ke,rn=en,nn=Qe,sn=cr,on=ur,an=(Pr=Ut(),Lr=Lt(1,0,0),Nr=Lt(0,1,0),function(t,e,r){var n=se(e,r);return n<-.999999?(oe(Pr,Lr,e),Te(Pr)<1e-6&&oe(Pr,Nr,e),ie(Pr,Pr),wr(t,Pr,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(oe(Pr,e,r),t[0]=Pr[0],t[1]=Pr[1],t[2]=Pr[2],t[3]=1+n,nn(t,t))}),cn=(zr=br(),Vr=br(),function(t,e,r,n,i,s){return Er(zr,e,i,s),Er(Vr,r,n,s),Er(t,zr,Vr,2*s*(1-s)),t}),un=(qr=l(),function(t,e,r,n){return qr[0]=r[0],qr[3]=r[1],qr[6]=r[2],qr[1]=n[0],qr[4]=n[1],qr[7]=n[2],qr[2]=-e[0],qr[5]=-e[1],qr[8]=-e[2],nn(t,Rr(t,qr))})},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{constructor(t){this.data=t,this.offset=0,this.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength)}alloc(t){const e=this.offset;return this.offset+t>this.data.byteLength?null:(this.offset+=t,e)}write(t){const e=this.alloc(t.byteLength);return null!==e&&(this.data.set(t,e),!0)}clear(){return this.offset=0,this}finish(){const t=this.data.subarray(0,this.offset);return this.offset=0,t}}!function(t){function e(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-32768||e>32767)throw new Error("Msg.writeInt: range error");const r=Object(n.c)(t.alloc(2));return t.data[r+0]=e>>0&255,t.data[r+1]=e>>8&255,r}function r(t){const e=Object(n.c)(t.alloc(2)),r=t.data[e]+(t.data[e+1]<<8);return r>>15?4294901760|r:r}t.writeChar=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-128||e>127)throw new Error("Msg.writeChar: range error");const r=Object(n.c)(t.alloc(1));return t.data[r]=e,r},t.writeByte=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<0||e>255)throw new Error("Msg.writeChar: range error");const r=Object(n.c)(t.alloc(1));return t.data[r]=e,r},t.writeShort=e,t.writeInt=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-(2**31)||e>2**31-1)throw new Error("Msg.writeInt: range error");const r=Object(n.c)(t.alloc(4));return t.data[r+0]=e>>0&255,t.data[r+1]=e>>8&255,t.data[r+2]=e>>16&255,t.data[r+3]=e>>24&255,r},t.writeAngle16=function(t,r){return e(t,Math.floor(65536*r/(2*Math.PI)))},t.writeFloat=function(t,e){const r=Object(n.c)(t.alloc(4));return t.dataView.setFloat32(r,e,!0),r},t.writeString=function(e,r){Object(n.b)(r.length<256);const i=t.writeByte(e,r.length);for(let n=0;n<r.length;n++)t.writeByte(e,r.charCodeAt(n));return i},t.skip=function(t,e){return Object(n.c)(t.alloc(e))},t.readChar=function(t){const e=Object(n.c)(t.alloc(1)),r=t.data[e];return r>>7?4294967040|r:r},t.readByte=function(t){const e=Object(n.c)(t.alloc(1));return t.data[e]},t.peekByte=function(t){return t.data[t.offset]},t.readShort=r,t.readInt=function(t){const e=Object(n.c)(t.alloc(4));return t.data[e+0]+(t.data[e+1]<<8)+(t.data[e+2]<<16)+(t.data[e+3]<<24)},t.peekInt=function(t){return t.data[t.offset+0]+(t.data[t.offset+1]<<8)+(t.data[t.offset+2]<<16)+(t.data[t.offset+3]<<24)},t.readAngle16=function(t){return r(t)*(2*Math.PI)/65536},t.readFloat=function(t){const e=Object(n.c)(t.alloc(4));return t.dataView.getFloat32(e,!0)},t.readString=function(e){const r=t.readByte(e),n=String.fromCharCode.apply(null,e.data.subarray(e.offset,e.offset+r));return t.skip(e,r),n}}(i||(i={}))},function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"f",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return c})),r.d(e,"h",(function(){return u})),r.d(e,"i",(function(){return h})),r.d(e,"g",(function(){return l}));var n=2200,i=2201,s=2202,o=2300,a=2301,c=2302,u=2400,h=2401,l=2402},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return o})),r.d(e,"c",(function(){return a})),r.d(e,"f",(function(){return c})),r.d(e,"b",(function(){return u}));var n=r(2);n.b.create();const i=n.d.create();function s(t,e,r){return(1-r)*t+r*e}function o(t,e,r){return(r-t)/(e-t)}function a(t,e,r){return Math.max(Math.min(t,r),e)}function c(t){return a(t,0,1)}function u(t,e,r=6.283){return function(t,e,r=1){const n=(e-t)%r;return 2*n%r-n}(t,e,r)}},function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r(17),i=r(14),s=new a,o=new i.a;function a(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(a.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(o.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(o.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,s=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*s,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,s=t.y,o=t.z,a=t.w,c=a*e+s*n-o*r,u=a*r+o*e-i*n,h=a*n+i*r-s*e,l=-i*e-s*r-o*n;return this.x=c*a+l*-i+u*-o-h*-s,this.y=u*a+l*-s+h*-i-c*-o,this.z=h*a+l*-o+c*-s-u*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*s-r*a,this.z=r*o-n*s,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)},projectOnPlane:function(t){return s.copy(this).projectOnVector(t),this.sub(s)},reflect:function(t){return this.sub(s.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var r=this.dot(t)/e;return Math.acos(n.a.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}})},function(t,e,r){"use strict";r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return o}));var n=r(1),i=r(0);function s(t){const e={};let r=0;const s=Object.keys(t);for(let o=0;o<s.length;o++){const a=t[s[o]];e[s[o]]=Object.assign(Object.assign({},a),{offset:r}),r+=n.l(a.type)*Object(i.d)(a.count,1)}return e}class o{constructor(t,e,r){this.bufferSize=0,this.bufferLayout=r;const i=Object.keys(this.bufferLayout);let s=this.bufferLayout[i[0]];for(let t=1;t<i.length;t++){const e=this.bufferLayout[i[t]];e.offset>s.offset&&(s=e)}this.bufferSize=s.offset+a(s),this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.buffer=e.createBuffer(t,n.c.Uniform,n.n.Dynamic,this.bufferSize)}getBufferView(){return{buffer:this.buffer,byteOffset:0}}getBufferLayout(){return this.bufferLayout}setFloat(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats[r.offset/4]=e}setVec2(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setVec3(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setVec4(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setMat4(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setBytes(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length!==a(r))throw new Error("Invalid size");this.bufferBytes.set(e,r.offset)}setFloats(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length!==a(r)/4)throw new Error("Invalid size");this.bufferFloats.set(e,r.offset/4)}getFloatArray(t){const e=this.bufferLayout[t];if(!e)throw new Error(`Attempted to set unknown uniform ${t}`);return new Float32Array(this.bufferData,e.offset,a(e)/4)}write(t){t.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(t){t.removeBuffer(this.buffer)}}function a(t){return n.l(t.type)*Object(i.d)(t.count,1)}},function(t,e,r){"use strict";r.d(e,"f",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"d",(function(){return h})),r.d(e,"c",(function(){return l})),r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return p}));var n=r(2),i=r(0),s=r(5),o=r(3);class a{constructor(){this.stateBuffer=[],this.latestFrame=-1,this.bufferFrameCount=64;for(let t=0;t<this.bufferFrameCount;t++)this.stateBuffer[t]={frame:-1,entities:[]}}addState(t){const e=[],r=[],n=this.stateBuffer[t.frame%this.bufferFrameCount].frame,s=this.getNextFrame(n+1);!function(t,e,r){if(r.length=0,!Object(i.e)(t))return;Object(i.b)(t.frame<e.frame);const n=t.entities.length,s=e.entities.length;for(let o=0,a=0;o<n||a<s;){const c=t.entities[o],u=e.entities[a];o>=n||u&&c.id>u.id?a+=1:a>=s||c&&u.id>c.id?(r.push(c.id),o+=1):c.id===u.id?(o+=1,a+=1):Object(i.b)(!1,"This should never happen")}}(this.stateBuffer[n%this.bufferFrameCount],Object(i.e)(s)?this.stateBuffer[s%this.bufferFrameCount]:t,e),function(t,e,r){if(r.length=0,!Object(i.e)(t)){for(let t=0;t<e.entities.length;t++)r[t]=t;return}Object(i.b)(t.frame<e.frame);const n=t.entities.length,s=e.entities.length;for(let o=0,a=0;o<n||a<s;){const c=t.entities[o],u=e.entities[a];o>=n||u&&c.id>u.id?(r.push(a),a+=1):a>=s||c&&u.id>c.id?o+=1:c.id===u.id?(o+=1,a+=1):Object(i.b)(!1,"This should never happen")}}(this.stateBuffer[this.latestFrame%this.bufferFrameCount],t,r);const o=this.stateBuffer[t.frame%this.bufferFrameCount];return o.frame=t.frame,o.entities=t.entities.slice(),this.latestFrame=t.frame,{additions:r,removals:e}}getState(t){return Object(i.b)(Number.isInteger(t)),Object(i.b)(t>=this.latestFrame-this.bufferFrameCount),this.stateBuffer[t%this.bufferFrameCount]}lerpState(t,e){const r=this.getPreviousFrame(t),n=this.getNextFrame(t),o=Object(i.e)(r),a=Object(i.e)(n);if(o&&!a)return console.warn("Extrapolation not yet implemented"),!1;if(!o&&a)return console.warn("Extrapolation not yet implemented"),!1;if(o||a){const o=this.getState(r),a=this.getState(n);return o===a?(Object.assign(e,o),!0):(function(t,e,r,n){Object(i.b)(t.entities instanceof Array,"Result must be a valid SimState"),t.frame=Object(s.e)(e.frame,r.frame,n),t.entities.length=0;const o=e.entities.length,a=r.entities.length,c=Math.max(o,a);for(let s=0,c=0;s<o||c<a;){const u=e.entities[s],d=r.entities[c],p=h();s>=o||d&&u.id>d.id?(l(p,d),t.entities.push(p),c+=1):c>=a||u&&d.id>u.id?(l(p,u),t.entities.push(p),s+=1):u.id===d.id?(f(p,u,d,n),t.entities.push(p),s+=1,c+=1):Object(i.b)(!1,"This should never happen")}Object(i.b)(t.entities.length===c)}(e,o,a,Object(s.d)(r,n,t)),!0)}return console.warn("No valid snapshot for this frame"),!1}hasState(t){const e=this.stateBuffer[t%this.bufferFrameCount];return Object(i.e)(e)&&e.frame===t}getPreviousFrame(t){var e;const r=Math.max(0,this.latestFrame-this.bufferFrameCount);let n=Math.floor(t);for(;n>=r&&(null===(e=this.stateBuffer[n%this.bufferFrameCount])||void 0===e?void 0:e.frame)!==n;)n-=1;return n>=r?n:void 0}getNextFrame(t){var e;let r=Math.ceil(t);for(;r<=this.latestFrame&&(null===(e=this.stateBuffer[r%this.bufferFrameCount])||void 0===e?void 0:e.frame)!==r;)r+=1;return r<=this.latestFrame?r:void 0}}function c(t,e){o.a.writeInt(t,e.frame),o.a.writeByte(t,e.entities.length);for(let r=0;r<e.entities.length;r++){const n=e.entities[r];o.a.writeByte(t,n.id),o.a.writeByte(t,n.type),o.a.writeByte(t,n.flags),o.a.writeFloat(t,n.origin[0]),o.a.writeFloat(t,n.origin[1]),o.a.writeFloat(t,n.origin[2]),o.a.writeFloat(t,n.orientation[0]),o.a.writeFloat(t,n.orientation[1]),o.a.writeFloat(t,n.orientation[2]),o.a.writeChar(t,n.parent),o.a.writeByte(t,n.state),o.a.writeInt(t,n.stateStartFrame),o.a.writeFloat(t,n.speed)}}function u(t,e){e.frame=o.a.readInt(t);const r=o.a.readByte(t);for(let n=0;n<r;n++){const r=h();r.id=o.a.readByte(t),r.type=o.a.readByte(t),r.flags=o.a.readByte(t),r.origin[0]=o.a.readFloat(t),r.origin[1]=o.a.readFloat(t),r.origin[2]=o.a.readFloat(t),r.orientation[0]=o.a.readFloat(t),r.orientation[1]=o.a.readFloat(t),r.orientation[2]=o.a.readFloat(t),r.parent=o.a.readChar(t),r.state=o.a.readByte(t),r.stateStartFrame=o.a.readInt(t),r.speed=o.a.readFloat(t),e.entities.push(r)}}function h(){return{id:-1,type:-1,flags:0,origin:n.d.create(),orientation:n.d.create(),parent:-1,state:0,stateStartFrame:0,speed:0}}function l(t,e){return t.id=e.id,t.type=e.type,t.flags=e.flags,n.d.copy(t.origin,e.origin),n.d.copy(t.orientation,e.orientation),t.parent=e.parent,t.state=e.state,t.stateStartFrame=e.stateStartFrame,t.speed=e.speed,t}function f(t,e,r,i){t.id=e.id,t.type=e.type,n.d.lerp(t.origin,e.origin,r.origin,i),n.d.lerp(t.orientation,e.orientation,r.orientation,i),t.speed=Object(s.e)(e.speed,r.speed,i),t.flags=r.flags,t.parent=r.parent,t.state=r.state,t.stateStartFrame=r.stateStartFrame}var d;!function(t){t[t.Avatar=0]="Avatar",t[t.Weapon=1]="Weapon"}(d||(d={}));class p{constructor(){this.stream=new a,this.factories={},this.objects=[],this.entityId=0}registerFactory(t,e){this.factories[t]=e}createGameObject(t,e){const r=this.entityId++,n=Object.assign(h(),e,{id:r,type:t});return this.createImmediate(n)}deleteGameObject(t){}loadState(t){this.loadedState=t;let e=0,r=0;for(;e<this.loadedState.entities.length;){const t=this.loadedState.entities[e++];let n=this.objects[r++];for(;n.state.id<t.id;)n=this.objects[r++];Object(i.b)(n.state.id===t.id,`Object ${t.id} should already have been created`),l(n.state,t)}}addState(t){const{additions:e,removals:r}=this.stream.addState(t);for(const r of e){const e=t.entities[r];this.createImmediate(e)}for(const t of r){const e=Object(i.c)(this.objects.find(e=>e.state.id===t));this.deleteImmediate(e)}}captureState(t){const e={frame:t,entities:[]};for(const t of this.objects)e.entities.push(t.state);this.stream.addState(e)}createImmediate(t){const e=this.factories[t.type].createGameObject(t);return this.objects.push(e),e}deleteImmediate(t){this.factories[t.state.type].deleteGameObject(t),Object(i.a)(this.objects,t)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(1);class i{constructor(t,e,r){this.defaultCullMode=t,this.defaultDepthState=e,this.renderFormat=r,this.primitives=[]}push(t){this.primitives.push(t)}}const s={opaque:new i(n.e.Back,{depthWriteEnabled:!0,depthTestEnabled:!0},{blendingEnabled:!1}),debug:new i(n.e.None,{depthWriteEnabled:!1,depthTestEnabled:!1},{blendingEnabled:!1})}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{on(t,e){return Object(n.e)(this.callbacks)||(this.callbacks={}),Object(n.e)(this.callbacks[t])||(this.callbacks[t]=[]),Object(n.b)(-1===this.callbacks[t].indexOf(e),"Attempted to add the same callback twice"),this.callbacks[t].push(e),this}once(t,e){const r=(...n)=>{e(...n),this.off(t,r)};return this.on(t,r),this}off(t,e){return Object(n.a)(Object(n.c)(this.callbacks)[t],e),this}fire(t,...e){if(!this.hasHandlers(t))return this;for(const r of this.callbacks[t])r(...e);return this}hasHandlers(t){return Object(n.e)(this.callbacks)&&Object(n.e)(this.callbacks[t])&&this.callbacks[t].length>0}}},function(t,e,r){"use strict";r.d(e,"c",(function(){return o}));var n=r(6),i=r(12);r.d(e,"a",(function(){return i.a}));var s=r(28);r.d(e,"b",(function(){return s.a}));class o extends n.a{constructor(t){super(),this.buffer=t}setBuffer(t){return this.buffer=t,this}set x(t){this.buffer&&(this.buffer[0]=t)}set y(t){this.buffer&&(this.buffer[1]=t)}set z(t){this.buffer&&(this.buffer[2]=t)}get x(){return this.buffer[0]}get y(){return this.buffer[1]}get z(){return this.buffer[2]}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(6),i=new n.a,s=new l,o=new n.a(0,0,0),a=new n.a(1,1,1),c=new n.a,u=new n.a,h=new n.a;function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(l.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,s,o,a,c,u,h,l,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=c,g[6]=u,g[10]=h,g[14]=l,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new l).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/i.setFromMatrixColumn(t,0).length(),s=1/i.setFromMatrixColumn(t,1).length(),o=1/i.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=0,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),c=Math.sin(n),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){var l=s*u,f=s*h,d=o*u,p=o*h;e[0]=a*u,e[4]=-a*h,e[8]=c,e[1]=f+d*c,e[5]=l-p*c,e[9]=-o*a,e[2]=p-l*c,e[6]=d+f*c,e[10]=s*a}else if("YXZ"===t.order){var m=a*u,g=a*h,y=c*u,b=c*h;e[0]=m+b*o,e[4]=y*o-g,e[8]=s*c,e[1]=s*h,e[5]=s*u,e[9]=-o,e[2]=g*o-y,e[6]=b+m*o,e[10]=s*a}else if("ZXY"===t.order){m=a*u,g=a*h,y=c*u,b=c*h;e[0]=m-b*o,e[4]=-s*h,e[8]=y+g*o,e[1]=g+y*o,e[5]=s*u,e[9]=b-m*o,e[2]=-s*c,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){l=s*u,f=s*h,d=o*u,p=o*h;e[0]=a*u,e[4]=d*c-f,e[8]=l*c+p,e[1]=a*h,e[5]=p*c+l,e[9]=f*c-d,e[2]=-c,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var v=s*a,w=s*c,x=o*a,_=o*c;e[0]=a*u,e[4]=_-v*h,e[8]=x*h+w,e[1]=h,e[5]=s*u,e[9]=-o*u,e[2]=-c*u,e[6]=w*h+x,e[10]=v-_*h}else if("XZY"===t.order){v=s*a,w=s*c,x=o*a,_=o*c;e[0]=a*u,e[4]=-h,e[8]=c*u,e[1]=v*h+_,e[5]=s*u,e[9]=w*h-x,e[2]=x*h-w,e[6]=o*u,e[10]=_*h+v}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(o,t,a)},lookAt:function(t,e,r){var n=this.elements;return h.subVectors(t,e),0===h.lengthSq()&&(h.z=1),h.normalize(),c.crossVectors(r,h),0===c.lengthSq()&&(1===Math.abs(r.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),c.crossVectors(r,h)),c.normalize(),u.crossVectors(h,c),n[0]=c.x,n[4]=u.x,n[8]=h.x,n[1]=c.y,n[5]=u.y,n[9]=h.y,n[2]=c.z,n[6]=u.z,n[10]=h.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[4],a=r[8],c=r[12],u=r[1],h=r[5],l=r[9],f=r[13],d=r[2],p=r[6],m=r[10],g=r[14],y=r[3],b=r[7],v=r[11],w=r[15],x=n[0],_=n[4],M=n[8],C=n[12],A=n[1],S=n[5],k=n[9],T=n[13],F=n[2],O=n[6],E=n[10],j=n[14],B=n[3],I=n[7],R=n[11],U=n[15];return i[0]=s*x+o*A+a*F+c*B,i[4]=s*_+o*S+a*O+c*I,i[8]=s*M+o*k+a*E+c*R,i[12]=s*C+o*T+a*j+c*U,i[1]=u*x+h*A+l*F+f*B,i[5]=u*_+h*S+l*O+f*I,i[9]=u*M+h*k+l*E+f*R,i[13]=u*C+h*T+l*j+f*U,i[2]=d*x+p*A+m*F+g*B,i[6]=d*_+p*S+m*O+g*I,i[10]=d*M+p*k+m*E+g*R,i[14]=d*C+p*T+m*j+g*U,i[3]=y*x+b*A+v*F+w*B,i[7]=y*_+b*S+v*O+w*I,i[11]=y*M+b*k+v*E+w*R,i[15]=y*C+b*T+v*j+w*U,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],o=t[5],a=t[9],c=t[13],u=t[2],h=t[6],l=t[10],f=t[14];return t[3]*(+i*a*h-n*c*h-i*o*l+r*c*l+n*o*f-r*a*f)+t[7]*(+e*a*f-e*c*l+i*s*l-n*s*f+n*c*u-i*a*u)+t[11]*(+e*c*h-e*o*f-i*s*h+r*s*f+i*o*u-r*c*u)+t[15]*(-n*o*u-e*a*h+e*o*l+n*s*h-r*s*l+r*a*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var r=this.elements,n=t.elements,i=n[0],s=n[1],o=n[2],a=n[3],c=n[4],u=n[5],h=n[6],l=n[7],f=n[8],d=n[9],p=n[10],m=n[11],g=n[12],y=n[13],b=n[14],v=n[15],w=d*b*l-y*p*l+y*h*m-u*b*m-d*h*v+u*p*v,x=g*p*l-f*b*l-g*h*m+c*b*m+f*h*v-c*p*v,_=f*y*l-g*d*l+g*u*m-c*y*m-f*u*v+c*d*v,M=g*d*h-f*y*h-g*u*p+c*y*p+f*u*b-c*d*b,C=i*w+s*x+o*_+a*M;if(0===C)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var A=1/C;return r[0]=w*A,r[1]=(y*p*a-d*b*a-y*o*m+s*b*m+d*o*v-s*p*v)*A,r[2]=(u*b*a-y*h*a+y*o*l-s*b*l-u*o*v+s*h*v)*A,r[3]=(d*h*a-u*p*a-d*o*l+s*p*l+u*o*m-s*h*m)*A,r[4]=x*A,r[5]=(f*b*a-g*p*a+g*o*m-i*b*m-f*o*v+i*p*v)*A,r[6]=(g*h*a-c*b*a-g*o*l+i*b*l+c*o*v-i*h*v)*A,r[7]=(c*p*a-f*h*a+f*o*l-i*p*l-c*o*m+i*h*m)*A,r[8]=_*A,r[9]=(g*d*a-f*y*a-g*s*m+i*y*m+f*s*v-i*d*v)*A,r[10]=(c*y*a-g*u*a+g*s*l-i*y*l-c*s*v+i*u*v)*A,r[11]=(f*u*a-c*d*a-f*s*l+i*d*l+c*s*m-i*u*m)*A,r[12]=M*A,r[13]=(f*y*o-g*d*o+g*s*p-i*y*p-f*s*b+i*d*b)*A,r[14]=(g*u*o-c*y*o-g*s*h+i*y*h+c*s*b-i*u*b)*A,r[15]=(c*d*o-f*u*o+f*s*h-i*d*h-c*s*p+i*u*p)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,o=t.y,a=t.z,c=i*s,u=i*o;return this.set(c*s+r,c*o-n*a,c*a+n*o,0,c*o+n*a,u*o+r,u*a-n*s,0,c*a-n*o,u*a+n*s,i*a*a+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,c=i+i,u=s+s,h=o+o,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=o*h,y=a*c,b=a*u,v=a*h,w=r.x,x=r.y,_=r.z;return n[0]=(1-(p+g))*w,n[1]=(f+v)*w,n[2]=(d-b)*w,n[3]=0,n[4]=(f-v)*x,n[5]=(1-(l+g))*x,n[6]=(m+y)*x,n[7]=0,n[8]=(d+b)*_,n[9]=(m-y)*_,n[10]=(1-(l+p))*_,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,o=i.set(n[0],n[1],n[2]).length(),a=i.set(n[4],n[5],n[6]).length(),c=i.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),t.x=n[12],t.y=n[13],t.z=n[14],s.copy(this);var u=1/o,h=1/a,l=1/c;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=h,s.elements[5]*=h,s.elements[6]*=h,s.elements[8]*=l,s.elements[9]*=l,s.elements[10]*=l,e.setFromRotationMatrix(s),r.x=o,r.y=a,r.z=c,this},makePerspective:function(t,e,r,n,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*i/(e-t),c=2*i/(r-n),u=(e+t)/(e-t),h=(r+n)/(r-n),l=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,r,n,i,s){var o=this.elements,a=1/(e-t),c=1/(r-n),u=1/(s-i),h=(e+t)*a,l=(r+n)*c,f=(s+i)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}})},function(t,e,r){"use strict";r.d(e,"c",(function(){return h})),r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return b}));var n,i=r(21),s=r(10),o=r(0),a=r(3);!function(t){t.Receive="rec",t.Acknowledge="ack"}(n||(n={}));class c extends s.a{constructor(){super(...arguments),this.remoteSequence=-1,this.localSequence=0,this.localHistory=[],this.remoteHistory=[],this.packetBuffer=new a.a(new Uint8Array(1032))}get isOpen(){return this.socket.isOpen}initialize(t){this.socket=t,this.socket.on(i.a.Message,t=>this.receive(t.data));const e={sequence:-1,ack:-1,ackBitfield:0},r={tag:0,size:0,sendTime:-1,rcvdTime:-1};for(let t=0;t<512;t++)this.localHistory[t]=Object.assign(Object.assign({},r),{header:Object.assign({},e)}),this.remoteHistory[t]=Object.assign(Object.assign({},r),{header:Object.assign({},e)})}close(){this.socket.close()}computeStats(t){const e=performance.now();let r=0,n=0,i=0,s=0,a=0,c=0,u=1/0,h=1/0;for(let t=0;t<Math.min(this.localSequence,512);t++){const a=this.localSequence-t,h=this.localHistory[a%512];h.header.sequence===a&&(e-h.sendTime>1e3&&(Object(o.e)(h.ackTime)?r+=1:n+=1),Object(o.e)(h.ackTime)&&(i+=h.ackTime-h.sendTime,s+=1),c+=h.size,u=Math.min(u,h.sendTime))}for(let t=0;t<Math.min(this.remoteSequence,512);t++){const e=this.remoteSequence-t,r=this.remoteHistory[e%512];r.header.sequence!==e||(a+=r.size,h=Math.min(h,r.rcvdTime))}const l=n+r>0?n/(n+r)*100:0,f=s>0?i/s:0,d=c/(e-u)*8,p=a/(e-h)*8;return t.onNetChannelSample(l,f,d,p),t}allocatePacket(){return this.packetBuffer.clear(),a.a.skip(this.packetBuffer,8),this.packetBuffer}send(t,e){Object(o.b)(t===this.packetBuffer,"Pass the same buffer from allocatePacket()");const r=this.localHistory[this.localSequence%512];r.header.sequence=this.localSequence,r.header.ack=this.remoteSequence,r.header.ackBitfield=this.writeAckBitfield(this.remoteHistory),r.tag=Object(o.d)(e,this.localSequence),r.sendTime=performance.now(),r.ackTime=void 0,r.size=this.packetBuffer.offset,this.packetBuffer.dataView.setUint16(0,r.header.sequence,!0),this.packetBuffer.dataView.setUint16(2,r.header.ack,!0),this.packetBuffer.dataView.setUint32(4,r.header.ackBitfield,!0);const n=this.packetBuffer.finish();this.socket.send(n),this.localSequence=u(this.localSequence+1)}receive(t){const e=new a.a(new Uint8Array(t)),r=e.dataView.getUint16(0,!0);if(i=r,s=this.remoteSequence,i>s&&i-s<=32768||i<s&&s-i>32768){this.remoteSequence=r;const i=this.remoteHistory[r%512];i.header.sequence=e.dataView.getUint16(0,!0),i.header.ack=e.dataView.getUint16(2,!0),i.header.ackBitfield=e.dataView.getUint32(4,!0),i.size=t.byteLength,i.rcvdTime=performance.now();const s=i.header.ackBitfield;let c;for(let t=0;t<32;t++)if(s&1<<t){const e=u(i.header.ack-t),r=this.localHistory[e%512];if(r.header.sequence===e&&!Object(o.e)(r.ackTime)){const e=this.acknowledge(r);0===t&&(c=e)}}a.a.skip(e,8),this.fire(n.Receive,e,c,i.rcvdTime)}else console.debug("NetChannel: Ignoring stale packet with sequence number",r);var i,s}acknowledge(t){t.ackTime=performance.now();const e={tag:t.tag,ackTime:t.ackTime,sentTime:t.sendTime,rttTime:t.ackTime-t.sendTime};return this.fire(n.Acknowledge,e),e}writeAckBitfield(t){let e=0;for(const r of t)if(-1!==r.header.sequence){const t=u(this.remoteSequence-r.header.sequence);t<32&&(e|=1<<t)}return e}}function u(t){return(t%65536+65536)%65536}var h,l,f,d=r(20),p=r(16),m=r(5),g=r(8);!function(t){t[t.Free=0]="Free",t[t.Disconnected=1]="Disconnected",t[t.Connected=2]="Connected",t[t.Active=3]="Active",t[t.Background=4]="Background"}(h||(h={})),function(t){t.Connected="con",t.Disconnected="dis",t.Activated="act",t.ServerTimeAdjust="stime",t.ReceiveServerFrame="rsf"}(l||(l={})),function(t){t[t.ServerFrame=0]="ServerFrame",t[t.ClientFrame=1]="ClientFrame",t[t.VisChange=2]="VisChange",t[t.ConnectInfo=3]="ConnectInfo",t[t._Count=4]="_Count"}(f||(f={}));Object(o.b)(8>=f._Count,"Don't forget to update the bitmask!");class y{constructor(){this.buffer=[],this.sendParity=0,this.recvParity=0}getMessageForTransmission(t){if(!(this.buffer.length<=0))return Object(o.e)(this.sendTag)||(this.sendTag=t),this.buffer[0]}ack(t){Object(o.e)(this.sendTag)&&Math.abs(t)>=this.sendTag&&(this.buffer.shift(),this.sendTag=void 0)}send(t){t[0]|=(1&this.sendParity)<<3,this.sendParity^=1,this.buffer.push(t)}receive(t){const e=(a.a.peekByte(t)>>3&1)!=this.recvParity;return e||(this.recvParity^=1),e}}class b extends s.a{constructor(t){super(),this.clock=t,this.state=h.Free,this.lastRequestedFrame=-1,this.lastReceivedFrame=-1,this.lastTransmittedFrame=-1,this.lastAcknowledgedFrame=-1,this.lastReceivedTime=-1,this.stats=new p.b,this.userCommands=new d.b,this.reliable=new y}get ping(){return this.stats.minMaxAve[p.a.Ping][2]}initialize(t){Object(o.b)(this.state===h.Free),console.debug(`NetClient: ${this.id} is attempting to connect`),t.on(i.a.Open,()=>{console.debug(`NetClient: ${this.id} connected`),this.state=h.Connected,this.fire(l.Connected)}),t.on(i.a.Close,()=>{console.debug(`NetClient: ${this.id} disconnected`),this.state=h.Disconnected,this.fire(l.Disconnected)}),this.channel=new c,this.channel.on(n.Receive,this.onMessage.bind(this)),this.channel.on(n.Acknowledge,this.onAck.bind(this)),this.channel.initialize(t),this.stats.initialize()}async connect(t){const e=new i.b;await e.connect(t),this.id=e.clientId,this.initialize(e)}accept(t){this.id=t.peerId,this.initialize(t)}close(){this.state=h.Disconnected,this.channel.close()}setNetGraphPanel(t){this.graphPanel=t}setSimStream(t){this.simStream=t}transmitReliable(t){const e=-(this.lastTransmittedFrame+1+t),r=this.reliable.getMessageForTransmission(e);if(!r)return!0;console.debug("Transmitting reliable message");const n=this.channel.allocatePacket();return n.write(r),this.channel.send(n,e),!1}transmitClientFrame(t,e){Object(o.b)(t===e.frame),this.userCommands.setUserCommand(e);const r=this.channel.allocatePacket(),n=this.reliable.getMessageForTransmission(t);n&&r.write(n),this.sendClientFrame(r,t,e),this.channel.send(r,t),this.lastTransmittedFrame=t,this.channel.computeStats(this.stats)}sendClientFrame(t,e,r){let n=f.ClientFrame,i=0;const s=a.a.writeChar(t,n);a.a.writeInt(t,e);const c=Math.max(this.lastAcknowledgedFrame,e-5,0);for(let r=e;r>=c;r--){const e=this.userCommands.getUserCommand(r);if(!Object(o.e)(e))break;Object(o.b)(e.frame===r),i+=1,d.a.serialize(t,e)}n|=i<<4,t.data[s]=n}receiveClientFrame(t,e){const r=a.a.readByte(t)>>4,n=a.a.readInt(t);for(let e=0;e<r;e++){const r={};if(d.a.deserialize(r,t),r.frame=n-e,this.userCommands.setUserCommand(r)&&this.graphPanel){const t=0===e?p.d.Received:p.d.Filled,n=r.frame<=this.lastRequestedFrame?p.d.Late:t;this.graphPanel.setPacketStatus(r.frame,n)}}this.lastReceivedFrame=n,this.lastReceivedTime=e}transmitServerFrame(t){const e=this.simStream.getState(t),r=this.lastReceivedFrame-this.lastRequestedFrame,n=this.channel.allocatePacket(),i=this.reliable.getMessageForTransmission(t);i&&n.write(i);let s=f.ServerFrame;s|=(15&Object(m.c)(r,-8,7))<<4,a.a.writeByte(n,s);const o=this.lastReceivedTime>0?performance.now()-this.lastReceivedTime:0,c=Object(m.c)(Math.round(o/this.clock.simDt*255),0,255);a.a.writeByte(n,c);const u=this.clock.getCurrentServerTime()-this.clock.serverTime,h=this.clock.serverTime-this.clock.simDt*t;a.a.writeByte(n,Object(m.c)(Math.round(h/this.clock.simDt*255),0,255)),a.a.writeByte(n,Object(m.c)(Math.round(u/this.clock.simDt*255),0,255)),Object(g.f)(n,e),this.channel.send(n,t),this.lastTransmittedFrame=t,this.channel.computeStats(this.stats)}receiveServerFrame(t,e){const r=a.a.readByte(t)>>4,n=r>>3?4294967280|r:r,i=a.a.readByte(t),s=i/255*this.clock.simDt,o=e&&i>0?e.rttTime-s:void 0,c=a.a.readByte(t)/255*this.clock.simDt,u=a.a.readByte(t)/255*this.clock.simDt,h={frame:-1,entities:[]};if(Object(g.e)(t,h),this.lastReceivedFrame=h.frame,o&&(!this.fastestAck||e.rttTime<this.fastestAck.rttTime)){this.fastestAck=e;const t=h.frame*this.clock.simDt+c+u+.5*o;this.fire(l.ServerTimeAdjust,t)}if(this.stats.onReceiveFrame(o,u),this.graphPanel){for(let t=this.lastRequestedFrame+1;t<h.frame;t++)this.simStream.hasState(t)||this.graphPanel.setPacketStatus(t,p.d.Filled);const t=h.frame<=this.lastRequestedFrame?p.d.Late:p.d.Received;this.graphPanel.setPacketStatus(h.frame,t)}this.fire(l.ReceiveServerFrame,n,h)}transmitConnectionInfo(t){let e=0;Object(o.b)(t<8),e|=t<<4,e|=7&f.ConnectInfo;const r=new Uint8Array([e]);this.reliable.send(r)}receiveConnectionInfo(t){this.reliable.receive(t);this.clientIndex=a.a.readByte(t)>>4}transmitVisibilityChange(t){let e=0;t&&(e|=240),e|=7&f.VisChange;const r=new Uint8Array([e]);this.reliable.send(r)}receiveVisibilityChange(t){const e=this.reliable.receive(t),r=(-8&a.a.readByte(t))>0;e||(this.state=r?h.Active:h.Background,console.log(`[Client ${this.id}] Received new visibility status: ${r?"visible":"hidden"}`))}getSimState(t,e){return this.lastRequestedFrame=Math.ceil(t),this.simStream.lerpState(t,e)}getUserCommand(t){this.lastRequestedFrame=t;let e=this.userCommands.getUserCommand(t);return this.state===h.Background?d.c:(Object(o.e)(e)||(console.warn(`[Client ${this.id}] Missing input for frame ${t}`),e=this.userCommands.getUserCommand()),Object(o.c)(e))}onAck(t){if(t.tag>0){const e=t.tag;e>this.lastAcknowledgedFrame&&(this.lastAcknowledgedFrame=e)}this.reliable.ack(t.tag)}onMessage(t,e,r){for(;t.offset<t.data.byteLength;){let n=!1;switch(7&a.a.peekByte(t)){case f.ServerFrame:this.receiveServerFrame(t,e);break;case f.ClientFrame:this.receiveClientFrame(t,r);break;case f.VisChange:this.receiveVisibilityChange(t);break;case f.ConnectInfo:this.receiveConnectionInfo(t);break;default:console.warn("Received unknown message. Ignoring."),n=!0}if(n)break}this.state===h.Connected&&(Object(o.c)(this.clientIndex),this.state=h.Active,this.fire(l.Activated))}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(17);function i(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}Object.assign(i,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,s,o){var a=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3],l=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(h!==p||a!==l||c!==f||u!==d){var m=1-o,g=a*l+c*f+u*d+h*p,y=g>=0?1:-1,b=1-g*g;if(b>Number.EPSILON){var v=Math.sqrt(b),w=Math.atan2(v,g*y);m=Math.sin(m*w)/v,o=Math.sin(o*w)/v}var x=o*y;if(a=a*m+l*x,c=c*m+f*x,u=u*m+d*x,h=h*m+p*x,m===1-o){var _=1/Math.sqrt(a*a+c*c+u*u+h*h);a*=_,c*=_,u*=_,h*=_}}t[e]=a,t[e+1]=c,t[e+2]=u,t[e+3]=h}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,c=o(r/2),u=o(n/2),h=o(i/2),l=a(r/2),f=a(n/2),d=a(i/2);return"XYZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"YXZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"ZXY"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"ZYX"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"YZX"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h-l*f*d):"XZY"===s&&(this._x=l*u*h-c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h+l*f*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],s=r[8],o=r[1],a=r[5],c=r[9],u=r[2],h=r[6],l=r[10],f=n+a+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(h-c)*e,this._y=(s-u)*e,this._z=(o-i)*e):n>a&&n>l?(e=2*Math.sqrt(1+n-a-l),this._w=(h-c)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(s+u)/e):a>l?(e=2*Math.sqrt(1+a-n-l),this._w=(s-u)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(c+h)/e):(e=2*Math.sqrt(1+l-n-a),this._w=(o-i)/e,this._x=(s+u)/e,this._y=(c+h)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(n.a.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,s=t._w,o=e._x,a=e._y,c=e._z,u=e._w;return this._x=r*u+s*o+n*c-i*a,this._y=n*u+s*a+i*o-r*c,this._z=i*u+s*c+r*a-n*o,this._w=s*u-r*o-n*a-i*c,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,s=this._w,o=s*t._w+r*t._x+n*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=r,this._y=n,this._z=i,this;var a=1-o*o;if(a<=Number.EPSILON){var c=1-e;return this._w=c*s+e*this._w,this._x=c*r+e*this._x,this._y=c*n+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),h=Math.atan2(u,o),l=Math.sin((1-e)*h)/u,f=Math.sin(e*h)/u;return this._w=s*l+this._w*f,this._x=r*l+this._x*f,this._y=n*l+this._y*f,this._z=i*l+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}})},function(t,e,r){"use strict";r.d(e,"f",(function(){return f})),r.d(e,"g",(function(){return d})),r.d(e,"e",(function(){return n.b})),r.d(e,"d",(function(){return n.a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return I}));var n=r(4);function i(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function s(t,e,r,n){i.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function o(t,e,r,n){i.call(this,t,e,r,n)}function a(t,e,r,n){i.call(this,t,e,r,n)}Object.assign(i.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var s;r:{n:if(!(t<n)){for(var o=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===o)break;if(i=n,t<(n=e[++r]))break e}s=e.length;break r}if(t>=i)break t;var a=e[1];t<a&&(r=2,i=a);for(o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===o)break;if(n=i,t>=(i=e[--r-1]))break e}s=r,r=0}for(;r<s;){var c=r+s>>>1;t<e[c]?s=c:r=c+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,s=0;s!==n;++s)e[s]=r[i+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(i.prototype,{beforeStart_:i.prototype.copySampleValue_,afterEnd_:i.prototype.copySampleValue_}),s.prototype=Object.assign(Object.create(i.prototype),{constructor:s,DefaultSettings_:{endingStart:n.h,endingEnd:n.h},intervalChanged_:function(t,e,r){var i=this.parameterPositions,s=t-2,o=t+1,a=i[s],c=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case n.i:s=t,a=2*e-r;break;case n.g:a=e+i[s=i.length-2]-i[s+1];break;default:s=t,a=r}if(void 0===c)switch(this.getSettings_().endingEnd){case n.i:o=t,c=2*r-e;break;case n.g:o=1,c=r+i[1]-i[0];break;default:o=t-1,c=e}var u=.5*(r-e),h=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(c-r),this._offsetPrev=s*h,this._offsetNext=o*h},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,u=this._offsetPrev,h=this._offsetNext,l=this._weightPrev,f=this._weightNext,d=(r-e)/(n-e),p=d*d,m=p*d,g=-l*m+2*l*p-l*d,y=(1+l)*m+(-1.5-2*l)*p+(-.5+l)*d+1,b=(-1-f)*m+(1.5+f)*p+.5*d,v=f*m-f*p,w=0;w!==o;++w)i[w]=g*s[u+w]+y*s[c+w]+b*s[a+w]+v*s[h+w];return i}}),o.prototype=Object.assign(Object.create(i.prototype),{constructor:o,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,u=(r-e)/(n-e),h=1-u,l=0;l!==o;++l)i[l]=s[c+l]*h+s[a+l]*u;return i}}),a.prototype=Object.assign(Object.create(i.prototype),{constructor:a,interpolate_:function(t){return this.copySampleValue_(t-1)}});var c={arraySlice:function(t,e,r){return c.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),s=0,o=0;o!==n;++s)for(var a=r[s]*e,c=0;c!==e;++c)i[o++]=t[a+c];return i},flattenJSON:function(t,e,r,n){for(var i=1,s=t[0];void 0!==s&&void 0===s[n];)s=t[i++];if(void 0!==s){var o=s[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=s[n])&&(e.push(s.time),r.push.apply(r,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{void 0!==(o=s[n])&&(e.push(s.time),o.toArray(r,r.length)),s=t[i++]}while(void 0!==s);else do{void 0!==(o=s[n])&&(e.push(s.time),r.push(o)),s=t[i++]}while(void 0!==s)}},subclip:function(t,e,r,n,i){i=i||30;var s=t.clone();s.name=e;for(var o=[],a=0;a<s.tracks.length;++a){for(var u=s.tracks[a],h=u.getValueSize(),l=[],f=[],d=0;d<u.times.length;++d){var p=u.times[d]*i;if(!(p<r||p>=n)){l.push(u.times[d]);for(var m=0;m<h;++m)f.push(u.values[d*h+m])}}0!==l.length&&(u.times=c.convertArray(l,u.times.constructor),u.values=c.convertArray(f,u.values.constructor),o.push(u))}s.tracks=o;var g=1/0;for(a=0;a<s.tracks.length;++a)g>s.tracks[a].times[0]&&(g=s.tracks[a].times[0]);for(a=0;a<s.tracks.length;++a)s.tracks[a].shift(-1*g);return s.resetDuration(),s}};function u(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=c.convertArray(e,this.TimeBufferType),this.values=c.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}Object.assign(u,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:c.convertArray(t.times,Array),values:c.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(u.prototype,{constructor:u,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:n.b,InterpolantFactoryMethodDiscrete:function(t){return new a(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new o(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new s(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case n.a:e=this.InterpolantFactoryMethodDiscrete;break;case n.b:e=this.InterpolantFactoryMethodLinear;break;case n.c:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n.a;case this.InterpolantFactoryMethodLinear:return n.b;case this.InterpolantFactoryMethodSmooth:return n.c}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,s=n-1;i!==n&&r[i]<t;)++i;for(;-1!==s&&r[s]>e;)--s;if(++s,0!==i||s!==n){i>=s&&(i=(s=Math.max(s,1))-1);var o=this.getValueSize();this.times=c.arraySlice(r,i,s),this.values=c.arraySlice(this.values,i*o,s*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,o=0;o!==i;o++){var a=r[o];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==s&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),t=!1;break}s=a}if(void 0!==n&&c.isTypedArray(n)){o=0;for(var u=n.length;o!==u;++o){var h=n[o];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,h),t=!1;break}}}return t},optimize:function(){for(var t=c.arraySlice(this.times),e=c.arraySlice(this.values),r=this.getValueSize(),i=this.getInterpolation()===n.c,s=1,o=t.length-1,a=1;a<o;++a){var u=!1,h=t[a];if(h!==t[a+1]&&(1!==a||h!==h[0]))if(i)u=!0;else for(var l=a*r,f=l-r,d=l+r,p=0;p!==r;++p){var m=e[l+p];if(m!==e[f+p]||m!==e[d+p]){u=!0;break}}if(u){if(a!==s){t[s]=t[a];var g=a*r,y=s*r;for(p=0;p!==r;++p)e[y+p]=e[g+p]}++s}}if(o>0){t[s]=t[o];for(g=o*r,y=s*r,p=0;p!==r;++p)e[y+p]=e[g+p];++s}return s!==t.length?(this.times=c.arraySlice(t,0,s),this.values=c.arraySlice(e,0,s*r)):(this.times=t,this.values=e),this},clone:function(){var t=c.arraySlice(this.times,0),e=c.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}});var h=r(14);function l(t,e,r,n){i.call(this,t,e,r,n)}function f(t,e,r,n){u.call(this,t,e,r,n)}function d(t,e,r,n){u.call(this,t,e,r,n)}function p(t,e,r){u.call(this,t,e,r)}function m(t,e,r,n){u.call(this,t,e,r,n)}function g(t,e,r,n){u.call(this,t,e,r,n)}function y(t,e,r,n){u.call(this,t,e,r,n)}l.prototype=Object.assign(Object.create(i.prototype),{constructor:l,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=(r-e)/(n-e),u=a+o;a!==u;a+=4)h.a.slerpFlat(i,0,s,a-o,s,a,c);return i}}),f.prototype=Object.assign(Object.create(u.prototype),{constructor:f,ValueTypeName:"quaternion",DefaultInterpolation:n.b,InterpolantFactoryMethodLinear:function(t){return new l(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),d.prototype=Object.assign(Object.create(u.prototype),{constructor:d,ValueTypeName:"vector"}),p.prototype=Object.assign(Object.create(u.prototype),{constructor:p,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:n.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),m.prototype=Object.assign(Object.create(u.prototype),{constructor:m,ValueTypeName:"color"}),g.prototype=Object.assign(Object.create(u.prototype),{constructor:g,ValueTypeName:"number"}),y.prototype=Object.assign(Object.create(u.prototype),{constructor:y,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:n.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});var b=r(17);function v(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=b.a.generateUUID(),this.duration<0&&this.resetDuration()}function w(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return g;case"vector":case"vector2":case"vector3":case"vector4":return d;case"color":return m;case"quaternion":return f;case"bool":case"boolean":return p;case"string":return y}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],n=[];c.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function x(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var i=e.tracks,s=i.length,o=new Array(s),a={endingStart:n.h,endingEnd:n.h},c=0;c!==s;++c){var u=i[c].createInterpolant(null);o[c]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n.f,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(v,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,s=r.length;i!==s;++i)e.push(w(r[i]).scale(n));return new v(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,s=r.length;i!==s;++i)e.push(u.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,s=[],o=0;o<i;o++){var a=[],u=[];a.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);var h=c.getKeyframeOrder(a);a=c.sortedArray(a,1,h),u=c.sortedArray(u,1,h),n||0!==a[0]||(a.push(i),u.push(u[0])),s.push(new g(".morphTargetInfluences["+e[o].name+"]",a,u).scale(1/r))}return new v(t,-1,s)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===e)return r[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,s=0,o=t.length;s<o;s++){var a=t[s],c=a.name.match(i);if(c&&c.length>1){var u=n[l=c[1]];u||(n[l]=u=[]),u.push(a)}}var h=[];for(var l in n)h.push(v.CreateFromMorphTargetSequence(l,n[l],e,r));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var s=[],o=[];c.flattenJSON(r,s,o,n),0!==s.length&&i.push(new t(e,s,o))}},n=[],i=t.name||"default",s=t.length||-1,o=t.fps||30,a=t.hierarchy||[],u=0;u<a.length;u++){var h=a[u].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var l={},p=0;p<h.length;p++)if(h[p].morphTargets)for(var m=0;m<h[p].morphTargets.length;m++)l[h[p].morphTargets[m]]=-1;for(var y in l){var b=[],w=[];for(m=0;m!==h[p].morphTargets.length;++m){var x=h[p];b.push(x.time),w.push(x.morphTarget===y?1:0)}n.push(new g(".morphTargetInfluence["+y+"]",b,w))}s=l.length*(o||1)}else{var _=".bones["+e[u].name+"]";r(d,_+".position",h,"pos",n),r(f,_+".quaternion",h,"rot",n),r(d,_+".scale",h,"scl",n)}}return 0===n.length?null:new v(i,s,n)}}),Object.assign(v.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new v(this.name,this.duration,t)}}),Object.assign(x.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,s=i/n,o=n/i;t.warp(1,s,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,s=this._timeScaleInterpolant,o=this.timeScale;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);var a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+r,c[0]=t/o,c[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var s=(t-i)*r;if(s<0||0===r)return;this._startTime=null,e=r*s}e*=this._updateTimeScale(t);var o=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var c=this._interpolants,u=this._propertyBindings,h=0,l=c.length;h!==l;++h)c[h].evaluate(o),u[h].accumulate(n,a)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,i=this.loop,s=this._loopCount,o=i===n.e;if(0===t)return-1===s?e:o&&1==(1&s)?r-e:e;if(i===n.d){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var a=Math.floor(e/r);e-=r*a,s+=Math.abs(a);var c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===c){var u=t<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(o&&1==(1&s))return r-e}return e},_setEndings:function(t,e,r){var i=this._interpolantSettings;r?(i.endingStart=n.i,i.endingEnd=n.i):(i.endingStart=t?this.zeroSlopeAtStart?n.i:n.h:n.g,i.endingEnd=e?this.zeroSlopeAtEnd?n.i:n.h:n.g)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);var o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=r,this}});var _=r(35),M=new RegExp("[\\[\\]\\.:\\/]","g"),C="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",A=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),S=/(WCOD+)?/.source.replace("WCOD",C),k=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),T=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),F=new RegExp("^"+A+S+k+T+"$"),O=["material","materials","bones"];function E(t,e,r){var n=r||j.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function j(t,e,r){this.path=e,this.parsedPath=r||j.parseTrackName(e),this.node=j.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function B(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function I(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Object.assign(E.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(j,{Composite:E,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new j.Composite(t,e,r):new j(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(M,"")},parseTrackName:function(t){var e=F.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==O.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var s=n(i.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(j.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=j.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var s=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var a=t[n];if(void 0!==a){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(j.prototype,{_getValue_unbound:j.prototype.getValue,_setValue_unbound:j.prototype.setValue}),Object.assign(B.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,s=this.cumulativeWeight;if(0===s){for(var o=0;o!==n;++o)r[i+o]=r[o];s=e}else{var a=e/(s+=e);this._mixBufferRegion(r,i,0,a,n)}this.cumulativeWeight=s},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,s=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*e;this._mixBufferRegion(r,n,o,1-i,e)}for(var a=e,c=e+e;a!==c;++a)if(r[a]!==r[a+e]){s.setValue(r,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,n=3*r;t.getValue(e,n);for(var i=r,s=n;i!==s;++i)e[i]=e[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,r,n,i){if(n>=.5)for(var s=0;s!==i;++s)t[e+s]=t[r+s]},_slerp:function(t,e,r,n){h.a.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var s=1-n,o=0;o!==i;++o){var a=e+o;t[a]=t[a]*s+t[r+o]*n}}}),I.prototype=Object.assign(Object.create(_.a.prototype),{constructor:I,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,s=t._propertyBindings,o=t._interpolants,a=r.uuid,c=this._bindingsByRootAndName,u=c[a];void 0===u&&(u={},c[a]=u);for(var h=0;h!==i;++h){var l=n[h],f=l.name,d=u[f];if(void 0!==d)s[h]=d;else{if(void 0!==(d=s[h])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,a,f));continue}var p=e&&e._propertyBindings[h].binding.parsedPath;++(d=new B(j.create(r,f,p),l.ValueTypeName,l.getValueSize())).referenceCount,this._addInactiveBinding(d,a,f),s[h]=d}o[h].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,s=0,o=i.length;s!==o;++s){var a=i[s];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{var o=s.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,c=a[a.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,a[u]=c,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],s=this._bindings;void 0===i&&(i={},n[e]=i),i[r]=t,t._cacheIndex=s.length,s.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,s=this._bindingsByRootAndName,o=s[n],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new o(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?v.findByName(r,t):t,s=null!==i?i.uuid:t,o=this._actionsByClip[s],a=null;if(void 0!==o){var c=o.actionByRoot[n];if(void 0!==c)return c;a=o.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var u=new x(this,i,e);return this._bindAction(u,a),this._addInactiveAction(u,s,n),u},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?v.findByName(r,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1,o=0;o!==r;++o){e[o]._update(n,t,i,s)}var a=this._bindings,c=this._nActiveBindings;for(o=0;o!==c;++o)a[o].apply(s);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var s=i.knownActions,o=0,a=s.length;o!==a;++o){var c=s[o];this._deactivateAction(c);var u=c._cacheIndex,h=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,e[u]=h,e.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var s=this._bindingsByRootAndName[e];if(void 0!==s)for(var o in s){var a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}})},function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"c",(function(){return o})),r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return c}));var n,i,s=r(0);!function(t){t[t.Missing=0]="Missing",t[t.Received=1]="Received",t[t.Filled=2]="Filled",t[t.Late=3]="Late"}(n||(n={}));class o{constructor(){this.enabled=!1;const t=document.createElement("div");t.style.cssText="opacity:0.9;z-index:10000;pointer-events:none;display:none",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}removePanel(t){this.dom.removeChild(t.dom)}addPanel(t){const e=Math.round(window.devicePixelRatio||1),r=3*e,i=15*e,o=3*e,a=2*e,c=64*(10*e),u=30*e,h=2*r+c,l=48*e,f="#222",d=document.createElement("canvas");d.height=l,d.width=h,d.style.cssText=`height:${Math.round(l/e)}px;width:${Math.round(h/e)}px`;const p=Object(s.c)(d.getContext("2d"));p.font="bold "+9*e+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=f,p.fillRect(0,0,h,l),p.fillStyle="#EEE",p.fillText(t,o,a),this.dom.appendChild(d);const m=this,g=new Array(64).fill(n.Missing);let y=0;return{dom:d,setPacketStatus(t,e){t>y-64&&t<y&&(g[t%64]=e)},update(t,e,l,d){if(!m.enabled)return;p.fillStyle=f,p.fillRect(r,i,c,u);const b=Math.floor(e/16)-32,v=b+64-1;let w=b;for(;w<=v;){const t=16*w,s=Math.round(((t-e)/1024+.5)*c),o=r+s;if(w+=1,w>y&&(g[w%64]=n.Missing),s>0&&s<c){switch(p.fillStyle="grey",p.fillRect(o-1,i,2,u),g[w%64]){case n.Missing:continue;case n.Received:p.fillStyle="green";break;case n.Filled:p.fillStyle="yellow";break;case n.Late:p.fillStyle="purple";break;default:p.fillStyle="red"}const t=4,e=Math.min(t,o-r);p.fillRect(o-e,i+.25*u,e+t,.5*u)}}p.fillStyle="red";const x=r+.5*c;p.fillRect(x,i,4,u),p.fillStyle="yellow";const _=r+((d-e)/1024+.5)*c;p.fillRect(_,i,4,u),p.fillStyle="purple";const M=r+((l-e)/1024+.5)*c;if(p.fillRect(M,i,4,u),y=v,Object(s.e)(t)){const e=t.toFixed(1).padStart(5);p.fillStyle=f,p.fillRect(o+.5*h,a,.5*h,i-a),p.fillStyle="#EEE",p.textAlign="right",p.fillText(`Ping: ${e}`,h-o,a)}}}}}!function(t){t[t.Ping=0]="Ping",t[t.Rtt=1]="Rtt",t[t.Vrtn=2]="Vrtn",t[t.Loss=3]="Loss",t[t.Dur=4]="Dur",t[t.Delay=5]="Delay",t[t.Ahead=6]="Ahead",t[t.Down=7]="Down",t[t.Up=8]="Up",t[t._Count=9]="_Count"}(i||(i={}));const a={[i.Ping]:{name:"Ping",unit:"ms",color:"aqua"},[i.Rtt]:{name:"RTT",unit:"ms",color:"cornflowerblue"},[i.Vrtn]:{name:"Net Vrtn",unit:"ms",color:"white"},[i.Dur]:{name:"Srv Tick",unit:"ms",color:"mediumpurple"},[i.Loss]:{name:"Pkt Loss",unit:"%",color:"darkorange"},[i.Down]:{name:"Down",unit:"Kbps",color:"greenyellow"},[i.Up]:{name:"Up",unit:"Kbps",color:"hotpink"}};class c{constructor(){this.minMaxAve=[],this.history=[],this.window=187.5,this.domMinMaxAve=[],this.enabled=!1;for(let t=0;t<i._Count;t++)this.minMaxAve[t]=[],this.history[t]=[],this.domMinMaxAve[t]=[];const t=document.createElement("div");t.style.cssText="\n            display:none;\n            font-family: Monaco, monospace;\n            font-size: 9pt;\n            background:rgba(50,50,50,0.8);\n            opacity:0.9;\n            z-index:10000;\n            pointer-events:none;\n            color:white",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}initialize(){const t=document.createElement("table");t.id="NetStats",t.style.tableLayout="fixed",t.style.borderSpacing="9pt";const e=document.styleSheets[0];e.insertRule("#NetStats>tr>:nth-child(2) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(4) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(5) { opacity: 0.7; }");let r=document.createElement("tr");r.appendChild(document.createElement("th")),r.appendChild(document.createElement("th")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   avg   ")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   min   ")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   max   ")),t.appendChild(r);for(const e in a){const r=Number.parseInt(e),n=Object(s.c)(a[r]);let i=document.createElement("tr");i.style.color=n.color,i.appendChild(document.createElement("td")).innerText=n.name,i.appendChild(document.createElement("td")).innerText=n.unit,this.domMinMaxAve[r][2]=i.appendChild(document.createElement("td")),this.domMinMaxAve[r][0]=i.appendChild(document.createElement("td")),this.domMinMaxAve[r][1]=i.appendChild(document.createElement("td")),t.appendChild(i)}this.dom.appendChild(t)}onReceiveFrame(t,e){if(!Object(s.e)(t)){const e=this.history[i.Ping];t=Object(s.d)(e[e.length-1],0)}const r=this.minMaxAve[i.Ping][2],n=Object(s.e)(r)?(t-r)**2:0;this.history[i.Vrtn].push(n),this.history[i.Ping].push(t),this.history[i.Dur].push(e)}onNetChannelSample(t,e,r,n){this.history[i.Loss].push(t),this.history[i.Rtt].push(e),this.history[i.Up].push(r),this.history[i.Down].push(n)}update(){var t,e,r;for(const t of this.history)for(;t.length>this.window;)t.shift();if(!this.enabled)return;if(0!==this.history[0].length)for(const n in a){const o=Number.parseInt(n);this.minMaxAve[o][0]=Math.min(...this.history[o]),this.minMaxAve[o][1]=Math.max(...this.history[o]),this.minMaxAve[o][2]=this.history[o].reduce((t,e)=>t+e,0)/this.history[o].length,o===i.Vrtn&&(this.minMaxAve[o][0]=Math.sqrt(this.minMaxAve[o][0]),this.minMaxAve[o][1]=Math.sqrt(this.minMaxAve[o][1]),this.minMaxAve[o][2]=Math.sqrt(this.minMaxAve[o][2]));const a=Object(s.d)(null===(t=this.minMaxAve[o][0])||void 0===t?void 0:t.toFixed(1),""),c=Object(s.d)(null===(e=this.minMaxAve[o][1])||void 0===e?void 0:e.toFixed(1),""),u=Object(s.d)(null===(r=this.minMaxAve[o][2])||void 0===r?void 0:r.toFixed(1),"");this.domMinMaxAve[o][0].innerText=a,this.domMinMaxAve[o][1].innerText=c,this.domMinMaxAve[o][2].innerText=u}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));for(var n=[],i=0;i<256;i++)n[i]=(i<16?"0":"")+i.toString(16);var s={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&e]+n[e>>8&255]+"-"+n[e>>16&15|64]+n[e>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&i]+n[i>>8&255]+n[i>>16&255]+n[i>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*s.DEG2RAD},radToDeg:function(t){return t*s.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,r,n,i){var s=Math.cos,o=Math.sin,a=s(r/2),c=o(r/2),u=s((e+n)/2),h=o((e+n)/2),l=s((e-n)/2),f=o((e-n)/2),d=s((n-e)/2),p=o((n-e)/2);"XYX"===i?t.set(a*h,c*l,c*f,a*u):"YZY"===i?t.set(c*f,a*h,c*l,a*u):"ZXZ"===i?t.set(c*l,c*f,a*h,a*u):"XZX"===i?t.set(a*h,c*p,c*d,a*u):"YXY"===i?t.set(c*d,a*h,c*p,a*u):"ZYZ"===i?t.set(c*p,c*d,a*h,a*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return c}));var n=r(1),i=r(0),s=r(11);class o{constructor(t,e,r,n){this.shader=r,this.name=e,this.layout=n,this.resources=t.createResourceTable(this.layout),this.bindings={}}destroy(t){t.removeResourceTable(this.resources)}assertReady(){for(const t of Object.keys(this.layout))Object(i.c)(this.bindings[t],`Material expects a binding for ${t}`)}getUniformBuffer(t){const e=this.bindings[t];return Object(i.c)(e,`Uniform buffer "${t}" is not bound to material "${this.name}"`),e}setUniformBuffer(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.UniformBuffer,"Mismatching resource type"),this.bindings[e]=r,t.setBuffer(this.resources,s.index,r.getBufferView())}setTexture(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.Texture,"Mismatching resource type"),Object(i.b)(!Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=r,t.setTexture(this.resources,s.index,r)}setTextureArray(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.Texture,"Mismatching resource type"),Object(i.b)(Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=r,t.setTextures(this.resources,s.index,r)}}class a extends s.b{constructor(t,e,r,n){super(),this.renderList=e,this.mesh=r,this.material=n,this.pipeline=t.createRenderPipeline(n.shader,e.renderFormat,r.vertexLayout,n.layout),this.vertexTable=t.createVertexTable(this.pipeline),r.vertexBuffers.forEach((e,r)=>{t.setVertexBuffer(this.vertexTable,r,e)}),this._primitive={renderPipeline:this.pipeline,resourceTable:this.material.resources,vertexTable:this.vertexTable,elementCount:this.mesh.elementCount,type:this.mesh.primitiveType,indexBuffer:this.mesh.indexBuffer,indexType:this.mesh.indexType}}get primitive(){return this.material.assertReady(),this._primitive}destroy(t){t.removeVertexTable(this.vertexTable),t.removeRenderPipeline(this.pipeline)}}class c extends a{constructor(t,e,r,n){super(t,e,r,n)}bindSkeleton(t,e){this.skeleton=e;const r={type:n.k.Texture2D,format:n.i.F32x4,usage:n.n.Dynamic,width:4,height:e.bones.length,defaultMinFilter:n.j.Nearest,defaultMagFilter:n.j.Nearest};this.boneTex=t.createTexture("BoneTex",r,this.skeleton.boneMatrices)}writeBonesToTex(t){return t.writeTextureData(this.boneTex,this.skeleton.boneMatrices),this.boneTex}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s}));const n="05b94d374dd887353ee16a8b340f2e3948e0648c",i=(n.slice(0,8),`https://github.com/themikelester/MoonDuel/tree/${n}`),s=!1},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return o})),r.d(e,"b",(function(){return a}));var n=r(0),i=r(3);class s{static serialize(t,e){const r=Math.atan2(e.headingZ,e.headingX);i.a.writeAngle16(t,r);let n=0;return n|=3&Math.sign(e.verticalAxis)+1<<0,n|=12&Math.sign(e.horizontalAxis)+1<<2,n|=240&e.actions<<4,i.a.writeByte(t,n),3}static deserialize(t,e){const r=i.a.readAngle16(e);t.headingX=Math.cos(r),t.headingZ=Math.sin(r);let n=i.a.readByte(e);return t.verticalAxis=((3&n)>>0)-1,t.horizontalAxis=((12&n)>>2)-1,t.actions=(240&n)>>4,3}}const o={frame:-1,headingX:0,headingZ:1,verticalAxis:0,horizontalAxis:0,actions:0};new TextEncoder,new TextDecoder;class a{constructor(){this.buffer=[],this.bufferSize=64,this.lastFrame=-1}setUserCommand(t){Object(n.b)(Number.isInteger(t.frame));const e=this.buffer[t.frame%this.bufferSize];return(!Object(n.e)(e)||e.frame!==t.frame)&&(this.buffer[t.frame%this.bufferSize]=t,this.lastFrame=t.frame,!0)}getUserCommand(t=this.lastFrame){if(Object(n.b)(Number.isInteger(t)),-1===t)return Object.assign(Object.assign({},o),{frame:t});const e=this.buffer[t%this.bufferSize];return Object(n.e)(e)&&e.frame===t?e:void 0}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return c})),r.d(e,"b",(function(){return u}));var n,i=r(10),s=r(30),o=r(0),a=r(19);!function(t){t.Open="open",t.Close="close",t.Message="message"}(n||(n={}));class c extends i.a{constructor(t){super(),this.signalSocket=t}async listen(t){this.signalSocket.on(s.b.Message,this.onMessage.bind(this,t)),this.iceServers=await this.signalSocket.requestIceServers()}async onMessage(t,e,r){console.debug("WebUDP: Received message",e),Object(o.c)(e.offer,"Expected an offer");const n=new u;n.accept(this.signalSocket,e,r),t(n)}}class u extends i.a{get isOpen(){return this.channel&&"open"===this.channel.readyState}connect(t){Object(o.b)(!Object(o.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=t;const e=new s.a,r=e.connect().then(()=>{this.clientId=e.clientId});return r.then(async()=>{const t=a.b?{}:await e.requestIceServers();this.peer=this.createPeer(t),this.peer.onconnectionstatechange=()=>{switch(this.peer.connectionState){case"connected":case"disconnected":break;case"failed":case"closed":this.close()}};const r=this.getIceCandidates(),n=this.peer.createDataChannel("webudp",{ordered:!1,maxRetransmits:0});this.setDataChannel(n);const i=await this.peer.createOffer();await this.peer.setLocalDescription(i),await r;const c={offer:Object(o.c)(this.peer.localDescription)};e.send(this.peerId,c),e.once(s.b.Message,(t,r)=>{Object(o.c)(t.answer,'Expected "answer" message from remote peer');console.debug("WebUDP: Received answer",t.answer),this.peer.setRemoteDescription(t.answer),e.close()})}),r}async accept(t,e,r){Object(o.b)(!Object(o.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=r,this.clientId=t.clientId;const n=a.b?{}:await t.requestIceServers();this.peer=this.createPeer(n);const i=this.getIceCandidates();await this.peer.setRemoteDescription(e.offer);const s=await this.peer.createAnswer();this.peer.setLocalDescription(s),await i,t.send(this.peerId,{answer:this.peer.localDescription}),this.peer.ondatachannel=t=>{this.setDataChannel(t.channel)}}send(t){return!(!this.channel||!this.isOpen)&&(this.channel.send(t),!0)}close(){Object(o.e)(this.peer)&&(this.fire(n.Close),this.channel&&this.channel.close(),this.peer&&this.peer.close(),this.peer=null,this.channel=null)}createPeer(t){return new RTCPeerConnection(t)}onDataChannelOpen(){console.debug("WebUDP: DataChannel open"),this.fire(n.Open)}onDataChannelClosed(){console.debug("WebUDP: DataChannel closed"),this.close()}onDataChannelError(t){var e;"closed"!==(null===(e=this.channel)||void 0===e?void 0:e.readyState)&&console.error("WebUdpPeer: Data channel error:",t.error)}setDataChannel(t){t.binaryType="arraybuffer",t.onopen=this.onDataChannelOpen.bind(this),t.onclose=this.onDataChannelClosed.bind(this),t.onerror=this.onDataChannelError.bind(this),t.onmessage=t=>{this.fire(n.Message,t)},this.channel=t}getIceCandidates(){return new Promise(t=>{const e=[];this.peer.onicecandidate=r=>{r.candidate?(console.debug("WebUDP: Received ICE candidate",r.candidate),e.push(r.candidate)):(console.debug("WebUDP: Received all ICE candidates"),t(e))}})}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(1),i=r(7);class s{constructor(t){this.renderer=t}initialize(){this.buffer=new i.a("GlobalUniforms",this.renderer,s.bufferLayout),this.bufferView=this.buffer.getBufferView()}update(){this.buffer.write(this.renderer)}}s.bufferLayout=Object(i.b)({g_camPos:{type:n.m.Float3},g_proj:{type:n.m.Float4x4},g_viewProj:{type:n.m.Float4x4}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return x})),r.d(e,"b",(function(){return M}));var n=r(0),i=r(10);const s={passive:!1,capture:!1};class o{constructor(t){var e=this.getTouchTargetCoords(t);this.x=e.x,this.y=e.y,this.id=t.identifier,this.target=t.target,this.touch=t}getTouchTargetCoords(t){for(var e=0,r=0,i=t.target;!(i instanceof HTMLElement);)i=Object(n.c)(i.parentNode);var s=i;do{e+=s.offsetLeft-s.scrollLeft,r+=s.offsetTop-s.scrollTop,s=s.offsetParent}while(s);return{x:t.pageX-e,y:t.pageY-r}}}class a{constructor(t,e){if(this.element=e.target,this.event=e,this.touches=[],this.changedTouches=[],e){var r,n=e.touches.length;for(r=0;r<n;r++)this.touches.push(new o(e.touches[r]));for(n=e.changedTouches.length,r=0;r<n;r++)this.changedTouches.push(new o(e.changedTouches[r]))}}getTouchById(t,e){var r,n=e.length;for(r=0;r<n;r++)if(e[r].id===t)return e[r];return null}}class c extends i.a{constructor(t){super(),this.element=void 0,this.onStart=t=>{t.preventDefault(),this.fire("touchstart",new a(this,t))},this.onEnd=t=>{t.preventDefault(),this.fire("touchend",new a(this,t))},this.onCancel=t=>{this.fire("touchcancel",new a(this,t))},this.onMove=t=>{t.preventDefault(),this.fire("touchmove",new a(this,t))},this.attach(t)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("touchstart",this.onStart,s),this.element.addEventListener("touchend",this.onEnd,s),this.element.addEventListener("touchmove",this.onMove,s),this.element.addEventListener("touchcancel",this.onCancel,s)}detach(){this.element&&(this.element.removeEventListener("touchstart",this.onStart,s),this.element.removeEventListener("touchend",this.onEnd,s),this.element.removeEventListener("touchmove",this.onMove,s),this.element.removeEventListener("touchcancel",this.onCancel,s)),this.element=void 0}registerAxis(t){let e,r,i;const s={value:0,options:t},o=t.source===b.TouchDragX?"x":"y";return this.on("touchstart",a=>{if(a.touches.length-1===Object(n.d)(t.index,0)){const t=a.changedTouches[0];e=t.id,r=performance.now(),i=t[o],s.value=0}}),this.on("touchend",t=>{const a=t.changedTouches.find(t=>t.id===e);if(Object(n.e)(a)){const n=t.changedTouches[0];e=n.id,r=performance.now(),i=n[o],s.value=0}}),this.on("touchmove",t=>{const a=t.changedTouches.find(t=>t.id===e);if(Object(n.e)(a)){const t=a[o],e=performance.now(),n=t-i;s.value=n,r=e}}),s}}class u extends i.a{constructor(t,e={}){super(),this.keysDown=new Map,this.handleKeyDown=this.onKeyDown.bind(this),this.handleKeyUp=this.onKeyUp.bind(this),this.attach(t),this.preventDefault=Object(n.d)(e.preventDefault,!1),this.stopPropagation=Object(n.d)(e.stopPropagation,!1)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("keydown",this.handleKeyDown,!1),this.element.addEventListener("keyup",this.handleKeyUp,!1)}detach(){this.element&&(this.element.removeEventListener("keydown",this.handleKeyDown),this.element.removeEventListener("keyup",this.handleKeyUp),this.element=void 0)}onKeyDown(t){var e=t.code;t.repeat||void 0!==e&&(this.keysDown.set(e,!0),this.fire("keydown",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}onKeyUp(t){var e=t.code;void 0!==e&&(this.keysDown.delete(e),this.fire("keyup",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}update(){this.keysDown.forEach((t,e)=>{this.keysDown.set(e,!1)})}isPressed(t){return this.keysDown.has(t)}wasPressed(t){return!!this.keysDown.get(t)}clear(){this.fire("clear",event),this.keysDown.clear()}}var h,l,f=r(27),d=r.n(f);!function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"}(h||(h={})),function(t){t.MouseUp="mouseup",t.MouseDown="mousedown",t.MouseMove="mousemove",t.MouseWheel="mousewheel"}(l||(l={}));const p={passive:!1,capture:!1};class m{constructor(t,e){Object(n.c)(e),Object(n.b)(e instanceof MouseEvent,"Expected MouseEvent");const r=t._getTargetCoords(e);if(r)this.x=r.x,this.y=r.y;else{if(!g.isPointerLocked())return;this.x=0,this.y=0}if(this.wheelDelta=0,"wheel"===e.type){const t=e;t.deltaY>0?this.wheelDelta=1:t.deltaY<0&&(this.wheelDelta=-1)}g.isPointerLocked()?(this.dx=e.movementX||0,this.dy=e.movementY||0):(this.dx=this.x-t._lastX,this.dy=this.y-t._lastY),"mousedown"!==e.type&&"mouseup"!==e.type||(this.button=e.button),this.buttons=t._buttons.slice(0),this.element=e.target,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.event=e}}class g extends i.a{constructor(t){super(),this.attached=!1,this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastButtons=[!1,!1,!1],this.onUp=this.handleUp.bind(this),this.onDown=this.handleDown.bind(this),this.onMove=this.handleMove.bind(this),this.onWheel=this.handleWheel.bind(this),this.onContextMenu=t=>{t.preventDefault()},this.attach(t)}static isPointerLocked(){return!!document.pointerLockElement}attach(t){this.target=t,this.attached||(this.attached=!0,window.addEventListener("mouseup",this.onUp,p),window.addEventListener("mousedown",this.onDown,p),window.addEventListener("mousemove",this.onMove,p),window.addEventListener("wheel",this.onWheel,p))}detach(){this.attached&&(this.attached=!1,this.target=null,window.removeEventListener("mouseup",this.onUp,p),window.removeEventListener("mousedown",this.onDown,p),window.removeEventListener("mousemove",this.onMove,p),window.removeEventListener("wheel",this.onWheel,p))}disableContextMenu(){this.target&&this.target.addEventListener("contextmenu",this.onContextMenu)}enableContextMenu(){this.target&&this.target.removeEventListener("contextmenu",this.onContextMenu)}enablePointerLock(t,e){if(document.body.requestPointerLock){if(t){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}if(e){const t=function(){e(),document.removeEventListener("pointerlockerror",t)};document.addEventListener("pointerlockerror",t,!1)}document.body.requestPointerLock()}else e&&e()}disablePointerLock(t){if(document.exitPointerLock){if(Object(n.e)(t)){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}document.exitPointerLock()}}update(){this._lastButtons[0]=this._buttons[0],this._lastButtons[1]=this._buttons[1],this._lastButtons[2]=this._buttons[2]}isPressed(t){return this._buttons[t]}wasPressed(t){return this._buttons[t]&&!this._lastButtons[t]}wasReleased(t){return!this._buttons[t]&&this._lastButtons[t]}handleUp(t){this._buttons[t.button]=!1;const e=new m(this,t);e.event&&this.fire(l.MouseUp,e)}handleDown(t){this._buttons[t.button]=!0;const e=new m(this,t);e.event&&this.fire(l.MouseDown,e)}handleMove(t){const e=new m(this,t);e.event&&(this.fire(l.MouseMove,e),this._lastX=e.x,this._lastY=e.y)}handleWheel(t){const e=new m(this,t);e.event&&this.fire(l.MouseWheel,e)}_getTargetCoords(t){const e=Object(n.c)(this.target),r=e.getBoundingClientRect(),i=Math.floor(r.left),s=Math.floor(r.top);return t.clientX<i||t.clientX>=i+e.clientWidth||t.clientY<s||t.clientY>=s+e.clientHeight?null:{x:t.clientX-i,y:t.clientY-s}}}class y{constructor(t){this.name=t}}var b;!function(t){t[t.MouseDragX=0]="MouseDragX",t[t.MouseDragY=1]="MouseDragY",t[t.MouseWheel=2]="MouseWheel",t[t.TouchDragX=3]="TouchDragX",t[t.TouchDragY=4]="TouchDragY",t[t.TouchPinch=5]="TouchPinch",t[t.TouchRotate=6]="TouchRotate",t[t.TwoTouchDragX=7]="TwoTouchDragX",t[t.TwoTouchDragY=8]="TwoTouchDragY",t[t.PadLeftStickX=9]="PadLeftStickX",t[t.PadLeftStickY=10]="PadLeftStickY",t[t.PadRightStickX=11]="PadRightStickX",t[t.PadRightStickY=12]="PadRightStickY",t[t.Key=13]="Key"}(b||(b={}));class v{constructor(){this.actions={},this.axes={}}attach(t){this.element=t,Object(n.e)(this.touch)&&this.touch.attach(t),Object(n.e)(this.keyboard)&&this.keyboard.attach(t),Object(n.e)(this.mouse)&&this.mouse.attach(t),window.addEventListener("blur",()=>{this.keyboard.clear()}),d.a.isEnabled&&d.a.onchange(()=>{this.keyboard.clear()})}detach(t){Object(n.e)(this.touch)&&this.touch.detach(),Object(n.e)(this.keyboard)&&this.keyboard.detach(),Object(n.e)(this.mouse)&&this.mouse.detach(),this.element=void 0}disableContextMenu(){this.mouse||this.enableMouse(),this.mouse.disableContextMenu()}enableContextMenu(){this.mouse||this.enableMouse(),this.mouse.enableContextMenu()}updateAxes(){for(const t in this.axes)for(const e of this.axes[t])e.func&&(e.value=e.func())}afterFrame(){this.keyboard&&this.keyboard.update(),this.mouse&&this.mouse.update()}registerKeys(t,e){this.keyboard||this.enableKeyboard(),Object(n.e)(this.actions[t])||(this.actions[t]=new y(name));const r=this.actions[t];Object(n.b)(!Object(n.e)(r.keys),"Action already has key bindings"),r.keys=e}registerMouse(t,e){this.mouse||this.enableMouse(),Object(n.e)(this.actions[t])||(this.actions[t]=new y(name));const r=this.actions[t];Object(n.b)(!Object(n.e)(r.mouseButtons),"Action already has mouse bindings"),r.mouseButtons=e}registerPadButton(t,e,r){Object(n.e)(this.actions[t])||(this.actions[t]=new y(name));const i=this.actions[t];Object(n.b)(!Object(n.e)(i.padButtons),"Action already has mouse bindings"),i.padButtons=e,i.padIndexes=r}registerAxis(t,e){Object(n.e)(this.axes[t])||(this.axes[t]=[]);const r=this.axes[t];switch(e.source){case b.Key:r.push({value:0,options:e,func:()=>{let t=0;return Object(n.e)(e.positiveKey)&&(t+=this.keyboard.isPressed(e.positiveKey)?1:0),Object(n.e)(e.negativeKey)&&(t+=this.keyboard.isPressed(e.negativeKey)?-1:0),t}});break;case b.TouchDragX:case b.TouchDragY:{Object(n.e)(this.touch)||this.enableTouches();const t=this.touch.registerAxis(e);r.push(t)}}}isPressed(t){const e=this.actions[t];if(!Object(n.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.isPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.isPressed(t))return!0;return!1}wasPressed(t){const e=this.actions[t];if(!Object(n.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.wasPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.wasPressed(t))return!0;return!1}getAxis(t){const e=Object(n.c)(this.axes[t],`No axis named "${t}"`);let r=0;for(const t of e)Math.abs(t.value)>Math.abs(r)&&(r=t.options.invert?-t.value:t.value);return r}enableMouse(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.mouse=new g(t)}enableKeyboard(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.keyboard=new u(t)}enableTouches(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.touch=new c(t)}}const w=d.a.isEnabled?d.a:void 0;var x;!function(t){t[t.Walk=1]="Walk",t[t.Fullscreen=2]="Fullscreen",t[t.AttackSide=4]="AttackSide",t[t.AttackVert=8]="AttackVert"}(x||(x={}));const _={[x.Walk]:{id:"walk",name:"Walk",desc:"Hold to walk instead of run"},[x.Fullscreen]:{id:"fullscreen",name:"Toggle Fullscreen",desc:"Toggle fullscreen mode"},[x.AttackSide]:{id:"attackSide",name:"Horizontal Attack",desc:"Attack horizontally"},[x.AttackVert]:{id:"attackVert",name:"Vertical Attack",desc:"Attack vertically"}};class M{constructor(){this.controller=new v}initialize({toplevel:t}){this.controller.attach(t),this.controller.enableMouse(),this.controller.enableTouches(),this.controller.keyboard=new u(window),this.controller.registerAxis("Vertical",{source:b.Key,positiveKey:"KeyW",negativeKey:"KeyS"}),this.controller.registerAxis("Horizontal",{source:b.Key,positiveKey:"KeyD",negativeKey:"KeyA"}),this.controller.registerAxis("Horizontal",{source:b.TouchDragX}),this.controller.registerAxis("Vertical",{source:b.TouchDragY,invert:!0}),this.controller.registerKeys(_[x.Walk].id,["ShiftLeft","ShiftRight"]),this.controller.registerKeys(_[x.Fullscreen].id,["Backslash"]),this.controller.registerKeys(_[x.AttackSide].id,["KeyQ"]),this.controller.registerKeys(_[x.AttackVert].id,["KeyE"]),this.controller.registerMouse(_[x.AttackSide].id,[h.Left]),this.controller.registerMouse(_[x.AttackVert].id,[h.Right]),this.controller.disableContextMenu()}isActive(t){return this.controller.isPressed(t)}wasActive(t){return this.controller.wasPressed(t)}getAxis(t){return this.controller.getAxis(t)}updateFixed({camera:t,clock:e,userCommands:r}){this.controller.updateAxes();const n=Object.keys(_).length;let i=0;for(let t=0;t<n;t++){const e=1<<t;this.isActive(_[e].id)&&(i|=e)}const s={frame:e.simFrame,headingX:t.forward[0],headingZ:t.forward[2],horizontalAxis:this.getAxis("Horizontal"),verticalAxis:this.getAxis("Vertical"),actions:i};r.setUserCommand(s)}afterFrame(){Object(n.e)(w)&&this.wasActive("toggleFullscreen")&&w.toggle(this.controller.element),this.controller.afterFrame()}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return w}));var n=r(7),i=r(1),s=r(2),o=r(22),a=r(0),c=r(9);const u=s.e.fromValues(1,0,0,1),h=s.e.fromValues(0,1,0,1),l=s.e.fromValues(0,0,1,1),f={},d={},p={},m={},g=s.a.create(),y=(new Float32Array(16),s.d.create()),b=new Float32Array(196608),v="\n  precision mediump float;\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    gl_FragColor = v_color;\n  }\n";class w{static setContext(t,e){this.renderer=t,this.globalUniforms=e}static initialize(){const t=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),e=this.renderer.createBuffer("ObbVerts",i.c.Vertex,i.n.Static,t),r=new Uint16Array([0,1,1,3,3,2,2,0,0,4,1,5,3,7,2,6,4,5,5,7,7,6,6,4,0,2,1,1,2,3,1,3,5,5,3,7,4,6,0,0,6,2,2,6,3,3,6,7,4,0,5,5,0,1,5,7,4,4,7,6]),s=this.renderer.createBuffer("ObbIndices",i.c.Index,i.n.Static,r),a=[];for(let t=0;t<32;t++){const e=4*t;a.push(e+0,e+1,e+2,e+2,e+1,e+3)}const c=this.renderer.createBuffer("QuadIndices",i.c.Index,i.n.Static,new Uint16Array(a)),u={buffers:[{stride:12,layout:{a_pos:{type:i.m.Float3,offset:0}}}]},h={blendingEnabled:!0,srcBlendFactor:i.b.Source,dstBlendFactor:i.b.OneMinusSource},l={blendingEnabled:!1},g=this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!0}),y=(this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!1}),this.renderer.createDepthStencilState({depthTestEnabled:!1,depthWriteEnabled:!1}));class b{constructor(){this.name="Obb",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n\n  uniform mat3 u_extents;\n  uniform vec3 u_center;\n\n  uniform mat4 g_viewProj;\n\n  void main()\n  {\n    vec3 pos = u_center + u_extents * a_pos;\n    gl_Position = g_viewProj * vec4(pos, 1.0);\n  }\n",this.fragSource="\n  precision mediump float;\n  uniform lowp vec4 u_color;\n\n  void main()\n  {\n    gl_FragColor = u_color;\n  }\n",this.resourceLayout=b.resourceLayout}}b.uniformLayout=Object(n.b)({u_extents:{type:i.m.Float3x3},u_center:{type:i.m.Float3},u_color:{type:i.m.Float4}}),b.resourceLayout={uniforms:{index:0,type:i.a.UniformBuffer,layout:b.uniformLayout},globalUniforms:{index:1,type:i.a.UniformBuffer,layout:o.a.bufferLayout}},f.shader=this.renderer.createShader(new b),f.pipeline=this.renderer.createRenderPipeline(f.shader,l,u,b.resourceLayout),f.resources=this.renderer.createResourceTable(b.resourceLayout),f.vertTable=this.renderer.createVertexTable(f.pipeline),f.depthState=g,f.uniforms=new n.a("ObbUniforms",this.renderer,b.uniformLayout),f.indexBuffer=s,f.count=0,this.renderer.setVertexBuffer(f.vertTable,0,{buffer:e}),this.renderer.setBuffer(f.resources,0,f.uniforms.getBufferView()),this.renderer.setBuffer(f.resources,1,this.globalUniforms.bufferView);class w{constructor(){this.name="Points",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n  attribute vec4 a_color;\n\n  uniform mat4 g_viewProj;\n\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    v_color = a_color;\n\n    gl_Position = g_viewProj * vec4(a_pos, 1.0);\n    gl_PointSize = 4.0;\n  }\n",this.fragSource=v,this.resourceLayout=w.resourceLayout}}w.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:o.a.bufferLayout}};const x={buffers:[{stride:32,layout:{a_pos:{offset:0,type:i.m.Float3},a_color:{offset:16,type:i.m.Float4}}}]};d.shader=this.renderer.createShader(new w),d.pipeline=this.renderer.createRenderPipeline(d.shader,h,x,w.resourceLayout),d.resources=this.renderer.createResourceTable(w.resourceLayout),d.vertTable=this.renderer.createVertexTable(d.pipeline),d.depthState=y,d.vertexBuffer=this.renderer.createBuffer("PointsVerts",i.c.Vertex,i.n.Dynamic,32768*x.buffers[0].stride),d.count=0,this.renderer.setVertexBuffer(d.resources,0,{buffer:d.vertexBuffer}),this.renderer.setBuffer(d.resources,0,this.globalUniforms.bufferView),m.shader=this.renderer.createShader(new w),m.pipeline=this.renderer.createRenderPipeline(m.shader,h,x,w.resourceLayout),m.resources=this.renderer.createResourceTable(w.resourceLayout),m.vertTable=this.renderer.createVertexTable(m.pipeline),m.depthState=y,m.indexBuffer=c,m.vertexBuffer=this.renderer.createBuffer("QuadVerts",i.c.Vertex,i.n.Dynamic,128*x.buffers[0].stride),m.count=0,this.renderer.setVertexBuffer(m.resources,0,{buffer:m.vertexBuffer}),this.renderer.setBuffer(m.resources,0,this.globalUniforms.bufferView);class _{constructor(){this.name="Sphere",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n\n  // Instanced\n  attribute vec3 a_origin;\n  attribute float a_radius;\n  attribute vec4 a_color;\n\n  uniform mat4 g_viewProj;\n\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    v_color = a_color;\n\n    vec3 pos = a_origin + a_radius * a_pos;\n    gl_Position = g_viewProj * vec4(pos, 1.0);\n  }\n",this.fragSource=v,this.resourceLayout=_.resourceLayout}}_.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:o.a.bufferLayout}};const M={buffers:[{stride:12,layout:{a_pos:{offset:0,type:i.m.Float3}}},{stride:32,layout:{a_origin:{offset:0,type:i.m.Float3},a_radius:{offset:12,type:i.m.Float},a_color:{offset:16,type:i.m.Float4}},stepMode:i.h.Instance}]};p.shader=this.renderer.createShader(new _),p.depthState=g,p.resources=this.renderer.createResourceTable(_.resourceLayout),p.pipeline=this.renderer.createRenderPipeline(p.shader,l,M,_.resourceLayout),p.vertTable=this.renderer.createVertexTable(p.pipeline),p.vertexBuffer=this.renderer.createBuffer("Spheres",i.c.Vertex,i.n.Dynamic,32*M.buffers[1].stride),p.indexBuffer=s,p.count=0,this.renderer.setVertexBuffer(p.vertTable,0,{buffer:e}),this.renderer.setVertexBuffer(p.vertTable,1,{buffer:p.vertexBuffer}),this.renderer.setBuffer(p.resources,0,this.globalUniforms.bufferView)}static renderObbs(t,e=!1,r=u){Object(a.e)(f.pipeline)||this.initialize(),Object(a.b)(t.length<=1,"Drawing multiple OBBs not yet supported. (Need to use multiple uniform buffers)"),f.uniforms.setVec4("u_color",r);for(let e of t){const t=s.a.fromMat4(g,e);f.uniforms.setFloats("u_extents",t),f.uniforms.setVec3("u_center",s.b.getTranslation(y,e))}f.uniforms.write(this.renderer);const n={renderPipeline:f.pipeline,vertexTable:f.vertTable,depthMode:f.depthState,resourceTable:f.resources,indexType:i.m.Ushort,indexBuffer:{buffer:f.indexBuffer,byteOffset:e?48:0},type:e?i.g.Triangles:i.g.Lines,elementCount:e?36:24};c.a.debug.push(n)}static renderLines(t,e=h){Object(a.e)(d.pipeline)||this.initialize(),console.assert(t.length<32768);for(let r=0;r<t.length;r++)b.set(t[r],8*r+0),b.set(e,8*r+4);this.renderer.writeBufferData(d.vertexBuffer,32*d.count,b.subarray(0,8*t.length)),d.count+=t.length}static renderQuads(t,e=h){Object(a.e)(m.pipeline)||this.initialize(),console.assert(4*t.length<32768);for(let r=0;r<t.length;r++)b.set(t[r],8*r+0),b.set(e,8*r+4);this.renderer.writeBufferData(m.vertexBuffer,4*m.count*32,b.subarray(0,8*t.length)),m.count+=t.length/4}static renderSpheres(t,e=l){Object(a.e)(p.pipeline)||this.initialize(),console.assert(t.length<32);for(let r=0;r<t.length;r++)b.set(t[r],8*r+0),b.set(e,8*r+4);this.renderer.writeBufferData(p.vertexBuffer,32*p.count,b.subarray(0,8*t.length)),p.count+=t.length}static flush(){if(d.count>0){const t={renderPipeline:d.pipeline,depthMode:d.depthState,resourceTable:d.resources,vertexTable:d.vertTable,type:i.g.Lines,elementCount:d.count};c.a.debug.push(t),d.count=0}if(p.count>0){const t={renderPipeline:p.pipeline,depthMode:p.depthState,resourceTable:p.resources,vertexTable:p.vertTable,type:i.g.Lines,elementCount:24,instanceCount:p.count,indexBuffer:{buffer:p.indexBuffer},indexType:i.m.Ushort};c.a.debug.push(t),p.count=0}if(m.count>0){const t={renderPipeline:m.pipeline,depthMode:m.depthState,resourceTable:m.resources,vertexTable:m.vertTable,type:i.g.Triangles,elementCount:6*m.count,indexBuffer:{buffer:m.indexBuffer},indexType:i.m.Ushort};c.a.debug.push(t),m.count=0}}}},function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,r){var n,i=r(80),s=r(53),o=r(82),a=r(83),c=r(84);"undefined"!=typeof ArrayBuffer&&(n=r(85));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=u||h;e.protocol=3;var f=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=i(f),p={type:"error",data:"parser error"},m=r(86);function g(t,e,r){for(var n=new Array(t.length),i=a(t.length,r),s=function(t,r,i){e(r,(function(e,r){n[t]=r,i(e,n)}))},o=0;o<t.length;o++)s(o,t[o],i)}e.encodePacket=function(t,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var s=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=t.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=f[t.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return n(o.buffer)}(t,r,i);if(void 0!==m&&s instanceof m)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);if(l)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=new FileReader;return i.onload=function(){e.encodePacket({type:t.type,data:i.result},r,!0,n)},i.readAsArrayBuffer(t.data)}(t,r,n);var i=new Uint8Array(1);i[0]=f[t.type];var s=new m([i.buffer,t.data]);return n(s)}(t,r,i);if(s&&s.base64)return function(t,r){var n="b"+e.packets[t.type]+t.data.data;return r(n)}(t,i);var o=f[t.type];return void 0!==t.data&&(o+=n?c.encode(String(t.data),{strict:!1}):String(t.data)),i(""+o)},e.encodeBase64Packet=function(t,r){var n,i="b"+e.packets[t.type];if(void 0!==m&&t.data instanceof m){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];r(i+t)},s.readAsDataURL(t.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var o=new Uint8Array(t.data),a=new Array(o.length),c=0;c<o.length;c++)a[c]=o[c];n=String.fromCharCode.apply(null,a)}return i+=btoa(n),r(i)},e.decodePacket=function(t,r,n){if(void 0===t)return p;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),r);if(n&&!1===(t=function(t){try{t=c.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return p;var i=t.charAt(0);return Number(i)==i&&d[i]?t.length>1?{type:d[i],data:t.substring(1)}:{type:d[i]}:p}i=new Uint8Array(t)[0];var s=o(t,1);return m&&"blob"===r&&(s=new m([s])),{type:d[i],data:s}},e.decodeBase64Packet=function(t,e){var r=d[t.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=n.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:r,data:i}},e.encodePayload=function(t,r,n){"function"==typeof r&&(n=r,r=null);var i=s(t);if(r&&i)return m&&!l?e.encodePayloadAsBlob(t,n):e.encodePayloadAsArrayBuffer(t,n);if(!t.length)return n("0:");g(t,(function(t,n){e.encodePacket(t,!!i&&r,!1,(function(t){n(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return n(e.join(""))}))},e.decodePayload=function(t,r,n){if("string"!=typeof t)return e.decodePayloadAsBinary(t,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===t)return n(p,0,1);for(var s,o,a="",c=0,u=t.length;c<u;c++){var h=t.charAt(c);if(":"===h){if(""===a||a!=(s=Number(a)))return n(p,0,1);if(a!=(o=t.substr(c+1,s)).length)return n(p,0,1);if(o.length){if(i=e.decodePacket(o,r,!1),p.type===i.type&&p.data===i.data)return n(p,0,1);if(!1===n(i,c+s,u))return}c+=s,a=""}else a+=h}return""!==a?n(p,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,r){if(!t.length)return r(new ArrayBuffer(0));g(t,(function(t,r){e.encodePacket(t,!0,!0,(function(t){return r(null,t)}))}),(function(t,e){var n=e.reduce((function(t,e){var r;return t+(r="string"==typeof e?e.length:e.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),s=0;return e.forEach((function(t){var e="string"==typeof t,r=t;if(e){for(var n=new Uint8Array(t.length),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);r=n.buffer}i[s++]=e?0:1;var a=r.byteLength.toString();for(o=0;o<a.length;o++)i[s++]=parseInt(a[o]);i[s++]=255;for(n=new Uint8Array(r),o=0;o<n.length;o++)i[s++]=n[o]})),r(i.buffer)}))},e.encodePayloadAsBlob=function(t,r){g(t,(function(t,r){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);t=n.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)o[i]=parseInt(s[i]);if(o[s.length]=255,m){var a=new m([e.buffer,o.buffer,t]);r(null,a)}}))}),(function(t,e){return r(new m(e))}))},e.decodePayloadAsBinary=function(t,r,n){"function"==typeof r&&(n=r,r=null);for(var i=t,s=[];i.byteLength>0;){for(var a=new Uint8Array(i),c=0===a[0],u="",h=1;255!==a[h];h++){if(u.length>310)return n(p,0,1);u+=a[h]}i=o(i,2+u.length),u=parseInt(u);var l=o(i,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var f=new Uint8Array(l);l="";for(h=0;h<f.length;h++)l+=String.fromCharCode(f[h])}s.push(l),i=o(i,u)}var d=s.length;s.forEach((function(t,i){n(e.decodePacket(t,r,!0),i,d)}))}},function(t,e,r){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},r=t.exports,n=function(){for(var t,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=r.length,s={};n<i;n++)if((t=r[n])&&t[1]in e){for(n=0;n<t.length;n++)s[r[0][n]]=t[n];return s}return!1}(),i={change:n.fullscreenchange,error:n.fullscreenerror},s={request:function(t){return new Promise(function(r,i){var s=function(){this.off("change",s),r()}.bind(this);this.on("change",s);var o=(t=t||e.documentElement)[n.requestFullscreen]();o instanceof Promise&&o.then(s).catch(i)}.bind(this))},exit:function(){return new Promise(function(t,r){if(this.isFullscreen){var i=function(){this.off("change",i),t()}.bind(this);this.on("change",i);var s=e[n.exitFullscreen]();s instanceof Promise&&s.then(i).catch(r)}else t()}.bind(this))},toggle:function(t){return this.isFullscreen?this.exit():this.request(t)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,r){var n=i[t];n&&e.addEventListener(n,r,!1)},off:function(t,r){var n=i[t];n&&e.removeEventListener(n,r,!1)},raw:n};n?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(e[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[n.fullscreenEnabled])}}}),r?t.exports=s:window.screenfull=s):r?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},function(t,e,r){"use strict";r.d(e,"a",(function(){return S}));var n=r(14),i=r(6),s=r(12),o=r(35),a=r(17),c=new s.a,u=new n.a;function h(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||h.DefaultOrder}function l(){this.mask=1}function f(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}h.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=a.a.clamp,i=t.elements,s=i[0],o=i[4],c=i[8],u=i[1],h=i[5],l=i[9],f=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-f,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(u,s))):"ZYX"===e?(this._y=Math.asin(-n(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===e?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(c,p))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(c,s)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return c.makeRotationFromQuaternion(t),this.setFromRotationMatrix(c,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return u.setFromEuler(this),this.setFromQuaternion(u,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new i.a(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(l.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(f.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,s,o,a,c){var u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=r,u[7]=s,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},extractBasis:function(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],o=r[3],a=r[6],c=r[1],u=r[4],h=r[7],l=r[2],f=r[5],d=r[8],p=n[0],m=n[3],g=n[6],y=n[1],b=n[4],v=n[7],w=n[2],x=n[5],_=n[8];return i[0]=s*p+o*y+a*w,i[3]=s*m+o*b+a*x,i[6]=s*g+o*v+a*_,i[1]=c*p+u*y+h*w,i[4]=c*m+u*b+h*x,i[7]=c*g+u*v+h*_,i[2]=l*p+f*y+d*w,i[5]=l*m+f*b+d*x,i[8]=l*g+f*v+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8];return e*s*u-e*o*c-r*i*u+r*o*a+n*i*c-n*s*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var r=t.elements,n=this.elements,i=r[0],s=r[1],o=r[2],a=r[3],c=r[4],u=r[5],h=r[6],l=r[7],f=r[8],d=f*c-u*l,p=u*h-f*a,m=l*a-c*h,g=i*d+s*p+o*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var y=1/g;return n[0]=d*y,n[1]=(o*l-f*s)*y,n[2]=(u*s-o*c)*y,n[3]=p*y,n[4]=(f*i-o*h)*y,n[5]=(o*a-u*i)*y,n[6]=m*y,n[7]=(s*h-l*i)*y,n[8]=(c*i-s*a)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,s,o){var a=Math.cos(i),c=Math.sin(i);this.set(r*a,r*c,-r*(a*s+c*o)+s+t,-n*c,n*a,-n*(-c*s+a*o)+o+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],s=n[3],o=n[6],a=n[1],c=n[4],u=n[7];return n[0]=e*i+r*a,n[3]=e*s+r*c,n[6]=e*o+r*u,n[1]=-r*i+e*a,n[4]=-r*s+e*c,n[7]=-r*o+e*u,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var d=0,p=new i.a,m=new n.a,g=new s.a,y=new i.a,b=new i.a,v=new i.a,w=new n.a,x=new i.a(1,0,0),_=new i.a(0,1,0),M=new i.a(0,0,1),C={type:"added"},A={type:"removed"};function S(){Object.defineProperty(this,"id",{value:d++}),this.uuid=a.a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=S.DefaultUp.clone();var t=new i.a,e=new h,r=new n.a,o=new i.a(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new s.a},normalMatrix:{value:new f}}),this.matrix=new s.a,this.matrixWorld=new s.a,this.matrixAutoUpdate=S.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new l,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}S.DefaultUp=new i.a(0,1,0),S.DefaultMatrixAutoUpdate=!0,S.prototype=Object.assign(Object.create(o.a.prototype),{constructor:S,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.multiply(m),this},rotateOnWorldAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.premultiply(m),this},rotateX:function(t){return this.rotateOnAxis(x,t)},rotateY:function(t){return this.rotateOnAxis(_,t)},rotateZ:function(t){return this.rotateOnAxis(M,t)},translateOnAxis:function(t,e){return p.copy(t).applyQuaternion(this.quaternion),this.position.add(p.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(x,t)},translateY:function(t){return this.translateOnAxis(_,t)},translateZ:function(t){return this.translateOnAxis(M,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(g.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?y.copy(t):y.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),b.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?g.lookAt(b,y,this.up):g.lookAt(y,b,this.up),this.quaternion.setFromRotationMatrix(g),n&&(g.extractRotation(n.matrixWorld),m.setFromRotationMatrix(g),this.quaternion.premultiply(m.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(C)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(A)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),g.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),g.multiply(t.parent.matrixWorld)),t.applyMatrix4(g),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new i.a),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new n.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(b,t,v),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new i.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(b,w,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new i.a),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var n=this.children,i=0,s=n.length;i<s;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var o=s.shapes;if(Array.isArray(o))for(var a=0,c=o.length;a<c;a++){var u=o[a];i(t.shapes,u)}else i(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(a=0,c=this.material.length;a<c;a++)h.push(i(t.materials,this.material[a]));n.material=h}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(t).object)}if(e){var l=m(t.geometries),f=m(t.materials),d=m(t.textures),p=m(t.images);o=m(t.shapes);l.length>0&&(r.geometries=l),f.length>0&&(r.materials=f),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return I})),r.d(e,"b",(function(){return R})),r.d(e,"c",(function(){return z})),r.d(e,"d",(function(){return V}));var n=r(2),i=r(23),s=r(5),o=r(8);const a=n.d.create(),c=n.d.create();class u{constructor(){this.orientationTarget=n.d.create()}update(t,e,r,a){const u=t.state,h=Object(o.c)(Object(o.d)(),u),l=u,f=this.getCameraRelativeMovementDirection(a,c),d=n.d.length(f)>.1,p=a.actions&i.a.Walk;let m=n.d.clone(h.orientation),g=!!(h.flags&I.IsUTurning);if(h.state!==R.None){e-h.stateStartFrame>=69&&(l.state=R.None,l.stateStartFrame=e)}else a.actions&i.a.AttackSide&&(l.stateStartFrame=e,l.state=R.AttackSide),a.actions&i.a.AttackVert&&(l.stateStartFrame=e,l.state=R.AttackVertical);if(h.state===R.Struck){e-h.stateStartFrame>34&&(t.hitBy.length=0,l.state=R.None,l.stateStartFrame=e)}let y=h.speed;const b=p?600:3e3;let v=p?150:600;l.state!==R.None&&(v=10);const w=(d?b:-b)*r,x=Object(s.c)(y+w,0,v);y+=Object(s.c)(x-y,-b*r,b*r);const _=n.d.scale(n.d.create(),h.orientation,y),M=n.d.scaleAndAdd(n.d.create(),h.origin,_,r);let C=d,A=3.75*Math.PI,S=1.875*Math.PI;Math.PI;g?n.d.dot(m,this.orientationTarget)>.99&&(g=!1):n.d.dot(f,this.orientationTarget)<-.99&&(g=!0,n.d.copy(this.orientationTarget,f));let k=y>0?S:A;if(g?(C=!0,k*=2,this.orientationTarget=this.orientationTarget):d&&n.d.copy(this.orientationTarget,f),C){const t=Math.atan2(h.orientation[0],h.orientation[2]),e=Math.atan2(this.orientationTarget[0],this.orientationTarget[2]);let i=Object(s.b)(t,e);const o=k*r,a=Object(s.c)(i,-o,o);n.d.rotateY(m,h.orientation,s.a,a)}let T=h.flags&~(I.IsWalking|I.IsUTurning);return p&&(T|=I.IsWalking),g&&(T|=I.IsUTurning),l.origin=M,l.speed=y,l.orientation=m,l.flags=T,l}getWorldRelativeMovementDirection(t,e){const r=t.horizontalAxis,i=t.verticalAxis;return n.d.normalize(e,n.d.set(e,r,0,i))}getCameraRelativeMovementDirection(t,e){const r=this.getWorldRelativeMovementDirection(t,e),i=n.d.normalize(a,n.d.set(a,t.headingX,0,t.headingZ));return n.d.set(e,r[0]*-i[2]+r[2]*i[0],0,r[0]*i[0]+r[2]*i[2])}}var h=r(18),l=r(1),f=r(9),d=r(7),p=r(0),m=r(28);function g(){m.a.call(this),this.type="Bone"}g.prototype=Object.assign(Object.create(m.a.prototype),{constructor:g,isBone:!0});var y=r(12),b=new y.a,v=new y.a;function w(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new y.a)}}Object.assign(w.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new y.a;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,s=t.length;i<s;i++){var o=t[i]?t[i].matrixWorld:v;b.multiplyMatrices(o,e[i]),b.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new w(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});var x=r(24),_=r(11);const M=n.e.fromValues(1,0,0,1),C=new _.c(n.d.create()),A=new Array(128).fill(0).map(t=>n.d.create());function S(t,e=M){const r=A;if(t){for(let e=0;e<t.bones.length;e++){const n=t.bones[e],i=n.parent;i&&(C.setBuffer(r[2*e+0]),i.getWorldPosition(C),C.setBuffer(r[2*e+1]),n.getWorldPosition(C))}x.a.renderLines(r.slice(0,2*t.bones.length),e)}}class k{constructor(){this.data=[],this.drawSkeleton=!1}initialize(t,e){this.avatars=t;for(let e=0;e<t.length;e++)this.data[e]={models:[],skinnedModels:[]};e.addFolder("Avatar").add(this,"drawSkeleton")}onResourcesLoaded(t,e){for(let r=0;r<this.avatars.length;r++){const n=this.avatars[r];for(let i=0;i<n.nodes.length;i++){const s=n.nodes[i];if(Object(p.e)(s.skinId)){const i=Object(p.c)(s.meshId);Object(p.b)(0===s.skinId),this.loadSkinnedModel(e,t,s,i,n.skeleton,r)}else Object(p.e)(s.meshId)&&this.loadModel(e,t,s,s.meshId,r)}}}createMaterial(t,e,r){const i=r.materials[e.materialIndex],s=Object(p.c)(i.technique),o=s.shaderId,a=function(t){const e={},r=[];for(const n of Object.keys(t.uniforms)){const i=t.uniforms[n];i.type===l.m.Texture2D?r.push(n):e[n]=i}const n=Object(d.b)(e),i={uniforms:{index:0,type:l.a.UniformBuffer,layout:n}};for(let t=0;t<r.length;t++){i[r[t]]={index:t,type:l.a.Texture}}return i}(s),c=new h.a(t,i.name,o,a),u=a.uniforms.layout,f=new d.a(i.name,t,u);if(c.setUniformBuffer(t,"uniforms",f),s){const e=Object(p.c)(i.values);for(const n of Object.keys(s.uniforms)){const i=s.uniforms[n],o=Object(p.d)(e[n],i.value);if(Object(p.e)(o))if(i.type===l.m.Texture2D){const e=r.textures[o.index].id;c.setTexture(t,n,e)}else i.type===l.m.Float?f.setFloat(n,o):f.setFloats(n,o)}f.setVec4("u_Color0",n.e.fromValues(.4266,.4171,.5057,1))}else f.setVec4("u_color",n.e.fromValues(0,1,0,1));return c}loadSkinnedModel(t,e,r,n,i,s){const o=e.meshes[n];for(let n of o.primitives){const o=this.createMaterial(t,n,e),a=new h.c(t,f.a.opaque,n.mesh,o);a.bindSkeleton(t,i),o.setTexture(t,"u_jointTex",a.boneTex),this.data[s].skinnedModels.push(a),r.add(a)}}loadModel(t,e,r,n,i){const s=e.meshes[n];for(let n of s.primitives){const s=this.createMaterial(t,n,e),o=new h.b(t,f.a.opaque,n.mesh,s);this.data[i].models.push(o),r.add(o)}}render(t,e){for(let r=0;r<this.avatars.length;r++){if(!this.avatars[r].isActive)continue;const i=this.data[r];for(let r=0;r<i.skinnedModels.length;r++){const s=i.skinnedModels[r],o=s.material.getUniformBuffer("uniforms");s.writeBonesToTex(t);const a=new Float32Array(s.matrixWorld.elements);Object(p.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_modelViewProjection",n.b.multiply(n.b.create(),e.viewProjMatrix,a)),Object(p.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_model",a),o.write(t),s.renderList.push(s.primitive)}for(let r=0;r<i.models.length;r++){const s=i.models[r],o=new Float32Array(s.matrixWorld.elements),a=s.material.getUniformBuffer("uniforms");a.setMat4("u_modelViewProjection",n.b.multiply(n.b.create(),e.viewProjMatrix,o)),a.write(t),s.renderList.push(s.primitive)}if(this.drawSkeleton&&(S(this.avatars[r].skeleton),window.server)){S(window.server.avatar.avatars[r].skeleton,n.e.fromValues(1,1,0,1))}}}}var T=r(15),F=r(4);const O=[.25,.75],E=[.15,.65];class j{constructor(t){this.targetAvatar=t}onResourcesLoaded(t,e){this.debugMenu=e.addFolder("Animation"),this.debugAnimationMixer=new T.b(this.targetAvatar);const r={that:this,togglePaused:()=>{this.debugAnimation&&(this.debugAnimation.paused=!this.debugAnimation.paused)},stop:()=>{this.debugAnimation&&(this.debugAnimation.stop(),this.debugAnimation=void 0)},get time(){if(Object(p.e)(this.that.debugAnimation)){return this.that.debugAnimation.time/this.that.debugAnimation.getClip().duration}return 0},set time(t){Object(p.e)(this.that.debugAnimation)&&(this.that.debugAnimation.paused=!0,this.that.debugAnimation.time=t*this.that.debugAnimation.getClip().duration)}};this.debugMenu.add(r,"togglePaused"),this.debugMenu.add(r,"stop"),this.debugMenu.add(r,"time",0,1,.01);const n={};for(const e of t)n[e.name]=()=>{this.debugAnimationMixer.stopAllAction(),this.debugAnimation=this.debugAnimationMixer.clipAction(e).reset().play()},this.debugMenu.add(n,e.name)}update(t){return this.debugAnimation&&this.debugAnimationMixer.update(t),this.targetAvatar.updateMatrixWorld(),this.targetAvatar.skeleton.update(),this.debugAnimation}}class B{constructor(){this.data=[],this.ready=!1}initialize(t){this.avatars=t,this.debugMenu=new j(this.avatars[0])}onResourcesLoaded(t,e){const r=Object(p.c)(t.animations.find(t=>"await1"===t.name)),n=Object(p.c)(t.animations.find(t=>"awalk1"===t.name)),i=Object(p.c)(t.animations.find(t=>"brun1"===t.name)),s=Object(p.c)(t.animations.find(t=>"aat_yoko1"===t.name)),o=Object(p.c)(t.animations.find(t=>"aat_tate1"===t.name)),a=Object(p.c)(t.animations.find(t=>"ahakai1"===t.name));for(let t=0;t<this.avatars.length;t++){const e=this.avatars[t];this.data[t]={aIdle:e.animationMixer.clipAction(r),aWalk:e.animationMixer.clipAction(n),aRun:e.animationMixer.clipAction(i),aAttackSide:e.animationMixer.clipAction(s),aAttackVert:e.animationMixer.clipAction(o),aStruck:e.animationMixer.clipAction(a),startingFoot:0};const c=this.data[t];c.aIdle.play().setEffectiveWeight(1),c.aWalk.play().setEffectiveWeight(0),c.aRun.play().setEffectiveWeight(0),c.aAttackSide.play().setEffectiveWeight(0),c.aAttackVert.play().setEffectiveWeight(0),c.aStruck.play().setEffectiveWeight(0),c.aAttackSide.setLoop(F.d,1),c.aAttackVert.setLoop(F.d,1),c.aIdle.time=t*(c.aIdle.getClip().duration/(this.avatars.length+1)),c.aWalk.time=O[c.startingFoot]*c.aWalk.getClip().duration,c.aRun.time=E[c.startingFoot]*c.aRun.getClip().duration}this.debugMenu.onResourcesLoaded(t.animations,e),this.ready=!0}apply(t,e,r){const n=t.state;let i=1;const o=r.renderTime/1e3,a=o,c=.001*(r.renderTime-n.stateStartFrame*r.simDt);let u=0;u=n.state===R.AttackSide||n.state===R.AttackVertical?Math.min(Object(s.f)(Object(s.d)(0,.2,c)),1-Object(s.f)(Object(s.d)(.8,1.1,c))):0,i-=u;let h=0;n.state===R.Struck&&(h=Math.min(Object(s.f)(Object(s.d)(0,.1,c)),1-Object(s.f)(Object(s.d)(.444,.544,c)))),i-=h;let l=i*Object(s.f)(Object(s.d)(0,600,n.speed)),f=i*Object(s.f)(Object(s.d)(600,0,n.speed));e.aRun.time=a%e.aRun.getClip().duration,e.aIdle.time=o%e.aIdle.getClip().duration,e.aAttackSide.time=c%e.aAttackSide.getClip().duration,e.aAttackVert.time=c%e.aAttackVert.getClip().duration,e.aStruck.time=c%e.aStruck.getClip().duration,e.aRun.weight=l,e.aIdle.weight=f,e.aAttackSide.weight=n.state===R.AttackSide?u:0,e.aAttackVert.weight=n.state===R.AttackVertical?u:0,e.aStruck.weight=h,t.animationMixer.update(0),t.updateMatrixWorld(),t.skeleton.update()}update(t){if(!this.ready)return;const e=.001*t.renderDt;for(let r=0;r<this.avatars.length;r++){const n=this.data[r],i=this.avatars[r];if(i.local){if(this.debugMenu.update(e))continue}i.isActive&&this.apply(i,n,t)}}}var I,R,U=r(13),D=r(20);class P extends _.b{constructor(){super(...arguments),this.local=!1,this.bounds=n.b.create(),this.hitBy=[]}get isActive(){return this.state&&(this.state.flags&I.IsActive)>0}}!function(t){t[t.IsActive=1]="IsActive",t[t.IsWalking=2]="IsWalking",t[t.IsUTurning=4]="IsUTurning"}(I||(I={})),function(t){t[t.None=0]="None",t[t.AttackSide=1]="AttackSide",t[t.AttackVertical=2]="AttackVertical",t[t.AttackThrow=3]="AttackThrow",t[t.Struck=4]="Struck"}(R||(R={}));const L=n.b.fromValues(40,0,0,0,0,110,0,0,0,0,40,0,0,110,10,1),N=n.b.create();class z{constructor(){this.avatars=[],this.animation=new B,this.renderer=new k;for(let t=0;t<8;t++)this.avatars[t]=new P;this.localAvatar=this.avatars[0]}initialize(t){t.world.registerFactory(o.a.Avatar,this),t.resources.load("data/Tn.glb","gltf",(e,r)=>{if(e)return console.error("Failed to load resource",e);this.gltf=r,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars),this.renderer.initialize(this.avatars,t.debugMenu)}onJoined(t){this.localAvatar=this.avatars[t],this.localAvatar.local=!0}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const r=this.gltf.nodes[e],n=t.nodes[e];for(const e of r.children){const r=this.gltf.nodes.indexOf(e);n.add(t.nodes[r])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const r=Object(p.c)(this.gltf.skins[0]),n=r.joints.map(e=>t.nodes[e]),i=null===(e=r.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new _.a).fromArray(t));t.skeleton=new w(n,i),t.animationMixer=new T.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu),this.renderer.onResourcesLoaded(this.gltf,t.gfxDevice)}update(t){for(const e of this.avatars){const r=e.state;if(!r||!e.nodes)continue;if(!e.weapon){const r=8+e.id,n=t.world.objects[r];e.weapon=n,Object(p.c)(e.nodes.find(t=>"j_tn_item_r1"===t.name)).add(e.weapon.transform)}const n=new _.c(r.origin);e.position.copy(n),e.lookAt(r.origin[0]+r.orientation[0],r.origin[1]+r.orientation[1],r.origin[2]+r.orientation[2]),e.updateMatrix(),e.updateMatrixWorld()}this.animation.update(t.clock)}updateFixed(t){}render(t){this.renderer.render(t.gfxDevice,t.camera)}createGameObject(t){const e=t.id;Object(p.b)(e<8);const r=this.avatars[e];return r.state=t,r}deleteGameObject(){}}class V{constructor(){this.avatars=[],this.controllers=[],this.animation=new B}initialize(t){t.world.registerFactory(o.a.Avatar,this);const e={orientation:n.d.fromValues(0,0,1)};for(let r=0;r<8;r++)this.avatars[r]=t.world.createGameObject(o.a.Avatar,e);for(let e=0;e<8;e++)this.avatars[e].weapon=t.world.createGameObject(o.a.Weapon,{parent:e});t.resources.load("data/Tn.glb","gltf",(e,r)=>{if(e)return console.error("Failed to load resource",e);this.gltf=r,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars),this.addAvatar(7)}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const r=this.gltf.nodes[e],n=t.nodes[e];for(const e of r.children){const r=this.gltf.nodes.indexOf(e);n.add(t.nodes[r])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const r=Object(p.c)(this.gltf.skins[0]),n=r.joints.map(e=>t.nodes[e]),i=null===(e=r.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new _.a).fromArray(t));t.skeleton=new w(n,i),Object(p.c)(t.nodes.find(t=>"j_tn_item_r1"===t.name)).add(t.weapon.transform),t.animationMixer=new T.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu)}update(t){}updateFixed(t){for(let e=0;e<8;e++){const r=this.avatars[e],s=t.net.clients[e],o=r.state;if(!r.isActive)continue;let a=D.c;s&&s.state===U.c.Active?a=s.getUserCommand(t.clock.simFrame):a.actions=i.a.AttackSide;const c=t.clock.simDt/1e3;this.controllers[e].update(r,t.clock.simFrame,c,a);const u=new _.c(o.origin);r.position.copy(u),r.lookAt(o.origin[0]+o.orientation[0],o.origin[1]+o.orientation[1],o.origin[2]+o.orientation[2]),r.updateMatrix(),r.updateMatrixWorld(),N.set(r.matrixWorld.elements),n.b.multiply(r.bounds,N,L),r.collisionId=t.collision.addTargetObb(r.bounds,r),o.state!==R.AttackSide&&o.state!==R.AttackVertical||t.collision.addAttackRegion({verts:r.weapon.attackQuad},r.weapon)}this.animation.update(t.clock)}updateFixedLate({collision:t,clock:e}){for(const r of this.avatars)if(r.isActive){const n=t.getHitsForTarget(r.collisionId);if(n.length>0){r.state.state!==R.Struck&&(r.state.state=R.Struck,r.state.stateStartFrame=e.simFrame);for(const t of n){const e=t.owner;r.hitBy.includes(e)||r.hitBy.push(e)}}}}createGameObject(t){const e=new P;e.state=t;const r=this.avatars.length;return this.controllers[r]=new u,this.avatars[r]=e,e}deleteGameObject(){}addAvatar(t){this.avatars[t].state.flags|=I.IsActive}removeAvatar(t){this.avatars[t].state.flags&=~I.IsActive}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return a}));var n,i=r(59),s=r(10),o=r(0);!function(t){t.JoinedRoom="joined",t.ClientJoined="clientjoin",t.Message="message",t.RoomMessage="roomMessage"}(n||(n={}));class a extends s.a{constructor(){super(...arguments),this.connected=!1}connect(t=window.config.kSignalServerAddress){return Object(o.b)(!this.connected),new Promise(e=>{this.socket=i.connect(t),this.socket.on("connect",()=>{this.connected=!0,console.debug("SignalSocket: Connected to MoonBeacon with ID:",this.socket.id)}),this.socket.on("roomJoined",t=>{console.debug("SignalSocket: Joined room:",t),this.room=t,e()}),this.socket.on("clientJoined",t=>{console.debug("SignalSocket: Client joined:",t),this.room.clients[t.id]=t,this.fire(n.ClientJoined,t.id)}),this.socket.on("clientLeaving",(t,e)=>{console.debug("SignalSocket: Client left:",t),delete this.room.clients[t]}),this.socket.on("message",t=>{console.debug("SignalSocket: Message received",t),this.fire(n.Message,t.data,t.from)}),this.socket.on("messageRoom",t=>{this.fire(n.RoomMessage,t.data,t.from)})})}send(t,e){const r={from:this.clientId,to:t,data:e};console.debug("SignalSocket: Sending message",r),this.socket.emit("message",r)}broadcast(t){const e={from:this.clientId,data:t};this.socket.emit("messageRoom",e)}requestIceServers(){return new Promise((t,e)=>{this.socket.emit("iceServers",e=>{t({iceServers:e})})})}close(){this.socket.close()}get clients(){return Object.keys(this.room.clients)}get serverId(){return this.room.server}get clientId(){return this.socket.id}}},function(t,e,r){(function(n){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))}),e.splice(i,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=r(67)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,r(36))},function(t,e){e.encode=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},e.decode=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},function(t,e){t.exports=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,r){(function(n){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))}),e.splice(i,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=r(87)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,r(36))},function(t,e,r){"use strict";function n(){}r.d(e,"a",(function(){return n})),Object.assign(n.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}})},function(t,e){var r,n,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,u=[],h=!1,l=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new p(t,e)),1!==u.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){var n=r(69)("socket.io-parser"),i=r(25),s=r(72),o=r(47),a=r(48);function c(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=c,e.Decoder=l;var u=e.ERROR+'"encode error"';function h(t){var r=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return u;r+=i}return n("encoded %j as %s",t,r),r}function l(){this.reconstructor=null}function f(t){this.reconPack=t,this.buffers=[]}function d(t){return{type:e.ERROR,data:"parser error: "+t}}c.prototype.encode=function(t,r){(n("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)?function(t,e){s.removeBlobs(t,(function(t){var r=s.deconstructPacket(t),n=h(r.packet),i=r.buffers;i.unshift(n),e(i)}))}(t,r):r([h(t)])},i(l.prototype),l.prototype.add=function(t){var r;if("string"==typeof t)r=function(t){var r=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return d("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var s="";"-"!==t.charAt(++r)&&(s+=t.charAt(r),r!=t.length););if(s!=Number(s)||"-"!==t.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(r+1))for(i.nsp="";++r;){if(","===(c=t.charAt(r)))break;if(i.nsp+=c,r===t.length)break}else i.nsp="/";var a=t.charAt(r+1);if(""!==a&&Number(a)==a){for(i.id="";++r;){var c;if(null==(c=t.charAt(r))||Number(c)!=c){--r;break}if(i.id+=t.charAt(r),r===t.length)break}i.id=Number(i.id)}if(t.charAt(++r)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(r));if(!(!1!==u&&(i.type===e.ERROR||o(u))))return d("invalid payload");i.data=u}return n("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?(this.reconstructor=new f(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!a(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(73),i=r(74),s=r(75);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return u(this,t,e,r)}function u(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,r),i=(t=a(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(c.isBuffer(e)){var r=0|d(e.length);return 0===(t=a(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?a(t,0):f(t,e);if("Buffer"===e.type&&s(e.data))return f(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(h(e),t=a(t,e<0?0:0|d(e)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function f(t,e){var r=e.length<0?0:0|d(e.length);t=a(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function p(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return F(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return k(this,e,r);case"latin1":case"binary":return T(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,i);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,i){var s,o=1,a=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,r/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var h=-1;for(s=r;s<a;s++)if(u(t,s)===u(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(r+c>a&&(r=a-c),s=r;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(t,s+f)!==u(e,f)){l=!1;break}if(l)return s}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[r+o]=a}return o}function w(t,e,r,n){return V(N(e,t.length-r),t,r,n)}function x(t,e,r,n){return V(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return x(t,e,r,n)}function M(t,e,r,n){return V(z(e),t,r,n)}function C(t,e,r,n){return V(function(t,e){for(var r,n,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function A(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,o,a,c,u=t[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=r)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=t[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,r){return u(null,t,e,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,r){return function(t,e,r,n){return h(e),e<=0?a(t,e):void 0!==r?"string"==typeof n?a(t,e).fill(r,n):a(t,e).fill(r):a(t,e)}(null,t,e,r)},c.allocUnsafe=function(t){return l(null,t)},c.allocUnsafeSlow=function(t){return l(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=c.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?S(this,0,t):m.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,r,n,i){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),a=Math.min(s,o),u=this.slice(n,i),h=t.slice(e,r),l=0;l<a;++l)if(u[l]!==h[l]){s=u[l],o=h[l];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},c.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},c.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},c.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return v(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return x(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return M(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function F(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=L(t[s]);return i}function O(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function E(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,r,n,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function B(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-r,2);i<s;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function I(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-r,4);i<s;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function R(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,s){return s||R(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function D(t,e,r,n,s){return s||R(t,0,r,8),i.write(t,e,r,n,52,8),r+8}c.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=c.prototype;else{var i=e-t;r=new c(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+t]}return r},c.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},c.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},c.prototype.readUInt8=function(t,e){return e||E(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||E(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||E(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||E(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||E(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return e||E(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||E(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(t,e){e||E(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(t,e){return e||E(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||E(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},c.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},c.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},c.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+r},c.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},c.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},c.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},c.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},c.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,s=n-r;if(this===t&&r<e&&e<n)for(i=s-1;i>=0;--i)t[i+e]=this[i+r];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+s),e);return s},c.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var s;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(s=e;s<r;++s)this[s]=t;else{var o=c.isBuffer(t)?t:N(new c(t,n).toString()),a=o.length;for(s=0;s<r-e;++s)this[s+e]=o[s%a]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function L(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function V(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(49))},function(t,e,r){var n=r(78);t.exports=function(t){var e=t.xdomain,r=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||n))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(t){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},function(t,e,r){var n=r(26),i=r(25);function s(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=s,i(s.prototype),s.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)},s.prototype.onPacket=function(t){this.emit("packet",t)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{constructor(){this._add=[],this._folders={}}add(t,e,r,n,i){const s={args:arguments};return this._add.push(s),{onChange:t=>{s.onChange=t}}}addFolder(t){return this._folders[t]=new i,this._folders[t]}async show(){var t;if(!Object(n.e)(this._guiPromise)){if(void 0===this._gui){this._guiPromise=r.e(2).then(r.bind(null,98));const t=await this._guiPromise;this._gui=new t.GUI({load:this._saveObject})}(null===(t=this._saveObject)||void 0===t?void 0:t.closed)&&this._gui.close();for(const t of this._add){this._gui.getRoot().remember(t.args[0]);const e=this._gui.add.apply(this._gui,t.args);t.onChange&&(e.onChange(t.onChange),t.onChange(e.object[e.property]))}for(const t in this._folders)this._folders[t]._gui=this._gui.addFolder(t),this._folders[t].show();this.add=this._gui.add.bind(this._gui),this.addFolder=this._gui.addFolder.bind(this._gui),this.show=this._gui.show.bind(this._gui),this.hide=this._gui.hide.bind(this._gui)}}hide(){}update(){if(this._gui&&!this._gui.closed){for(var t in this._gui.__controllers)this._gui.__controllers[t].updateDisplay();for(const t in this._gui.__folders){const e=this._gui.__folders[t];for(const t of e.__controllers)t.updateDisplay()}}}toJSON(){return this._gui?this._gui.getSaveObject():void 0}fromJSON(t){Object(n.b)(!Object(n.e)(this._gui),"State must be loaded before the DebugMenu is shown"),this._saveObject=t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(0),i=r(5);class s{constructor(){this.renderTime=0,this.serverTime=0,this.clientTime=0,this.simFrame=0,this.realDt=0,this.renderDt=0,this.simDt=16,this.realTime=0,this.clientDelay=0,this.renderDelay=0,this.paused=!1,this.speed=1,this.stepDt=0}initialize({debugMenu:t}){var e;(null===(e=window.client)||void 0===e?void 0:e.debugMenu)===t&&(t.add(this,"paused").onChange(()=>{window.server&&(window.server.clock.paused=this.paused)}),t.add(this,"speed",.05,2,.05).onChange(()=>{window.server&&(window.server.clock.speed=this.speed)}),t.add(this,"step").onChange(()=>{window.server&&window.server.clock.step()})),this.zero()}zero(){this.serverTime=0,this.clientTime=0,this.renderTime=0,this.simFrame=0}syncToServerTime(t){this.tick();const e=t-this.serverTime;return this.serverTime=t,e}setClientDelay(t){Object(n.b)(t<=0,"ClientDelay is expected to be negative"),this.clientDelay=t}setRenderDelay(t){Object(n.b)(t>=0,"RenderDelay is expected to be positive"),this.renderDelay=t}tick(){const t=performance.now();this.realDt=t-this.realTime,this.realTime=t,this.realDt*=this.speed,this.paused&&(this.realDt=this.stepDt),this.serverTime+=this.realDt;const e=this.serverTime-this.clientDelay,r=e-this.clientTime;if(r>250){this.clientTime=e;const t=this.clientTime/this.simDt;this.simFrame=Math.floor(t)}else{const t=.95*this.realDt,e=1.05*this.realDt,n=Object(i.c)(r,t,e);this.clientTime+=n}const n=this.serverTime-this.renderDelay,s=n-this.renderTime;if(s>250)this.renderTime=n;else{const t=.75*this.realDt,e=1.25*this.realDt;this.renderDt=Object(i.c)(s,t,e),this.renderTime+=this.renderDt}this.stepDt=0}updateFixed(){const t=this.clientTime-this.simDt*this.simFrame>=this.simDt;return t&&(this.simFrame+=1),t}getCurrentServerTime(){const t=performance.now()-this.realTime;return this.serverTime+t}step(t=this.simDt){this.paused=!0,this.stepDt=t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return u}));var n=r(21),i=r(13),s=r(0),o=r(16),a=r(5);class c{constructor(){this.graph=new o.c,this.clientAhead=125,this.renderDelay=125,this.averageServerFrameDiff=0,this.averageClientFrameDiff=0,this.renderDelayTimestamp=0,this.showStats=!1,this.showGraph=!1}initialize(t){this.context=t;const e=this.context.clock;this.client=new i.a(t.clock),this.client.setSimStream(t.world.stream);const r=this.context.debugMenu.addFolder("Net");r.add(this,"clientAhead",0,1e3,16).onChange(()=>e.setClientDelay(-this.clientAhead)),r.add(this,"renderDelay",0,1e3,16).onChange(()=>e.setRenderDelay(this.renderDelay)),r.add(this,"showStats").onChange(t=>this.client.stats.setEnabled(t)),r.add(this,"showGraph").onChange(t=>this.graph.setEnabled(t)),this.context.toplevel.appendChild(this.graph.dom),this.context.toplevel.appendChild(this.client.stats.dom)}terminate(){this.client.close()}onConnect(t){this.context.clock.setClientDelay(-this.clientAhead),this.context.clock.setRenderDelay(this.renderDelay),this.client.on(i.b.ServerTimeAdjust,this.onServerTimeAdjust.bind(this)),this.client.on(i.b.ReceiveServerFrame,this.onServerFrame.bind(this)),this.client.on(i.b.Activated,this.onJoined.bind(this)),this.client.connect(t),this.client.on(i.b.Connected,()=>{this.graph&&this.client.setNetGraphPanel(this.graph.addPanel(`Client: ${this.client.id}`))})}onJoined(){this.context.avatar.onJoined(this.client.clientIndex)}onServerFrame(t,e){this.context.world.addState(e),this.averageServerFrameDiff=Object(a.e)(t,this.averageServerFrameDiff,.95);const r=(1.5-this.averageServerFrameDiff)*this.context.clock.simDt;this.clientAhead=Object(a.c)(this.clientAhead+.01*r,0,250),this.context.clock.setClientDelay(-this.clientAhead);const n=1*this.context.clock.simDt,i=e.frame-this.client.lastRequestedFrame;if(this.averageClientFrameDiff=Object(a.e)(i,this.averageClientFrameDiff,.9),i<0){const t=(3-i)*this.context.clock.simDt;this.renderDelay=Object(a.c)(this.renderDelay+t,0,250),this.context.clock.setRenderDelay(this.renderDelay),this.renderDelayTimestamp=performance.now(),this.averageClientFrameDiff=3}if(performance.now()-this.renderDelayTimestamp>3e3){const t=(3-this.averageClientFrameDiff)*this.context.clock.simDt;Math.abs(t)>n&&(this.renderDelay=Object(a.c)(this.renderDelay+t,0,250),console.debug(`Adjusting renderTime by ${t} ms`),this.context.clock.setRenderDelay(this.renderDelay),this.averageClientFrameDiff=3),this.renderDelayTimestamp=performance.now()}}onServerTimeAdjust(t){const e=this.context.clock.syncToServerTime(t);console.debug(`Adjusting serverTime by ${e.toFixed(2)} ms`)}onVisibility(t){if(this.client.state===i.c.Active)if(this.client.transmitVisibilityChange(!t),this.client.transmitReliable(0),t){const t=16;let e=1;this.transmitInterval=window.setInterval(()=>{this.client.transmitReliable(e++)&&(clearInterval(this.transmitInterval),this.transmitInterval)},t)}else Object(s.e)(this.transmitInterval)&&(window.clearInterval(this.transmitInterval),this.transmitInterval=void 0)}update({}){this.client.stats.update(),this.updateNetGraph()}updateNetGraph(){var t;const e=this.context.clock;null===(t=this.client.graphPanel)||void 0===t||t.update(this.client.ping,e.serverTime,e.renderTime,e.clientTime),window.server&&window.server.net.updateNetGraph()}}class u{constructor(){this.clients=[]}initialize(t){var e;this.context=t,this.graph=null===(e=window.client)||void 0===e?void 0:e.net.graph}terminate(){this.signalSocket&&this.signalSocket.close();for(const t of this.clients)t&&t.close()}async onConnect(t){this.signalSocket=t;const e=new n.c(t);await e.listen(async t=>{const e=new i.a(this.context.clock);e.setSimStream(this.context.world.stream),e.on(i.b.Connected,this.onClientConnected.bind(this,e)),e.on(i.b.Disconnected,this.onClientDisconnected.bind(this,e)),e.accept(t);let r=this.clients.indexOf(null);r<0&&(r=this.clients.length),this.clients[r]=e,e.clientIndex=r,e.transmitConnectionInfo(r)})}onClientConnected(t){console.log("Client connected:",t),this.context.avatar.addAvatar(t.clientIndex),this.graph&&t.setNetGraphPanel(this.graph.addPanel(`Server: ${t.id}`))}onClientDisconnected(t){var e;console.log("Client disconnected:",t),this.context.avatar.removeAvatar(t.clientIndex);const r=this.clients.indexOf(t);this.clients[r]=null,t.graphPanel&&(null===(e=this.graph)||void 0===e||e.removePanel(t.graphPanel))}transmitToClients(t){for(const e of this.clients)e&&e.transmitServerFrame(t)}updateNetGraph(){var t;if(this.graph)for(const e of this.clients){const r=window.client.clock.serverTime;e&&(null===(t=e.graphPanel)||void 0===t||t.update(e.ping,r,void 0,this.context.clock.getCurrentServerTime()))}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return v}));var n=r(18),i=r(7),s=r(0),o=r(1),a=r(2),c=r(9),u=r(11),h=r(29),l=r(8);const f=a.b.create();a.d.create(),a.d.create();var d,p;!function(t){t[t.None=0]="None",t[t.Sword=1]="Sword"}(d||(d={})),function(t){t[t.IsActive=1]="IsActive"}(p||(p={}));class m{constructor(t,e,r){this.transform=new u.b,this.attackQuad=[a.d.create(),a.d.create(),a.d.create(),a.d.create()],this.state=r,this.type=t}get isActive(){return this.state.flags&p.IsActive}}class g{}class y extends g{loadResources(){}create(){throw new Error("Attempted to create an empty weapon")}}class b extends g{constructor(){super(),this.matTextures={},this.ready=!1,this.attackObb=a.b.fromValues(20,0,0,0,0,5,0,0,0,0,90,0,0,0,110,1),this.attackLine=[a.d.fromValues(22,0,20),a.d.fromValues(18,0,200)]}loadResources(t,e){e&&(this.readyPromise=new Promise(r=>{t.load(b.kFilename,"gltf",(t,n)=>{if(t)return console.error("Failed to load resource",t);this.onResourcesLoaded(Object(s.c)(n),e),this.ready=!0,r()})}))}create(t,e){const r=new m(d.Sword,this.attackObb,t);return e&&this.readyPromise.then(()=>{const t=new n.a(e,name,this.shader,this.resourceLayout),s=new n.b(e,c.a.opaque,this.mesh,t);s.updateWorldMatrix(!0,!1),r.transform.add(s),Object.keys(this.matTextures).forEach(r=>t.setTexture(e,r,this.matTextures[r])),t.setUniformBuffer(e,"material",this.matUniformBuf);const o=this.resourceLayout.model.layout,a=new i.a("SwordModelUniforms",e,o);t.setUniformBuffer(e,"model",a),r.model=s}),r}onResourcesLoaded(t,e){const r=t,n=r.meshes[0].primitives[0],c=r.materials[n.materialIndex],u=Object(s.c)(c.technique);this.shader=u.shaderId,this.mesh=n.mesh,this.meshNode=Object(s.c)(r.nodes.find(t=>0===t.meshId));const h=["u_model","u_modelViewProjection"],l={},f={},d=[];for(const t of Object.keys(u.uniforms)){const e=u.uniforms[t];h.includes(t)?f[t]=e:e.type===o.m.Texture2D?d.push(t):l[t]=e}const p=Object(i.b)(l),m=Object(i.b)(f),g={model:{index:0,type:o.a.UniformBuffer,layout:m},material:{index:1,type:o.a.UniformBuffer,layout:p}};for(let t=0;t<d.length;t++){g[d[t]]={index:t,type:o.a.Texture}}this.resourceLayout=g,this.matUniformBuf=new i.a(c.name,e,p);const y=Object(s.c)(c.values);for(const t of Object.keys(l).concat(d)){const e=u.uniforms[t],n=Object(s.c)(Object(s.d)(y[t],e.value),`Expected material uniform '${t}' to have a value in the material or technique`);if(e.type===o.m.Texture2D){const e=r.textures[n.index].id;this.matTextures[t]=e}else e.type===o.m.Float?this.matUniformBuf.setFloat(t,n):this.matUniformBuf.setFloats(t,n)}this.matUniformBuf.setVec4("u_Color0",a.e.fromValues(.4266,.4171,.5057,1)),this.matUniformBuf.write(e)}}b.kFilename="data/Tkwn.glb";class v{constructor(t){this.weapons=[],t.registerFactory(l.a.Weapon,this),this.blueprints={[d.None]:new y,[d.Sword]:new b}}initialize({resources:t,gfxDevice:e}){this.gfxDevice=e,this.blueprints[d.Sword].loadResources(t,e)}createGameObject(t){const e=this.blueprints[d.Sword].create(t,this.gfxDevice);return this.weapons.push(e),e}deleteGameObject(){}updateFixed({world:t,collision:e}){for(const e in this.weapons){const r=this.weapons[e],n=this.blueprints[r.type],i=t.objects.find(t=>t.state.id===r.state.parent);r.state.flags=i.state.flags&h.a.IsActive,r.isActive&&(a.d.copy(r.attackQuad[2],r.attackQuad[0]),a.d.copy(r.attackQuad[3],r.attackQuad[1]),f.set(r.transform.matrixWorld.elements),a.d.transformMat4(r.attackQuad[0],n.attackLine[0],f),a.d.transformMat4(r.attackQuad[1],n.attackLine[1],f))}}render({gfxDevice:t,camera:e},r=!1){for(const r of this.weapons){if(!r.isActive)continue;const n=r.model;if(Object(s.e)(n)){r.transform.updateWorldMatrix(!1,!0);const i=new Float32Array(n.matrixWorld.elements),s=n.material.getUniformBuffer("model");s.setMat4("u_model",i),s.setMat4("u_modelViewProjection",a.b.multiply(a.b.create(),e.viewProjMatrix,i)),s.write(t),n.renderList.push(n.primitive)}}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return P}));var n,i=r(60),s=r.n(i);!function(t){t[t.LoadingAsync=0]="LoadingAsync",t[t.LoadingSync=1]="LoadingSync",t[t.Loaded=2]="Loaded",t[t.Unloaded=3]="Unloaded",t[t.Failed=4]="Failed"}(n||(n={}));var o=r(1),a=r(0);var c=r(2),u=r(15),h=r(11);const l=1313821514,f=5130562;let d=new TextDecoder;function p(t){return d.decode(t)}class m{constructor(t){const e=new DataView(t,0,12),r=new DataView(t,12),n=p(new Uint8Array(t,0,4)),i=e.getUint32(4,!0);e.getUint32(8,!0);if("glTF"!==n)throw new Error("Unsupported glTF-Binary header.");if(i<2)throw new Error("Unsupported legacy binary file detected.");let s=0;for(;s<r.byteLength;){const e=r.getUint32(s,!0);s+=4;const n=r.getUint32(s,!0);switch(s+=4,n){case l:{const r=new Uint8Array(t,12+s,e);this.json=p(r)}break;case f:{const r=12+s;this.binaryChunk=new Uint8Array(t,r,e)}break;default:console.warn("Skipping unexpected glTF-Binary chunk type:",n)}s+=e}Object(a.b)(!!this.json,"glTF-Binary: JSON content not found.")}}class g{constructor(t,e){this.gltf=t,this.bufferData=e}bufferViewData(t){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const e=this.gltf.bufferViews[t],r=Object(a.c)(this.bufferData[e.buffer],`No data for buffer ${e.buffer}`),n=e.byteLength||0,i=e.byteOffset||0,s=r.buffer,o=r.byteOffset;return new Uint8Array(s,o+i,n)}accessorData(t){if(!this.gltf.accessors)throw new Error("No accessors views found.");const e=this.gltf.accessors[t],r=C[e.type];let n;const i=M[e.componentType],s=i.BYTES_PER_ELEMENT*r*e.count;if(void 0!==e.bufferView){const t=this.bufferViewData(e.bufferView);n=new i(t.buffer,t.byteOffset+Object(a.d)(e.byteOffset,0),e.count*r)}else n=new i(s);if(e.sparse){const{count:t,indices:i,values:s}=e.sparse;let o=M[i.componentType],a=this.bufferViewData(i.bufferView);const c=new o(a.buffer,a.byteOffset+(i.byteOffset||0),t);o=M[e.componentType],a=this.bufferViewData(s.bufferView);const u=new o(this.bufferViewData(s.bufferView).buffer,a.byteOffset+(s.byteOffset||0),t*r);e.bufferView&&(n=new Uint8Array(n));const h=new M[e.componentType](n.buffer);for(let e=0;e<t;e++)for(let t=0;t<r;t++)h[r*c[e]+t]=u[r*e+t]}return n}}class y extends h.b{clone(t=!1){const e=super.clone(t);return e.morphWeight=this.morphWeight,e.meshId=this.meshId,e.skinId=this.skinId,e}}function b(t,e){let r;switch(e){case 5120:r=o.m.Char;break;case 5121:r=o.m.Uchar;break;case 5122:r=o.m.Short;break;case 5123:r=o.m.Ushort;break;case 5125:r=o.m.Uint;break;case 5126:r=o.m.Float;break;default:throw new Error("Invalid GLTF component type")}switch(t){case"SCALAR":r+=0;break;case"VEC2":r+=1;break;case"VEC3":r+=2;break;case"VEC4":r+=3;break;case"MAT2":throw new Error("2x2 Matrice not yet supported");case"MAT3":r=o.m.Float3x3;break;case"MAT4":r=o.m.Float4x4}return r}function v(t){switch(t){case 5124:return o.m.Int;case 5126:return o.m.Float;case 35664:return o.m.Float2;case 35665:return o.m.Float3;case 35666:return o.m.Float4;case 35667:return o.m.Int2;case 35668:return o.m.Int3;case 35669:return o.m.Int4;case 35675:return o.m.Float3x3;case 35676:return o.m.Float4x4;case 35678:return o.m.Texture2D;default:throw new Error("Invalid GLTF component type")}}function w(t){switch(t){case 0:return o.g.Points;case 1:return o.g.Lines;case 2:return o.g.LineLoop;case 3:return o.g.LineStrip;case 4:return o.g.Triangles;case 5:return o.g.TriangleStrip;case 6:return o.g.TriangleFan;default:throw new Error("Invalid GLTF primitive mode")}}const x={9728:o.j.Nearest,9729:o.j.Linear},_={9728:o.j.Nearest,9729:o.j.Linear},M={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"a_pos",NORMAL:"a_normal",TANGENT:"a_tangent",JOINTS_0:"a_joints",WEIGHTS_0:"a_weights",COLOR_0:"a_color",TEXCOORD_0:"a_uv0",TEXCOORD_1:"a_uv1",MORPH0_POSITION:"a_posMorph0"},S={NORMAL:"HAS_NORMALS 1",TANGENT:"HAS_TANGENT 1",JOINTS_0:"HAS_JOINT_SET0 1",WEIGHTS_0:"HAS_WEIGHT_SET0 1",COLOR_0:"HAS_COLOR0 1",TEXCOORD_0:"HAS_UV_SET0 1",TEXCOORD_1:"HAS_UV_SET1 1"},k={CUBICSPLINE:void 0,LINEAR:u.e,STEP:u.d},T={translation:"position",rotation:"quaternion",scale:"scale",weights:"_UNSUPPORTED"};function F(t,e,r){const n=r,i=e.gltf;let s=Object(a.e)(r.material)?Object(a.c)(t.transient.materials[r.material]):void 0;const c=[];let u=void 0;const h=[];if(Object(a.e)(n.indices)){const r=Object(a.c)(i.accessors)[n.indices];u=O(t,e,Object(a.c)(r.bufferView),o.c.Index)}let l;if(s&&Object(a.e)(s.techniqueIndex)){l={};const e=Object(a.c)(t.transient.techniques).techniques[s.techniqueIndex],r=Object.keys(e.attributes);for(const t of r){l[e.attributes[t].semantic]=t}}else l=A;const f={buffers:[]},d={};for(let r in n.attributes){const s=Object(a.c)(i.accessors)[n.attributes[r]],u=Object(a.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),p=d[u];let m;if(Object(a.e)(p))m=f.buffers[p];else{d[u]=h.length;const r=O(t,e,u,o.c.Vertex),n=Object(a.c)(i.bufferViews)[u];m={stride:Object(a.d)(n.byteStride,0),layout:{}},h.push(r),f.buffers.push(m)}const g=S[r];Object(a.e)(g)&&c.push(g);const y=Object(a.c)(l[r],`Unknown vertex attribute semantic: ${r}`);m.layout[y]={type:b(s.type,s.componentType),offset:s.byteOffset||0}}if(n.targets){c.push("HAS_MORPH0 1"),Object(a.b)(1===n.targets.length,"Only 1 morph target is currently supported");const r=n.targets[0];for(let n in r)if("POSITION"===n){const s=Object(a.c)(i.accessors)[r[n]],c=Object(a.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),u=Object(a.c)(i.bufferViews)[c];let d=f.buffers[c];const p=O(t,e,c,o.c.Vertex);Object(a.e)(d)||(h[c]=p,d=f.buffers[c]={stride:Object(a.d)(u.byteStride,0),layout:{}});const m=l[`MORPH0_${n}`];d.layout[m]={type:b(s.type,s.componentType),offset:s.byteOffset||0}}}const p=i.accessors[Object(a.c)(n.indices,"Only indexed primitives are currently supported")],m=Object(a.c)(u,"Only indexed primitives are currently supported");return{mesh:{elementCount:p.count,vertexBuffers:h,primitiveType:w(Object(a.d)(n.mode,4)),indexType:b(p.type,p.componentType),indexBuffer:m,vertexLayout:f},materialIndex:r.material}}function O(t,e,r,n){if(Object(a.e)(t.bufferViews[r]))return t.bufferViews[r];const i=Object(a.c)(e.gltf.bufferViews)[r].name||`buffer${r}`;t.bufferData[r]=new Uint8Array(e.bufferViewData(r)).buffer,Object(a.b)(!t.transferList.includes(t.bufferData[r])),t.transferList.push(t.bufferData[r]);const s={name:i,type:n,buffer:-1};return t.bufferViews[r]=s,s}function E(t,e){return Object(a.d)(e.gltf.materials,[]).map((t,e)=>{var r;const n=null===(r=t.extensions)||void 0===r?void 0:r.KHR_techniques_webgl,i=n?n.technique:void 0,s=n?n.values:void 0;return{name:Object(a.d)(t.name,`Material${e}`),renderFormat:{blendingEnabled:!1},cullMode:t.doubleSided?o.e.None:o.e.Back,techniqueIndex:i,values:s}})}function j(t,e){var r;if(!(null===(r=e.gltf.extensionsUsed)||void 0===r?void 0:r.includes("KHR_techniques_webgl")))return;const n=Object(a.c)(e.gltf.extensions.KHR_techniques_webgl);return{shaderData:n.shaders.map((r,n)=>{const i=Object(a.c)(r.bufferView,"Shader loading from URI not yet supported"),s=new Uint8Array(e.bufferViewData(i)).buffer;return Object(a.b)(!t.transferList.includes(s)),t.transferList.push(s),s}),shaders:n.programs.map(t=>({name:t.name,fsIndex:t.fragmentShader,vsIndex:t.vertexShader})),techniques:n.techniques.map((t,e)=>{const r={};for(const e in Object(a.d)(t.uniforms,{})){const n=t.uniforms[e];r[e]=Object.assign(Object.assign({},n),{type:v(n.type)})}return{shaderIndex:t.program,attributes:Object(a.d)(t.attributes,{}),uniforms:r}})}}function B(t,e){return Object(a.d)(e.gltf.nodes,[]).map(t=>{const r=Object(a.d)(t.scale,[1,1,1]),n=Object(a.d)(t.rotation,[0,0,0,1]),i=Object(a.d)(t.translation,[0,0,0]),s={name:t.name,scale:c.d.fromValues(r[0],r[1],r[2]),rotation:c.c.fromValues(n[0],n[1],n[2],n[3]),translation:c.d.fromValues(i[0],i[1],i[2]),morphWeight:Object(a.d)(t.weights,[0])[0],transform:c.b.create(),meshId:Object(a.e)(t.mesh)?t.mesh:void 0,skinId:Object(a.e)(t.skin)?t.skin:void 0,children:[]};if(Object(a.e)(t.matrix)?(s.transform.set(t.matrix),c.b.getRotation(s.rotation,s.transform),c.b.getTranslation(s.translation,s.transform),c.b.getScaling(s.scale,s.transform)):s.transform=c.b.fromRotationTranslationScale(c.b.create(),s.rotation,s.translation,s.scale),Object(a.e)(t.children))for(let r=0;r<t.children.length;r++){const n=t.children[r];Object(a.c)(e.gltf.nodes)[n];s.children.push(n)}return s})}async function I(t,e){const r=Object(a.d)(e.gltf.images,[]),n=Object(a.d)(e.gltf.textures,[]),i=Object(a.d)(e.gltf.samplers,[]),s={type:o.k.Texture2D,format:o.i.U8x4,usage:o.n.Static},c={wrapS:10497,wrapT:10497},u=r.map(r=>{const n=Object(a.c)(r.bufferView,"Image loading from a URI is not yet supported"),i=e.bufferViewData(n);let s;if(Object(a.e)(self.createImageBitmap)){const t=new Blob([i],{type:Object(a.c)(r.mimeType)});s=createImageBitmap(t)}else s=Promise.resolve(new Uint8Array(i).buffer);return s.then(e=>(Object(a.b)(!t.transferList.includes(e)),t.transferList.push(e),e))}),h=n.map(t=>{const e=Object(a.d)(i[t.sampler],c),r=Object.assign({},s);return Object(a.e)(e.magFilter)&&(r.defaultMagFilter=x[e.magFilter],Object(a.e)(r.defaultMagFilter)||console.warn(`Unsupported texture mag filter: ${e.magFilter}`)),Object(a.e)(e.minFilter)&&(r.defaultMagFilter=_[e.minFilter],Object(a.e)(r.defaultMagFilter)||console.warn(`Unsupported texture min filter: ${e.magFilter}`)),(Object(a.e)(e.wrapS)||Object(a.e)(e.wrapT))&&(Object(a.e)(r.defaultMagFilter)||console.warn(`Texture wrapping not yet supported: ${e.magFilter}`)),{name:t.name,desc:r,imageIndex:Object(a.c)(t.source)}});return{imageData:await Promise.all(u),textures:h}}function R(t,e){let r=[];for(const n of Object(a.d)(e.gltf.animations,[])){const i=n.samplers.map(r=>{Object(a.b)(5126===e.gltf.accessors[r.input].componentType,"Non-float animation time type unsupported"),Object(a.b)(5126===e.gltf.accessors[r.output].componentType,"Non-float animation values type unsupported");const n=new Float32Array(e.accessorData(r.input)),i=new Float32Array(e.accessorData(r.output));return t.transferList.push(n.buffer,i.buffer),{times:n,values:i}}),s=[];for(const t of n.channels){const e=t.target.node;if(!Object(a.e)(e))continue;const r=T[t.target.path],o=i[t.sampler],c=Object(a.d)(n.samplers[t.sampler].interpolation,"LINEAR");s.push({targetNodeId:e,targetProperty:r,times:o.times,values:o.values,interpolation:c})}r.push({name:n.name,maxTime:n.maxTime,tracks:s})}return r}class U extends u.c{copySampleValue_(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n*3+n,s=0;s!==n;s++)e[s]=r[i+s];return e}beforeStart_(t){this.copySampleValue_(t)}afterEnd_(t){this.copySampleValue_(t)}interpolate_(t,e,r,n){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,u=n-e,h=(r-e)/u,l=h*h,f=l*h,d=t*c,p=d-c,m=-2*f+3*l,g=f-l,y=1-m,b=g-l+h;for(let t=0;t!==o;t++){const e=s[p+t+o],r=s[p+t+a]*u,n=s[d+t+o],c=s[d+t]*u;i[t]=y*e+b*r+m*n+g*c}return i}}const D={texture:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download image");const r=t.source.uri.match(/.*\/(.+?)\./);t.name=r&&r.length>1?r[1]:"Unknown",self.createImageBitmap?(t.imageBitmap=await createImageBitmap(await e.blob()),t.transferList.push(t.imageBitmap),t.status=n.LoadingSync):(t.imageBuffer=await e.arrayBuffer(),t.transferList.push(t.imageBuffer),t.status=n.LoadingSync)}loadSync(t,e){if(e.imageBitmap)e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:o.n.Static,type:o.k.Texture2D,format:o.i.U8x3,maxAnistropy:16},e.imageBitmap):-1,e.imageBitmap.close(),delete e.imageBitmap,e.status=n.Loaded;else{if(e.imageBuffer){var r=new Blob([e.imageBuffer],{type:"image/jpeg"});let t=window.URL.createObjectURL(r);delete e.imageBuffer,e.imageElement=new Image,e.imageElement.src=t,e.status=n.LoadingSync}Object(a.e)(e.imageElement)&&e.imageElement.complete&&(e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:o.n.Static,type:o.k.Texture2D,format:o.i.U8x3,maxAnistropy:16},e.imageElement):-1,delete e.imageElement,e.status=n.Loaded)}}unloadSync(t,e){Object(a.e)(e.texture)&&t.renderer&&t.renderer.removeTexture(e.texture),Object(a.e)(e.imageBitmap)&&e.imageBitmap.close()}},gltf:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download GLTF");const r=await e.arrayBuffer(),i=new m(r),s=JSON.parse(i.json),o=new g(s,[i.binaryChunk]);t.nodes=[],t.meshes=[],t.materials=[],t.textures=[],t.bufferViews=[],t.animations=[],t.rootNodeIds=[],t.bufferData=[],t.transient={techniques:j(t,o),materials:E(0,o),nodes:B(0,o),animation:R(t,o),textures:await I(t,o)},function(t,e){const r=Object(a.d)(e.gltf.meshes,[]);t.meshes=[];for(let n=0;n<r.length;n++){const i=Object(a.c)(r[n]),s=[];for(let r of i.primitives)s.push(F(t,e,r));const o={name:i.name,id:n,primitives:s};t.meshes[n]=o}}(t,o),function(t,e){const r=Object(a.d)(e.gltf.skins,[]);t.skins=[];for(let n=0;n<r.length;n++){const i=r[n];let s=void 0;if(Object(a.e)(i.inverseBindMatrices)){const r=new Float32Array(e.accessorData(i.inverseBindMatrices));Object(a.b)(!t.transferList.includes(r.buffer)),t.transferList.push(r.buffer),s=[];for(let t=0;t<i.joints.length;t++)s[t]=r.subarray(16*t,16*t+16)}t.skins[n]={name:i.name,skeleton:i.skeleton,joints:i.joints,inverseBindMatrices:s}}}(t,o),function(t,e){const r=Object(a.d)(e.gltf.scene,0);if(Object(a.e)(r)){const n=Object(a.c)(e.gltf.scenes),i=Object(a.c)(n[r]);t.rootNodeIds=Object(a.d)(i.nodes,[])}}(t,o),Object(a.b)(!t.transferList.includes(r)),t.status=n.LoadingSync}loadSync(t,e){if(Object(a.e)(self.createImageBitmap))e.status=n.Loaded;else if(function(t,e){let r=!1;const i=t.transient.textures;let s=0;for(let c=0;c<i.textures.length;c++){const u=i.textures[c],h=i.imageData[u.imageIndex];if(Object(a.e)(t.textures[c]))s+=1;else{if(h instanceof ArrayBuffer){r=!0;var o=new Blob([h],{type:"image/jpeg"});let e=window.URL.createObjectURL(o);i.imageData[u.imageIndex]=new Image,i.imageData[u.imageIndex].src=e,t.status=n.LoadingSync}h.complete&&(Object(a.b)(Object(a.e)(t.textures),"This should have been defined as an empty array by loadTexturesSync()"),t.textures[c]={desc:u.desc,name:u.name,id:Object(a.e)(e.renderer)?e.renderer.createTexture(u.name,u.desc,h):-1})}}return s===i.textures.length?t.status=n.Loaded:t.status=n.LoadingSync,!r}(e,t))return;if(e.techniques=function(t,e){if(!Object(a.e)(t))return[];const r=Object(a.e)(e.renderer)?t.shaders.map(r=>{const n=t.shaderData[r.vsIndex],i=t.shaderData[r.fsIndex],s={name:r.name,vertSource:p(n),fragSource:p(i)};return e.renderer.createShader(s)}):[];return t.techniques.map(t=>({shaderId:r[t.shaderIndex],attributes:t.attributes,uniforms:t.uniforms}))}(e.transient.techniques,t),e.materials=function(t,e){return t.map(t=>({name:t.name,renderFormat:t.renderFormat,cullMode:t.cullMode,values:t.values,technique:Object(a.e)(t.techniqueIndex)?e.techniques[t.techniqueIndex]:void 0}))}(e.transient.materials,e),e.nodes=function(t){const e=t.map((t,e)=>{const r=new y;return r.name=Object(a.d)(t.name,`Node${e}`),r.position.set(t.translation[0],t.translation[1],t.translation[2]),r.quaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),r.scale.set(t.scale[0],t.scale[1],t.scale[2]),r.skinId=t.skinId,r.meshId=t.meshId,r.morphWeight=t.morphWeight,r});for(let r=0;r<e.length;r++){const n=t[r],i=e[r];for(const t of n.children)i.add(e[t])}return e}(e.transient.nodes),e.animations=function(t,e){const r=[];for(const n of t){const t=n.tracks.map(t=>{let r;switch(t.targetProperty){case"quaternion":r=u.f;break;case"position":case"scale":r=u.g;break;default:throw new Error("Unsupported animation target property")}const n=new r(`${e.nodes[t.targetNodeId].name}.${t.targetProperty}`,t.times,t.values,k[t.interpolation]);return"CUBICSPLINE"===t.interpolation&&(n.createInterpolant=function(t){return new U(this.times,this.values,this.getValueSize()/3,t)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),n});r.push(new u.a(n.name,n.maxTime,t))}return r}(e.transient.animation,e),e.textures=function(t,e){const r=[];if(Object(a.e)(self.createImageBitmap)&&Object(a.e)(e.renderer)){for(const n of t.textures){const i=t.imageData[n.imageIndex];Object(a.b)(i instanceof ImageBitmap),r.push({desc:n.desc,name:n.name,id:e.renderer.createTexture(n.name,n.desc,i)})}for(const e of t.imageData)e.close()}return r}(e.transient.textures,t),Object(a.e)(t.renderer))for(let r in e.bufferData){const n=e.bufferViews[r],i=e.bufferData[r];n.buffer=t.renderer.createBuffer(n.name,n.type,o.n.Static,i)}e.status===n.Loaded&&delete e.transient}unloadSync(t,e){}}};class P{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(t){this.worker=new s.a,this.worker.onmessage=t=>this.onMessage(t),this.context={renderer:t}}onMessage(t){this.messages.push(t)}load(t,e,r){if(!Object(a.e)(D[e]))return void r("Invalid resource type",void 0);const i="string"==typeof t?t:t.uri,s="string"==typeof t?void 0:t.headers,o=i+e;if(Object(a.e)(this.cache[o]))r(void 0,this.cache[o]);else if(this.requests[o])this.requests[o].push(r);else{this.requests[o]=[r];const t={source:{uri:i,headers:s,type:e},status:n.LoadingAsync,transferList:[]};this.worker.postMessage([t])}}unload(t,e){const r=("string"==typeof t?t:t.uri)+e;if(Object(a.e)(this.cache[r])){const t=this.cache[r];D[t.source.type].unloadSync(this.context,t),delete this.cache[r]}else{if(!this.requests[r])throw new Error(`Attempted to unload a resource that was never loaded: ${r}`);delete this.requests[r]}}update(){for(let t of this.messages)Array.prototype.push.apply(this.pending,t.data);for(let t of this.pending){const e=t.source.uri+t.source.type;if(Object(a.e)(this.requests[e])||(t.status=n.Unloaded),t.status===n.LoadingSync){D[t.source.type].loadSync(this.context,t)}switch(t.status){case n.Loaded:case n.Failed:this.finished.push(t);break;case n.Unloaded:this.unloaded.push(t);break;case n.LoadingAsync:this.loadingAsync.push(t);break;case n.LoadingSync:this.loadingSync.push(t)}}this.pending.length=0;for(let t of this.finished){const e=t.source.uri+t.source.type,r=Object(a.c)(this.requests[e]).length;Object(a.b)(r>=1),this.cache[e]=t;for(let i=0;i<r;i++)t.status===n.Failed?this.requests[e][i](t.error,void 0):this.requests[e][i](void 0,t);delete this.requests[e]}const t=[];for(let e of this.loadingAsync)Array.prototype.push.apply(t,e.transferList);this.worker.postMessage(this.loadingAsync,t);for(let t of this.unloaded){D[t.source.type].unloadSync(this.context,t)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}},function(t,e){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),s=t.indexOf("]");-1!=i&&-1!=s&&(t=t.substring(0,i)+t.substring(i,s).replace(/:/g,";")+t.substring(s,t.length));for(var o=r.exec(t||""),a={},c=14;c--;)a[n[c]]=o[c]||"";return-1!=i&&-1!=s&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){(function(e){t.exports=function(t){return r&&e.isBuffer(t)||n&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))};var r="function"==typeof e&&"function"==typeof e.isBuffer,n="function"==typeof ArrayBuffer}).call(this,r(38).Buffer)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var n=r(76),i=r(56),s=r(25),o=r(37),a=r(57),c=r(58),u=r(31)("socket.io-client:manager"),h=r(55),l=r(93),f=Object.prototype.hasOwnProperty;function d(t,e){if(!(this instanceof d))return new d(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=e.parser||o;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=d,d.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},d.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},d.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},s(d.prototype),d.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},d.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},d.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(t,e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=a(r,"open",(function(){i.onopen(),t&&t()})),o=a(r,"error",(function(e){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var r=new Error("Connection error");r.data=e,t(r)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var h=setTimeout((function(){u("connect attempt timed out after %d",c),s.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(s),this.subs.push(o),this},d.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(a(t,"data",c(this,"ondata"))),this.subs.push(a(t,"ping",c(this,"onping"))),this.subs.push(a(t,"pong",c(this,"onpong"))),this.subs.push(a(t,"error",c(this,"onerror"))),this.subs.push(a(t,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(t){this.decoder.add(t)},d.prototype.ondecoded=function(t){this.emit("packet",t)},d.prototype.onerror=function(t){u("error",t),this.emitAll("error",t)},d.prototype.socket=function(t,e){var r=this.nsps[t];if(!r){r=new i(this,t,e),this.nsps[t]=r;var n=this;r.on("connecting",s),r.on("connect",(function(){r.id=n.generateId(t)})),this.autoConnect&&s()}function s(){~h(n.connecting,r)||n.connecting.push(r)}return r},d.prototype.destroy=function(t){var e=h(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},d.prototype.packet=function(t){u("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(r){for(var n=0;n<r.length;n++)e.engine.write(r[n],t.options);e.encoding=!1,e.processPacketQueue()})))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},d.prototype.cleanup=function(){u("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(t){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();u("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout((function(){t.skipReconnect||(u("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(u("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(u("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(r)}})}},d.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,r){var n=r(39),i=r(79),s=r(89),o=r(90);e.polling=function(t){var e=!1,r=!1,o=!1!==t.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),e=t.hostname!==location.hostname||c!==t.port,r=t.secure!==a}if(t.xdomain=e,t.xscheme=r,"open"in new n(t)&&!t.forceJSONP)return new i(t);if(!o)throw new Error("JSONP disabled");return new s(t)},e.websocket=o},function(t,e,r){var n=r(40),i=r(32),s=r(26),o=r(33),a=r(54),c=r(34)("engine.io-client:polling");t.exports=h;var u=null!=new(r(39))({xdomain:!1}).responseType;function h(t){var e=t&&t.forceBase64;u&&!e||(this.supportsBinary=!1),n.call(this,t)}o(h,n),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(t){var e=this;function r(){c("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--n||r()}))),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){c("pre-pause writing complete"),--n||r()})))}else r()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(t){var e=this;c("polling got data %s",t);s.decodePayload(t,this.socket.binaryType,(function(t,r,n){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var t=this;function e(){c("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},h.prototype.write=function(t){var e=this;this.writable=!1;var r=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,r)}))},h.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(t[this.timestampParam]=a()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(r=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t}},function(t,e,r){(function(e){var n=r(81),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function t(r){if(!r||"object"!=typeof r)return!1;if(n(r)){for(var i=0,a=r.length;i<a;i++)if(t(r[i]))return!0;return!1}if("function"==typeof e&&e.isBuffer&&e.isBuffer(r)||"function"==typeof ArrayBuffer&&r instanceof ArrayBuffer||s&&r instanceof Blob||o&&r instanceof File)return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return t(r.toJSON(),!0);for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&t(r[c]))return!0;return!1}}).call(this,r(38).Buffer)},function(t,e,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},o=0,a=0;function c(t){var e="";do{e=i[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function u(){var t=c(+new Date);return t!==n?(o=0,n=t):t+"."+c(o++)}for(;a<64;a++)s[i[a]]=a;u.encode=c,u.decode=function(t){var e=0;for(a=0;a<t.length;a++)e=64*e+s[t.charAt(a)];return e},t.exports=u},function(t,e){var r=[].indexOf;t.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}},function(t,e,r){var n=r(37),i=r(25),s=r(92),o=r(57),a=r(58),c=r(31)("socket.io-client:socket"),u=r(32),h=r(53);t.exports=d;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;function d(t,e,r){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[o(t,"open",a(this,"onopen")),o(t,"packet",a(this,"onpacket")),o(t,"close",a(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},d.prototype.emit=function(t){if(l.hasOwnProperty(t))return f.apply(this,arguments),this;var e=s(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:h(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},d.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},d.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},d.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},d.prototype.onpacket=function(t){var e=t.nsp===this.nsp,r=t.type===n.ERROR&&"/"===t.nsp;if(e||r)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},d.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},d.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var i=s(arguments);c("sending ack %j",i),e.packet({type:h(i)?n.BINARY_ACK:n.ACK,id:t,data:i})}}},d.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(t){return this.flags.compress=t,this},d.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e,r){return t.on(e,r),{destroy:function(){t.removeListener(e,r)}}}},function(t,e){var r=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return e.apply(t,n.concat(r.call(arguments)))}}},function(t,e,r){var n=r(66),i=r(37),s=r(50),o=r(31)("socket.io-client");t.exports=e=c;var a=e.managers={};function c(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,i=n(t),c=i.source,u=i.id,h=i.path,l=a[u]&&h in a[u].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||l?(o("ignoring socket cache for %s",c),r=s(c,e)):(a[u]||(o("new io instance for %s",c),a[u]=s(c,e)),r=a[u]),i.query&&!e.query&&(e.query=i.query),r.socket(i.path,e)}e.protocol=i.protocol,e.connect=c,e.Manager=r(50),e.Socket=r(56)},function(t,e,r){t.exports=function(){return new Worker(r.p+"ResourceLoading.worker.eff2a532c5b14b8277f0.js")}},function(t,e,r){"use strict";r.r(e),r.d(e,"Server",(function(){return B}));var n=r(19),i=r(29),s=r(42),o=r(43),a=r(45),c=r(20),u=r(41),h=r(8),l=r(44),f=r(2);const d=f.d.create(),p=f.d.create(),m=f.d.create(),g=f.d.create(),y=f.d.create(),b=f.d.create(),v=f.d.create(),w=f.d.create(),x=f.d.create();function _(t,e,r,n){let i,s,o,a,c,u,h=1/0,l=-1/0,_=0;const M=t.halfLengths[0],C=t.halfLengths[1],A=t.halfLengths[2],S=f.d.subtract(d,e,t.center),k=f.d.subtract(p,r,t.center),T=f.d.subtract(m,n,t.center),F=f.d.subtract(g,k,S),O=f.d.subtract(y,T,k),E=f.d.subtract(b,S,T);function j(t,e,r){h=Math.min(t,e,r),l=Math.max(t,e,r)}function B(t,e,r,n){i=t*S[1]-e*S[2],o=t*T[1]-e*T[2],i<o?(h=i,l=o):(h=o,l=i),_=r*C+n*A}function I(t,e,r,n){i=-t*S[0]+e*S[2],o=-t*T[0]+e*T[2],i<o?(h=i,l=o):(h=o,l=i),_=r*M+n*A}function R(t,e,r,n){s=t*k[0]-e*k[1],o=t*T[0]-e*T[1],o<s?(h=o,l=s):(h=s,l=o),_=r*M+n*C}if(a=Math.abs(F[0]),c=Math.abs(F[1]),u=Math.abs(F[2]),B(F[2],F[1],u,c),h>_||l<-_)return!1;if(I(F[2],F[0],u,a),h>_||l<-_)return!1;if(R(F[1],F[0],c,a),h>_||l<-_)return!1;if(a=Math.abs(O[0]),c=Math.abs(O[1]),u=Math.abs(O[2]),B(O[2],O[1],u,c),h>_||l<-_)return!1;if(I(O[2],O[0],u,a),h>_||l<-_)return!1;if(function(t,e,r,n){i=t*S[0]-e*S[1],s=t*k[0]-e*k[1],i<s?(h=i,l=s):(h=s,l=i),_=r*M+n*C}(O[1],O[0],c,a),h>_||l<-_)return!1;if(a=Math.abs(E[0]),c=Math.abs(E[1]),u=Math.abs(E[2]),function(t,e,r,n){i=t*S[1]-e*S[2],s=t*k[1]-e*k[2],i<s?(h=i,l=s):(h=s,l=i),_=r*C+n*A}(E[2],E[1],u,c),h>_||l<-_)return!1;if(function(t,e,r,n){i=-t*S[0]+e*S[2],s=-t*k[0]+e*k[2],i<s?(h=i,l=s):(h=s,l=i),_=r*M+n*A}(E[2],E[0],u,a),h>_||l<-_)return!1;if(R(E[1],E[0],c,a),h>_||l<-_)return!1;if(j(S[0],k[0],T[0]),h>M||l<-M)return!1;if(j(S[1],k[1],T[1]),h>C||l<-C)return!1;if(j(S[2],k[2],T[2]),h>A||l<-A)return!1;const U=f.d.cross(v,F,O);return!!function(t,e,r){let n;const i=w,s=x;for(n=0;n<=2;n++)t[n]>0?(i[n]=-r[n],s[n]=r[n]):(i[n]=r[n],s[n]=-r[n]);return!(f.d.dot(t,i)+e>0)&&f.d.dot(t,s)+e>=0}(U,-f.d.dot(U,S),t.halfLengths)}var M=r(0),C=r(24);class A{constructor(){this.center=f.d.create(),this.bases=[f.d.create(),f.d.create(),f.d.create()],this.halfLengths=f.d.create()}setFromMatrix(t){return f.b.getTranslation(this.center,t),f.d.set(this.bases[0],t[0],t[1],t[2]),f.d.set(this.bases[1],t[4],t[5],t[6]),f.d.set(this.bases[2],t[8],t[9],t[10]),this.halfLengths[0]=f.d.length(this.bases[0]),this.halfLengths[1]=f.d.length(this.bases[1]),this.halfLengths[2]=f.d.length(this.bases[2]),f.d.scale(this.bases[0],this.bases[0],1/this.halfLengths[0]),f.d.scale(this.bases[1],this.bases[1],1/this.halfLengths[1]),f.d.scale(this.bases[2],this.bases[2],1/this.halfLengths[2]),this}toMatrix(t){return f.b.set(t,this.halfLengths[0]*this.bases[0][0],this.halfLengths[0]*this.bases[0][1],this.halfLengths[0]*this.bases[0][2],0,this.halfLengths[1]*this.bases[1][0],this.halfLengths[1]*this.bases[1][1],this.halfLengths[1]*this.bases[1][2],0,this.halfLengths[2]*this.bases[2][0],this.halfLengths[2]*this.bases[2][1],this.halfLengths[2]*this.bases[2][2],0,this.center[0],this.center[1],this.center[2],1),t}createWorldToObbMatrix(t){const e=f.d.dot(this.center,this.bases[0]),r=f.d.dot(this.center,this.bases[1]),n=f.d.dot(this.center,this.bases[2]);return f.b.set(t,this.bases[0][0],this.bases[1][0],this.bases[2][0],0,this.bases[0][1],this.bases[1][1],this.bases[2][1],0,this.bases[0][2],this.bases[1][2],this.bases[2][2],0,-e,-r,-n,1),t}}const S=f.b.create(),k=f.d.create(),T=f.d.create(),F=f.d.create(),O=f.d.create(),E={center:f.d.create(),halfLengths:f.d.create()};class j{constructor(){this.attacks=[],this.attackOwners=[],this.targets=[],this.targetOwners=[],this.hitCache=[];for(let t=0;t<8;t++)this.hitCache[t]=f.d.create()}addAttackRegion(t,e){this.attacks.push(t),this.attackOwners.push(e)}addTargetObb(t,e){t instanceof A||(t=(new A).setFromMatrix(t));const r=this.targets.length;return this.targets.push(t),this.targetOwners.push(e),r}getHitsForTarget(t){const e=this.targets[t],r=[];let n=0;const i=e.createWorldToObbMatrix(S);for(let t=0;t<this.attacks.length;t++){const s=this.attacks[t],o=f.d.transformMat4(k,s.verts[0],i),a=f.d.transformMat4(T,s.verts[1],i),c=f.d.transformMat4(F,s.verts[2],i),u=f.d.transformMat4(O,s.verts[3],i),h=E;h.halfLengths=e.halfLengths;let l=_(h,o,a,c);if(l||(l=_(h,a,c,u)),l){Object(M.b)(n<8,"Too many hits in one frame");const e=this.hitCache[n++];r.push({owner:this.attackOwners[t],pos:e})}}return r}clear(){this.attacks.length=0,this.targets.length=0,this.attackOwners.length=0,this.targetOwners.length=0}debugRender(){const t=this.targets.map(t=>t.toMatrix(f.b.create())),e=[];for(const t of this.attacks)e.push(t.verts[0],t.verts[1],t.verts[2],t.verts[3]);C.a.renderObbs(t.slice(0,1)),C.a.renderQuads(e)}}class B{constructor(){this.debugMenu=new u.a,this.world=new h.b,this.collision=new j,this.avatar=new i.d,this.weapon=new l.a(this.world),this.clock=new s.a,this.net=new o.b,this.resources=new a.a,this.userCommands=new c.b,this.init()}async init(){console.log(`Source for this build available at ${n.a}`),window.onbeforeunload=this.onUnload.bind(this),this.resources.initialize(),this.clock.initialize(this),this.net.initialize(this),this.avatar.initialize(this),this.weapon.initialize(this),n.b;return setInterval(this.tick.bind(this),16),0}onConnect(t){this.net.onConnect(t)}tick(){this.clock.tick(),this.updateFixed(),this.update()}updateFixed(){let t=0;for(;this.clock.updateFixed();)t+=1,this.collision.clear(),this.avatar.updateFixed(this),this.weapon.updateFixed(this),this.avatar.updateFixedLate(this),this.world.captureState(this.clock.simFrame),this.net.transmitToClients(this.clock.simFrame);1!==t&&console.warn("[Server] Uneven fixed frame tick:",t)}update(){this.resources.update(),this.collision.debugRender()}onUnload(){this.net.terminate()}}},,,,,function(t,e,r){var n=r(46),i=r(31)("socket.io-client:url");t.exports=function(t,e){var r=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),r=n(t));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var s=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port,r.href=r.protocol+"://"+s+(e&&e.port===r.port?"":":"+r.port),r}},function(t,e,r){t.exports=function(t){function e(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let r;function o(...t){if(!o.enabled)return;const e=o,i=Number(new Date),s=i-(r||i);e.diff=s,e.prev=r,e.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;a++;const s=n.formatters[i];if("function"==typeof s){const n=t[a];r=s.call(e,n),t.splice(a,1),a--}return r}),n.formatArgs.call(e,t),(e.log||n.log).apply(e,t)}return o.namespace=t,o.enabled=n.enabled(t),o.useColors=n.useColors(),o.color=e(t),o.destroy=i,o.extend=s,"function"==typeof n.init&&n.init(o),n.instances.push(o),o}function i(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function s(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(o),...n.skips.map(o).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(e=0;e<i;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=r(68),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function o(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return o(t,e,s,"day");if(e>=i)return o(t,e,i,"hour");if(e>=n)return o(t,e,n,"minute");if(e>=r)return o(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){(function(n){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG),t}(e=t.exports=r(70)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.diff),!r)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(s=i))})),t.splice(s,0,n)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,r(36))},function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,i=+new Date,s=i-(r||i);t.diff=s,t.prev=r,t.curr=i,r=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;c++;var i=e.formatters[n];if("function"==typeof i){var s=o[c];r=i.call(t,s),o.splice(c,1),c--}return r})),e.formatArgs.call(t,o);var u=n.log||e.log||console.log.bind(console);u.apply(t,o)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var s=e.instances[r];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r(71),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function o(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var a,c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===c&&!1===isNaN(t))return e.long?o(a=t,s,"day")||o(a,i,"hour")||o(a,n,"minute")||o(a,r,"second")||a+" ms":function(t){if(t>=s)return Math.round(t/s)+"d";if(t>=i)return Math.round(t/i)+"h";if(t>=n)return Math.round(t/n)+"m";if(t>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){var n=r(47),i=r(48),s=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);e.deconstructPacket=function(t){var e=[],r=t.data,s=t;return s.data=function t(e,r){if(!e)return e;if(i(e)){var s={_placeholder:!0,num:r.length};return r.push(e),s}if(n(e)){for(var o=new Array(e.length),a=0;a<e.length;a++)o[a]=t(e[a],r);return o}if("object"==typeof e&&!(e instanceof Date)){o={};for(var c in e)o[c]=t(e[c],r);return o}return e}(r,e),s.attachments=e.length,{packet:s,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,r){if(!e)return e;if(e&&e._placeholder)return r[e.num];if(n(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],r);else if("object"==typeof e)for(var s in e)e[s]=t(e[s],r);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var r=0,s=t;!function t(c,u,h){if(!c)return c;if(o&&c instanceof Blob||a&&c instanceof File){r++;var l=new FileReader;l.onload=function(){h?h[u]=this.result:s=this.result,--r||e(s)},l.readAsArrayBuffer(c)}else if(n(c))for(var f=0;f<c.length;f++)t(c[f],f,c);else if("object"==typeof c&&!i(c))for(var d in c)t(c[d],d,c)}(s),r||e(s)}},function(t,e,r){"use strict";e.byteLength=function(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,n=u(t),o=n[0],a=n[1],c=new s(function(t,e,r){return 3*(e+r)/4-r}(0,o,a)),h=0,l=a>0?o-4:o;for(r=0;r<l;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],c[h++]=e>>16&255,c[h++]=e>>8&255,c[h++]=255&e;2===a&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,c[h++]=255&e);1===a&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,c[h++]=e>>8&255,c[h++]=255&e);return c},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,s=[],o=0,a=r-i;o<a;o+=16383)s.push(h(t,o,o+16383>a?a:o+16383));1===i?(e=t[r-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return s.join("")};for(var n=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)n[a]=o[a],i[o.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t,e,r){for(var i,s,o=[],a=e;a<r;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,c=(1<<a)-1,u=c>>1,h=-7,l=r?i-1:0,f=r?-1:1,d=t[e+l];for(l+=f,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[e+l],l+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+t[e+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=u}return(d?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,c,u=8*s-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(e*c-1)*Math.pow(2,i),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[r+d]=255&o,d+=p,o/=256,u-=8);t[r+d-p]|=128*m}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){t.exports=r(77),t.exports.parser=r(26)},function(t,e,r){var n=r(51),i=r(25),s=r(34)("engine.io-client:socket"),o=r(55),a=r(26),c=r(46),u=r(32);function h(t,e){if(!(this instanceof h))return new h(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=c(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=c(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=h,h.priorWebsocketSuccess=!1,i(h.prototype),h.protocol=a.protocol,h.Socket=h,h.Transport=r(40),h.transports=r(51),h.parser=r(26),h.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}(this.query);e.EIO=a.protocol,e.transport=t;var r=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new n[t]({query:e,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},h.prototype.open=function(){var t;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},h.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},h.prototype.probe=function(t){s('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(s('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(s('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;h.priorWebsocketSuccess="websocket"===e.name,s('pausing current transport "%s"',n.transport.name),n.transport.pause((function(){r||"closed"!==n.readyState&&(s("changing transport and sending upgrade packet"),f(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush())}))}else{s('probe transport "%s" failed',t);var o=new Error("probe error");o.transport=e.name,n.emit("upgradeError",o)}})))}function o(){r||(r=!0,f(),e.close(),e=null)}function a(r){var i=new Error("probe error: "+r);i.transport=e.name,o(),s('probe transport "%s" failed because of error: %s',t,r),n.emit("upgradeError",i)}function c(){a("transport closed")}function u(){a("socket closed")}function l(t){e&&t.name!==e.name&&(s('"%s" works - aborting "%s"',t.name,e.name),o())}function f(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),n.removeListener("close",u),n.removeListener("upgrading",l)}h.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",u),this.once("upgrading",l),e.open()},h.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},h.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else s('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},h.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},h.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(t,e,r){return this.sendPacket("message",t,e,r),this},h.prototype.sendPacket=function(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():e()})):this.upgrading?n():e()}function e(){t.onClose("forced close"),s("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this},h.prototype.onError=function(t){s("socket error %j",t),h.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},h.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(t){for(var e=[],r=0,n=t.length;r<n;r++)~o(this.transports,t[r])&&e.push(t[r]);return e}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,r){var n=r(39),i=r(52),s=r(25),o=r(33),a=r(34)("engine.io-client:polling-xhr");function c(){}function u(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,r=location.port;r||(r=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==e}}function h(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(t.exports=u,t.exports.Request=h,o(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new h(t)},u.prototype.doWrite=function(t,e){var r="string"!=typeof t&&void 0!==t,n=this.request({method:"POST",data:t,isBinary:r}),i=this;n.on("success",e),n.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=n},u.prototype.doPoll=function(){a("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},s(h.prototype),h.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(t),r=this;try{a("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&e.setRequestHeader(i,this.extraHeaders[i])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?r.onLoad():setTimeout((function(){r.onError("number"==typeof e.status?e.status:0)}),0))},a("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){r.onError(t)}),0)}"undefined"!=typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},h.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},h.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},h.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",f);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,f,!1)}function f(){for(var t in h.requests)h.requests.hasOwnProperty(t)&&h.requests[t].abort()}},function(t,e){t.exports=Object.keys||function(t){var e=[],r=Object.prototype.hasOwnProperty;for(var n in t)r.call(t,n)&&e.push(n);return e}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e){t.exports=function(t,e,r){var n=t.byteLength;if(e=e||0,r=r||n,t.slice)return t.slice(e,r);if(e<0&&(e+=n),r<0&&(r+=n),r>n&&(r=n),e>=n||e>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(r-e),o=e,a=0;o<r;o++,a++)s[a]=i[o];return s.buffer}},function(t,e){function r(){}t.exports=function(t,e,n){var i=!1;return n=n||r,s.count=t,0===t?e():s;function s(t,r){if(s.count<=0)throw new Error("after called too many times");--s.count,t?(i=!0,e(t),e=n):0!==s.count||i||e(null,r)}}},function(t,e){
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var r,n,i,s=String.fromCharCode;function o(t){for(var e,r,n=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function a(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(t,e){return s(t>>e&63|128)}function u(t,e){if(0==(4294967168&t))return s(t);var r="";return 0==(4294965248&t)?r=s(t>>6&31|192):0==(4294901760&t)?(a(t,e)||(t=65533),r=s(t>>12&15|224),r+=c(t,6)):0==(4292870144&t)&&(r=s(t>>18&7|240),r+=c(t,12),r+=c(t,6)),r+=s(63&t|128)}function h(){if(i>=n)throw Error("Invalid byte index");var t=255&r[i];if(i++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function l(t){var e,s;if(i>n)throw Error("Invalid byte index");if(i==n)return!1;if(e=255&r[i],i++,0==(128&e))return e;if(192==(224&e)){if((s=(31&e)<<6|h())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&e)){if((s=(15&e)<<12|h()<<6|h())>=2048)return a(s,t)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(s=(7&e)<<18|h()<<12|h()<<6|h())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}t.exports={version:"2.1.2",encode:function(t,e){for(var r=!1!==(e=e||{}).strict,n=o(t),i=n.length,s=-1,a="";++s<i;)a+=u(n[s],r);return a},decode:function(t,e){var a=!1!==(e=e||{}).strict;r=o(t),n=r.length,i=0;for(var c,u=[];!1!==(c=l(a));)u.push(c);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=s((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=s(e);return i}(u)}}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),i=n.length,s="";for(r=0;r<i;r+=3)s+=t[n[r]>>2],s+=t[(3&n[r])<<4|n[r+1]>>4],s+=t[(15&n[r+1])<<2|n[r+2]>>6],s+=t[63&n[r+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},e.decode=function(t){var e,n,i,s,o,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var h=new ArrayBuffer(a),l=new Uint8Array(h);for(e=0;e<c;e+=4)n=r[t.charCodeAt(e)],i=r[t.charCodeAt(e+1)],s=r[t.charCodeAt(e+2)],o=r[t.charCodeAt(e+3)],l[u++]=n<<2|i>>4,l[u++]=(15&i)<<4|s>>2,l[u++]=(3&s)<<6|63&o;return h}}()},function(t,e){var r=void 0!==r?r:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),s=r&&r.prototype.append&&r.prototype.getBlob;function o(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var r=new Uint8Array(t.byteLength);r.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=r.buffer}return e}return t}))}function a(t,e){e=e||{};var n=new r;return o(t).forEach((function(t){n.append(t)})),e.type?n.getBlob(e.type):n.getBlob()}function c(t,e){return new Blob(o(t),e||{})}"undefined"!=typeof Blob&&(a.prototype=Blob.prototype,c.prototype=Blob.prototype),t.exports=n?i?Blob:c:s?a:void 0},function(t,e,r){t.exports=function(t){function e(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let r;function o(...t){if(!o.enabled)return;const e=o,i=Number(new Date),s=i-(r||i);e.diff=s,e.prev=r,e.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;a++;const s=n.formatters[i];if("function"==typeof s){const n=t[a];r=s.call(e,n),t.splice(a,1),a--}return r}),n.formatArgs.call(e,t),(e.log||n.log).apply(e,t)}return o.namespace=t,o.enabled=n.enabled(t),o.useColors=n.useColors(),o.color=e(t),o.destroy=i,o.extend=s,"function"==typeof n.init&&n.init(o),n.instances.push(o),o}function i(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function s(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(o),...n.skips.map(o).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(e=0;e<i;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=r(88),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function o(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return o(t,e,s,"day");if(e>=i)return o(t,e,i,"hour");if(e>=n)return o(t,e,n,"minute");if(e>=r)return o(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){(function(e){var n=r(52),i=r(33);t.exports=h;var s,o=/\n/g,a=/\\n/g;function c(){}function u(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function h(t){if(n.call(this,t),this.query=this.query||{},!s){var e=u();s=e.___eio=e.___eio||[]}this.index=s.length;var r=this;s.push((function(t){r.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){r.script&&(r.script.onerror=c)}),!1)}i(h,n),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},h.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},h.prototype.doWrite=function(t,e){var r=this;if(!this.form){var n,i=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function u(){h(),e()}function h(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(t)}catch(t){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),h(),t=t.replace(a,"\\\n"),this.area.value=t.replace(o,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,r(49))},function(t,e,r){(function(e){var n,i,s=r(40),o=r(26),a=r(32),c=r(33),u=r(54),h=r(34)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{i=r(91)}catch(t){}var l=n||i;function f(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=n&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(l=i),s.call(this,t)}t.exports=f,c(f,s),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new l(t,e):new l(t):new l(t,e,r)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},f.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},f.prototype.write=function(t){var r=this;this.writable=!1;for(var n=t.length,i=0,s=n;i<s;i++)!function(t){o.encodePacket(t,r.supportsBinary,(function(i){if(!r.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),r.perMessageDeflate)("string"==typeof i?e.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(s.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,s)}catch(t){h("websocket closed before onclose event")}--n||a()}))}(t[i]);function a(){r.emit("flush"),setTimeout((function(){r.writable=!0,r.emit("drain")}),0)}},f.prototype.onClose=function(){s.prototype.onClose.call(this)},f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},f.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",r="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),(t=a.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t},f.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===f.prototype.name)}}).call(this,r(38).Buffer)},function(t,e){},function(t,e){t.exports=function(t,e){for(var r=[],n=(e=e||0)||0;n<t.length;n++)r[n-e]=t[n];return r}},function(t,e){function r(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-r:t+r}return 0|Math.min(t,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(t){this.ms=t},r.prototype.setMax=function(t){this.max=t},r.prototype.setJitter=function(t){this.jitter=t}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec2 a_pos;out vec3 v_worldPos;uniform float u_gridRadius;uniform mat4 g_viewProj;void main(){v_worldPos=vec3(a_pos.x,0,a_pos.y)*u_gridRadius;gl_Position=g_viewProj*vec4(v_worldPos,1.);}",uniforms:{u_gridRadius:{variableType:"float",variableName:"u_gridRadius"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec3 v_worldPos;out vec4 o_fragColor;uniform vec4 u_baseColor;uniform vec4 u_lineColor;uniform float u_gridUnit;uniform float u_gridRadius;void main(){vec2 coord=v_worldPos.xz/u_gridUnit;vec2 grid=abs(fract(coord-0.5)-0.5)/fwidth(coord);float line=min(grid.x,grid.y);float lineAmount=1.-min(line,1.);vec4 color=mix(u_baseColor,u_lineColor,lineAmount);float opacity=smoothstep(u_gridRadius*0.7,u_gridRadius,length(v_worldPos));color=mix(color,vec4(0),opacity);o_fragColor=color;}",uniforms:{u_baseColor:{variableType:"vec4",variableName:"u_baseColor"},u_lineColor:{variableType:"vec4",variableName:"u_lineColor"},u_gridUnit:{variableType:"float",variableName:"u_gridUnit"},u_gridRadius:{variableType:"float",variableName:"u_gridRadius"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;attribute vec3 a_normal;attribute vec2 a_uv0;uniform mat4 u_model;uniform mat4 g_viewProj;varying vec2 v_uv;void main(){v_uv=a_uv0;gl_Position=g_viewProj*u_model*vec4(a_pos,1.);}",uniforms:{u_model:{variableType:"mat4",variableName:"u_model"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;uniform sampler2D u_tex;varying vec2 v_uv;void main(){vec4 tap=texture2D(u_tex,v_uv);gl_FragColor=vec4(tap.xyz,1);}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"},u_tex:{variableType:"sampler2D",variableName:"u_tex"}},consts:{}}},,function(t,e,r){"use strict";r.r(e);var n=r(19),i=r(1);let s;function o(t){switch(t){case s.FLOAT:return i.m.Float;case s.FLOAT_VEC2:return i.m.Float2;case s.FLOAT_VEC3:return i.m.Float3;case s.FLOAT_VEC4:return i.m.Float4;case s.INT:return i.m.Int;case s.INT_VEC2:return i.m.Int2;case s.INT_VEC3:return i.m.Int3;case s.INT_VEC4:return i.m.Int4;case s.FLOAT_MAT3:return i.m.Float3x3;case s.FLOAT_MAT4:return i.m.Float4x4;case s.SAMPLER_2D:return i.m.Texture2D;case s.SAMPLER_3D:return i.m.Texture3D;case s.SAMPLER_CUBE:return i.m.TextureCube;case s.UNSIGNED_INT:return i.m.Uint;case s.UNSIGNED_INT_VEC2:return i.m.Uint2;case s.UNSIGNED_INT_VEC3:return i.m.Uint3;case s.UNSIGNED_INT_VEC4:return i.m.Uint4;default:return w(`Unsupported WebGL type: ${t}`)}}function a(t){switch(255&t){case i.m.Float:return 1;case i.m.Float2:return 2;case i.m.Float3:return 3;case i.m.Float4:return 4;case i.m.Int:return 1;case i.m.Int2:return 2;case i.m.Int3:return 3;case i.m.Int4:return 4;case i.m.Uint:return 1;case i.m.Uint2:return 2;case i.m.Uint3:return 3;case i.m.Uint4:return 4;case i.m.Short:return 1;case i.m.Short2:return 2;case i.m.Short3:return 3;case i.m.Short4:return 4;case i.m.Ushort:return 1;case i.m.Ushort2:return 2;case i.m.Ushort3:return 3;case i.m.Ushort4:return 4;case i.m.Char:return 1;case i.m.Char2:return 2;case i.m.Char3:return 3;case i.m.Char4:return 4;case i.m.Uchar:return 1;case i.m.Uchar2:return 2;case i.m.Uchar3:return 3;case i.m.Uchar4:return 4;case i.m.Half:return 1;case i.m.Half2:return 2;case i.m.Half3:return 3;case i.m.Half4:return 4;default:return w(`Unsupported type: ${t}`)}}function c(t){switch(255&t){case i.m.Float:case i.m.Float2:case i.m.Float3:case i.m.Float4:return s.FLOAT;case i.m.Int:case i.m.Int2:case i.m.Int3:case i.m.Int4:return s.INT;case i.m.Uint:case i.m.Uint2:case i.m.Uint3:case i.m.Uint4:return s.UNSIGNED_INT;case i.m.Short:case i.m.Short2:case i.m.Short3:case i.m.Short4:return s.SHORT;case i.m.Ushort:case i.m.Ushort2:case i.m.Ushort3:case i.m.Ushort4:return s.UNSIGNED_SHORT;case i.m.Char:case i.m.Char2:case i.m.Char3:case i.m.Char4:return s.BYTE;case i.m.Uchar:case i.m.Uchar2:case i.m.Uchar3:case i.m.Uchar4:return s.UNSIGNED_BYTE;case i.m.Half:case i.m.Half2:case i.m.Half3:case i.m.Half4:return s.HALF_FLOAT;default:return w(`Unsupported type: ${t}`)}}function u(t){switch(t){case i.g.Points:return s.POINTS;case i.g.Lines:return s.LINES;case i.g.LineLoop:return s.LINE_LOOP;case i.g.LineStrip:return s.LINE_STRIP;case i.g.Triangles:return s.TRIANGLES;case i.g.TriangleStrip:return s.TRIANGLE_STRIP;case i.g.TriangleFan:return s.TRIANGLE_FAN;default:return w(`Unsupported primitive type: ${t}`)}}function h(t){switch(t){case i.m.Short_Norm:case i.m.Short2_Norm:case i.m.Short3_Norm:case i.m.Short4_Norm:case i.m.Ushort_Norm:case i.m.Ushort2_Norm:case i.m.Ushort3_Norm:case i.m.Ushort4_Norm:case i.m.Char_Norm:case i.m.Char2_Norm:case i.m.Char3_Norm:case i.m.Char4_Norm:case i.m.Uchar_Norm:case i.m.Uchar2_Norm:case i.m.Uchar3_Norm:case i.m.Uchar4_Norm:return!0;default:return!1}}function l(t){switch(t){case i.m.Uchar:return s.UNSIGNED_BYTE;case i.m.Uint:return s.UNSIGNED_INT;case i.m.Ushort:return s.UNSIGNED_SHORT;default:return w(`Unsupported index type: ${t}`)}}function f(t){switch(t){case i.k.Texture2D:return s.TEXTURE_2D;case i.k.Texture3D:return s.TEXTURE_3D;case i.k.TextureCube:return s.TEXTURE_CUBE_MAP;default:return w(`Unsupported texture type: ${t}`)}}function d(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:return s.ALPHA;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA;case i.i.F16:return s.ALPHA;case i.i.F16x4:case i.i.F32x4:return s.RGBA;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function p(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:case i.i.U8_sRGB:return s.RED;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:case i.i.U10_10_10_2:return s.RGBA;case i.i.F16:return s.RED;case i.i.F16x2:return s.RG;case i.i.F16x4:return s.RGBA;case i.i.F32x2:return s.RG;case i.i.F32x4:return s.RGBA;case i.i.F11_11_10:return s.RGB;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function m(t){switch(t){case i.i.U565:return s.RGB565;case i.i.U8:case i.i.U8_sRGB:return s.R8;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG8;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB8;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA8;case i.i.U10_10_10_2:return s.RGB10_A2;case i.i.F16:return s.R16F;case i.i.F16x2:return s.RG16F;case i.i.F16x3:return s.RGB16F;case i.i.F16x4:return s.RGBA16F;case i.i.F32x2:return s.RG32F;case i.i.F32x3:return s.RGB32F;case i.i.F32x4:return s.RGBA32F;case i.i.Depth32:return s.DEPTH_COMPONENT32F;case i.i.Depth24Stencil8:return s.DEPTH24_STENCIL8;default:return w(`Unsupported texel format: ${t}`)}}function g(t){switch(t){case i.i.Undefined:return 0;case i.i.U565:return s.UNSIGNED_SHORT_5_6_5;case i.i.U8:case i.i.U8_sRGB:case i.i.U8x2:case i.i.U8x2_sRGB:case i.i.U8x3:case i.i.U8x3_sRGB:case i.i.U8x4:case i.i.U8x4_sRGB:return s.UNSIGNED_BYTE;case i.i.U10_10_10_2:return s.RGBA;case i.i.F11_11_10:return s.FLOAT;case i.i.F16:case i.i.F16x2:case i.i.F16x4:return s.HALF_FLOAT;case i.i.F32x2:case i.i.F32x4:case i.i.Depth32:return s.FLOAT;case i.i.Depth24Stencil8:return s.UNSIGNED_INT_24_8;default:return w(`Unsupported texel format: ${t}`)}}function y(t){switch(t){case i.j.Nearest:return s.NEAREST;case i.j.Linear:return s.LINEAR;default:return w(`Unsupported texture filter: ${t}`)}}function b(t){switch(t){case i.b.Zero:return s.ZERO;case i.b.One:return s.One;case i.b.Source:return s.SRC_ALPHA;case i.b.OneMinusSource:return s.ONE_MINUS_SRC_ALPHA;default:return w(`Unsupported blend factor: ${t}`)}}function v(t,e="Assert failed"){t||w(e)}function w(t){throw console.error(t),new Error(t)}function x(t,e){return void 0!==t?t:e}function _(t){return null!=t}function M(t){return void 0!==t.height}function C(t,e,r){const n=s.createShader(e);if(s.shaderSource(n,r),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){const i=e===s.VERTEX_SHADER?"Vertex":"Fragment",o=r.split("\n").map((t,e)=>`${e+1}: ${t}`).join("\n");console.error(o),w(`${i} compilation failed for shader ${t}:\n  ${s.getShaderInfoLog(n)}. See source above.`)}return n}function A(t,e,r){const n=t.vertexLayout.buffers[r],o=t.shader.reflection,a=Object.keys(n.layout);s.bindBuffer(s.ARRAY_BUFFER,e.buffer.glId);for(let t=0;t<a.length;t++){const r=n.layout[a[t]],u=o.attributes[a[t]];if(_(u))if(e.buffer){const t=c(r.type),o=h(r.type);s.enableVertexAttribArray(u.location),s.vertexAttribPointer(u.location,u.components,t,o,n.stride,r.offset+e.offset),n.stepMode===i.h.Instance&&(s.instancedArrays?s.instancedArrays.vertexAttribDivisorANGLE(u.location,1):s.vertexAttribDivisor(u.location,1))}else s.disableVertexAttribArray(u.location)}}function S(t){return t.type===i.a.Texture}class k{constructor(){this.objects=[],this.freeList=[],this.count=0}get(t){const e=this.objects[t];return v(void 0!==e,"Invalid ID"),e}create(t){if(++this.count,this.freeList.length>0){const e=this.freeList.pop();return this.objects[e]=t,e}return this.objects.push(t),this.objects.length-1}delete(t){--this.count,delete this.objects[t],this.freeList.push(t)}}class T{constructor(){this.debugEnabled=!1,this.buffers=new k,this.textures=new k,this.shaders=new k,this.renderPipelines=new k,this.resourceTables=new k,this.vertexTables=new k,this.renderPasses=new k,this.depthStencilStates=new k}initialize(t){const e={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(s=t.getContext("webgl2",e),s||(s=t.getContext("webgl",e)),!s)return!1;this.webGlVersion=s instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(t){let e,r=0;return(e=s.getExtension("OES_vertex_array_object"))&&(r|=i.f.VertexArrayObject,s.createVertexArray=e.createVertexArrayOES.bind(e),s.deleteVertexArray=e.deleteVertexArrayOES.bind(e),s.bindVertexArray=e.bindVertexArrayOES.bind(e)),(e=s.getExtension("OES_texture_half_float"))&&(r|=i.f.TextureHalf,s.HALF_FLOAT=e.HALF_FLOAT_OES),(e=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(r|=i.f.AnistropicFiltering,s.MAX_TEXTURE_MAX_ANISOTROPY_EXT=e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,s.TEXTURE_MAX_ANISOTROPY_EXT=e.TEXTURE_MAX_ANISOTROPY_EXT),s.getExtension("OES_texture_float")&&(r|=i.f.TextureFloat),s.getExtension("OES_texture_float_linear")&&(r|=i.f.TextureFloatLinearFiltering),s.getExtension("OES_texture_half_float_linear")&&(r|=i.f.TextureHalfLinearFiltering),s.getExtension("OES_standard_derivatives")&&(r|=i.f.ShaderDerivatives),s.texSubImage2D&&(r|=i.f.TextureWrite),(s.instancedArrays=s.getExtension("ANGLE_instanced_arrays"))&&(r|=i.f.Instancing),r|=i.f.ShaderGlsl100,t>=2&&(r|=i.f.VertexArrayObject,r|=i.f.TextureFloat,r|=i.f.TextureHalf,r|=i.f.Instancing,r|=i.f.ShaderGlsl300),r}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:t.width,height:t.height}),v(this.defaultRenderPass===i.o),this.current={},s.clearColor(0,0,0,1);const r=new Uint8Array([0,0,0,1]),n={usage:i.n.Static,type:i.k.Texture2D,format:i.i.U8x4,width:1,height:1},o=this.createTexture("DefaultTexture",n,r);return this.defaultTexture=this.textures.get(o),this.isGfxFeatureSupported(i.f.AnistropicFiltering)&&(this.maxAnisotropy=s.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),!0}isGfxFeatureSupported(t){return!!(this.featureFlags&t)}setDebugEnabled(t){this.debugEnabled=t}resize(t,e){const r=this.renderPasses.get(this.defaultRenderPass);r.width=t,r.height=e}beginFrame(){}endFrame(){}bindRenderPass(t){const e=this.renderPasses.get(t);s.bindFramebuffer(s.FRAMEBUFFER,e.glFramebuffer),s.viewport(0,0,e.width,e.height);const r=s.COLOR_BUFFER_BIT;s.clear(r)}bindPipeline(t){const e=this.renderPipelines.get(t);this.pipeline=e,this.current.shader!==e.shader&&(s.useProgram(e.shader.glProgram),this.current.shader=e.shader),e.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=e.renderFormat.blendingEnabled,e.renderFormat.blendingEnabled?s.enable(s.BLEND):s.disable(s.BLEND)),!this.current.blending||this.current.srcBlendFactor==e.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==e.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=x(e.renderFormat.srcBlendFactor,i.b.One),this.current.dstBlendFactor=x(e.renderFormat.dstBlendFactor,i.b.OneMinusSource),s.blendFunc(b(this.current.srcBlendFactor),b(this.current.dstBlendFactor)))}draw(t,e,r,n,o){const a=u(t),c=l(r),h=i.l(r),f=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.glId),s.drawElements(a,o,c,n*h)}drawInstanced(t,e,r,n,o,a){const c=u(t),h=l(r),f=i.l(r),d=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,d.glId),s.instancedArrays?s.instancedArrays.drawElementsInstancedANGLE(c,o,h,n*f,a):s.drawElementsInstanced(c,o,h,n*f,a)}drawNonIndexed(t,e,r){const n=u(t);s.drawArrays(n,e,r)}setDepthStencilState(t){const e=this.depthStencilStates.get(t),r=this.current.depthStencil;r&&e.depthWriteEnabled==r.depthWriteEnabled||s.depthMask(e.depthWriteEnabled),r&&e.depthCompareFunc==r.depthCompareFunc||s.depthFunc(e.depthCompareFunc),r&&e.depthTestEnabled==r.depthTestEnabled||(e.depthTestEnabled?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST)),this.current.depthStencil=e}setCullMode(t){this.current.cullMode!=t&&(this.current.cullMode=t,t==i.e.None?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(function(t){switch(t){case i.e.None:return s.NONE;case i.e.Back:return s.BACK;case i.e.Front:return s.FRONT;default:return w(`Unsupported culling mode: ${t}`)}}(t))))}createDepthStencilState(t){const e=function(t){switch(t){case i.d.Never:return s.NEVER;case i.d.Less:return s.LESS;case i.d.Equal:return s.EQUAL;case i.d.LessEqual:return s.LEQUAL;case i.d.Greater:return s.GREATER;case i.d.NotEqual:return s.NOTEQUAL;case i.d.GreaterEqual:return s.GEQUAL;case i.d.Always:return s.ALWAYS;default:return w(`Unsupported compare func: ${t}`)}}(x(t.depthCompareFunc,i.d.Less));return this.depthStencilStates.create({depthTestEnabled:t.depthTestEnabled,depthWriteEnabled:t.depthWriteEnabled,depthCompareFunc:e})}createVertexTable(t){const e=this.renderPipelines.get(t);let r=null;return this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(r=s.createVertexArray()),this.vertexTables.create({pipeline:e,vao:r,buffers:[]})}removeVertexTable(t){if(this.isGfxFeatureSupported(i.f.VertexArrayObject)){const e=this.vertexTables.get(t);s.deleteVertexArray(e.vao)}this.vertexTables.delete(t)}createResourceTable(t){return this.resourceTables.create({layout:t,buffers:[],textures:[]})}removeResourceTable(t){this.resourceTables.delete(t)}bindVertices(t){const e=this.vertexTables.get(t);if(this.debugEnabled){const t=e.pipeline.shader.name,r=e.pipeline.vertexLayout.buffers.length;for(let n=0;n<r;n++)v(_(e.buffers[n]),`Shader ${t} expects a vertex buffer bound at slot ${n}`)}if(this.isGfxFeatureSupported(i.f.VertexArrayObject))s.bindVertexArray(e.vao);else for(let t=0;t<e.buffers.length;t++)A(e.pipeline,e.buffers[t],t)}bindResources(t){const e=this.resourceTables.get(t),r=this.pipeline.uniformLayout,n=this.pipeline.shader.reflection,o=this.pipeline.shader.name;for(let t=0;t<n.uniforms.length;t++){const o=n.uniforms[t],a=r[o.name],c=e.buffers[a.index].buffer.cpuBuffer;v(_(c));const u=new Float32Array(c.buffer,a.offset,o.size/4),h=this.pipeline.shader.uniformVals[o.name];if(!u.every((t,e)=>t===h[e]))switch(this.pipeline.shader.uniformVals[o.name].set(u),o.type){case i.m.Float:s.uniform1fv(o.location,u);break;case i.m.Float2:s.uniform2fv(o.location,u);break;case i.m.Float3:s.uniform3fv(o.location,u);break;case i.m.Float4:s.uniform4fv(o.location,u);break;case i.m.Float3x3:s.uniformMatrix3fv(o.location,!1,u);break;case i.m.Float4x4:s.uniformMatrix4fv(o.location,!1,u);break;default:w("Unknown shader uniform type")}}for(let t=0;t<n.textureArray.length;t++){const i=n.textureArray[t],a=r[i.name].index;void 0===e.textures[a]&&console.warn(`Shader ${o} expects texture "${i.name}" (index ${a}) to be bound`);for(let t=0;t<i.count;t++){const r=e.textures[a+t]||this.defaultTexture,n=i.location+t;s.activeTexture(s.TEXTURE0+n),s.bindTexture(r.target,r.glId)}}}setVertexBuffer(t,e,r){const n=this.vertexTables.get(t),o={buffer:this.buffers.get(r.buffer),offset:r.byteOffset||0};v(e<i.r),n.buffers[e]=o,this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(s.bindVertexArray(n.vao),A(n.pipeline,o,e))}setBuffer(t,e,r){const n=this.resourceTables.get(t),i=this.buffers.get(r.buffer);n.buffers[e]={buffer:i,offset:r.byteOffset||0}}setTexture(t,e,r){const n=this.resourceTables.get(t),i=r?this.textures.get(r):null;n.textures[e]=i}setTextures(t,e,r){const n=this.resourceTables.get(t);for(let t=0;t<r.length;t++){const i=r[t]?this.textures.get(r[t]):null;n.textures[e+t]=i}}writeBufferData(t,e,r){const n=this.buffers.get(t);if(n.type===i.c.Uniform){const t=ArrayBuffer.isView(r)?r.buffer:r,i=new Uint8Array(t);_(n.cpuBuffer)?n.cpuBuffer.set(i,e):w("No CPU buffer assigned to uniform buffer")}else s.bindBuffer(n.target,n.glId),s.bufferSubData(n.target,e,r)}createRenderPipeline(t,e,r,n){const s=this.shaders.get(t),o=Object.keys(n),a=o.map(t=>n[t]),c=s.reflection;if(this.debugEnabled){for(const t of o){const e=n[t];e.type===i.a.UniformBuffer&&v(void 0!==e.layout,`A BufferLayout must be provided for UniformBuffer "${t}" in the ResourceLayout passed to createRenderPipeline()`+"to define uniform binding locations. In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader")}for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],r=a.find(t=>!S(t)&&t.layout&&t.layout[e.name]);v(void 0!==r,`Shader '${s.name}' expects uniform '${e.name}' to be set in a uniform buffer`);const n=r.layout[e.name].type;if(v(n===e.type,`Shader '${s.name}' expects uniform '${e.name}' to be type ${e.type} but the ShaderResourceLayout specifies type ${n}`),e.count>1){const t=r.layout[e.name].count;v(void 0!==t,`Shader '${s.name}' expects uniform '${e.name}' to be an array but the ShaderResourceLayout specifies a scalar value`),v(t>=e.count,`Shader '${s.name}' expects uniform '${e.name}' to be an array of length ${e.count} but the ShaderResourceLayout specifies a length of ${t}`)}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],r=a.find((t,r)=>S(t)&&o[r]===e.name);v(void 0!==r,`Shader '${s.name}' expects texture '${e.name}', but it is not defined in the ShaderResourceLayout`),v((r.count||1)===e.count,`Shader '${s.name}' expects texture '${e.name}' to be an array of length ${e.count}, but the ResourceLayout specifies length ${r.count}`)}Object.keys(c.attributes).forEach(t=>{v(void 0!==r.buffers.find(e=>e&&void 0!==e.layout[t]),`VertexLayout does not supply attribute ${t} required by Shader '${s.name}'`)}),this.isGfxFeatureSupported(i.f.Instancing)||r.buffers.forEach(t=>{v(t.stepMode!==i.h.Instance,"Instancing is not supported by this WebGL context")})}const u={};for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],r=a.find(t=>!S(t)&&t.layout&&t.layout[e.name]);u[e.name]={offset:r.layout[e.name].offset,index:r.index}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],r=n[e.name];u[e.name]={offset:0,index:r.index}}return this.renderPipelines.create({shader:s,renderFormat:e,vertexLayout:r,resourceLayout:n,uniformLayout:u})}removeRenderPipeline(t){this.renderPipelines.delete(t)}createShader(t){return this._createShader(t.name,t.vertSource,t.fragSource)}_createShader(t,e,r){const n=function(t,e,r){const n=C(t,s.VERTEX_SHADER,e),i=C(t,s.FRAGMENT_SHADER,r),o=s.createProgram();return s.attachShader(o,n),s.attachShader(o,i),s.linkProgram(o),s.deleteShader(n),s.deleteShader(i),s.getProgramParameter(o,s.LINK_STATUS)||w(`Linking failed for shader ${t}:\n  ${s.getProgramInfoLog(o)}`),o}(t,e instanceof Array?e.join("\n#line 0\n"):e,r instanceof Array?r.join("\n#line 0\n"):r),u=function(t){const e={},r=[],n=[],u={};let h=0;const l=s.getProgramParameter(t,s.ACTIVE_ATTRIBUTES);v(l<i.p);for(let e=0;e<l;e++){const r=s.getActiveAttrib(t,e),n=o(r.type);u[r.name]={location:e,count:r.size,components:a(n),glType:c(n),type:n}}const f=s.getProgramParameter(t,s.ACTIVE_UNIFORMS);v(f<i.q);for(let a=0;a<f;a++){const c=s.getActiveUniform(t,a),u=o(c.type),l=c.name.replace("[0]","");if(u>=i.k.Texture2D&&u<=i.k.TextureCube){const n={name:l,count:c.size,type:u,location:h,locationGl:s.getUniformLocation(t,c.name)};h+=c.size,e[l]=n,r.push(n)}else{const e={name:l,count:c.size,type:u,size:i.l(u)*c.size,location:s.getUniformLocation(t,c.name)};n.push(e)}}return{attributes:u,uniforms:n,textures:e,textureArray:r,textureCount:h}}(n),h={};for(let t=0;t<u.uniforms.length;t++){const e=u.uniforms[t];h[e.name]=new Float32Array(e.size/4)}s.useProgram(n);const l=Object.keys(u.textures);for(let t=0;t<l.length;t++){const e=u.textures[l[t]],r=Array.from(Array(e.count).keys()).map((t,r)=>e.location+r);s.uniform1iv(e.locationGl,r)}return this.current.shader=void 0,this.shaders.create({name:t,glProgram:n,reflection:u,uniformVals:h})}removeShader(t){const e=this.shaders.get(t);s.deleteProgram(e.glProgram),this.shaders.delete(t)}createTexture(t,e,r){const n=!r||r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength,o=1===this.webGlVersion?d:p,a={target:f(e.type),format:o(e.format),internalFormat:this.webGlVersion>1?m(e.format):o(e.format),type:g(e.format),usage:e.usage,width:n?x(e.width,1):r.width,height:n?x(e.height,1):r.height,depth:e.depth||1,minFilter:y(void 0!==e.defaultMinFilter?e.defaultMinFilter:i.j.Linear),magFilter:y(void 0!==e.defaultMagFilter?e.defaultMagFilter:i.j.Linear),glId:s.createTexture()};if(s.bindTexture(a.target,a.glId),s.texParameteri(a.target,s.TEXTURE_MIN_FILTER,a.minFilter),s.texParameteri(a.target,s.TEXTURE_MAG_FILTER,a.magFilter),s.texParameteri(a.target,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(a.target,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),_(e.maxAnistropy)&&e.maxAnistropy>1&&this.isGfxFeatureSupported(i.f.AnistropicFiltering)){const t=Math.min(this.maxAnisotropy,e.maxAnistropy);s.texParameterf(s.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,t)}const c=this.webGlVersion>1?a.internalFormat:a.format;if(e.type===i.k.Texture3D)s.texImage3D(a.target,0,c,a.width,a.height,a.depth,0,a.format,a.type,r);else if(n)r instanceof ArrayBuffer&&(r=new Uint8Array(r)),s.texImage2D(a.target,0,c,a.width,a.height,0,a.format,a.type,r);else if(void 0!==r)s.texImage2D(a.target,0,c,a.format,a.type,r);else{v(void 0!==a.width&&void 0!==a.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),s.texImage2D(a.target,0,c,e.width,e.height,0,a.format,a.type,null)}return this.textures.create(a)}writeTextureData(t,e){const r=this.textures.get(t);v(r.target===s.TEXTURE_2D,"Currently only 2D textures may be written to"),s.bindTexture(r.target,r.glId);const n=M(e)?e.width!==r.width:!!M(e)&&e.height!==r.height;this.isGfxFeatureSupported(i.f.TextureWrite)&&!n?M(e)?s.texSubImage2D(r.target,0,0,0,r.format,r.type,e):s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,e):s.texImage2D(r.target,0,r.internalFormat,r.format,r.type,e)}removeTexture(t){const e=this.textures.get(t);s.deleteTexture(e.glId),this.textures.delete(t)}createBuffer(t,e,r,n){let o,a;v(r!=i.n.None);const c=function(t){switch(t){case i.c.Undefined:return 0;case i.c.Uniform:return s.UNIFORM_BUFFER;case i.c.Vertex:return s.ARRAY_BUFFER;case i.c.Index:return s.ELEMENT_ARRAY_BUFFER;case i.c.Readback:return s.TRANSFORM_FEEDBACK_BUFFER}}(e),u=t=>Number.isInteger(t),h=t=>t instanceof ArrayBuffer,l=u(n)?null:n,f=u(n)?n:n.byteLength;if(v(f>0||null!==l,"Either an ArrayBuffer or size must be provided"),e!=i.c.Uniform)a=s.createBuffer(),s.bindBuffer(c,a),s.bufferData(c,n,r==i.n.Dynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW);else if(l){const t=h(l)?l:l.buffer,e=h(l)?0:l.byteOffset;o=new Uint8Array(t,e,f)}else o=new Uint8Array(f);return this.buffers.create({name:t,type:e,target:c,usage:r,size:f,glId:a,cpuBuffer:o})}removeBuffer(t){const e=this.buffers.get(t);e.type!=i.c.Uniform&&s.deleteBuffer(e.glId),this.buffers.delete(t)}readPixels(t,e,r,n,i){s.readPixels(t,e,r,n,s.RGBA,s.UNSIGNED_BYTE,i)}}var F=r(2),O=r(0);class E{constructor(t,e,r=1,n=2e4){this.cameraMatrix=F.b.create(),this.viewMatrix=F.b.create(),this.projectionMatrix=F.b.create(),this.projectionMatrixInverse=F.b.create(),this.viewProjMatrix=F.b.create(),this.viewProjMatrixInverse=F.b.create(),this.forward=F.d.create(),this.up=F.d.create(),this.right=F.d.create(),t=Object(O.d)(t,60/180*Math.PI),r=Object(O.d)(r,1),n=Object(O.d)(n,2e3),e=Object(O.d)(e,1),this.setPerspective(t,e,r,n)}copy(t){this.fov=t.fov,this.near=t.near,this.far=t.far,this.aspect=t.aspect,F.b.copy(this.cameraMatrix,t.cameraMatrix),F.b.copy(this.viewMatrix,t.viewMatrix),F.b.copy(this.projectionMatrix,t.projectionMatrix),F.b.copy(this.projectionMatrixInverse,t.projectionMatrixInverse),F.b.copy(this.viewProjMatrix,t.viewProjMatrix),F.b.copy(this.viewProjMatrixInverse,t.viewProjMatrixInverse),F.d.copy(this.forward,t.forward),F.d.copy(this.up,t.up),F.d.copy(this.right,t.right)}getPos(t){return F.b.getTranslation(t,this.cameraMatrix)}viewMatrixUpdated(){F.b.invert(this.cameraMatrix,this.viewMatrix),F.d.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),F.d.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),F.d.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),F.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),F.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(t,e,r,n=1/0){this.fov=t,this.aspect=e,this.near=r,this.far=n,F.b.perspective(this.projectionMatrix,t,e,r,n),F.b.invert(this.projectionMatrixInverse,this.projectionMatrix),F.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),F.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}var j=r(41),B=r(29),I=r(5),R=r(11);const U=F.d.create(),D=F.d.create(),P=new R.c(F.d.create()),L=F.d.fromValues(0,1,0);class N{constructor(t){this.camera=t,this.camPos=F.d.create()}initialize(t){const e=window.innerWidth/window.innerHeight;this.resize(e),this.controller=new z,this.controller.camera=this.camera,this.controller.initialize(t)}resize(t){this.camera.setPerspective(this.camera.fov,t,this.camera.near,this.camera.far)}update(t){this.controller.update(t);const e=this.camera.getPos(this.camPos);t.globalUniforms.buffer.setVec3("g_camPos",e),t.globalUniforms.buffer.setMat4("g_proj",this.camera.projectionMatrix),t.globalUniforms.buffer.setMat4("g_viewProj",this.camera.viewProjMatrix)}toJSON(){return this.controller.toJSON()}fromJSON(t){return this.controller.fromJSON(t)}}class z{constructor(){this.minDistance=500,this.maxDistance=800}initialize(t){const e=P.buffer,r=F.d.add(U,e,F.d.set(U,1e3,700,0));F.b.lookAt(this.camera.viewMatrix,r,e,L),this.camera.viewMatrixUpdated(),this.heading=Math.atan2(this.camera.forward[0],this.camera.forward[2]),this.pitch=.5*Math.PI,this.distance=1e3;const n=t.debugMenu.addFolder("FollowCam");n.add(this,"pitch",0,.5*Math.PI,.01*Math.PI),n.add(this,"minDistance",500,2e3,100),n.add(this,"maxDistance",500,3e3,100)}update(t){if(this.follow=t.avatar.localAvatar,!this.follow)return!1;this.follow.getWorldPosition(P);const e=F.d.add(P.buffer,P.buffer,F.d.set(D,0,250,0)),r=this.camera.getPos(U),n=F.d.subtract(U,e,r),i=F.d.length(n),s=Math.atan2(n[2],n[0]);let o=Object(I.b)(this.heading,s);this.heading=(this.heading+o)%6.283,this.distance=Object(I.c)(i,this.minDistance,this.maxDistance);const a=function(t,e,r){const n=Math.sin(r);return t[0]=n*Math.cos(e),t[1]=Math.cos(r),t[2]=n*Math.sin(e),t}(U,this.heading+Math.PI,this.pitch),c=F.d.scale(U,a,this.distance),u=F.d.add(U,e,c);return F.b.lookAt(this.camera.viewMatrix,u,e,L),this.camera.viewMatrixUpdated(),!1}toJSON(){return""}fromJSON(t){}}var V=r(42),q=r(9);class W{constructor(t,e){this.canvas=t,this.gfxDevice=e,this.resolutionScale=1}initialize({debugMenu:t}){for(let t in q.a)q.a[t].defaultDepthStateId=this.gfxDevice.createDepthStencilState(q.a[t].defaultDepthState);t.addFolder("Compositor").add(this,"resolutionScale",1,16,1)}render(){this.width=this.canvas.clientWidth*devicePixelRatio/this.resolutionScale,this.height=this.canvas.clientHeight*devicePixelRatio/this.resolutionScale,this.width===this.canvas.width&&this.height===this.canvas.height||(this.canvas.width=this.width,this.canvas.height=this.height,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)),this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(i.o),H(this.gfxDevice,q.a.opaque),H(this.gfxDevice,q.a.debug),this.gfxDevice.endFrame();for(let t in q.a)q.a[t].primitives.length=0}resize(t,e,r){this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.canvas.style.position="absolute"}}function H(t,e){const r=e.primitives.length;for(let n=0;n<r;n++){const r=e.primitives[n];if(t.bindPipeline(r.renderPipeline),t.bindVertices(r.vertexTable),t.bindResources(r.resourceTable),t.setCullMode(e.defaultCullMode),t.setDepthStencilState(e.defaultDepthStateId),Object(O.e)(r.indexBuffer)){const e=r.indexType===i.m.Ushort?2:4,n=Object(O.d)(r.indexBuffer.byteOffset,0)/e;Object(O.e)(r.instanceCount)?t.drawInstanced(r.type,r.indexBuffer.buffer,Object(O.c)(r.indexType),n,r.elementCount,r.instanceCount):t.draw(r.type,r.indexBuffer.buffer,Object(O.c)(r.indexType),n,r.elementCount)}else t.drawNonIndexed(r.type,0,r.elementCount)}}var G=r(94),Y=r.n(G),X=r(95),$=r.n(X),K=r(22);class J{constructor(t,e,r){this.resourceTable=r,this.vertexTable=e,this.renderPipeline=t,this.elementCount=0,this.type=i.g.Triangles}}var Z=r(7);class Q{constructor(){this.name="GridShader",this.vertSource=Q.vert.sourceCode,this.fragSource=Q.frag.sourceCode}}Q.vert=Y.a,Q.frag=$.a,Q.UniformLayout=Object(Z.b)({u_baseColor:{type:i.m.Float4},u_lineColor:{type:i.m.Float4},u_gridUnit:{type:i.m.Float},u_gridRadius:{type:i.m.Float}}),Q.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:K.a.bufferLayout},uniforms:{index:1,type:i.a.UniformBuffer,layout:Q.UniformLayout}};class tt{constructor(){this.baseColor=F.e.fromValues(.3,.3,.3,1),this.lineColor=F.e.fromValues(1,1,1,1),this.gridUnit=100,this.gridRadius=5e3,this.enabled=!0}initialize({gfxDevice:t,globalUniforms:e,debugMenu:r}){if(!t.isGfxFeatureSupported(i.f.ShaderGlsl300))return console.warn("GLSL version 300 not supported, disabling DebugGrid"),void(this.enabled=!1);const n=t.createShader(new Q),s=Q.resourceLayout,o={buffers:[{stride:2,layout:{a_pos:{type:i.m.Char2,offset:0}}}]},a=t.createRenderPipeline(n,{blendingEnabled:!1},o,s),c=t.createBuffer("GridVertices",i.c.Vertex,i.n.Static,new Int8Array([-1,-1,1,-1,-1,1,1,1])),u=t.createBuffer("GridIndices",i.c.Index,i.n.Static,new Uint16Array([0,2,1,1,2,3])),h=t.createResourceTable(s);this.uniforms=new Z.a("GridUniforms",t,Q.UniformLayout),t.setBuffer(h,0,e.bufferView),t.setBuffer(h,1,this.uniforms.getBufferView());const l=t.createVertexTable(a);t.setVertexBuffer(l,0,{buffer:c}),this.primitive=new J(a,l,h),this.primitive.indexBuffer={buffer:u},this.primitive.indexType=i.m.Ushort,this.primitive.elementCount=6;const f=r.addFolder("DebugGrid");f.add(this,"enabled"),f.add(this,"gridUnit",1,100,10),f.add(this,"gridRadius")}render({gfxDevice:t}){this.enabled&&(this.uniforms.setVec4("u_baseColor",this.baseColor),this.uniforms.setVec4("u_lineColor",this.lineColor),this.uniforms.setFloat("u_gridUnit",this.gridUnit),this.uniforms.setFloat("u_gridRadius",this.gridRadius),this.uniforms.write(t),q.a.opaque.push(this.primitive))}}var et=r(23),rt=r(43),nt=r(45);class it{constructor(){this.clearing=!1}initialize(t){t.debugMenu.add(this,"clearState"),this.loadState(t)&&console.log("Loaded state from localStorage")}saveState({cameraSystem:t,debugMenu:e}){const r={version:1,cameraSystem:t,debugMenu:e},n=JSON.stringify(r);this.clearing||window.localStorage.setItem("state",n)}loadState({cameraSystem:t,debugMenu:e}){const r=window.localStorage.getItem("state");if(!Object(O.e)(r))return!1;const n=JSON.parse(r);if(1!==n.version)return!1;try{t.fromJSON(n.cameraSystem),e.fromJSON(n.debugMenu)}catch(t){return console.warn("Failed to load state:",t),!1}return!0}clearState(){window.localStorage.removeItem("state"),this.clearing=!0,location.reload()}update(t){n.b&&this.saveState(t)}}var st=r(20),ot=r(13),at=r(44),ct=r(24),ut=r(8),ht=r(96),lt=r.n(ht),ft=r(97),dt=r.n(ft),pt=r(18);class mt{constructor(){this.name="Stage",this.vertSource=lt.a.sourceCode,this.fragSource=dt.a.sourceCode}}mt.uniformLayout=Object(Z.b)({u_model:{type:i.m.Float4x4},u_color:{type:i.m.Float4}}),mt.resourceLayout={model:{index:0,type:i.a.UniformBuffer,layout:mt.uniformLayout},global:{index:1,type:i.a.UniformBuffer,layout:K.a.bufferLayout},u_tex:{index:2,type:i.a.Texture}};class gt{initialize({resources:t,gfxDevice:e,globalUniforms:r}){this.shader=e.createShader(new mt),t.load(gt.filename,"gltf",(t,n)=>{Object(O.b)(!t,t),this.onResourcesLoaded(e,r,n)})}onResourcesLoaded(t,e,r){var n,i;const s=r,o=s.textures[0].id,a=s.meshes[0].primitives[0],c=new pt.a(t,"Arena",this.shader,mt.resourceLayout);this.model=new pt.b(t,q.a.opaque,a.mesh,c);const u=s.nodes.find(t=>0===t.meshId);null===(n=u)||void 0===n||n.updateMatrixWorld();const h=F.b.fromValues.apply(null,null===(i=u)||void 0===i?void 0:i.matrixWorld.elements),l=F.b.fromScaling(F.b.create(),F.d.fromValues(gt.outerRadius,gt.outerRadius,gt.outerRadius));F.b.multiply(h,l,h);const f=new Z.a("ArenaUniforms",t,mt.uniformLayout);f.setVec4("u_color",[1,0,0,1]),f.setMat4("u_model",h),f.write(t),c.setUniformBuffer(t,"model",f),c.setUniformBuffer(t,"global",e.buffer),c.setTexture(t,"u_tex",o)}render({}){this.model&&this.model.renderList.push(this.model.primitive)}}gt.filename="data/Arena.glb",gt.outerRadius=2e3;class yt{constructor(){this.canvas=document.createElement("canvas"),this.gfxDevice=new T,this.camera=new E,this.displayFrame={frame:-1,entities:[]},this.world=new ut.b,this.debugMenu=new j.a,this.avatar=new B.c,this.clock=new V.a,this.cameraSystem=new N(this.camera),this.compositor=new W(this.canvas,this.gfxDevice),this.debugGrid=new tt,this.globalUniforms=new K.a(this.gfxDevice),this.input=new et.b,this.net=new rt.a,this.resources=new nt.a,this.state=new it,this.userCommands=new st.b,this.weapons=new at.a(this.world),this.stage=new gt}async init(){return console.log(`Source for this build available at ${n.a}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(n.b),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),ct.a.setContext(this.gfxDevice,this.globalUniforms),this.onResize(),this.resources.initialize(this.gfxDevice),this.clock.initialize(this),this.input.initialize(this),this.net.initialize(this),this.cameraSystem.initialize(this),this.compositor.initialize(this),this.globalUniforms.initialize(),this.avatar.initialize(this),this.weapons.initialize(this),this.stage.initialize(this),this.debugGrid.initialize(this),this.state.initialize(this),window.onresize=this.onResize.bind(this),document.onvisibilitychange=this.onVisibility.bind(this),window.onbeforeunload=this.onUnload.bind(this),n.b&&this.debugMenu.show(),window.requestAnimationFrame(this.tick.bind(this)),0):1}onConnect(t){this.net.onConnect(t)}tick(t){this.clock.tick(),this.updateFixed(),this.update(),this.render(),this.input.afterFrame(),this.debugMenu.update(),window.requestAnimationFrame(this.tick.bind(this))}updateFixed(){for(;this.clock.updateFixed();)if(this.input.updateFixed(this),this.net.client.state===ot.c.Active){const t=Object(O.c)(this.userCommands.getUserCommand(this.clock.simFrame));this.net.client.transmitClientFrame(this.clock.simFrame,t)}}update(){if(this.net.client.state===ot.c.Active){let t=this.clock.renderTime/this.clock.simDt;this.net.client.getSimState(t,this.displayFrame)&&this.world.loadState(this.displayFrame)}this.net.update(this),this.resources.update(),this.avatar.update(this),this.cameraSystem.update(this),this.state.update(this),this.globalUniforms.update()}render(){this.avatar.render(this),this.weapons.render(this),this.stage.render(this),this.debugGrid.render(this),ct.a.flush(),this.compositor.render()}onResize(){this.cameraSystem.resize(window.innerWidth/window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}onVisibility(){const t=document.hidden;this.net.onVisibility(t)}onUnload(){this.net.terminate()}}var bt=r(61),vt=r(30);const wt={debug:t=>t.debugMenu.show()};window.config={kSignalServerAddress:n.b?"localhost:8888":"3.23.86.226:8888"},async function(){const t=new yt;window.client=t,t.init(),new URLSearchParams(window.location.search).forEach((e,r)=>{const n=wt[r];n&&n(t,e)});const e=new vt.a;if(await e.connect(window.config.kSignalServerAddress),e.serverId===e.clientId){const t=new bt.Server;t.onConnect(e),window.server=t}else e.close();t.onConnect(e.serverId)}()}]);