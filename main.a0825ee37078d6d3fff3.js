!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.kMaxShaderAttributes=16,t.kMaxShaderUniforms=64,t.kMaxShaderVertexBuffers=16,t.kDefaultRenderPass=0,function(e){e[e.VertexArrayObject=1]="VertexArrayObject",e[e.TextureFloat=2]="TextureFloat",e[e.TextureHalf=4]="TextureHalf",e[e.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",e[e.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",e[e.TextureWrite=32]="TextureWrite",e[e.ShaderDerivatives=64]="ShaderDerivatives",e[e.Instancing=128]="Instancing",e[e.AnistropicFiltering=256]="AnistropicFiltering"}(t.Feature||(t.Feature={})),function(e){e[e.Undefined=0]="Undefined",e[e.Float=1]="Float",e[e.Float2=2]="Float2",e[e.Float3=3]="Float3",e[e.Float4=4]="Float4",e[e.Int=5]="Int",e[e.Int2=6]="Int2",e[e.Int3=7]="Int3",e[e.Int4=8]="Int4",e[e.Uint=9]="Uint",e[e.Uint2=10]="Uint2",e[e.Uint3=11]="Uint3",e[e.Uint4=12]="Uint4",e[e.Short=13]="Short",e[e.Short2=14]="Short2",e[e.Short3=15]="Short3",e[e.Short4=16]="Short4",e[e.Ushort=17]="Ushort",e[e.Ushort2=18]="Ushort2",e[e.Ushort3=19]="Ushort3",e[e.Ushort4=20]="Ushort4",e[e.Char=21]="Char",e[e.Char2=22]="Char2",e[e.Char3=23]="Char3",e[e.Char4=24]="Char4",e[e.Uchar=25]="Uchar",e[e.Uchar2=26]="Uchar2",e[e.Uchar3=27]="Uchar3",e[e.Uchar4=28]="Uchar4",e[e.Half=29]="Half",e[e.Half2=30]="Half2",e[e.Half3=31]="Half3",e[e.Half4=32]="Half4",e[e.Float3x3=33]="Float3x3",e[e.Float3x4=34]="Float3x4",e[e.Float4x4=35]="Float4x4",e[e.Texture2D=240]="Texture2D",e[e.Texture3D=241]="Texture3D",e[e.TextureCube=242]="TextureCube"}(n=t.Type||(t.Type={})),function(e){e[e.Texture2D=240]="Texture2D",e[e.Texture3D=241]="Texture3D",e[e.TextureCube=242]="TextureCube"}(t.TextureType||(t.TextureType={})),function(e){e[e.Undefined=0]="Undefined",e[e.U565=1]="U565",e[e.U8=2]="U8",e[e.U8_sRGB=3]="U8_sRGB",e[e.U8x2=4]="U8x2",e[e.U8x2_sRGB=5]="U8x2_sRGB",e[e.U8x3=6]="U8x3",e[e.U8x3_sRGB=7]="U8x3_sRGB",e[e.U8x4=8]="U8x4",e[e.U8x4_sRGB=9]="U8x4_sRGB",e[e.U10_10_10_2=10]="U10_10_10_2",e[e.F11_11_10=11]="F11_11_10",e[e.F16=12]="F16",e[e.F16x2=13]="F16x2",e[e.F16x3=14]="F16x3",e[e.F16x4=15]="F16x4",e[e.F32x2=16]="F32x2",e[e.F32x3=17]="F32x3",e[e.F32x4=18]="F32x4",e[e.Depth32=19]="Depth32",e[e.Depth24Stencil8=20]="Depth24Stencil8"}(t.TexelFormat||(t.TexelFormat={})),function(e){e[e.Nearest=0]="Nearest",e[e.Linear=1]="Linear"}(t.TextureFilter||(t.TextureFilter={})),function(e){e[e.Never=0]="Never",e[e.Less=1]="Less",e[e.Equal=2]="Equal",e[e.LessEqual=3]="LessEqual",e[e.Greater=4]="Greater",e[e.NotEqual=5]="NotEqual",e[e.GreaterEqual=6]="GreaterEqual",e[e.Always=7]="Always"}(t.CompareFunc||(t.CompareFunc={})),function(e){e[e.Points=0]="Points",e[e.Lines=1]="Lines",e[e.LineLoop=2]="LineLoop",e[e.LineStrip=3]="LineStrip",e[e.Triangles=4]="Triangles",e[e.TriangleStrip=5]="TriangleStrip",e[e.TriangleFan=6]="TriangleFan"}(t.PrimitiveType||(t.PrimitiveType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Uniform=1]="Uniform",e[e.Vertex=2]="Vertex",e[e.Index=3]="Index",e[e.Readback=4]="Readback"}(t.BufferType||(t.BufferType={})),function(e){e[e.Undefined=0]="Undefined",e[e.UniformBuffer=1]="UniformBuffer",e[e.Texture=2]="Texture"}(t.BindingType||(t.BindingType={})),function(e){e[e.None=0]="None",e[e.Static=1]="Static",e[e.Dynamic=2]="Dynamic"}(t.Usage||(t.Usage={})),function(e){e[e.None=0]="None",e[e.Back=1]="Back",e[e.Front=2]="Front"}(t.CullMode||(t.CullMode={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Source=2]="Source",e[e.OneMinusSource=3]="OneMinusSource"}(t.BlendFactor||(t.BlendFactor={})),function(e){e[e.Vertex=0]="Vertex",e[e.Instance=1]="Instance"}(t.StepMode||(t.StepMode={})),t.TranslateTypeToSize=function(e){switch(e){case n.Float:return 4;case n.Float2:return 8;case n.Float3:return 12;case n.Float4:return 16;case n.Int:return 4;case n.Int2:return 8;case n.Int3:return 12;case n.Int4:return 16;case n.Uint:return 4;case n.Uint2:return 8;case n.Uint3:return 12;case n.Uint4:return 16;case n.Short:return 2;case n.Short2:return 4;case n.Short3:return 6;case n.Short4:return 8;case n.Ushort:return 2;case n.Ushort2:return 4;case n.Ushort3:return 6;case n.Ushort4:return 8;case n.Char:return 1;case n.Char2:return 2;case n.Char3:return 3;case n.Char4:return 4;case n.Uchar:return 1;case n.Uchar2:return 2;case n.Uchar3:return 3;case n.Uchar4:return 4;case n.Half:return 2;case n.Half2:return 4;case n.Half3:return 6;case n.Half4:return 8;case n.Float3x3:return 36;case n.Float4x4:return 64;default:throw new Error(`Unsupported type: ${e}`)}}},function(e,t,r){"use strict";function n(e,t=""){if(!e)throw console.error((new Error).stack),new Error(`Assert fail: ${t}`)}function a(e,t){return null!=e?e:t}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=n,t.assertDefined=function(e,t){if(null!=e)return e;throw new Error(a(t,"Missing object"))},t.defined=function(e){return null!=e},t.defaultValue=a,t.arrayRemove=function(e,t){const r=e.indexOf(t);return n(r>=0),e.splice(r,1),r},t.nArray=function(e,t){const r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LoadingAsync=0]="LoadingAsync",e[e.LoadingSync=1]="LoadingSync",e[e.Loaded=2]="Loaded",e[e.Unloaded=3]="Unloaded",e[e.Failed=4]="Failed"}(t.ResourceStatus||(t.ResourceStatus={}))},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"EPSILON",(function(){return d})),r.d(n,"ARRAY_TYPE",(function(){return p})),r.d(n,"RANDOM",(function(){return m})),r.d(n,"setMatrixArrayType",(function(){return y})),r.d(n,"toRadian",(function(){return x})),r.d(n,"equals",(function(){return T}));var a={};r.r(a),r.d(a,"create",(function(){return M})),r.d(a,"clone",(function(){return g})),r.d(a,"copy",(function(){return v})),r.d(a,"identity",(function(){return F})),r.d(a,"fromValues",(function(){return w})),r.d(a,"set",(function(){return _})),r.d(a,"transpose",(function(){return S})),r.d(a,"invert",(function(){return E})),r.d(a,"adjoint",(function(){return U})),r.d(a,"determinant",(function(){return A})),r.d(a,"multiply",(function(){return L})),r.d(a,"rotate",(function(){return D})),r.d(a,"scale",(function(){return R})),r.d(a,"fromRotation",(function(){return I})),r.d(a,"fromScaling",(function(){return P})),r.d(a,"str",(function(){return B})),r.d(a,"frob",(function(){return O})),r.d(a,"LDU",(function(){return V})),r.d(a,"add",(function(){return C})),r.d(a,"subtract",(function(){return G})),r.d(a,"exactEquals",(function(){return N})),r.d(a,"equals",(function(){return j})),r.d(a,"multiplyScalar",(function(){return k})),r.d(a,"multiplyScalarAndAdd",(function(){return q})),r.d(a,"mul",(function(){return z})),r.d(a,"sub",(function(){return H}));var i={};r.r(i),r.d(i,"create",(function(){return X})),r.d(i,"clone",(function(){return $})),r.d(i,"copy",(function(){return Y})),r.d(i,"identity",(function(){return W})),r.d(i,"fromValues",(function(){return K})),r.d(i,"set",(function(){return Q})),r.d(i,"invert",(function(){return Z})),r.d(i,"determinant",(function(){return J})),r.d(i,"multiply",(function(){return ee})),r.d(i,"rotate",(function(){return te})),r.d(i,"scale",(function(){return re})),r.d(i,"translate",(function(){return ne})),r.d(i,"fromRotation",(function(){return ae})),r.d(i,"fromScaling",(function(){return ie})),r.d(i,"fromTranslation",(function(){return ue})),r.d(i,"str",(function(){return se})),r.d(i,"frob",(function(){return oe})),r.d(i,"add",(function(){return ce})),r.d(i,"subtract",(function(){return fe})),r.d(i,"multiplyScalar",(function(){return he})),r.d(i,"multiplyScalarAndAdd",(function(){return le})),r.d(i,"exactEquals",(function(){return de})),r.d(i,"equals",(function(){return pe})),r.d(i,"mul",(function(){return me})),r.d(i,"sub",(function(){return ye}));var u={};r.r(u),r.d(u,"create",(function(){return be})),r.d(u,"fromMat4",(function(){return xe})),r.d(u,"clone",(function(){return Te})),r.d(u,"copy",(function(){return Me})),r.d(u,"fromValues",(function(){return ge})),r.d(u,"set",(function(){return ve})),r.d(u,"identity",(function(){return Fe})),r.d(u,"transpose",(function(){return we})),r.d(u,"invert",(function(){return _e})),r.d(u,"adjoint",(function(){return Se})),r.d(u,"determinant",(function(){return Ee})),r.d(u,"multiply",(function(){return Ue})),r.d(u,"translate",(function(){return Ae})),r.d(u,"rotate",(function(){return Le})),r.d(u,"scale",(function(){return De})),r.d(u,"fromTranslation",(function(){return Re})),r.d(u,"fromRotation",(function(){return Ie})),r.d(u,"fromScaling",(function(){return Pe})),r.d(u,"fromMat2d",(function(){return Be})),r.d(u,"fromQuat",(function(){return Oe})),r.d(u,"normalFromMat4",(function(){return Ve})),r.d(u,"projection",(function(){return Ce})),r.d(u,"str",(function(){return Ge})),r.d(u,"frob",(function(){return Ne})),r.d(u,"add",(function(){return je})),r.d(u,"subtract",(function(){return ke})),r.d(u,"multiplyScalar",(function(){return qe})),r.d(u,"multiplyScalarAndAdd",(function(){return ze})),r.d(u,"exactEquals",(function(){return He})),r.d(u,"equals",(function(){return Xe})),r.d(u,"mul",(function(){return $e})),r.d(u,"sub",(function(){return Ye}));var s={};r.r(s),r.d(s,"create",(function(){return We})),r.d(s,"clone",(function(){return Ke})),r.d(s,"copy",(function(){return Qe})),r.d(s,"fromValues",(function(){return Ze})),r.d(s,"set",(function(){return Je})),r.d(s,"identity",(function(){return et})),r.d(s,"transpose",(function(){return tt})),r.d(s,"invert",(function(){return rt})),r.d(s,"adjoint",(function(){return nt})),r.d(s,"determinant",(function(){return at})),r.d(s,"multiply",(function(){return it})),r.d(s,"translate",(function(){return ut})),r.d(s,"scale",(function(){return st})),r.d(s,"rotate",(function(){return ot})),r.d(s,"rotateX",(function(){return ct})),r.d(s,"rotateY",(function(){return ft})),r.d(s,"rotateZ",(function(){return ht})),r.d(s,"fromTranslation",(function(){return lt})),r.d(s,"fromScaling",(function(){return dt})),r.d(s,"fromRotation",(function(){return pt})),r.d(s,"fromXRotation",(function(){return mt})),r.d(s,"fromYRotation",(function(){return yt})),r.d(s,"fromZRotation",(function(){return bt})),r.d(s,"fromRotationTranslation",(function(){return xt})),r.d(s,"fromQuat2",(function(){return Tt})),r.d(s,"getTranslation",(function(){return Mt})),r.d(s,"getScaling",(function(){return gt})),r.d(s,"getRotation",(function(){return vt})),r.d(s,"fromRotationTranslationScale",(function(){return Ft})),r.d(s,"fromRotationTranslationScaleOrigin",(function(){return wt})),r.d(s,"fromQuat",(function(){return _t})),r.d(s,"frustum",(function(){return St})),r.d(s,"perspective",(function(){return Et})),r.d(s,"perspectiveFromFieldOfView",(function(){return Ut})),r.d(s,"ortho",(function(){return At})),r.d(s,"lookAt",(function(){return Lt})),r.d(s,"targetTo",(function(){return Dt})),r.d(s,"str",(function(){return Rt})),r.d(s,"frob",(function(){return It})),r.d(s,"add",(function(){return Pt})),r.d(s,"subtract",(function(){return Bt})),r.d(s,"multiplyScalar",(function(){return Ot})),r.d(s,"multiplyScalarAndAdd",(function(){return Vt})),r.d(s,"exactEquals",(function(){return Ct})),r.d(s,"equals",(function(){return Gt})),r.d(s,"mul",(function(){return Nt})),r.d(s,"sub",(function(){return jt}));var o={};r.r(o),r.d(o,"create",(function(){return kt})),r.d(o,"clone",(function(){return qt})),r.d(o,"length",(function(){return zt})),r.d(o,"fromValues",(function(){return Ht})),r.d(o,"copy",(function(){return Xt})),r.d(o,"set",(function(){return $t})),r.d(o,"add",(function(){return Yt})),r.d(o,"subtract",(function(){return Wt})),r.d(o,"multiply",(function(){return Kt})),r.d(o,"divide",(function(){return Qt})),r.d(o,"ceil",(function(){return Zt})),r.d(o,"floor",(function(){return Jt})),r.d(o,"min",(function(){return er})),r.d(o,"max",(function(){return tr})),r.d(o,"round",(function(){return rr})),r.d(o,"scale",(function(){return nr})),r.d(o,"scaleAndAdd",(function(){return ar})),r.d(o,"distance",(function(){return ir})),r.d(o,"squaredDistance",(function(){return ur})),r.d(o,"squaredLength",(function(){return sr})),r.d(o,"negate",(function(){return or})),r.d(o,"inverse",(function(){return cr})),r.d(o,"normalize",(function(){return fr})),r.d(o,"dot",(function(){return hr})),r.d(o,"cross",(function(){return lr})),r.d(o,"lerp",(function(){return dr})),r.d(o,"hermite",(function(){return pr})),r.d(o,"bezier",(function(){return mr})),r.d(o,"random",(function(){return yr})),r.d(o,"transformMat4",(function(){return br})),r.d(o,"transformMat3",(function(){return xr})),r.d(o,"transformQuat",(function(){return Tr})),r.d(o,"rotateX",(function(){return Mr})),r.d(o,"rotateY",(function(){return gr})),r.d(o,"rotateZ",(function(){return vr})),r.d(o,"angle",(function(){return Fr})),r.d(o,"zero",(function(){return wr})),r.d(o,"str",(function(){return _r})),r.d(o,"exactEquals",(function(){return Sr})),r.d(o,"equals",(function(){return Er})),r.d(o,"sub",(function(){return Ar})),r.d(o,"mul",(function(){return Lr})),r.d(o,"div",(function(){return Dr})),r.d(o,"dist",(function(){return Rr})),r.d(o,"sqrDist",(function(){return Ir})),r.d(o,"len",(function(){return Pr})),r.d(o,"sqrLen",(function(){return Br})),r.d(o,"forEach",(function(){return Or}));var c={};r.r(c),r.d(c,"create",(function(){return Vr})),r.d(c,"clone",(function(){return Cr})),r.d(c,"fromValues",(function(){return Gr})),r.d(c,"copy",(function(){return Nr})),r.d(c,"set",(function(){return jr})),r.d(c,"add",(function(){return kr})),r.d(c,"subtract",(function(){return qr})),r.d(c,"multiply",(function(){return zr})),r.d(c,"divide",(function(){return Hr})),r.d(c,"ceil",(function(){return Xr})),r.d(c,"floor",(function(){return $r})),r.d(c,"min",(function(){return Yr})),r.d(c,"max",(function(){return Wr})),r.d(c,"round",(function(){return Kr})),r.d(c,"scale",(function(){return Qr})),r.d(c,"scaleAndAdd",(function(){return Zr})),r.d(c,"distance",(function(){return Jr})),r.d(c,"squaredDistance",(function(){return en})),r.d(c,"length",(function(){return tn})),r.d(c,"squaredLength",(function(){return rn})),r.d(c,"negate",(function(){return nn})),r.d(c,"inverse",(function(){return an})),r.d(c,"normalize",(function(){return un})),r.d(c,"dot",(function(){return sn})),r.d(c,"cross",(function(){return on})),r.d(c,"lerp",(function(){return cn})),r.d(c,"random",(function(){return fn})),r.d(c,"transformMat4",(function(){return hn})),r.d(c,"transformQuat",(function(){return ln})),r.d(c,"zero",(function(){return dn})),r.d(c,"str",(function(){return pn})),r.d(c,"exactEquals",(function(){return mn})),r.d(c,"equals",(function(){return yn})),r.d(c,"sub",(function(){return bn})),r.d(c,"mul",(function(){return xn})),r.d(c,"div",(function(){return Tn})),r.d(c,"dist",(function(){return Mn})),r.d(c,"sqrDist",(function(){return gn})),r.d(c,"len",(function(){return vn})),r.d(c,"sqrLen",(function(){return Fn})),r.d(c,"forEach",(function(){return wn}));var f={};r.r(f),r.d(f,"create",(function(){return _n})),r.d(f,"identity",(function(){return Sn})),r.d(f,"setAxisAngle",(function(){return En})),r.d(f,"getAxisAngle",(function(){return Un})),r.d(f,"getAngle",(function(){return An})),r.d(f,"multiply",(function(){return Ln})),r.d(f,"rotateX",(function(){return Dn})),r.d(f,"rotateY",(function(){return Rn})),r.d(f,"rotateZ",(function(){return In})),r.d(f,"calculateW",(function(){return Pn})),r.d(f,"exp",(function(){return Bn})),r.d(f,"ln",(function(){return On})),r.d(f,"pow",(function(){return Vn})),r.d(f,"slerp",(function(){return Cn})),r.d(f,"random",(function(){return Gn})),r.d(f,"invert",(function(){return Nn})),r.d(f,"conjugate",(function(){return jn})),r.d(f,"fromMat3",(function(){return kn})),r.d(f,"fromEuler",(function(){return qn})),r.d(f,"str",(function(){return zn})),r.d(f,"clone",(function(){return Qn})),r.d(f,"fromValues",(function(){return Zn})),r.d(f,"copy",(function(){return Jn})),r.d(f,"set",(function(){return ea})),r.d(f,"add",(function(){return ta})),r.d(f,"mul",(function(){return ra})),r.d(f,"scale",(function(){return na})),r.d(f,"dot",(function(){return aa})),r.d(f,"lerp",(function(){return ia})),r.d(f,"length",(function(){return ua})),r.d(f,"len",(function(){return sa})),r.d(f,"squaredLength",(function(){return oa})),r.d(f,"sqrLen",(function(){return ca})),r.d(f,"normalize",(function(){return fa})),r.d(f,"exactEquals",(function(){return ha})),r.d(f,"equals",(function(){return la})),r.d(f,"rotationTo",(function(){return da})),r.d(f,"sqlerp",(function(){return pa})),r.d(f,"setAxes",(function(){return ma}));var h={};r.r(h),r.d(h,"create",(function(){return ya})),r.d(h,"clone",(function(){return ba})),r.d(h,"fromValues",(function(){return xa})),r.d(h,"fromRotationTranslationValues",(function(){return Ta})),r.d(h,"fromRotationTranslation",(function(){return Ma})),r.d(h,"fromTranslation",(function(){return ga})),r.d(h,"fromRotation",(function(){return va})),r.d(h,"fromMat4",(function(){return Fa})),r.d(h,"copy",(function(){return wa})),r.d(h,"identity",(function(){return _a})),r.d(h,"set",(function(){return Sa})),r.d(h,"getReal",(function(){return Ea})),r.d(h,"getDual",(function(){return Ua})),r.d(h,"setReal",(function(){return Aa})),r.d(h,"setDual",(function(){return La})),r.d(h,"getTranslation",(function(){return Da})),r.d(h,"translate",(function(){return Ra})),r.d(h,"rotateX",(function(){return Ia})),r.d(h,"rotateY",(function(){return Pa})),r.d(h,"rotateZ",(function(){return Ba})),r.d(h,"rotateByQuatAppend",(function(){return Oa})),r.d(h,"rotateByQuatPrepend",(function(){return Va})),r.d(h,"rotateAroundAxis",(function(){return Ca})),r.d(h,"add",(function(){return Ga})),r.d(h,"multiply",(function(){return Na})),r.d(h,"mul",(function(){return ja})),r.d(h,"scale",(function(){return ka})),r.d(h,"dot",(function(){return qa})),r.d(h,"lerp",(function(){return za})),r.d(h,"invert",(function(){return Ha})),r.d(h,"conjugate",(function(){return Xa})),r.d(h,"length",(function(){return $a})),r.d(h,"len",(function(){return Ya})),r.d(h,"squaredLength",(function(){return Wa})),r.d(h,"sqrLen",(function(){return Ka})),r.d(h,"normalize",(function(){return Qa})),r.d(h,"str",(function(){return Za})),r.d(h,"exactEquals",(function(){return Ja})),r.d(h,"equals",(function(){return ei}));var l={};r.r(l),r.d(l,"create",(function(){return ti})),r.d(l,"clone",(function(){return ri})),r.d(l,"fromValues",(function(){return ni})),r.d(l,"copy",(function(){return ai})),r.d(l,"set",(function(){return ii})),r.d(l,"add",(function(){return ui})),r.d(l,"subtract",(function(){return si})),r.d(l,"multiply",(function(){return oi})),r.d(l,"divide",(function(){return ci})),r.d(l,"ceil",(function(){return fi})),r.d(l,"floor",(function(){return hi})),r.d(l,"min",(function(){return li})),r.d(l,"max",(function(){return di})),r.d(l,"round",(function(){return pi})),r.d(l,"scale",(function(){return mi})),r.d(l,"scaleAndAdd",(function(){return yi})),r.d(l,"distance",(function(){return bi})),r.d(l,"squaredDistance",(function(){return xi})),r.d(l,"length",(function(){return Ti})),r.d(l,"squaredLength",(function(){return Mi})),r.d(l,"negate",(function(){return gi})),r.d(l,"inverse",(function(){return vi})),r.d(l,"normalize",(function(){return Fi})),r.d(l,"dot",(function(){return wi})),r.d(l,"cross",(function(){return _i})),r.d(l,"lerp",(function(){return Si})),r.d(l,"random",(function(){return Ei})),r.d(l,"transformMat2",(function(){return Ui})),r.d(l,"transformMat2d",(function(){return Ai})),r.d(l,"transformMat3",(function(){return Li})),r.d(l,"transformMat4",(function(){return Di})),r.d(l,"rotate",(function(){return Ri})),r.d(l,"angle",(function(){return Ii})),r.d(l,"zero",(function(){return Pi})),r.d(l,"str",(function(){return Bi})),r.d(l,"exactEquals",(function(){return Oi})),r.d(l,"equals",(function(){return Vi})),r.d(l,"len",(function(){return Ci})),r.d(l,"sub",(function(){return Gi})),r.d(l,"mul",(function(){return Ni})),r.d(l,"div",(function(){return ji})),r.d(l,"dist",(function(){return ki})),r.d(l,"sqrDist",(function(){return qi})),r.d(l,"sqrLen",(function(){return zi})),r.d(l,"forEach",(function(){return Hi}));var d=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function y(e){p=e}var b=Math.PI/180;function x(e){return e*b}function T(e,t){return Math.abs(e-t)<=d*Math.max(1,Math.abs(e),Math.abs(t))}function M(){var e=new p(4);return p!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function g(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function v(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function F(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function w(e,t,r,n){var a=new p(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function _(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function S(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function E(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=r*i-a*n;return u?(u=1/u,e[0]=i*u,e[1]=-n*u,e[2]=-a*u,e[3]=r*u,e):null}function U(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function A(e){return e[0]*e[3]-e[2]*e[1]}function L(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=r[0],o=r[1],c=r[2],f=r[3];return e[0]=n*s+i*o,e[1]=a*s+u*o,e[2]=n*c+i*f,e[3]=a*c+u*f,e}function D(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=Math.sin(r),o=Math.cos(r);return e[0]=n*o+i*s,e[1]=a*o+u*s,e[2]=n*-s+i*o,e[3]=a*-s+u*o,e}function R(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=r[0],o=r[1];return e[0]=n*s,e[1]=a*s,e[2]=i*o,e[3]=u*o,e}function I(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e}function P(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function B(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function O(e){return Math.hypot(e[0],e[1],e[2],e[3])}function V(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]}function C(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function G(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function j(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=t[0],s=t[1],o=t[2],c=t[3];return Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=d*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}function k(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function q(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var z=L,H=G;function X(){var e=new p(6);return p!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function $(e){var t=new p(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function W(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function K(e,t,r,n,a,i){var u=new p(6);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=a,u[5]=i,u}function Q(e,t,r,n,a,i,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=u,e}function Z(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=r*i-n*a;return o?(o=1/o,e[0]=i*o,e[1]=-n*o,e[2]=-a*o,e[3]=r*o,e[4]=(a*s-i*u)*o,e[5]=(n*u-r*s)*o,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=r[0],f=r[1],h=r[2],l=r[3],d=r[4],p=r[5];return e[0]=n*c+i*f,e[1]=a*c+u*f,e[2]=n*h+i*l,e[3]=a*h+u*l,e[4]=n*d+i*p+s,e[5]=a*d+u*p+o,e}function te(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=Math.sin(r),f=Math.cos(r);return e[0]=n*f+i*c,e[1]=a*f+u*c,e[2]=n*-c+i*f,e[3]=a*-c+u*f,e[4]=s,e[5]=o,e}function re(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=r[0],f=r[1];return e[0]=n*c,e[1]=a*c,e[2]=i*f,e[3]=u*f,e[4]=s,e[5]=o,e}function ne(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=r[0],f=r[1];return e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=n*c+i*f+s,e[5]=a*c+u*f+o,e}function ae(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ue(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function se(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function oe(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ce(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function fe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function he(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function le(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e}function de(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function pe(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=t[0],c=t[1],f=t[2],h=t[3],l=t[4],p=t[5];return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-f)<=d*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(u-l)<=d*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))}var me=ee,ye=fe;function be(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function xe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Te(e){var t=new p(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Me(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ge(e,t,r,n,a,i,u,s,o){var c=new p(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=n,c[4]=a,c[5]=i,c[6]=u,c[7]=s,c[8]=o,c}function ve(e,t,r,n,a,i,u,s,o,c){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=u,e[6]=s,e[7]=o,e[8]=c,e}function Fe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function we(e,t){if(e===t){var r=t[1],n=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function _e(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=f*u-s*c,l=-f*i+s*o,d=c*i-u*o,p=r*h+n*l+a*d;return p?(p=1/p,e[0]=h*p,e[1]=(-f*n+a*c)*p,e[2]=(s*n-a*u)*p,e[3]=l*p,e[4]=(f*r-a*o)*p,e[5]=(-s*r+a*i)*p,e[6]=d*p,e[7]=(-c*r+n*o)*p,e[8]=(u*r-n*i)*p,e):null}function Se(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8];return e[0]=u*f-s*c,e[1]=a*c-n*f,e[2]=n*s-a*u,e[3]=s*o-i*f,e[4]=r*f-a*o,e[5]=a*i-r*s,e[6]=i*c-u*o,e[7]=n*o-r*c,e[8]=r*u-n*i,e}function Ee(e){var t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],u=e[5],s=e[6],o=e[7],c=e[8];return t*(c*i-u*o)+r*(-c*a+u*s)+n*(o*a-i*s)}function Ue(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=t[8],l=r[0],d=r[1],p=r[2],m=r[3],y=r[4],b=r[5],x=r[6],T=r[7],M=r[8];return e[0]=l*n+d*u+p*c,e[1]=l*a+d*s+p*f,e[2]=l*i+d*o+p*h,e[3]=m*n+y*u+b*c,e[4]=m*a+y*s+b*f,e[5]=m*i+y*o+b*h,e[6]=x*n+T*u+M*c,e[7]=x*a+T*s+M*f,e[8]=x*i+T*o+M*h,e}function Ae(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=t[8],l=r[0],d=r[1];return e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=s,e[5]=o,e[6]=l*n+d*u+c,e[7]=l*a+d*s+f,e[8]=l*i+d*o+h,e}function Le(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=t[8],l=Math.sin(r),d=Math.cos(r);return e[0]=d*n+l*u,e[1]=d*a+l*s,e[2]=d*i+l*o,e[3]=d*u-l*n,e[4]=d*s-l*a,e[5]=d*o-l*i,e[6]=c,e[7]=f,e[8]=h,e}function De(e,t,r){var n=r[0],a=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Re(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ie(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Pe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Oe(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=r+r,s=n+n,o=a+a,c=r*u,f=n*u,h=n*s,l=a*u,d=a*s,p=a*o,m=i*u,y=i*s,b=i*o;return e[0]=1-h-p,e[3]=f-b,e[6]=l+y,e[1]=f+b,e[4]=1-c-p,e[7]=d-m,e[2]=l-y,e[5]=d+m,e[8]=1-c-h,e}function Ve(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=t[9],l=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15],x=r*s-n*u,T=r*o-a*u,M=r*c-i*u,g=n*o-a*s,v=n*c-i*s,F=a*c-i*o,w=f*m-h*p,_=f*y-l*p,S=f*b-d*p,E=h*y-l*m,U=h*b-d*m,A=l*b-d*y,L=x*A-T*U+M*E+g*S-v*_+F*w;return L?(L=1/L,e[0]=(s*A-o*U+c*E)*L,e[1]=(o*S-u*A-c*_)*L,e[2]=(u*U-s*S+c*w)*L,e[3]=(a*U-n*A-i*E)*L,e[4]=(r*A-a*S+i*_)*L,e[5]=(n*S-r*U-i*w)*L,e[6]=(m*F-y*v+b*g)*L,e[7]=(y*M-p*F-b*T)*L,e[8]=(p*v-m*M+b*x)*L,e):null}function Ce(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Ge(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ne(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function je(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function ke(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function qe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function ze(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Xe(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=t[0],l=t[1],p=t[2],m=t[3],y=t[4],b=t[5],x=t[6],T=t[7],M=t[8];return Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-l)<=d*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-p)<=d*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(u-y)<=d*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(s-b)<=d*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-x)<=d*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(c-T)<=d*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(f-M)<=d*Math.max(1,Math.abs(f),Math.abs(M))}var $e=Ue,Ye=ke;function We(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ze(e,t,r,n,a,i,u,s,o,c,f,h,l,d,m,y){var b=new p(16);return b[0]=e,b[1]=t,b[2]=r,b[3]=n,b[4]=a,b[5]=i,b[6]=u,b[7]=s,b[8]=o,b[9]=c,b[10]=f,b[11]=h,b[12]=l,b[13]=d,b[14]=m,b[15]=y,b}function Je(e,t,r,n,a,i,u,s,o,c,f,h,l,d,p,m,y){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=u,e[6]=s,e[7]=o,e[8]=c,e[9]=f,e[10]=h,e[11]=l,e[12]=d,e[13]=p,e[14]=m,e[15]=y,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],i=t[6],u=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=a,e[13]=u,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function rt(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=t[9],l=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15],x=r*s-n*u,T=r*o-a*u,M=r*c-i*u,g=n*o-a*s,v=n*c-i*s,F=a*c-i*o,w=f*m-h*p,_=f*y-l*p,S=f*b-d*p,E=h*y-l*m,U=h*b-d*m,A=l*b-d*y,L=x*A-T*U+M*E+g*S-v*_+F*w;return L?(L=1/L,e[0]=(s*A-o*U+c*E)*L,e[1]=(a*U-n*A-i*E)*L,e[2]=(m*F-y*v+b*g)*L,e[3]=(l*v-h*F-d*g)*L,e[4]=(o*S-u*A-c*_)*L,e[5]=(r*A-a*S+i*_)*L,e[6]=(y*M-p*F-b*T)*L,e[7]=(f*F-l*M+d*T)*L,e[8]=(u*U-s*S+c*w)*L,e[9]=(n*S-r*U-i*w)*L,e[10]=(p*v-m*M+b*x)*L,e[11]=(h*M-f*v-d*x)*L,e[12]=(s*_-u*E-o*w)*L,e[13]=(r*E-n*_+a*w)*L,e[14]=(m*T-p*g-y*x)*L,e[15]=(f*g-h*T+l*x)*L,e):null}function nt(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=t[9],l=t[10],d=t[11],p=t[12],m=t[13],y=t[14],b=t[15];return e[0]=s*(l*b-d*y)-h*(o*b-c*y)+m*(o*d-c*l),e[1]=-(n*(l*b-d*y)-h*(a*b-i*y)+m*(a*d-i*l)),e[2]=n*(o*b-c*y)-s*(a*b-i*y)+m*(a*c-i*o),e[3]=-(n*(o*d-c*l)-s*(a*d-i*l)+h*(a*c-i*o)),e[4]=-(u*(l*b-d*y)-f*(o*b-c*y)+p*(o*d-c*l)),e[5]=r*(l*b-d*y)-f*(a*b-i*y)+p*(a*d-i*l),e[6]=-(r*(o*b-c*y)-u*(a*b-i*y)+p*(a*c-i*o)),e[7]=r*(o*d-c*l)-u*(a*d-i*l)+f*(a*c-i*o),e[8]=u*(h*b-d*m)-f*(s*b-c*m)+p*(s*d-c*h),e[9]=-(r*(h*b-d*m)-f*(n*b-i*m)+p*(n*d-i*h)),e[10]=r*(s*b-c*m)-u*(n*b-i*m)+p*(n*c-i*s),e[11]=-(r*(s*d-c*h)-u*(n*d-i*h)+f*(n*c-i*s)),e[12]=-(u*(h*y-l*m)-f*(s*y-o*m)+p*(s*l-o*h)),e[13]=r*(h*y-l*m)-f*(n*y-a*m)+p*(n*l-a*h),e[14]=-(r*(s*y-o*m)-u*(n*y-a*m)+p*(n*o-a*s)),e[15]=r*(s*l-o*h)-u*(n*l-a*h)+f*(n*o-a*s),e}function at(e){var t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],u=e[5],s=e[6],o=e[7],c=e[8],f=e[9],h=e[10],l=e[11],d=e[12],p=e[13],m=e[14],y=e[15];return(t*u-r*i)*(h*y-l*m)-(t*s-n*i)*(f*y-l*p)+(t*o-a*i)*(f*m-h*p)+(r*s-n*u)*(c*y-l*d)-(r*o-a*u)*(c*m-h*d)+(n*o-a*s)*(c*p-f*d)}function it(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=t[8],l=t[9],d=t[10],p=t[11],m=t[12],y=t[13],b=t[14],x=t[15],T=r[0],M=r[1],g=r[2],v=r[3];return e[0]=T*n+M*s+g*h+v*m,e[1]=T*a+M*o+g*l+v*y,e[2]=T*i+M*c+g*d+v*b,e[3]=T*u+M*f+g*p+v*x,T=r[4],M=r[5],g=r[6],v=r[7],e[4]=T*n+M*s+g*h+v*m,e[5]=T*a+M*o+g*l+v*y,e[6]=T*i+M*c+g*d+v*b,e[7]=T*u+M*f+g*p+v*x,T=r[8],M=r[9],g=r[10],v=r[11],e[8]=T*n+M*s+g*h+v*m,e[9]=T*a+M*o+g*l+v*y,e[10]=T*i+M*c+g*d+v*b,e[11]=T*u+M*f+g*p+v*x,T=r[12],M=r[13],g=r[14],v=r[15],e[12]=T*n+M*s+g*h+v*m,e[13]=T*a+M*o+g*l+v*y,e[14]=T*i+M*c+g*d+v*b,e[15]=T*u+M*f+g*p+v*x,e}function ut(e,t,r){var n,a,i,u,s,o,c,f,h,l,d,p,m=r[0],y=r[1],b=r[2];return t===e?(e[12]=t[0]*m+t[4]*y+t[8]*b+t[12],e[13]=t[1]*m+t[5]*y+t[9]*b+t[13],e[14]=t[2]*m+t[6]*y+t[10]*b+t[14],e[15]=t[3]*m+t[7]*y+t[11]*b+t[15]):(n=t[0],a=t[1],i=t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=t[8],l=t[9],d=t[10],p=t[11],e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=s,e[5]=o,e[6]=c,e[7]=f,e[8]=h,e[9]=l,e[10]=d,e[11]=p,e[12]=n*m+s*y+h*b+t[12],e[13]=a*m+o*y+l*b+t[13],e[14]=i*m+c*y+d*b+t[14],e[15]=u*m+f*y+p*b+t[15]),e}function st(e,t,r){var n=r[0],a=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ot(e,t,r,n){var a,i,u,s,o,c,f,h,l,p,m,y,b,x,T,M,g,v,F,w,_,S,E,U,A=n[0],L=n[1],D=n[2],R=Math.hypot(A,L,D);return R<d?null:(A*=R=1/R,L*=R,D*=R,a=Math.sin(r),u=1-(i=Math.cos(r)),s=t[0],o=t[1],c=t[2],f=t[3],h=t[4],l=t[5],p=t[6],m=t[7],y=t[8],b=t[9],x=t[10],T=t[11],M=A*A*u+i,g=L*A*u+D*a,v=D*A*u-L*a,F=A*L*u-D*a,w=L*L*u+i,_=D*L*u+A*a,S=A*D*u+L*a,E=L*D*u-A*a,U=D*D*u+i,e[0]=s*M+h*g+y*v,e[1]=o*M+l*g+b*v,e[2]=c*M+p*g+x*v,e[3]=f*M+m*g+T*v,e[4]=s*F+h*w+y*_,e[5]=o*F+l*w+b*_,e[6]=c*F+p*w+x*_,e[7]=f*F+m*w+T*_,e[8]=s*S+h*E+y*U,e[9]=o*S+l*E+b*U,e[10]=c*S+p*E+x*U,e[11]=f*S+m*E+T*U,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ct(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[4],u=t[5],s=t[6],o=t[7],c=t[8],f=t[9],h=t[10],l=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+c*n,e[5]=u*a+f*n,e[6]=s*a+h*n,e[7]=o*a+l*n,e[8]=c*a-i*n,e[9]=f*a-u*n,e[10]=h*a-s*n,e[11]=l*a-o*n,e}function ft(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],u=t[1],s=t[2],o=t[3],c=t[8],f=t[9],h=t[10],l=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-c*n,e[1]=u*a-f*n,e[2]=s*a-h*n,e[3]=o*a-l*n,e[8]=i*n+c*a,e[9]=u*n+f*a,e[10]=s*n+h*a,e[11]=o*n+l*a,e}function ht(e,t,r){var n=Math.sin(r),a=Math.cos(r),i=t[0],u=t[1],s=t[2],o=t[3],c=t[4],f=t[5],h=t[6],l=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+c*n,e[1]=u*a+f*n,e[2]=s*a+h*n,e[3]=o*a+l*n,e[4]=c*a-i*n,e[5]=f*a-u*n,e[6]=h*a-s*n,e[7]=l*a-o*n,e}function lt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,r){var n,a,i,u=r[0],s=r[1],o=r[2],c=Math.hypot(u,s,o);return c<d?null:(u*=c=1/c,s*=c,o*=c,n=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=u*u*i+a,e[1]=s*u*i+o*n,e[2]=o*u*i-s*n,e[3]=0,e[4]=u*s*i-o*n,e[5]=s*s*i+a,e[6]=o*s*i+u*n,e[7]=0,e[8]=u*o*i+s*n,e[9]=s*o*i-u*n,e[10]=o*o*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xt(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=n+n,o=a+a,c=i+i,f=n*s,h=n*o,l=n*c,d=a*o,p=a*c,m=i*c,y=u*s,b=u*o,x=u*c;return e[0]=1-(d+m),e[1]=h+x,e[2]=l-b,e[3]=0,e[4]=h-x,e[5]=1-(f+m),e[6]=p+y,e[7]=0,e[8]=l+b,e[9]=p-y,e[10]=1-(f+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Tt(e,t){var r=new p(3),n=-t[0],a=-t[1],i=-t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=n*n+a*a+i*i+u*u;return h>0?(r[0]=2*(s*u+f*n+o*i-c*a)/h,r[1]=2*(o*u+f*a+c*n-s*i)/h,r[2]=2*(c*u+f*i+s*a-o*n)/h):(r[0]=2*(s*u+f*n+o*i-c*a),r[1]=2*(o*u+f*a+c*n-s*i),r[2]=2*(c*u+f*i+s*a-o*n)),xt(e,t,r),e}function Mt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function gt(e,t){var r=t[0],n=t[1],a=t[2],i=t[4],u=t[5],s=t[6],o=t[8],c=t[9],f=t[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(i,u,s),e[2]=Math.hypot(o,c,f),e}function vt(e,t){var r=new p(3);gt(r,t);var n=1/r[0],a=1/r[1],i=1/r[2],u=t[0]*n,s=t[1]*a,o=t[2]*i,c=t[4]*n,f=t[5]*a,h=t[6]*i,l=t[8]*n,d=t[9]*a,m=t[10]*i,y=u+f+m,b=0;return y>0?(b=2*Math.sqrt(y+1),e[3]=.25*b,e[0]=(h-d)/b,e[1]=(l-o)/b,e[2]=(s-c)/b):u>f&&u>m?(b=2*Math.sqrt(1+u-f-m),e[3]=(h-d)/b,e[0]=.25*b,e[1]=(s+c)/b,e[2]=(l+o)/b):f>m?(b=2*Math.sqrt(1+f-u-m),e[3]=(l-o)/b,e[0]=(s+c)/b,e[1]=.25*b,e[2]=(h+d)/b):(b=2*Math.sqrt(1+m-u-f),e[3]=(s-c)/b,e[0]=(l+o)/b,e[1]=(h+d)/b,e[2]=.25*b),e}function Ft(e,t,r,n){var a=t[0],i=t[1],u=t[2],s=t[3],o=a+a,c=i+i,f=u+u,h=a*o,l=a*c,d=a*f,p=i*c,m=i*f,y=u*f,b=s*o,x=s*c,T=s*f,M=n[0],g=n[1],v=n[2];return e[0]=(1-(p+y))*M,e[1]=(l+T)*M,e[2]=(d-x)*M,e[3]=0,e[4]=(l-T)*g,e[5]=(1-(h+y))*g,e[6]=(m+b)*g,e[7]=0,e[8]=(d+x)*v,e[9]=(m-b)*v,e[10]=(1-(h+p))*v,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function wt(e,t,r,n,a){var i=t[0],u=t[1],s=t[2],o=t[3],c=i+i,f=u+u,h=s+s,l=i*c,d=i*f,p=i*h,m=u*f,y=u*h,b=s*h,x=o*c,T=o*f,M=o*h,g=n[0],v=n[1],F=n[2],w=a[0],_=a[1],S=a[2],E=(1-(m+b))*g,U=(d+M)*g,A=(p-T)*g,L=(d-M)*v,D=(1-(l+b))*v,R=(y+x)*v,I=(p+T)*F,P=(y-x)*F,B=(1-(l+m))*F;return e[0]=E,e[1]=U,e[2]=A,e[3]=0,e[4]=L,e[5]=D,e[6]=R,e[7]=0,e[8]=I,e[9]=P,e[10]=B,e[11]=0,e[12]=r[0]+w-(E*w+L*_+I*S),e[13]=r[1]+_-(U*w+D*_+P*S),e[14]=r[2]+S-(A*w+R*_+B*S),e[15]=1,e}function _t(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=r+r,s=n+n,o=a+a,c=r*u,f=n*u,h=n*s,l=a*u,d=a*s,p=a*o,m=i*u,y=i*s,b=i*o;return e[0]=1-h-p,e[1]=f+b,e[2]=l-y,e[3]=0,e[4]=f-b,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=l+y,e[9]=d-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function St(e,t,r,n,a,i,u){var s=1/(r-t),o=1/(a-n),c=1/(i-u);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*o,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(a+n)*o,e[10]=(u+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*i*2*c,e[15]=0,e}function Et(e,t,r,n,a){var i,u=1/Math.tan(t/2);return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(n-a),e[10]=(a+n)*i,e[14]=2*a*n*i):(e[10]=-1,e[14]=-2*n),e}function Ut(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),u=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),o=2/(u+s),c=2/(a+i);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(u-s)*o*.5,e[9]=(a-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function At(e,t,r,n,a,i,u){var s=1/(t-r),o=1/(n-a),c=1/(i-u);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(a+n)*o,e[14]=(u+i)*c,e[15]=1,e}function Lt(e,t,r,n){var a,i,u,s,o,c,f,h,l,p,m=t[0],y=t[1],b=t[2],x=n[0],T=n[1],M=n[2],g=r[0],v=r[1],F=r[2];return Math.abs(m-g)<d&&Math.abs(y-v)<d&&Math.abs(b-F)<d?et(e):(f=m-g,h=y-v,l=b-F,a=T*(l*=p=1/Math.hypot(f,h,l))-M*(h*=p),i=M*(f*=p)-x*l,u=x*h-T*f,(p=Math.hypot(a,i,u))?(a*=p=1/p,i*=p,u*=p):(a=0,i=0,u=0),s=h*u-l*i,o=l*a-f*u,c=f*i-h*a,(p=Math.hypot(s,o,c))?(s*=p=1/p,o*=p,c*=p):(s=0,o=0,c=0),e[0]=a,e[1]=s,e[2]=f,e[3]=0,e[4]=i,e[5]=o,e[6]=h,e[7]=0,e[8]=u,e[9]=c,e[10]=l,e[11]=0,e[12]=-(a*m+i*y+u*b),e[13]=-(s*m+o*y+c*b),e[14]=-(f*m+h*y+l*b),e[15]=1,e)}function Dt(e,t,r,n){var a=t[0],i=t[1],u=t[2],s=n[0],o=n[1],c=n[2],f=a-r[0],h=i-r[1],l=u-r[2],d=f*f+h*h+l*l;d>0&&(f*=d=1/Math.sqrt(d),h*=d,l*=d);var p=o*l-c*h,m=c*f-s*l,y=s*h-o*f;return(d=p*p+m*m+y*y)>0&&(p*=d=1/Math.sqrt(d),m*=d,y*=d),e[0]=p,e[1]=m,e[2]=y,e[3]=0,e[4]=h*y-l*m,e[5]=l*p-f*y,e[6]=f*m-h*p,e[7]=0,e[8]=f,e[9]=h,e[10]=l,e[11]=0,e[12]=a,e[13]=i,e[14]=u,e[15]=1,e}function Rt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function It(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Pt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Bt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Ot(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Vt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Ct(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Gt(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=e[9],l=e[10],p=e[11],m=e[12],y=e[13],b=e[14],x=e[15],T=t[0],M=t[1],g=t[2],v=t[3],F=t[4],w=t[5],_=t[6],S=t[7],E=t[8],U=t[9],A=t[10],L=t[11],D=t[12],R=t[13],I=t[14],P=t[15];return Math.abs(r-T)<=d*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-M)<=d*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-g)<=d*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(i-v)<=d*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(u-F)<=d*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(s-w)<=d*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-_)<=d*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-S)<=d*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(f-E)<=d*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(h-U)<=d*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(l-A)<=d*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(p-L)<=d*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(m-D)<=d*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(y-R)<=d*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(b-I)<=d*Math.max(1,Math.abs(b),Math.abs(I))&&Math.abs(x-P)<=d*Math.max(1,Math.abs(x),Math.abs(P))}var Nt=it,jt=Bt;function kt(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function qt(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function Ht(e,t,r){var n=new p(3);return n[0]=e,n[1]=t,n[2]=r,n}function Xt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $t(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Yt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Wt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Kt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Qt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Zt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Jt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function er(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function tr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function rr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function nr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function ar(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function ir(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return Math.hypot(r,n,a)}function ur(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return r*r+n*n+a*a}function sr(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function or(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function cr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function fr(e,t){var r=t[0],n=t[1],a=t[2],i=r*r+n*n+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function hr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lr(e,t,r){var n=t[0],a=t[1],i=t[2],u=r[0],s=r[1],o=r[2];return e[0]=a*o-i*s,e[1]=i*u-n*o,e[2]=n*s-a*u,e}function dr(e,t,r,n){var a=t[0],i=t[1],u=t[2];return e[0]=a+n*(r[0]-a),e[1]=i+n*(r[1]-i),e[2]=u+n*(r[2]-u),e}function pr(e,t,r,n,a,i){var u=i*i,s=u*(2*i-3)+1,o=u*(i-2)+i,c=u*(i-1),f=u*(3-2*i);return e[0]=t[0]*s+r[0]*o+n[0]*c+a[0]*f,e[1]=t[1]*s+r[1]*o+n[1]*c+a[1]*f,e[2]=t[2]*s+r[2]*o+n[2]*c+a[2]*f,e}function mr(e,t,r,n,a,i){var u=1-i,s=u*u,o=i*i,c=s*u,f=3*i*s,h=3*o*u,l=o*i;return e[0]=t[0]*c+r[0]*f+n[0]*h+a[0]*l,e[1]=t[1]*c+r[1]*f+n[1]*h+a[1]*l,e[2]=t[2]*c+r[2]*f+n[2]*h+a[2]*l,e}function yr(e,t){t=t||1;var r=2*m()*Math.PI,n=2*m()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e}function br(e,t,r){var n=t[0],a=t[1],i=t[2],u=r[3]*n+r[7]*a+r[11]*i+r[15];return u=u||1,e[0]=(r[0]*n+r[4]*a+r[8]*i+r[12])/u,e[1]=(r[1]*n+r[5]*a+r[9]*i+r[13])/u,e[2]=(r[2]*n+r[6]*a+r[10]*i+r[14])/u,e}function xr(e,t,r){var n=t[0],a=t[1],i=t[2];return e[0]=n*r[0]+a*r[3]+i*r[6],e[1]=n*r[1]+a*r[4]+i*r[7],e[2]=n*r[2]+a*r[5]+i*r[8],e}function Tr(e,t,r){var n=r[0],a=r[1],i=r[2],u=r[3],s=t[0],o=t[1],c=t[2],f=a*c-i*o,h=i*s-n*c,l=n*o-a*s,d=a*l-i*h,p=i*f-n*l,m=n*h-a*f,y=2*u;return f*=y,h*=y,l*=y,d*=2,p*=2,m*=2,e[0]=s+f+d,e[1]=o+h+p,e[2]=c+l+m,e}function Mr(e,t,r,n){var a=[],i=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],i[0]=a[0],i[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),i[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function gr(e,t,r,n){var a=[],i=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],i[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),i[1]=a[1],i[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function vr(e,t,r,n){var a=[],i=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],i[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),i[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),i[2]=a[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function Fr(e,t){var r=e[0],n=e[1],a=e[2],i=t[0],u=t[1],s=t[2],o=Math.sqrt(r*r+n*n+a*a)*Math.sqrt(i*i+u*u+s*s),c=o&&hr(e,t)/o;return Math.acos(Math.min(Math.max(c,-1),1))}function wr(e){return e[0]=0,e[1]=0,e[2]=0,e}function _r(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Sr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Er(e,t){var r=e[0],n=e[1],a=e[2],i=t[0],u=t[1],s=t[2];return Math.abs(r-i)<=d*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-s)<=d*Math.max(1,Math.abs(a),Math.abs(s))}var Ur,Ar=Wt,Lr=Kt,Dr=Qt,Rr=ir,Ir=ur,Pr=zt,Br=sr,Or=(Ur=kt(),function(e,t,r,n,a,i){var u,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,u=r;u<s;u+=t)Ur[0]=e[u],Ur[1]=e[u+1],Ur[2]=e[u+2],a(Ur,Ur,i),e[u]=Ur[0],e[u+1]=Ur[1],e[u+2]=Ur[2];return e});function Vr(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Cr(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Gr(e,t,r,n){var a=new p(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function Nr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function jr(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function kr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function qr(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function zr(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Hr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Xr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function $r(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Yr(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Wr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Kr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Qr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Zr(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Jr(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.hypot(r,n,a,i)}function en(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+a*a+i*i}function tn(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(t,r,n,a)}function rn(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function nn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function an(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function un(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=r*r+n*n+a*a+i*i;return u>0&&(u=1/Math.sqrt(u)),e[0]=r*u,e[1]=n*u,e[2]=a*u,e[3]=i*u,e}function sn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function on(e,t,r,n){var a=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],o=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],f=t[0],h=t[1],l=t[2],d=t[3];return e[0]=h*c-l*o+d*s,e[1]=-f*c+l*u-d*i,e[2]=f*o-h*u+d*a,e[3]=-f*s+h*i-l*a,e}function cn(e,t,r,n){var a=t[0],i=t[1],u=t[2],s=t[3];return e[0]=a+n*(r[0]-a),e[1]=i+n*(r[1]-i),e[2]=u+n*(r[2]-u),e[3]=s+n*(r[3]-s),e}function fn(e,t){var r,n,a,i,u,s;t=t||1;do{u=(r=2*m()-1)*r+(n=2*m()-1)*n}while(u>=1);do{s=(a=2*m()-1)*a+(i=2*m()-1)*i}while(s>=1);var o=Math.sqrt((1-u)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*a*o,e[3]=t*i*o,e}function hn(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*u,e[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*u,e[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*u,e[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*u,e}function ln(e,t,r){var n=t[0],a=t[1],i=t[2],u=r[0],s=r[1],o=r[2],c=r[3],f=c*n+s*i-o*a,h=c*a+o*n-u*i,l=c*i+u*a-s*n,d=-u*n-s*a-o*i;return e[0]=f*c+d*-u+h*-o-l*-s,e[1]=h*c+d*-s+l*-u-f*-o,e[2]=l*c+d*-o+f*-s-h*-u,e[3]=t[3],e}function dn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function pn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function yn(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=t[0],s=t[1],o=t[2],c=t[3];return Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=d*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}var bn=qr,xn=zr,Tn=Hr,Mn=Jr,gn=en,vn=tn,Fn=rn,wn=function(){var e=Vr();return function(t,r,n,a,i,u){var s,o;for(r||(r=4),n||(n=0),o=a?Math.min(a*r+n,t.length):t.length,s=n;s<o;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,u),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function _n(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Sn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function En(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Un(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>d?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function An(e,t){var r=aa(e,t);return Math.acos(2*r*r-1)}function Ln(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=r[0],o=r[1],c=r[2],f=r[3];return e[0]=n*f+u*s+a*c-i*o,e[1]=a*f+u*o+i*s-n*c,e[2]=i*f+u*c+n*o-a*s,e[3]=u*f-n*s-a*o-i*c,e}function Dn(e,t,r){r*=.5;var n=t[0],a=t[1],i=t[2],u=t[3],s=Math.sin(r),o=Math.cos(r);return e[0]=n*o+u*s,e[1]=a*o+i*s,e[2]=i*o-a*s,e[3]=u*o-n*s,e}function Rn(e,t,r){r*=.5;var n=t[0],a=t[1],i=t[2],u=t[3],s=Math.sin(r),o=Math.cos(r);return e[0]=n*o-i*s,e[1]=a*o+u*s,e[2]=i*o+n*s,e[3]=u*o-a*s,e}function In(e,t,r){r*=.5;var n=t[0],a=t[1],i=t[2],u=t[3],s=Math.sin(r),o=Math.cos(r);return e[0]=n*o+a*s,e[1]=a*o-n*s,e[2]=i*o+u*s,e[3]=u*o-i*s,e}function Pn(e,t){var r=t[0],n=t[1],a=t[2];return e[0]=r,e[1]=n,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),e}function Bn(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=Math.sqrt(r*r+n*n+a*a),s=Math.exp(i),o=u>0?s*Math.sin(u)/u:0;return e[0]=r*o,e[1]=n*o,e[2]=a*o,e[3]=s*Math.cos(u),e}function On(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=Math.sqrt(r*r+n*n+a*a),s=u>0?Math.atan2(u,i)/u:0;return e[0]=r*s,e[1]=n*s,e[2]=a*s,e[3]=.5*Math.log(r*r+n*n+a*a+i*i),e}function Vn(e,t,r){return On(e,t),na(e,e,r),Bn(e,e),e}function Cn(e,t,r,n){var a,i,u,s,o,c=t[0],f=t[1],h=t[2],l=t[3],p=r[0],m=r[1],y=r[2],b=r[3];return(i=c*p+f*m+h*y+l*b)<0&&(i=-i,p=-p,m=-m,y=-y,b=-b),1-i>d?(a=Math.acos(i),u=Math.sin(a),s=Math.sin((1-n)*a)/u,o=Math.sin(n*a)/u):(s=1-n,o=n),e[0]=s*c+o*p,e[1]=s*f+o*m,e[2]=s*h+o*y,e[3]=s*l+o*b,e}function Gn(e){var t=m(),r=m(),n=m(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=i*Math.sin(2*Math.PI*n),e[3]=i*Math.cos(2*Math.PI*n),e}function Nn(e,t){var r=t[0],n=t[1],a=t[2],i=t[3],u=r*r+n*n+a*a+i*i,s=u?1/u:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-a*s,e[3]=i*s,e}function jn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function kn(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,u=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*u+u]+1),e[a]=.5*r,r=.5/r,e[3]=(t[3*i+u]-t[3*u+i])*r,e[i]=(t[3*i+a]+t[3*a+i])*r,e[u]=(t[3*u+a]+t[3*a+u])*r}return e}function qn(e,t,r,n){var a=.5*Math.PI/180;t*=a,r*=a,n*=a;var i=Math.sin(t),u=Math.cos(t),s=Math.sin(r),o=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return e[0]=i*o*f-u*s*c,e[1]=u*s*f+i*o*c,e[2]=u*o*c-i*s*f,e[3]=u*o*f+i*s*c,e}function zn(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Hn,Xn,$n,Yn,Wn,Kn,Qn=Cr,Zn=Gr,Jn=Nr,ea=jr,ta=kr,ra=Ln,na=Qr,aa=sn,ia=cn,ua=tn,sa=ua,oa=rn,ca=oa,fa=un,ha=mn,la=yn,da=(Hn=kt(),Xn=Ht(1,0,0),$n=Ht(0,1,0),function(e,t,r){var n=hr(t,r);return n<-.999999?(lr(Hn,Xn,t),Pr(Hn)<1e-6&&lr(Hn,$n,t),fr(Hn,Hn),En(e,Hn,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(lr(Hn,t,r),e[0]=Hn[0],e[1]=Hn[1],e[2]=Hn[2],e[3]=1+n,fa(e,e))}),pa=(Yn=_n(),Wn=_n(),function(e,t,r,n,a,i){return Cn(Yn,t,a,i),Cn(Wn,r,n,i),Cn(e,Yn,Wn,2*i*(1-i)),e}),ma=(Kn=be(),function(e,t,r,n){return Kn[0]=r[0],Kn[3]=r[1],Kn[6]=r[2],Kn[1]=n[0],Kn[4]=n[1],Kn[7]=n[2],Kn[2]=-t[0],Kn[5]=-t[1],Kn[8]=-t[2],fa(e,kn(e,Kn))});function ya(){var e=new p(8);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function ba(e){var t=new p(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xa(e,t,r,n,a,i,u,s){var o=new p(8);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o[4]=a,o[5]=i,o[6]=u,o[7]=s,o}function Ta(e,t,r,n,a,i,u){var s=new p(8);s[0]=e,s[1]=t,s[2]=r,s[3]=n;var o=.5*a,c=.5*i,f=.5*u;return s[4]=o*n+c*r-f*t,s[5]=c*n+f*e-o*r,s[6]=f*n+o*t-c*e,s[7]=-o*e-c*t-f*r,s}function Ma(e,t,r){var n=.5*r[0],a=.5*r[1],i=.5*r[2],u=t[0],s=t[1],o=t[2],c=t[3];return e[0]=u,e[1]=s,e[2]=o,e[3]=c,e[4]=n*c+a*o-i*s,e[5]=a*c+i*u-n*o,e[6]=i*c+n*s-a*u,e[7]=-n*u-a*s-i*o,e}function ga(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function va(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Fa(e,t){var r=_n();vt(r,t);var n=new p(3);return Mt(n,t),Ma(e,r,n),e}function wa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function _a(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Sa(e,t,r,n,a,i,u,s,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=i,e[5]=u,e[6]=s,e[7]=o,e}var Ea=Jn;function Ua(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Aa=Jn;function La(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Da(e,t){var r=t[4],n=t[5],a=t[6],i=t[7],u=-t[0],s=-t[1],o=-t[2],c=t[3];return e[0]=2*(r*c+i*u+n*o-a*s),e[1]=2*(n*c+i*s+a*u-r*o),e[2]=2*(a*c+i*o+r*s-n*u),e}function Ra(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=.5*r[0],o=.5*r[1],c=.5*r[2],f=t[4],h=t[5],l=t[6],d=t[7];return e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=u*s+a*c-i*o+f,e[5]=u*o+i*s-n*c+h,e[6]=u*c+n*o-a*s+l,e[7]=-n*s-a*o-i*c+d,e}function Ia(e,t,r){var n=-t[0],a=-t[1],i=-t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return Dn(e,t,r),n=e[0],a=e[1],i=e[2],u=e[3],e[4]=h*u+p*n+l*i-d*a,e[5]=l*u+p*a+d*n-h*i,e[6]=d*u+p*i+h*a-l*n,e[7]=p*u-h*n-l*a-d*i,e}function Pa(e,t,r){var n=-t[0],a=-t[1],i=-t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return Rn(e,t,r),n=e[0],a=e[1],i=e[2],u=e[3],e[4]=h*u+p*n+l*i-d*a,e[5]=l*u+p*a+d*n-h*i,e[6]=d*u+p*i+h*a-l*n,e[7]=p*u-h*n-l*a-d*i,e}function Ba(e,t,r){var n=-t[0],a=-t[1],i=-t[2],u=t[3],s=t[4],o=t[5],c=t[6],f=t[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return In(e,t,r),n=e[0],a=e[1],i=e[2],u=e[3],e[4]=h*u+p*n+l*i-d*a,e[5]=l*u+p*a+d*n-h*i,e[6]=d*u+p*i+h*a-l*n,e[7]=p*u-h*n-l*a-d*i,e}function Oa(e,t,r){var n=r[0],a=r[1],i=r[2],u=r[3],s=t[0],o=t[1],c=t[2],f=t[3];return e[0]=s*u+f*n+o*i-c*a,e[1]=o*u+f*a+c*n-s*i,e[2]=c*u+f*i+s*a-o*n,e[3]=f*u-s*n-o*a-c*i,s=t[4],o=t[5],c=t[6],f=t[7],e[4]=s*u+f*n+o*i-c*a,e[5]=o*u+f*a+c*n-s*i,e[6]=c*u+f*i+s*a-o*n,e[7]=f*u-s*n-o*a-c*i,e}function Va(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=r[0],o=r[1],c=r[2],f=r[3];return e[0]=n*f+u*s+a*c-i*o,e[1]=a*f+u*o+i*s-n*c,e[2]=i*f+u*c+n*o-a*s,e[3]=u*f-n*s-a*o-i*c,s=r[4],o=r[5],c=r[6],f=r[7],e[4]=n*f+u*s+a*c-i*o,e[5]=a*f+u*o+i*s-n*c,e[6]=i*f+u*c+n*o-a*s,e[7]=u*f-n*s-a*o-i*c,e}function Ca(e,t,r,n){if(Math.abs(n)<d)return wa(e,t);var a=Math.hypot(r[0],r[1],r[2]);n*=.5;var i=Math.sin(n),u=i*r[0]/a,s=i*r[1]/a,o=i*r[2]/a,c=Math.cos(n),f=t[0],h=t[1],l=t[2],p=t[3];e[0]=f*c+p*u+h*o-l*s,e[1]=h*c+p*s+l*u-f*o,e[2]=l*c+p*o+f*s-h*u,e[3]=p*c-f*u-h*s-l*o;var m=t[4],y=t[5],b=t[6],x=t[7];return e[4]=m*c+x*u+y*o-b*s,e[5]=y*c+x*s+b*u-m*o,e[6]=b*c+x*o+m*s-y*u,e[7]=x*c-m*u-y*s-b*o,e}function Ga(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function Na(e,t,r){var n=t[0],a=t[1],i=t[2],u=t[3],s=r[4],o=r[5],c=r[6],f=r[7],h=t[4],l=t[5],d=t[6],p=t[7],m=r[0],y=r[1],b=r[2],x=r[3];return e[0]=n*x+u*m+a*b-i*y,e[1]=a*x+u*y+i*m-n*b,e[2]=i*x+u*b+n*y-a*m,e[3]=u*x-n*m-a*y-i*b,e[4]=n*f+u*s+a*c-i*o+h*x+p*m+l*b-d*y,e[5]=a*f+u*o+i*s-n*c+l*x+p*y+d*m-h*b,e[6]=i*f+u*c+n*o-a*s+d*x+p*b+h*y-l*m,e[7]=u*f-n*s-a*o-i*c+p*x-h*m-l*y-d*b,e}var ja=Na;function ka(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var qa=aa;function za(e,t,r,n){var a=1-n;return qa(t,r)<0&&(n=-n),e[0]=t[0]*a+r[0]*n,e[1]=t[1]*a+r[1]*n,e[2]=t[2]*a+r[2]*n,e[3]=t[3]*a+r[3]*n,e[4]=t[4]*a+r[4]*n,e[5]=t[5]*a+r[5]*n,e[6]=t[6]*a+r[6]*n,e[7]=t[7]*a+r[7]*n,e}function Ha(e,t){var r=Wa(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function Xa(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var $a=ua,Ya=$a,Wa=oa,Ka=Wa;function Qa(e,t){var r=Wa(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,a=t[1]/r,i=t[2]/r,u=t[3]/r,s=t[4],o=t[5],c=t[6],f=t[7],h=n*s+a*o+i*c+u*f;e[0]=n,e[1]=a,e[2]=i,e[3]=u,e[4]=(s-n*h)/r,e[5]=(o-a*h)/r,e[6]=(c-i*h)/r,e[7]=(f-u*h)/r}return e}function Za(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Ja(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function ei(e,t){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=t[0],h=t[1],l=t[2],p=t[3],m=t[4],y=t[5],b=t[6],x=t[7];return Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-h)<=d*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-l)<=d*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-p)<=d*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(u-m)<=d*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(s-y)<=d*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-b)<=d*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-x)<=d*Math.max(1,Math.abs(c),Math.abs(x))}function ti(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function ri(e){var t=new p(2);return t[0]=e[0],t[1]=e[1],t}function ni(e,t){var r=new p(2);return r[0]=e,r[1]=t,r}function ai(e,t){return e[0]=t[0],e[1]=t[1],e}function ii(e,t,r){return e[0]=t,e[1]=r,e}function ui(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function si(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function oi(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function ci(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function fi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function hi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function li(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function di(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function pi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function mi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function yi(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function bi(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function xi(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Ti(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Mi(e){var t=e[0],r=e[1];return t*t+r*r}function gi(e,t){return e[0]=-t[0],e[1]=-t[1],e}function vi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Fi(e,t){var r=t[0],n=t[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function wi(e,t){return e[0]*t[0]+e[1]*t[1]}function _i(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Si(e,t,r,n){var a=t[0],i=t[1];return e[0]=a+n*(r[0]-a),e[1]=i+n*(r[1]-i),e}function Ei(e,t){t=t||1;var r=2*m()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Ui(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e}function Ai(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a+r[4],e[1]=r[1]*n+r[3]*a+r[5],e}function Li(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[3]*a+r[6],e[1]=r[1]*n+r[4]*a+r[7],e}function Di(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],e}function Ri(e,t,r,n){var a=t[0]-r[0],i=t[1]-r[1],u=Math.sin(n),s=Math.cos(n);return e[0]=a*s-i*u+r[0],e[1]=a*u+i*s+r[1],e}function Ii(e,t){var r=e[0],n=e[1],a=t[0],i=t[1],u=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+i*i),s=u&&(r*a+n*i)/u;return Math.acos(Math.min(Math.max(s,-1),1))}function Pi(e){return e[0]=0,e[1]=0,e}function Bi(e){return"vec2("+e[0]+", "+e[1]+")"}function Oi(e,t){return e[0]===t[0]&&e[1]===t[1]}function Vi(e,t){var r=e[0],n=e[1],a=t[0],i=t[1];return Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))}var Ci=Ti,Gi=si,Ni=oi,ji=ci,ki=bi,qi=xi,zi=Mi,Hi=function(){var e=ti();return function(t,r,n,a,i,u){var s,o;for(r||(r=2),n||(n=0),o=a?Math.min(a*r+n,t.length):t.length,s=n;s<o;s+=r)e[0]=t[s],e[1]=t[s+1],i(e,e,u),t[s]=e[0],t[s+1]=e[1];return t}}();r.d(t,"glMatrix",(function(){return n})),r.d(t,"mat2",(function(){return a})),r.d(t,"mat2d",(function(){return i})),r.d(t,"mat3",(function(){return u})),r.d(t,"mat4",(function(){return s})),r.d(t,"quat",(function(){return f})),r.d(t,"quat2",(function(){return h})),r.d(t,"vec2",(function(){return l})),r.d(t,"vec3",(function(){return o})),r.d(t,"vec4",(function(){return c}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class a{constructor(e,t){this.defaultCullMode=e,this.defaultDepthState=t,this.primitives=[]}push(e){this.primitives.push(e)}}t.RenderList=a,t.renderLists={opaque:new a(n.CullMode.Back,{depthWriteEnabled:!0,depthTestEnabled:!0})}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(0));class i{constructor(e){this.bufferSize=0,this.renderer=e}initialize(){this.bufferSize=0;const e=Object.keys(i.bufferLayout);for(let t=0;t<e.length;t++){const r=i.bufferLayout[e[t]];this.bufferSize+=a.TranslateTypeToSize(r.type)}this._buffer=this.renderer.createBuffer("GlobalUniforms",a.BufferType.Uniform,a.Usage.Dynamic,this.bufferSize)}setUniform(e,t){const r=i.bufferLayout[e];if(!r)throw new Error(`Attempted to set unknown global uniform ${e}`);const n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this.renderer.writeBufferData(this.buffer,r.offset,n)}get buffer(){return this._buffer}}t.GlobalUniforms=i,i.bufferLayout=function(e){let t=0;const r=Object.keys(e);for(let n=0;n<r.length;n++){const i=e[r[n]];i.offset=t,t+=a.TranslateTypeToSize(i.type)}return e}({g_camPos:{type:a.Type.Float3},g_proj:{type:a.Type.Float4x4},g_viewProj:{type:a.Type.Float4x4}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(7),a=r(8),i=r(9),u=r(10),s=r(11),o=r(12),c=r(5),f=r(16),h=r(17);window.main=new class{constructor(){this.canvas=document.createElement("canvas"),this.paused=!1,this.gfxDevice=new a.WebGlRenderer,this.camera=new i.Camera,this.dt=0,this.realTime=0,this.cameraSystem=new u.CameraSystem(this.camera),this.compositor=new s.Compositor(this.canvas,this.gfxDevice),this.globalUniforms=new c.GlobalUniforms(this.gfxDevice),this.demo=new o.Demo,this.input=new f.InputManager,this.resources=new h.ResourceManager,this._updateLoop=e=>{this.paused||(this.dt=e-this.realTime,this.realTime=e,this.resources.update(),this.cameraSystem.update(this),this.demo.update(this),this.compositor.render(),this.demo.render(this),this.input.afterFrame(),window.requestAnimationFrame(this._updateLoop))},this.init()}async init(){return console.log(`Source for this build available at ${n.GITHUB_REVISION_URL}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(n.IS_DEVELOPMENT),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),this.resources.initialize(this.gfxDevice),this.input.initialize(this),this.cameraSystem.initialize(),this.compositor.initialize(),this.globalUniforms.initialize(),this.demo.initialize(this),window.onresize=this._onResize.bind(this),this._onResize(),n.IS_DEVELOPMENT,this._updateLoop(window.performance.now()),0):1}setPaused(e){this.paused!==e&&(this.paused=!0,this.paused||window.requestAnimationFrame(this._updateLoop))}_onResize(){this.cameraSystem.resize(window.innerWidth,window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GIT_REVISION="c3d1585653f23467ec6e3a61610af1c67c4d4d37",t.GIT_SHORT_REVISION=t.GIT_REVISION.slice(0,8),t.GITHUB_URL="https://github.com/themikelester/gfx-boilerplate",t.GITHUB_REVISION_URL=`${t.GITHUB_URL}/commit/${t.GIT_REVISION}`,t.IS_DEVELOPMENT=!1},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(0));let i;function u(e){switch(e){case i.FLOAT:return a.Type.Float;case i.FLOAT_VEC2:return a.Type.Float2;case i.FLOAT_VEC3:return a.Type.Float3;case i.FLOAT_VEC4:return a.Type.Float4;case i.INT:return a.Type.Int;case i.INT_VEC2:return a.Type.Int2;case i.INT_VEC3:return a.Type.Int3;case i.INT_VEC4:return a.Type.Int4;case i.FLOAT_MAT3:return a.Type.Float3x3;case i.FLOAT_MAT4:return a.Type.Float4x4;case i.SAMPLER_2D:return a.Type.Texture2D;case i.SAMPLER_3D:return a.Type.Texture3D;case i.SAMPLER_CUBE:return a.Type.TextureCube;case i.UNSIGNED_INT:return a.Type.Uint;case i.UNSIGNED_INT_VEC2:return a.Type.Uint2;case i.UNSIGNED_INT_VEC3:return a.Type.Uint3;case i.UNSIGNED_INT_VEC4:return a.Type.Uint4;default:return T(`Unsupported WebGL type: ${e}`)}}function s(e){switch(e){case a.Type.Float:return 1;case a.Type.Float2:return 2;case a.Type.Float3:return 3;case a.Type.Float4:return 4;case a.Type.Int:return 1;case a.Type.Int2:return 2;case a.Type.Int3:return 3;case a.Type.Int4:return 4;case a.Type.Uint:return 1;case a.Type.Uint2:return 2;case a.Type.Uint3:return 3;case a.Type.Uint4:return 4;case a.Type.Short:return 1;case a.Type.Short2:return 2;case a.Type.Short3:return 3;case a.Type.Short4:return 4;case a.Type.Ushort:return 1;case a.Type.Ushort2:return 2;case a.Type.Ushort3:return 3;case a.Type.Ushort4:return 4;case a.Type.Char:return 1;case a.Type.Char2:return 2;case a.Type.Char3:return 3;case a.Type.Char4:return 4;case a.Type.Uchar:return 1;case a.Type.Uchar2:return 2;case a.Type.Uchar3:return 3;case a.Type.Uchar4:return 4;case a.Type.Half:return 1;case a.Type.Half2:return 2;case a.Type.Half3:return 3;case a.Type.Half4:return 4;default:return T(`Unsupported type: ${e}`)}}function o(e){switch(e){case a.Type.Float:case a.Type.Float2:case a.Type.Float3:case a.Type.Float4:return i.FLOAT;case a.Type.Int:case a.Type.Int2:case a.Type.Int3:case a.Type.Int4:return i.INT;case a.Type.Uint:case a.Type.Uint2:case a.Type.Uint3:case a.Type.Uint4:return i.UNSIGNED_INT;case a.Type.Short:case a.Type.Short2:case a.Type.Short3:case a.Type.Short4:return i.SHORT;case a.Type.Ushort:case a.Type.Ushort2:case a.Type.Ushort3:case a.Type.Ushort4:return i.UNSIGNED_SHORT;case a.Type.Char:case a.Type.Char2:case a.Type.Char3:case a.Type.Char4:return i.BYTE;case a.Type.Uchar:case a.Type.Uchar2:case a.Type.Uchar3:case a.Type.Uchar4:return i.UNSIGNED_BYTE;case a.Type.Half:case a.Type.Half2:case a.Type.Half3:case a.Type.Half4:return i.HALF_FLOAT;default:return T(`Unsupported type: ${e}`)}}function c(e){switch(e){case a.PrimitiveType.Points:return i.POINTS;case a.PrimitiveType.Lines:return i.LINES;case a.PrimitiveType.LineLoop:return i.LINE_LOOP;case a.PrimitiveType.LineStrip:return i.LINE_STRIP;case a.PrimitiveType.Triangles:return i.TRIANGLES;case a.PrimitiveType.TriangleStrip:return i.TRIANGLE_STRIP;case a.PrimitiveType.TriangleFan:return i.TRIANGLE_FAN;default:return T(`Unsupported primitive type: ${e}`)}}function f(e){switch(e){case a.Type.Uchar:return i.UNSIGNED_BYTE;case a.Type.Uint:return i.UNSIGNED_INT;case a.Type.Ushort:return i.UNSIGNED_SHORT;default:return T(`Unsupported index type: ${e}`)}}function h(e){switch(e){case a.TextureType.Texture2D:return i.TEXTURE_2D;case a.TextureType.Texture3D:return i.TEXTURE_3D;case a.TextureType.TextureCube:return i.TEXTURE_CUBE_MAP;default:return T(`Unsupported texture type: ${e}`)}}function l(e){switch(e){case a.TexelFormat.U565:return i.RGB;case a.TexelFormat.U8:return i.ALPHA;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.RGBA;case a.TexelFormat.F16:return i.ALPHA;case a.TexelFormat.F16x4:case a.TexelFormat.F32x4:return i.RGBA;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT;case a.TexelFormat.Depth24Stencil8:return i.DEPTH_STENCIL;default:return T(`Unsupported texel format: ${e}`)}}function d(e){switch(e){case a.TexelFormat.U565:return i.RGB;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:return i.RED;case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:return i.RG;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:case a.TexelFormat.U10_10_10_2:return i.RGBA;case a.TexelFormat.F16:return i.RED;case a.TexelFormat.F16x2:return i.RG;case a.TexelFormat.F16x4:return i.RGBA;case a.TexelFormat.F32x2:return i.RG;case a.TexelFormat.F32x4:return i.RGBA;case a.TexelFormat.F11_11_10:return i.RGB;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT;case a.TexelFormat.Depth24Stencil8:return i.DEPTH_STENCIL;default:return T(`Unsupported texel format: ${e}`)}}function p(e){switch(e){case a.TexelFormat.U565:return i.RGB565;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:return i.R8;case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:return i.RG8;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB8;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.RGBA8;case a.TexelFormat.U10_10_10_2:return i.RGB10_A2;case a.TexelFormat.F16:return i.R16F;case a.TexelFormat.F16x2:return i.RG16F;case a.TexelFormat.F16x3:return i.RGB16F;case a.TexelFormat.F16x4:return i.RGBA16F;case a.TexelFormat.F32x2:return i.RG32F;case a.TexelFormat.F32x3:return i.RGB32F;case a.TexelFormat.F32x4:return i.RGBA32F;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT32F;case a.TexelFormat.Depth24Stencil8:return i.DEPTH24_STENCIL8;default:return T(`Unsupported texel format: ${e}`)}}function m(e){switch(e){case a.TexelFormat.Undefined:return 0;case a.TexelFormat.U565:return i.UNSIGNED_SHORT_5_6_5;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.UNSIGNED_BYTE;case a.TexelFormat.U10_10_10_2:return i.RGBA;case a.TexelFormat.F11_11_10:return i.FLOAT;case a.TexelFormat.F16:case a.TexelFormat.F16x2:case a.TexelFormat.F16x4:return i.HALF_FLOAT;case a.TexelFormat.F32x2:case a.TexelFormat.F32x4:case a.TexelFormat.Depth32:return i.FLOAT;case a.TexelFormat.Depth24Stencil8:return i.UNSIGNED_INT_24_8;default:return T(`Unsupported texel format: ${e}`)}}function y(e){switch(e){case a.TextureFilter.Nearest:return i.NEAREST;case a.TextureFilter.Linear:return i.LINEAR;default:return T("Unsupported texture filter: ${filter)")}}function b(e){switch(e){case a.BlendFactor.Zero:return i.ZERO;case a.BlendFactor.One:return i.One;case a.BlendFactor.Source:return i.SRC_ALPHA;case a.BlendFactor.OneMinusSource:return i.ONE_MINUS_SRC_ALPHA;default:return T(`Unsupported blend factor: ${e}`)}}function x(e,t="Assert failed"){e||T(t)}function T(e){throw console.error(e),new Error(e)}function M(e,t){return void 0!==e?e:t}function g(e){return null!=e}function v(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap}function F(e,t,r){const n=i.createShader(t);if(i.shaderSource(n,r),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){T(`${t===i.VERTEX_SHADER?"Vertex":"Fragment"} compilation failed for shader ${e}:\n  ${i.getShaderInfoLog(n)}`)}return n}function w(e,t,r){const n=e.vertexLayout.buffers[r],u=e.shader.reflection,s=Object.keys(n.layout);i.bindBuffer(i.ARRAY_BUFFER,t.buffer.glId);for(let e=0;e<s.length;e++){const r=n.layout[s[e]],o=u.attributes[s[e]];g(o)&&(t.buffer?(i.enableVertexAttribArray(o.location),i.vertexAttribPointer(o.location,o.components,o.glType,!0,n.stride,r.offset+t.offset),n.stepMode===a.StepMode.Instance&&(i.instancedArrays?i.instancedArrays.vertexAttribDivisorANGLE(o.location,1):i.vertexAttribDivisor(o.location,1))):i.disableVertexAttribArray(o.location))}}function _(e){return e.type===a.BindingType.Texture}class S{constructor(){this.objects=[],this.freeList=[],this.count=0}get(e){const t=this.objects[e];return x(void 0!==t,"Invalid ID"),t}create(e){if(++this.count,this.freeList.length>0){const t=this.freeList.pop();return this.objects[t]=e,t}return this.objects.push(e),this.objects.length-1}delete(e){--this.count,delete this.objects[e],this.freeList.push(e)}}t.WebGlRenderer=class{constructor(){this.debugEnabled=!1,this.buffers=new S,this.textures=new S,this.shaders=new S,this.renderPipelines=new S,this.resourceTables=new S,this.renderPasses=new S,this.depthStencilStates=new S}initialize(e){const t={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(i=e.getContext("webgl2",t),i||(i=e.getContext("webgl",t)),!i)return!1;this.webGlVersion=i instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(e){let t,r=0;return(t=i.getExtension("OES_vertex_array_object"))&&(r|=a.Feature.VertexArrayObject,i.createVertexArray=t.createVertexArrayOES.bind(t),i.deleteVertexArray=t.deleteVertexArrayOES.bind(t),i.bindVertexArray=t.bindVertexArrayOES.bind(t)),(t=i.getExtension("OES_texture_half_float"))&&(r|=a.Feature.TextureHalf,i.HALF_FLOAT=t.HALF_FLOAT_OES),(t=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(r|=a.Feature.AnistropicFiltering,i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=t.MAX_TEXTURE_MAX_ANISOTROPY_EXT,i.TEXTURE_MAX_ANISOTROPY_EXT=t.TEXTURE_MAX_ANISOTROPY_EXT),i.getExtension("OES_texture_float")&&(r|=a.Feature.TextureFloat),i.getExtension("OES_texture_float_linear")&&(r|=a.Feature.TextureFloatLinearFiltering),i.getExtension("OES_texture_half_float_linear")&&(r|=a.Feature.TextureHalfLinearFiltering),i.getExtension("OES_standard_derivatives")&&(r|=a.Feature.ShaderDerivatives),i.texSubImage2D&&(r|=a.Feature.TextureWrite),(i.instancedArrays=i.getExtension("ANGLE_instanced_arrays"))&&(r|=a.Feature.Instancing),e>=2&&(r|=a.Feature.VertexArrayObject,r|=a.Feature.TextureFloat,r|=a.Feature.TextureHalf,r|=a.Feature.Instancing),r}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:e.width,height:e.height}),x(this.defaultRenderPass===a.kDefaultRenderPass),this.current={},i.clearColor(0,0,0,1);const r=new Uint8Array([0,0,0,1]),n={usage:a.Usage.Static,type:a.TextureType.Texture2D,format:a.TexelFormat.U8x4,width:1,height:1},u=this.createTexture("DefaultTexture",n,r);return this.defaultTexture=this.textures.get(u),this.isGfxFeatureSupported(a.Feature.AnistropicFiltering)&&(this.maxAnisotropy=i.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),!0}isGfxFeatureSupported(e){return!!(this.featureFlags&e)}setDebugEnabled(e){this.debugEnabled=e}resize(e,t){const r=this.renderPasses.get(this.defaultRenderPass);r.width=e,r.height=t}beginFrame(){}endFrame(){}bindRenderPass(e){const t=this.renderPasses.get(e);i.bindFramebuffer(i.FRAMEBUFFER,t.glFramebuffer),i.viewport(0,0,t.width,t.height);const r=i.COLOR_BUFFER_BIT;i.clear(r)}bindPipeline(e){const t=this.renderPipelines.get(e);this.current.shader!==t.shader&&(i.useProgram(t.shader.glProgram),this.current.shader=t.shader),t.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=t.renderFormat.blendingEnabled,t.renderFormat.blendingEnabled?i.enable(i.BLEND):i.disable(i.BLEND)),!this.current.blending||this.current.srcBlendFactor==t.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==t.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=M(t.renderFormat.srcBlendFactor,a.BlendFactor.One),this.current.dstBlendFactor=M(t.renderFormat.dstBlendFactor,a.BlendFactor.OneMinusSource),i.blendFunc(b(this.current.srcBlendFactor),b(this.current.dstBlendFactor)))}draw(e,t,r,n,u){const s=c(e),o=f(r),h=a.TranslateTypeToSize(r),l=this.buffers.get(t);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l.glId),i.drawElements(s,u,o,n*h)}drawInstanced(e,t,r,n,u,s){const o=c(e),h=f(r),l=a.TranslateTypeToSize(r),d=this.buffers.get(t);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d.glId),i.instancedArrays?i.instancedArrays.drawElementsInstancedANGLE(o,u,h,n*l,s):i.drawElementsInstanced(o,u,h,n*l,s)}drawNonIndexed(e,t,r){const n=c(e);i.drawArrays(n,t,r)}setDepthStencilState(e){const t=this.depthStencilStates.get(e),r=this.current.depthStencil;r&&t.depthWriteEnabled==r.depthWriteEnabled||i.depthMask(t.depthWriteEnabled),r&&t.depthCompareFunc==r.depthCompareFunc||i.depthFunc(t.depthCompareFunc),r&&t.depthTestEnabled==r.depthTestEnabled||(t.depthTestEnabled?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST)),this.current.depthStencil=t}setCullMode(e){this.current.cullMode!=e&&(this.current.cullMode=e,e==a.CullMode.None?i.disable(i.CULL_FACE):(i.enable(i.CULL_FACE),i.cullFace(function(e){switch(e){case a.CullMode.None:return i.NONE;case a.CullMode.Back:return i.BACK;case a.CullMode.Front:return i.FRONT;default:return T(`Unsupported culling mode: ${e}`)}}(e))))}createDepthStencilState(e){const t=function(e){switch(e){case a.CompareFunc.Never:return i.NEVER;case a.CompareFunc.Less:return i.LESS;case a.CompareFunc.Equal:return i.EQUAL;case a.CompareFunc.LessEqual:return i.LEQUAL;case a.CompareFunc.Greater:return i.GREATER;case a.CompareFunc.NotEqual:return i.NOTEQUAL;case a.CompareFunc.GreaterEqual:return i.GEQUAL;case a.CompareFunc.Always:return i.ALWAYS;default:return T(`Unsupported compare func: ${e}`)}}(M(e.depthCompareFunc,a.CompareFunc.Less));return this.depthStencilStates.create({depthTestEnabled:e.depthTestEnabled,depthWriteEnabled:e.depthWriteEnabled,depthCompareFunc:t})}createResourceTable(e){const t=this.renderPipelines.get(e);let r=null;return this.isGfxFeatureSupported(a.Feature.VertexArrayObject)&&(r=i.createVertexArray()),this.resourceTables.create({pipeline:t,vao:r,buffers:[],textures:[],uniforms:[]})}removeResourceTable(e){if(this.isGfxFeatureSupported(a.Feature.VertexArrayObject)){const t=this.resourceTables.get(e);i.deleteVertexArray(t.vao)}this.resourceTables.delete(e)}bindResources(e){const t=this.resourceTables.get(e),r=t.pipeline.shader.uniformLayout,n=t.pipeline.shader.reflection,u=t.pipeline.shader.name;if(this.isGfxFeatureSupported(a.Feature.VertexArrayObject))i.bindVertexArray(t.vao);else for(let e=0;e<t.buffers.length;e++)w(t.pipeline,t.buffers[e],e);for(let e=0;e<n.uniforms.length;e++){const u=n.uniforms[e],s=r[u.name],o=t.uniforms[s.index].buffer.cpuBuffer;x(g(o));const c=new Float32Array(o.buffer,s.offset,u.size/4),f=t.pipeline.shader.uniformVals[u.name];if(!c.every((e,t)=>e===f[t]))switch(t.pipeline.shader.uniformVals[u.name].set(c),u.type){case a.Type.Float:i.uniform1fv(u.location,c);break;case a.Type.Float2:i.uniform2fv(u.location,c);break;case a.Type.Float3:i.uniform3fv(u.location,c);break;case a.Type.Float4:i.uniform4fv(u.location,c);break;case a.Type.Float3x3:i.uniformMatrix3fv(u.location,!1,c);break;case a.Type.Float4x4:i.uniformMatrix4fv(u.location,!1,c);break;default:T("Unknown shader uniform type")}}for(let e=0;e<n.textureArray.length;e++){const a=n.textureArray[e],s=r[a.name].index;void 0===t.textures[s]&&console.warn(`Shader ${u} expects texture "${a.name}" (index ${s}) to be bound`);for(let e=0;e<a.count;e++){const r=t.textures[s+e]||this.defaultTexture,n=a.location+e;i.activeTexture(i.TEXTURE0+n),i.bindTexture(r.target,r.glId)}}}setBuffer(e,t,r=0,n=0){const u=this.resourceTables.get(e),s=this.buffers.get(t),o={buffer:s,offset:n};x(r<a.kMaxShaderVertexBuffers),s.type===a.BufferType.Uniform?u.uniforms[r]=o:(u.buffers[r]=o,this.isGfxFeatureSupported(a.Feature.VertexArrayObject)&&(i.bindVertexArray(u.vao),w(u.pipeline,o,r)))}setTexture(e,t,r){const n=this.resourceTables.get(e),a=t?this.textures.get(t):null;n.textures[r]=a}setTextures(e,t,r){const n=this.resourceTables.get(e);for(let e=0;e<t.length;e++){const a=t[e]?this.textures.get(t[e]):null;n.textures[r+e]=a}}writeBufferData(e,t,r){const n=this.buffers.get(e);if(n.type===a.BufferType.Uniform){const e=ArrayBuffer.isView(r)?r.buffer:r,a=new Uint8Array(e);g(n.cpuBuffer)?n.cpuBuffer.set(a,t):T("No CPU buffer assigned to uniform buffer")}else i.bindBuffer(n.target,n.glId),i.bufferSubData(n.target,t,r)}createRenderPipeline(e,t,r,n){const i=this.shaders.get(e);if(this.debugEnabled){Object.keys(i.reflection.attributes).forEach(e=>{x(void 0!==r.buffers.find(t=>t&&void 0!==t.layout[e]),`VertexLayout does not supply attribute ${e} required by Shader '${i.name}'`)});const e=Object.keys(n).map(e=>n[e]),t=Object.keys(i.uniformLayout);for(let r=0;r<t.length;r++){const n=i.uniformLayout[t[r]];e.find(e=>e.index===n.index)||T(`ResourceLayout does not supply a texture at index ${n.index} required by uniform '${t[r]}' of Shader '${i.name}'`)}this.isGfxFeatureSupported(a.Feature.Instancing)||r.buffers.forEach(e=>{x(e.stepMode!==a.StepMode.Instance,"Instancing is not supported by this WebGL context")})}return this.renderPipelines.create({shader:i,renderFormat:t,vertexLayout:r,resourceLayout:n})}removeRenderPipeline(e){this.renderPipelines.delete(e)}createShader(e){return this._createShader(e.name,e.vertSource,e.fragSource,e.resourceLayout)}_createShader(e,t,r,n){x(void 0!==n,"A ShaderResourceLayout must be passed to createShader to define uniform binding locations.In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader");const c=function(e,t,r){const n=F(e,i.VERTEX_SHADER,t),a=F(e,i.FRAGMENT_SHADER,r),u=i.createProgram();return i.attachShader(u,n),i.attachShader(u,a),i.linkProgram(u),i.deleteShader(n),i.deleteShader(a),i.getProgramParameter(u,i.LINK_STATUS)||T(`Linking failed for shader ${e}:\n  ${i.getProgramInfoLog(u)}`),u}(e,t instanceof Array?t.join("\n#line 0\n"):t,r instanceof Array?r.join("\n#line 0\n"):r),f=function(e){const t={},r=[],n=[],c={};let f=0;const h=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);x(h<a.kMaxShaderAttributes);for(let t=0;t<h;t++){const r=i.getActiveAttrib(e,t),n=u(r.type);c[r.name]={location:t,count:r.size,components:s(n),glType:o(n),type:n}}const l=i.getProgramParameter(e,i.ACTIVE_UNIFORMS);x(l<a.kMaxShaderUniforms);for(let s=0;s<l;s++){const o=i.getActiveUniform(e,s),c=u(o.type),h=o.name.replace("[0]","");if(c>=a.TextureType.Texture2D&&c<=a.TextureType.TextureCube){const n={name:h,count:o.size,type:c,location:f,locationGl:i.getUniformLocation(e,o.name)};f+=o.size,t[h]=n,r.push(n)}else{const t={name:h,count:o.size,type:c,size:a.TranslateTypeToSize(c)*o.size,location:i.getUniformLocation(e,o.name)};n.push(t)}}return{attributes:c,uniforms:n,textures:t,textureArray:r,textureCount:f}}(c),h=Object.keys(n),l=h.map(e=>n[e]);if(this.debugEnabled){for(let t=0;t<f.uniforms.length;t++){const r=f.uniforms[t],n=l.find(e=>!_(e)&&e.layout&&e.layout[r.name]);x(void 0!==n,`Shader '${e}' expects uniform '${r.name}' to be set in a uniform buffer`);const a=n.layout[r.name].type;x(a===r.type,`Shader '${e}' expects uniform '${r.name}' to be type ${r.type} but the ShaderResourceLayout specifies type ${a}`)}for(let t=0;t<f.textureArray.length;t++){const r=f.textureArray[t],n=l.find((e,t)=>_(e)&&h[t]===r.name);x(void 0!==n,`Shader '${e}' expects texture '${r.name}', but it is not defined in the ShaderResourceLayout`),x((n.count||1)===r.count,`Shader '${e}' expects texture '${r.name}' to be an array of length ${r.count}, but the ResourceLayout specifies length ${n.count}`)}}const d={};for(let e=0;e<f.uniforms.length;e++){const t=f.uniforms[e],r=l.find(e=>!_(e)&&e.layout&&e.layout[t.name]);d[t.name]={offset:r.layout[t.name].offset,index:r.index}}for(let e=0;e<f.textureArray.length;e++){const t=f.textureArray[e],r=n[t.name];d[t.name]={offset:0,index:r.index}}const p={};for(let e=0;e<f.uniforms.length;e++){const t=f.uniforms[e];p[t.name]=new Float32Array(t.size/4)}i.useProgram(c);const m=Object.keys(f.textures);for(let e=0;e<m.length;e++){const t=f.textures[m[e]],r=Array.from(Array(t.count).keys()).map((e,r)=>t.location+r);i.uniform1iv(t.locationGl,r)}return this.current.shader=void 0,this.shaders.create({name:e,glProgram:c,reflection:f,uniformVals:p,uniformLayout:d})}removeShader(e){const t=this.shaders.get(e);i.deleteProgram(t.glProgram),this.shaders.delete(e)}createTexture(e,t,r){const n=!r||r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength,u=1===this.webGlVersion?l:d,s={target:h(t.type),format:u(t.format),internalFormat:this.webGlVersion>1?p(t.format):u(t.format),type:m(t.format),usage:t.usage,width:n?M(t.width,1):r.width,height:n?M(t.height,1):r.height,depth:t.depth||1,minFilter:y(void 0!==t.defaultMinFilter?t.defaultMinFilter:a.TextureFilter.Linear),magFilter:y(void 0!==t.defaultMagFilter?t.defaultMagFilter:a.TextureFilter.Linear),glId:i.createTexture()};if(i.bindTexture(s.target,s.glId),i.texParameteri(s.target,i.TEXTURE_MIN_FILTER,s.minFilter),i.texParameteri(s.target,i.TEXTURE_MAG_FILTER,s.magFilter),i.texParameteri(s.target,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(s.target,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),g(t.maxAnistropy)&&t.maxAnistropy>1&&this.isGfxFeatureSupported(a.Feature.AnistropicFiltering)){const e=Math.min(this.maxAnisotropy,t.maxAnistropy);i.texParameterf(i.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,e)}const o=this.webGlVersion>1?s.internalFormat:s.format;if(t.type===a.TextureType.Texture3D)i.texImage3D(s.target,0,o,s.width,s.height,s.depth,0,s.format,s.type,r);else if(n)r instanceof ArrayBuffer&&(r=new Uint8Array(r)),i.texImage2D(s.target,0,o,s.width,s.height,0,s.format,s.type,r);else if(void 0!==r)i.texImage2D(s.target,0,o,s.format,s.type,r);else{x(void 0!==s.width&&void 0!==s.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),i.texImage2D(s.target,0,o,t.width,t.height,0,s.format,s.type,null)}return this.textures.create(s)}writeTextureData(e,t){const r=this.textures.get(e);x(r.target===i.TEXTURE_2D,"Currently only 2D textures may be written to"),i.bindTexture(r.target,r.glId);const n=v(t)?t.width!==r.width:!!v(t)&&t.height!==r.height;this.isGfxFeatureSupported(a.Feature.TextureWrite)&&!n?v(t)?i.texSubImage2D(r.target,0,0,0,r.format,r.type,t):i.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,t):i.texImage2D(r.target,0,r.internalFormat,r.format,r.type,t)}removeTexture(e){const t=this.textures.get(e);i.deleteTexture(t.glId),this.textures.delete(e)}createBuffer(e,t,r,n){let u,s;x(r!=a.Usage.None);const o=function(e){switch(e){case a.BufferType.Undefined:return 0;case a.BufferType.Uniform:return i.UNIFORM_BUFFER;case a.BufferType.Vertex:return i.ARRAY_BUFFER;case a.BufferType.Index:return i.ELEMENT_ARRAY_BUFFER;case a.BufferType.Readback:return i.TRANSFORM_FEEDBACK_BUFFER}}(t),c=e=>Number.isInteger(e),f=e=>e instanceof ArrayBuffer,h=c(n)?null:n,l=c(n)?n:n.byteLength;if(x(l>0||null!==h,"Either an ArrayBuffer or size must be provided"),t!=a.BufferType.Uniform)s=i.createBuffer(),i.bindBuffer(o,s),i.bufferData(o,n,r==a.Usage.Dynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW);else if(h){const e=f(h)?h:h.buffer,t=f(h)?0:h.byteOffset;u=new Uint8Array(e,t,l)}else u=new Uint8Array(l);return this.buffers.create({name:e,type:t,target:o,usage:r,size:l,glId:s,cpuBuffer:u})}removeBuffer(e){const t=this.buffers.get(e);t.type!=a.BufferType.Uniform&&i.deleteBuffer(t.glId),this.buffers.delete(e)}readPixels(e,t,r,n,a){i.readPixels(e,t,r,n,i.RGBA,i.UNSIGNED_BYTE,a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),a=r(1);t.Camera=class{constructor(e,t,r,i){this.cameraMatrix=n.mat4.create(),this.viewMatrix=n.mat4.create(),this.projectionMatrix=n.mat4.create(),this.projectionMatrixInverse=n.mat4.create(),this.viewProjMatrix=n.mat4.create(),this.viewProjMatrixInverse=n.mat4.create(),this.forward=n.vec3.create(),this.up=n.vec3.create(),this.right=n.vec3.create(),e=a.defaultValue(e,60/180*Math.PI),r=a.defaultValue(r,.1),i=a.defaultValue(i,2e3),t=a.defaultValue(t,1),this.setPerspective(e,t,r,i)}copy(e){this.fov=e.fov,this.near=e.near,this.far=e.far,this.aspect=e.aspect,n.mat4.copy(this.cameraMatrix,e.cameraMatrix),n.mat4.copy(this.viewMatrix,e.viewMatrix),n.mat4.copy(this.projectionMatrix,e.projectionMatrix),n.mat4.copy(this.projectionMatrixInverse,e.projectionMatrixInverse),n.mat4.copy(this.viewProjMatrix,e.viewProjMatrix),n.mat4.copy(this.viewProjMatrixInverse,e.viewProjMatrixInverse),n.vec3.copy(this.forward,e.forward),n.vec3.copy(this.up,e.up),n.vec3.copy(this.right,e.right)}getPos(e){return n.mat4.getTranslation(e,this.cameraMatrix)}viewMatrixUpdated(){n.mat4.invert(this.cameraMatrix,this.viewMatrix),n.vec3.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),n.vec3.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),n.vec3.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),n.mat4.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.mat4.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(e,t,r,a=1/0){this.fov=e,this.aspect=t,this.near=r,this.far=a,n.mat4.perspective(this.projectionMatrix,e,t,r,a),n.mat4.invert(this.projectionMatrixInverse,this.projectionMatrix),n.mat4.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.mat4.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),a=n.vec3.create();n.vec3.create(),n.vec3.create();t.CameraSystem=class{constructor(e){this.camera=e,this.camPos=n.vec3.create()}initialize(){this.resize(window.innerWidth,window.innerHeight),this.controller=new u,this.controller.camera=this.camera}resize(e,t){const r=e/t;this.camera.setPerspective(this.camera.fov,r,this.camera.near,this.camera.far)}update({globalUniforms:e,input:t,dt:r}){this.controller.update(t,r);const n=this.camera.getPos(this.camPos);e.setUniform("g_camPos",new Float32Array([n[0],n[1],n[2]])),e.setUniform("g_proj",Float32Array.from(this.camera.projectionMatrix)),e.setUniform("g_viewProj",Float32Array.from(this.camera.viewProjMatrix))}};const i=n.vec3.fromValues(0,1,0);class u{constructor(){this.x=-Math.PI/2,this.y=2,this.z=-4,this.orbitSpeed=-.05,this.xVel=0,this.yVel=0,this.zVel=0,this.translation=n.vec3.create(),this.txVel=0,this.tyVel=0,this.shouldOrbit=!0}update(e,t){e.isKeyDownEventTriggered("KeyR")&&(this.shouldOrbit=!this.shouldOrbit),e.isKeyDownEventTriggered("Numpad5")&&(this.shouldOrbit=!1,this.xVel=this.yVel=0),e.isKeyDownEventTriggered("KeyB")&&(this.shouldOrbit=!1,this.xVel=this.yVel=0,this.txVel=this.tyVel=0,this.xVel=this.yVel=this.zVel=0,n.vec3.set(this.translation,0,0,0));const r=this.shouldOrbit,u=e.invertX?-1:1,o=e.invertY?-1:1;1===e.button?(this.txVel+=e.dx*(-10-Math.min(this.z,.01))/-5e3,this.tyVel+=e.dy*(-10-Math.min(this.z,.01))/5e3):e.isDragging()?(this.xVel+=e.dx/-200*u,this.yVel+=e.dy/-200*o):r&&Math.abs(this.xVel)<Math.abs(this.orbitSpeed)&&(this.xVel+=1*this.orbitSpeed/50),this.zVel+=e.dz;let c=0,f=0;e.isKeyDown("KeyA")&&(c+=.02),e.isKeyDown("KeyD")&&(c-=.02),e.isKeyDown("KeyW")&&(f+=.02),e.isKeyDown("KeyS")&&(f-=.02);const h=e.isKeyDown("ShiftLeft")||e.isKeyDown("ShiftRight");if(h?(this.xVel+=-c,this.yVel+=-f):(this.txVel+=c,this.tyVel+=-f),this.xVel=s(this.xVel,2),this.yVel=s(this.yVel,2),0!==this.xVel||0!==this.yVel||0!==this.zVel||0!==this.txVel||0!==this.tyVel){const t=e.isDragging()||h?.92:.96;this.x+=-this.xVel/10,this.xVel*=t,this.y+=-this.yVel/10,this.yVel*=t,this.txVel*=t,this.tyVel*=t,this.z+=4*Math.max(Math.log(Math.abs(this.zVel)),0)*Math.sign(this.zVel),0===e.dz&&(this.zVel*=.85),this.z>-10&&(this.z=-10,this.zVel=0),n.vec3.set(a,this.camera.cameraMatrix[0],this.camera.cameraMatrix[1],this.camera.cameraMatrix[2]),n.vec3.scaleAndAdd(this.translation,this.translation,a,this.txVel),n.vec3.set(a,this.camera.cameraMatrix[4],this.camera.cameraMatrix[5],this.camera.cameraMatrix[6]),n.vec3.scaleAndAdd(this.translation,this.translation,a,this.tyVel);const r=a;!function(e,t,r){const n=Math.sin(r);e[0]=n*Math.cos(t),e[1]=Math.cos(r),e[2]=n*Math.sin(t)}(r,this.x,this.y),n.vec3.scale(r,r,this.z),n.vec3.add(r,r,this.translation),n.mat4.lookAt(this.camera.viewMatrix,r,this.translation,i),n.mat4.invert(this.camera.cameraMatrix,this.camera.viewMatrix),this.camera.viewMatrixUpdated()}return!1}}function s(e,t){return Math.max(-t,Math.min(e,t))}t.OrbitCameraController=u},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(0)),i=r(4),u=r(1);t.Compositor=class{constructor(e,t){this.canvas=e,this.gfxDevice=t}initialize(){for(let e in i.renderLists)i.renderLists[e].defaultDepthStateId=this.gfxDevice.createDepthStencilState(i.renderLists[e].defaultDepthState)}render(){this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(a.kDefaultRenderPass),function(e,t){const r=t.primitives.length;for(let n=0;n<r;n++){const r=t.primitives[n];if(e.bindPipeline(r.renderPipeline),e.bindResources(r.resourceTable),e.setCullMode(t.defaultCullMode),e.setDepthStencilState(t.defaultDepthStateId),u.defined(r.indexBuffer)){const t=r.indexType===a.Type.Ushort?2:4,n=u.defaultValue(r.indexBuffer.byteOffset,0)/t;e.draw(r.type,r.indexBuffer.bufferId,u.assertDefined(r.indexType),n,r.elementCount)}else e.drawNonIndexed(r.type,0,r.elementCount)}}(this.gfxDevice,i.renderLists.opaque),this.gfxDevice.endFrame();for(let e in i.renderLists)i.renderLists[e].primitives.length=0}resize(e,t,r){this.canvas.setAttribute("style",`width: ${e}px; height: ${t}px;`),this.canvas.width=e*r,this.canvas.height=t*r,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)}}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(13)),u=n(r(14)),s=r(5),o=a(r(0)),c=r(4),f=r(15);class h{constructor(){this.name="SimpleShader",this.vertSource=h.vert.sourceCode,this.fragSource=h.frag.sourceCode,this.resourceLayout=h.resourceLayout}}h.vert=i.default,h.frag=u.default,h.uniformLayout={u_color:{offset:0,type:o.Type.Float4}},h.resourceLayout={uniforms:{index:0,type:o.BindingType.UniformBuffer,layout:h.uniformLayout},globalUniforms:{index:1,type:o.BindingType.UniformBuffer,layout:s.GlobalUniforms.bufferLayout}};t.Demo=class{initialize({gfxDevice:e,globalUniforms:t,resources:r}){const n={buffers:[{stride:12,layout:{a_pos:{type:o.Type.Float3,offset:0}}}]};r.load("data/Duck.glb","gltf",(e,t)=>{e?console.error("Failed to load resource",e):console.log(t)}),this.shader=e.createShader(new h),this.pipeline=e.createRenderPipeline(this.shader,{blendingEnabled:!1},n,h.resourceLayout);const a=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]);this.vertexBuffer=e.createBuffer("PlaneVertices",o.BufferType.Vertex,o.Usage.Static,a),this.indexBuffer=e.createBuffer("PlaneIndices",o.BufferType.Index,o.Usage.Static,new Uint16Array([0,1,2,2,1,3]).buffer),this.uniformBuffer=new f.UniformBuffer("PlaneUniforms",e,h.uniformLayout),this.uniformBuffer.setFloats("u_color",new Float32Array([0,0,1,1])),this.uniformBuffer.write(e),this.resources=e.createResourceTable(this.pipeline),e.setBuffer(this.resources,this.vertexBuffer,0),e.setBuffer(this.resources,this.uniformBuffer.getBuffer(),0),e.setBuffer(this.resources,t.buffer,1)}update({}){}render({}){const e={renderPipeline:this.pipeline,resourceTable:this.resources,elementCount:6,indexBuffer:{bufferId:this.indexBuffer},indexType:o.Type.Ushort,type:o.PrimitiveType.Triangles};c.renderLists.opaque.push(e)}}},function(e,t){e.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;uniform mat4 g_viewProj;void main(){gl_Position=g_viewProj*vec4(a_pos,1.);}",uniforms:{g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"}},consts:{}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(0)),i=r(1);t.UniformBuffer=class{constructor(e,t,r){this.bufferSize=0,this.bufferLayout=r,this.bufferSize=0;const n=Object.keys(this.bufferLayout);for(let e=0;e<n.length;e++){const t=this.bufferLayout[n[e]];null==t.offset&&(t.offset=this.bufferSize),this.bufferSize=t.offset+a.TranslateTypeToSize(t.type)}this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.bufferView=new DataView(this.bufferData),this.buffer=t.createBuffer(e,a.BufferType.Uniform,a.Usage.Dynamic,this.bufferSize)}getBuffer(){return this.buffer}getBufferLayout(){return this.bufferLayout}setFloat(e,t){const r=i.assertDefined(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferView.setFloat32(r.offset,t,!0)}setVec2(e,t){const r=i.assertDefined(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferView.setFloat32(r.offset+0,t[0],!0),this.bufferView.setFloat32(r.offset+4,t[1],!0)}setVec3(e,t){const r=i.assertDefined(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferView.setFloat32(r.offset+0,t[0],!0),this.bufferView.setFloat32(r.offset+4,t[1],!0),this.bufferView.setFloat32(r.offset+8,t[2],!0)}setVec4(e,t){const r=i.assertDefined(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferView.setFloat32(r.offset+0,t[0],!0),this.bufferView.setFloat32(r.offset+4,t[1],!0),this.bufferView.setFloat32(r.offset+8,t[2],!0),this.bufferView.setFloat32(r.offset+12,t[3],!0)}setBytes(e,t){const r=this.bufferLayout[e];if(!r)throw new Error(`Attempted to set unknown uniform ${e}`);if(t.byteLength!==a.TranslateTypeToSize(r.type)*(r.count||1))throw new Error("Invalid size");this.bufferBytes.set(t,r.offset)}setFloats(e,t){const r=this.bufferLayout[e];if(!r)throw new Error(`Attempted to set unknown uniform ${e}`);if(t.byteLength!==a.TranslateTypeToSize(r.type)*(r.count||1))throw new Error("Invalid size");this.bufferFloats.set(t,r.offset/4)}getFloatArray(e){const t=this.bufferLayout[e];if(!t)throw new Error(`Attempted to set unknown uniform ${e}`);return new Float32Array(this.bufferData,t.offset,a.TranslateTypeToSize(t.type)/4)}write(e){e.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(e){e.removeBuffer(this.buffer)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InputManager=class{constructor(){this.invertY=!1,this.invertX=!1,this.button=-1,this.onisdraggingchanged=null,this.listeners=[],this.scrollListeners=[],this.usePointerLock=!0,this.isInteractive=!0,this.touchGesture=0,this.prevTouchX=0,this.prevTouchY=0,this.prevPinchDist=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this._onKeyDown=e=>{if(function(e){switch(e){case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":return!0;default:return!1}}(e.code))e.preventDefault();else if(!this._hasFocus())return;this.keysDown.set(e.code,!e.repeat),this.callListeners()},this._onKeyUp=e=>{this.keysDown.delete(e.code),this.callListeners()},this._onBlur=()=>{this.keysDown.clear(),this.callListeners()},this._onWheel=e=>{e.preventDefault(),this.dz+=-4*Math.sign(e.deltaY),this.callScrollListeners()},this._onTouchChange=e=>{if(this.isInteractive)if(e.preventDefault(),1==e.touches.length){const t=this._getScaledTouches(e.touches);this.touchGesture=1,this.prevTouchX=t[0].x,this.prevTouchY=t[0].y,this.dTouchX=0,this.dTouchY=0}else if(2==e.touches.length){const t=this._getPinchValues(e.touches);this.touchGesture=2,this.prevTouchX=t.x,this.prevTouchY=t.y,this.prevPinchDist=t.dist,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0}else this.touchGesture=0},this._onTouchMove=e=>{if(this.isInteractive)if(e.preventDefault(),1==e.touches.length){const t=this._getScaledTouches(e.touches);this.touchGesture=1,this.dTouchX=t[0].x-this.prevTouchX,this.dTouchY=t[0].y-this.prevTouchY,this.onMotion(this.dTouchX,this.dTouchY),this.prevTouchX=t[0].x,this.prevTouchY=t[0].y}else if(2==e.touches.length){const t=this._getPinchValues(e.touches);this.touchGesture=2,this.dTouchX=t.x-this.prevTouchX,this.dTouchY=t.y-this.prevTouchY,this.dPinchDist=t.dist-this.prevPinchDist,this.prevTouchX=t.x,this.prevTouchY=t.y,this.prevPinchDist=t.dist}else this.touchGesture=0}}initialize({toplevel:e}){document.body.tabIndex=-1,this.toplevel=e,this.toplevel.tabIndex=-1,this.keysDown=new Map,document.addEventListener("keydown",this._onKeyDown,{capture:!0}),document.addEventListener("keyup",this._onKeyUp,{capture:!0}),window.addEventListener("blur",this._onBlur),this.toplevel.addEventListener("wheel",this._onWheel,{passive:!1}),this.toplevel.addEventListener("mousedown",e=>{this.isInteractive&&(this.button=e.button,a.takeGrab(this,e,{takePointerLock:this.usePointerLock,useGrabbingCursor:!0,releaseOnMouseUp:!0}),null!==this.onisdraggingchanged&&this.onisdraggingchanged())}),this.toplevel.addEventListener("touchstart",this._onTouchChange),this.toplevel.addEventListener("touchend",this._onTouchChange),this.toplevel.addEventListener("touchcancel",this._onTouchChange),this.toplevel.addEventListener("touchmove",this._onTouchMove),this.afterFrame()}addListener(e){this.listeners.push(e)}addScrollListener(e){this.scrollListeners.push(e)}getMouseDeltaX(){return this.dx}getMouseDeltaY(){return this.dy}getTouchDeltaX(){return 2==this.touchGesture?this.dTouchX:0}getTouchDeltaY(){return 2==this.touchGesture?this.dTouchY:0}getPinchDeltaDist(){return 2==this.touchGesture?this.dPinchDist:0}isKeyDownEventTriggered(e){return!!this.keysDown.get(e)}isKeyDown(e){return this.keysDown.has(e)}isDragging(){return 0!=this.touchGesture||a.hasGrabListener(this)}afterFrame(){this.dx=0,this.dy=0,this.dz=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this.keysDown.forEach((e,t)=>{this.keysDown.set(t,!1)})}focusViewer(){this.toplevel.focus()}_hasFocus(){return document.activeElement===document.body||document.activeElement===this.toplevel}callListeners(){for(let e=0;e<this.listeners.length;e++)this.listeners[e](this)}callScrollListeners(){for(let e=0;e<this.scrollListeners.length;e++)this.scrollListeners[e](this)}_getScaledTouches(e){const t=[],r=1e3/Math.max(1,Math.min(this.toplevel.clientWidth,this.toplevel.clientHeight));for(let n=0;n<e.length;n++)t.push({x:e[n].clientX*r,y:e[n].clientY*r});return t}_getPinchValues(e){const t=this._getScaledTouches(e);return{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2,dist:Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y)}}onMotion(e,t){this.dx+=e,this.dy+=t}onGrabReleased(){this.button=-1,null!==this.onisdraggingchanged&&this.onisdraggingchanged()}};t.GlobalCursorOverride=new class{constructor(){this.styleElem=document.createElement("style"),document.head.appendChild(this.styleElem),this.style=this.styleElem.sheet}setCursor(e){if(this.style.cssRules.length&&this.style.deleteRule(0),e){const t=`* { ${e.map(e=>`cursor: ${e} !important;`).join(" ")} }`;this.style.insertRule(t,0)}}};class n{constructor(){this.grabListener=null,this.grabOptions=null,this.lastX=-1,this.lastY=-1,this._onMouseMove=e=>{if(null===this.grabListener)return;let t,r;void 0!==e.movementX?(t=e.movementX,r=e.movementY):(t=e.pageX-this.lastX,r=e.pageY-this.lastY,this.lastX=e.pageX,this.lastY=e.pageY),this.grabListener.onMotion(t,r)},this._onMouseDown=e=>{const t=this.grabOptions.grabElement;t&&!function(e,t){let r=e;for(;null!==r;){if(r===t)return!0;r=r.parentElement}return!1}(e.target,t)&&this.releaseGrab()},this._onMouseUp=e=>{this.releaseGrab()}}hasGrabListener(e){return this.grabListener===e}isGrabbed(){return null!==this.grabListener}takeGrab(e,r,n){if(null!==this.grabListener)return;this.grabListener=e,this.grabOptions=n,n.useGrabbingCursor&&t.GlobalCursorOverride.setCursor(["grabbing","-webkit-grabbing"]),this.lastX=r.pageX,this.lastY=r.pageY,document.body.focus(),r.preventDefault();const a=r.target;n.takePointerLock&&void 0!==a.requestPointerLock&&a.requestPointerLock(),document.addEventListener("mousemove",this._onMouseMove),n.releaseOnMouseUp?document.addEventListener("mouseup",this._onMouseUp):document.addEventListener("mousedown",this._onMouseDown,{capture:!0})}releaseGrab(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousedown",this._onMouseDown,{capture:!0}),void 0!==document.exitPointerLock&&document.exitPointerLock(),t.GlobalCursorOverride.setCursor(null);const e=this.grabListener;this.grabListener=null,e.onGrabReleased(),this.grabOptions=null}}t.GrabManager=n;const a=new n},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(18)),i=r(2),u=r(19),s=r(1),o=r(20),c={texture:new u.TextureLoader,gltf:new o.GltfLoader};t.ResourceManager=class{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(e){this.worker=new a.default,this.worker.onmessage=e=>this.onMessage(e),this.context={renderer:e}}onMessage(e){this.messages.push(e)}load(e,t,r){if(!s.defined(c[t]))return void r("Invalid resource type",void 0);const n="string"==typeof e?e:e.uri,a="string"==typeof e?void 0:e.headers,u=n+t;if(s.defined(this.cache[u]))r(void 0,this.cache[u]);else if(this.requests[u])this.requests[u].push(r);else{this.requests[u]=[r];const e={source:{uri:n,headers:a,type:t},status:i.ResourceStatus.LoadingAsync,transferList:[]};this.worker.postMessage([e])}}unload(e,t){const r=("string"==typeof e?e:e.uri)+t;if(s.defined(this.cache[r])){const e=this.cache[r];c[e.source.type].unloadSync(this.context,e),delete this.cache[r]}else{if(!this.requests[r])throw new Error(`Attempted to unload a resource that was never loaded: ${r}`);delete this.requests[r]}}update(){for(let e of this.messages)Array.prototype.push.apply(this.pending,e.data);for(let e of this.pending){const t=e.source.uri+e.source.type;if(s.defined(this.requests[t])||(e.status=i.ResourceStatus.Unloaded),e.status===i.ResourceStatus.LoadingSync){c[e.source.type].loadSync(this.context,e)}switch(e.status){case i.ResourceStatus.Loaded:case i.ResourceStatus.Failed:this.finished.push(e);break;case i.ResourceStatus.Unloaded:this.unloaded.push(e);break;case i.ResourceStatus.LoadingAsync:this.loadingAsync.push(e);break;case i.ResourceStatus.LoadingSync:this.loadingSync.push(e)}}this.pending.length=0;for(let e of this.finished){const t=e.source.uri+e.source.type,r=s.assertDefined(this.requests[t]).length;s.assert(r>=1),this.cache[t]=e;for(let n=0;n<r;n++)e.status===i.ResourceStatus.Failed?this.requests[t][n](e.error,void 0):this.requests[t][n](void 0,e);delete this.requests[t]}const e=[];for(let t of this.loadingAsync)Array.prototype.push.apply(e,t.transferList);this.worker.postMessage(this.loadingAsync,e);for(let e of this.unloaded){c[e.source.type].unloadSync(this.context,e)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}},function(e,t,r){e.exports=function(){return new Worker(r.p+"ResourceLoading.worker.69942b71c5e1713ddce7.js")}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=r(2),i=n(r(0)),u=r(1);t.TextureLoader=class{async loadAsync(e){const t=await fetch(e.source.uri);if(200!=t.status)throw new Error("Failed to download image");const r=e.source.uri.match(/.*\/(.+?)\./);e.name=r&&r.length>1?r[1]:"Unknown",self.createImageBitmap?(e.imageBitmap=await createImageBitmap(await t.blob()),e.transferList.push(e.imageBitmap),e.status=a.ResourceStatus.LoadingSync):(e.imageBuffer=await t.arrayBuffer(),e.transferList.push(e.imageBuffer),e.status=a.ResourceStatus.LoadingSync)}loadSync(e,t){if(t.imageBitmap)t.texture=e.renderer.createTexture(t.name,{usage:i.Usage.Static,type:i.TextureType.Texture2D,format:i.TexelFormat.U8x3,maxAnistropy:16},t.imageBitmap),t.imageBitmap.close(),delete t.imageBitmap,t.status=a.ResourceStatus.Loaded;else{if(t.imageBuffer){var r=new Blob([t.imageBuffer],{type:"image/jpeg"});let e=window.URL.createObjectURL(r);delete t.imageBuffer,t.imageElement=new Image,t.imageElement.src=e,t.status=a.ResourceStatus.LoadingSync}u.defined(t.imageElement)&&t.imageElement.complete&&(t.texture=e.renderer.createTexture(t.name,{usage:i.Usage.Static,type:i.TextureType.Texture2D,format:i.TexelFormat.U8x3,maxAnistropy:16},t.imageElement),delete t.imageElement,t.status=a.ResourceStatus.Loaded)}}unloadSync(e,t){u.defined(t.texture)&&e.renderer.removeTexture(t.texture),u.defined(t.imageBitmap)&&t.imageBitmap.close()}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const a=n(r(0)),i=r(1),u=r(3),s=r(2),o=1313821514,c=5130562;let f=new TextDecoder;function h(e){return f.decode(e)}class l{constructor(e){const t=new DataView(e,0,12),r=new DataView(e,12),n=h(new Uint8Array(e,0,4)),a=t.getUint32(4,!0);t.getUint32(8,!0);if("glTF"!==n)throw new Error("Unsupported glTF-Binary header.");if(a<2)throw new Error("Unsupported legacy binary file detected.");let u=0;for(;u<r.byteLength;){const t=r.getUint32(u,!0);u+=4;const n=r.getUint32(u,!0);switch(u+=4,n){case o:{const r=new Uint8Array(e,12+u,t);this.json=h(r)}break;case c:{const r=12+u;this.binaryChunk=new Uint8Array(e,r,t)}break;default:console.warn("Skipping unexpected glTF-Binary chunk type:",n)}u+=t}i.assert(!!this.json,"glTF-Binary: JSON content not found.")}}class d{constructor(e,t){this.gltf=e,this.bufferData=t}bufferViewData(e){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const t=this.gltf.bufferViews[e],r=i.assertDefined(this.bufferData[t.buffer],`No data for buffer ${t.buffer}`),n=t.byteLength||0,a=t.byteOffset||0,u=r.buffer,s=r.byteOffset;return new Uint8Array(u,s+a,n)}accessorData(e){if(!this.gltf.accessors)throw new Error("No accessors views found.");const t=this.gltf.accessors[e],r=b[t.type];let n;if(void 0!==t.bufferView)n=this.bufferViewData(t.bufferView);else{const e=y[t.componentType].BYTES_PER_ELEMENT*r*t.count;n=new Uint8Array(e)}if(t.sparse){const{count:e,indices:a,values:i}=t.sparse;let u=y[a.componentType],s=this.bufferViewData(a.bufferView);const o=new u(s.buffer,s.byteOffset+(a.byteOffset||0),e);u=y[t.componentType],s=this.bufferViewData(i.bufferView);const c=new u(this.bufferViewData(i.bufferView).buffer,s.byteOffset+(i.byteOffset||0),e*r);t.bufferView&&(n=new Uint8Array(n));const f=new y[t.componentType](n.buffer);for(let t=0;t<e;t++)for(let e=0;e<r;e++)f[r*o[t]+e]=c[r*t+e]}return n}}function p(e,t){let r;switch(t){case 5120:r=a.Type.Char;break;case 5121:r=a.Type.Uchar;break;case 5122:r=a.Type.Short;break;case 5123:r=a.Type.Ushort;break;case 5125:r=a.Type.Uint;break;case 5126:r=a.Type.Float;break;default:throw new Error("Invalid GLTF component type")}switch(e){case"SCALAR":r+=0;break;case"VEC2":r+=1;break;case"VEC3":r+=2;break;case"VEC4":r+=3;break;case"MAT2":throw new Error("2x2 Matrice not yet supported");case"MAT3":r=a.Type.Float3x3;break;case"MAT4":r=a.Type.Float4x4}return r}function m(e){switch(e){case 0:return a.PrimitiveType.Points;case 1:return a.PrimitiveType.Lines;case 2:return a.PrimitiveType.LineLoop;case 3:return a.PrimitiveType.LineStrip;case 4:return a.PrimitiveType.Triangles;case 5:return a.PrimitiveType.TriangleStrip;case 6:return a.PrimitiveType.TriangleFan;default:throw new Error("Invalid GLTF primitive mode")}}t.GltfAsset=d;const y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},x={POSITION:"a_pos",NORMAL:"a_normal",TANGENT:"a_tangent",JOINTS_0:"a_joints",WEIGHTS_0:"a_weights",COLOR_0:"a_color",TEXCOORD_0:"a_uv0",TEXCOORD_1:"a_uv1",MORPH0_POSITION:"a_posMorph0"},T={NORMAL:"HAS_NORMALS 1",TANGENT:"HAS_TANGENT 1",JOINTS_0:"HAS_JOINT_SET0 1",WEIGHTS_0:"HAS_WEIGHT_SET0 1",COLOR_0:"HAS_COLOR0 1",TEXCOORD_0:"HAS_UV_SET0 1",TEXCOORD_1:"HAS_UV_SET1 1"};function M(e,t,r){const n=i.defaultValue(r.scale,[1,1,1]),a=i.defaultValue(r.rotation,[0,0,0,1]),s=i.defaultValue(r.translation,[0,0,0]),o={name:r.name,scale:u.vec3.fromValues(n[0],n[1],n[2]),rotation:u.quat.fromValues(a[0],a[1],a[2],a[3]),translation:u.vec3.fromValues(s[0],s[1],s[2]),morphWeight:i.defaultValue(r.weights,[0])[0]};if(i.defined(r.matrix)?o.transform=u.mat4.fromValues.apply(null,r.matrix):o.transform=u.mat4.fromRotationTranslationScale(u.mat4.create(),o.rotation,o.translation,o.scale),i.defined(r.mesh)&&(o.mesh=function(e,t,r){const n=i.assertDefined(t.gltf.meshes)[r],a=[];for(let r of n.primitives)a.push(g(e,t,r));const u={name:n.name,id:r,primitives:a};return e.meshes[r]=u,u}(e,t,r.mesh)),i.defined(r.children)){o.children=[];for(let n=0;n<r.children.length;n++){const a=r.children[n];M(e,t,i.assertDefined(t.gltf.nodes)[a]),o.children.push(a)}}return e.nodes.push(o),o}function g(e,t,r){const n=r,u=t.gltf;let s;if(!i.defined(r.material))throw new Error("Default material not yet supported");s=function(e,t,r){const n=i.assertDefined(t.gltf.materials)[r];if(i.defined(e.materials[r]))return e.materials[r];const u={renderFormat:{blendingEnabled:!1},cullMode:n.doubleSided?a.CullMode.None:a.CullMode.Back,textures:{}},s=i.defaultValue(n.pbrMetallicRoughness,{baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1});if(s.baseColorTexture){const r=i.defaultValue(s.baseColorTexture.texCoord,0);i.assert(0===r,"Non-zero UV indices not yet supported");const n=function(e,t,r){if(i.defined(e.textures[r]))return e.textures[r];const n=i.assertDefined(t.gltf.images)[r];i.assertDefined(n,"Image loading from a URI is not yet supported");const u={type:a.TextureType.Texture2D,format:a.TexelFormat.U8x3,usage:a.Usage.Static},s=n.name||`tex${r}`,o=t.bufferViewData(i.assertDefined(n.bufferView));let c;if(i.defined(self.createImageBitmap)){const e=new Blob([o],{type:i.assertDefined(n.mimeType)});c=createImageBitmap(e)}else c=Promise.resolve(o.buffer);e.promises.push(c.then(t=>{e.transferList.push(t),e.imageData[r]=t}));const f={name:s,index:r,id:-1,desc:u};return e.textures[r]=f,f}(e,t,s.baseColorTexture.index);u.textures.baseColorTexture=n}return e.materials[r]=u,u}(e,t,r.material);const o=[];let c;if(i.defined(n.indices)){const r=i.assertDefined(u.accessors)[n.indices];c=v(e,t,i.assertDefined(r.bufferView),a.BufferType.Index)}const f={buffers:[]};for(let r in n.attributes){const s=i.assertDefined(u.accessors)[n.attributes[r]],c=i.assertDefined(s.bufferView,"Undefined accessor buffers are not yet implemented"),h=i.assertDefined(u.bufferViews)[c];let l=f.buffers[c];v(e,t,c,a.BufferType.Vertex);const d=T[r];i.defined(d)&&o.push(d),i.defined(l)||(l=f.buffers[c]={stride:i.defaultValue(h.byteStride,0),layout:{}}),l.layout[x[r]]={type:p(s.type,s.componentType),offset:s.byteOffset||0}}if(n.targets){o.push("HAS_MORPH0 1"),i.assert(1===n.targets.length,"Only 1 morph target is currently supported");const r=n.targets[0];for(let n in r)if("POSITION"===n){const s=i.assertDefined(u.accessors)[r[n]],o=i.assertDefined(s.bufferView,"Undefined accessor buffers are not yet implemented"),c=i.assertDefined(u.bufferViews)[o];let h=f.buffers[o];v(e,t,o,a.BufferType.Vertex),i.defined(h)||(h=f.buffers[o]={stride:i.defaultValue(c.byteStride,0),layout:{}}),h.layout[x[`MORPH0_${n}`]]={type:p(s.type,s.componentType),offset:s.byteOffset||0}}}const h=u.accessors[i.assertDefined(n.indices,"Only indexed primitives are currently supported")],l=i.assertDefined(c,"Only indexed primitives are currently supported");return{elementCount:h.count,type:m(i.defaultValue(n.mode,4)),indexType:p(h.type,h.componentType),indexBuffer:l,vertexLayout:f,material:s}}function v(e,t,r,n){if(i.defined(e.bufferViews[r]))return e.bufferViews[r];const a=i.assertDefined(t.gltf.bufferViews)[r].name||`buffer${r}`;e.bufferData[r]=new Uint8Array(t.bufferViewData(r)).buffer,e.transferList.push(e.bufferData[r]);const u={name:a,type:n,id:-1};return e.bufferViews[r]=u,u}t.GltfLoader=class{async loadAsync(e){const t=await fetch(e.source.uri);if(200!=t.status)throw new Error("Failed to download GLTF");const r=await t.arrayBuffer(),n=new l(r),a=JSON.parse(n.json),u=new d(a,[n.binaryChunk]);e.nodes=[],e.meshes=[],e.materials=[],e.textures=[],e.bufferViews=[],e.animations=[],e.rootNodeIds=[],e.promises=[],e.imageData=[],e.bufferData=[],function(e,t,r){const n=i.assertDefined(t.gltf.scenes)[r];if(n.nodes)for(let r of n.nodes){e.rootNodeIds.push(r),M(e,t,i.assertDefined(t.gltf.nodes)[r])}}(e,u,i.defaultValue(u.gltf.scene,0)),await Promise.all(e.promises),delete e.promises,e.status=s.ResourceStatus.LoadingSync}loadSync(e,t){for(let r in t.bufferData){const n=t.bufferViews[r],i=t.bufferData[r];n.id=e.renderer.createBuffer(n.name,n.type,a.Usage.Static,i)}if(i.defined(self.createImageBitmap)){for(let r in t.imageData){const n=t.imageData[r],i=t.textures[r];n instanceof ImageBitmap&&(i.id=e.renderer.createTexture(i.name,{usage:a.Usage.Static,type:a.TextureType.Texture2D,format:a.TexelFormat.U8x3,maxAnistropy:16},n),n.close())}delete t.imageData,t.status=s.ResourceStatus.Loaded}else{let n=0;for(let i in t.imageData){const u=t.imageData[i],o=t.textures[i];if(-1===o.id){if(u instanceof ArrayBuffer){var r=new Blob([u],{type:"image/jpeg"});let e=window.URL.createObjectURL(r);t.imageData[i]=new Image,t.imageData[i].src=e,t.status=s.ResourceStatus.LoadingSync}t.imageData[i].complete&&(o.id=e.renderer.createTexture(o.name,{usage:a.Usage.Static,type:a.TextureType.Texture2D,format:a.TexelFormat.U8x3,maxAnistropy:16},t.imageData[i]))}else n+=1}n===t.textures.length&&(delete t.imageData,t.status=s.ResourceStatus.Loaded)}}unloadSync(e,t){}}}]);