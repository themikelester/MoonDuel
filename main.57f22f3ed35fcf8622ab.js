!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e,r){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.kMaxShaderAttributes=16,e.kMaxShaderUniforms=64,e.kMaxShaderVertexBuffers=16,e.kDefaultRenderPass=0,function(t){t[t.VertexArrayObject=1]="VertexArrayObject",t[t.TextureFloat=2]="TextureFloat",t[t.TextureHalf=4]="TextureHalf",t[t.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",t[t.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",t[t.TextureWrite=32]="TextureWrite",t[t.ShaderDerivatives=64]="ShaderDerivatives",t[t.Instancing=128]="Instancing",t[t.AnistropicFiltering=256]="AnistropicFiltering"}(e.Feature||(e.Feature={})),function(t){t[t.Undefined=0]="Undefined",t[t.Float=1]="Float",t[t.Float2=2]="Float2",t[t.Float3=3]="Float3",t[t.Float4=4]="Float4",t[t.Int=5]="Int",t[t.Int2=6]="Int2",t[t.Int3=7]="Int3",t[t.Int4=8]="Int4",t[t.Uint=9]="Uint",t[t.Uint2=10]="Uint2",t[t.Uint3=11]="Uint3",t[t.Uint4=12]="Uint4",t[t.Short=13]="Short",t[t.Short2=14]="Short2",t[t.Short3=15]="Short3",t[t.Short4=16]="Short4",t[t.Ushort=17]="Ushort",t[t.Ushort2=18]="Ushort2",t[t.Ushort3=19]="Ushort3",t[t.Ushort4=20]="Ushort4",t[t.Char=21]="Char",t[t.Char2=22]="Char2",t[t.Char3=23]="Char3",t[t.Char4=24]="Char4",t[t.Uchar=25]="Uchar",t[t.Uchar2=26]="Uchar2",t[t.Uchar3=27]="Uchar3",t[t.Uchar4=28]="Uchar4",t[t.Half=29]="Half",t[t.Half2=30]="Half2",t[t.Half3=31]="Half3",t[t.Half4=32]="Half4",t[t.Float3x3=33]="Float3x3",t[t.Float3x4=34]="Float3x4",t[t.Float4x4=35]="Float4x4",t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube"}(n=e.Type||(e.Type={})),function(t){t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube"}(e.TextureType||(e.TextureType={})),function(t){t[t.Undefined=0]="Undefined",t[t.U565=1]="U565",t[t.U8=2]="U8",t[t.U8_sRGB=3]="U8_sRGB",t[t.U8x2=4]="U8x2",t[t.U8x2_sRGB=5]="U8x2_sRGB",t[t.U8x3=6]="U8x3",t[t.U8x3_sRGB=7]="U8x3_sRGB",t[t.U8x4=8]="U8x4",t[t.U8x4_sRGB=9]="U8x4_sRGB",t[t.U10_10_10_2=10]="U10_10_10_2",t[t.F11_11_10=11]="F11_11_10",t[t.F16=12]="F16",t[t.F16x2=13]="F16x2",t[t.F16x3=14]="F16x3",t[t.F16x4=15]="F16x4",t[t.F32x2=16]="F32x2",t[t.F32x3=17]="F32x3",t[t.F32x4=18]="F32x4",t[t.Depth32=19]="Depth32",t[t.Depth24Stencil8=20]="Depth24Stencil8"}(e.TexelFormat||(e.TexelFormat={})),function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(e.TextureFilter||(e.TextureFilter={})),function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"}(e.CompareFunc||(e.CompareFunc={})),function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"}(e.PrimitiveType||(e.PrimitiveType={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uniform=1]="Uniform",t[t.Vertex=2]="Vertex",t[t.Index=3]="Index",t[t.Readback=4]="Readback"}(e.BufferType||(e.BufferType={})),function(t){t[t.Undefined=0]="Undefined",t[t.UniformBuffer=1]="UniformBuffer",t[t.Texture=2]="Texture"}(e.BindingType||(e.BindingType={})),function(t){t[t.None=0]="None",t[t.Static=1]="Static",t[t.Dynamic=2]="Dynamic"}(e.Usage||(e.Usage={})),function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Front=2]="Front"}(e.CullMode||(e.CullMode={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Source=2]="Source",t[t.OneMinusSource=3]="OneMinusSource"}(e.BlendFactor||(e.BlendFactor={})),function(t){t[t.Vertex=0]="Vertex",t[t.Instance=1]="Instance"}(e.StepMode||(e.StepMode={})),e.TranslateTypeToSize=function(t){switch(t){case n.Float:return 4;case n.Float2:return 8;case n.Float3:return 12;case n.Float4:return 16;case n.Int:return 4;case n.Int2:return 8;case n.Int3:return 12;case n.Int4:return 16;case n.Uint:return 4;case n.Uint2:return 8;case n.Uint3:return 12;case n.Uint4:return 16;case n.Short:return 2;case n.Short2:return 4;case n.Short3:return 6;case n.Short4:return 8;case n.Ushort:return 2;case n.Ushort2:return 4;case n.Ushort3:return 6;case n.Ushort4:return 8;case n.Char:return 1;case n.Char2:return 2;case n.Char3:return 3;case n.Char4:return 4;case n.Uchar:return 1;case n.Uchar2:return 2;case n.Uchar3:return 3;case n.Uchar4:return 4;case n.Half:return 2;case n.Half2:return 4;case n.Half3:return 6;case n.Half4:return 8;case n.Float3x3:return 36;case n.Float4x4:return 64;default:throw new Error(`Unsupported type: ${t}`)}}},function(t,e,r){"use strict";function n(t,e=""){if(!t)throw console.error((new Error).stack),new Error(`Assert fail: ${e}`)}function a(t,e){return null!=t?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=n,e.assertDefined=function(t,e){if(null!=t)return t;throw new Error(a(e,"Missing object"))},e.defined=function(t){return null!=t},e.defaultValue=a,e.arrayRemove=function(t,e){const r=t.indexOf(e);return n(r>=0),t.splice(r,1),r},e.nArray=function(t,e){const r=new Array(t);for(let n=0;n<t;n++)r[n]=e();return r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(0);class a{constructor(t,e){this.defaultCullMode=t,this.defaultDepthState=e,this.primitives=[]}push(t){this.primitives.push(t)}}e.RenderList=a,e.renderLists={opaque:new a(n.CullMode.Back,{depthWriteEnabled:!0,depthTestEnabled:!0})}},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=n(r(0));class i{constructor(t){this.bufferSize=0,this.renderer=t}initialize(){this.bufferSize=0;const t=Object.keys(i.bufferLayout);for(let e=0;e<t.length;e++){const r=i.bufferLayout[t[e]];this.bufferSize+=a.TranslateTypeToSize(r.type)}this._buffer=this.renderer.createBuffer("GlobalUniforms",a.BufferType.Uniform,a.Usage.Dynamic,this.bufferSize)}setUniform(t,e){const r=i.bufferLayout[t];if(!r)throw new Error(`Attempted to set unknown global uniform ${t}`);const n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);this.renderer.writeBufferData(this.buffer,r.offset,n)}get buffer(){return this._buffer}}e.GlobalUniforms=i,i.bufferLayout=function(t){let e=0;const r=Object.keys(t);for(let n=0;n<r.length;n++){const i=t[r[n]];i.offset=e,e+=a.TranslateTypeToSize(i.type)}return t}({g_camPos:{type:a.Type.Float3},g_proj:{type:a.Type.Float4x4},g_viewProj:{type:a.Type.Float4x4}})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.LoadingAsync=0]="LoadingAsync",t[t.LoadingSync=1]="LoadingSync",t[t.Loaded=2]="Loaded",t[t.Unloaded=3]="Unloaded",t[t.Failed=4]="Failed"}(e.ResourceStatus||(e.ResourceStatus={}))},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"EPSILON",(function(){return d})),r.d(n,"ARRAY_TYPE",(function(){return p})),r.d(n,"RANDOM",(function(){return m})),r.d(n,"setMatrixArrayType",(function(){return M})),r.d(n,"toRadian",(function(){return x})),r.d(n,"equals",(function(){return b}));var a={};r.r(a),r.d(a,"create",(function(){return T})),r.d(a,"clone",(function(){return v})),r.d(a,"copy",(function(){return g})),r.d(a,"identity",(function(){return F})),r.d(a,"fromValues",(function(){return _})),r.d(a,"set",(function(){return w})),r.d(a,"transpose",(function(){return E})),r.d(a,"invert",(function(){return S})),r.d(a,"adjoint",(function(){return U})),r.d(a,"determinant",(function(){return A})),r.d(a,"multiply",(function(){return L})),r.d(a,"rotate",(function(){return R})),r.d(a,"scale",(function(){return D})),r.d(a,"fromRotation",(function(){return I})),r.d(a,"fromScaling",(function(){return P})),r.d(a,"str",(function(){return B})),r.d(a,"frob",(function(){return O})),r.d(a,"LDU",(function(){return V})),r.d(a,"add",(function(){return G})),r.d(a,"subtract",(function(){return C})),r.d(a,"exactEquals",(function(){return N})),r.d(a,"equals",(function(){return j})),r.d(a,"multiplyScalar",(function(){return q})),r.d(a,"multiplyScalarAndAdd",(function(){return z})),r.d(a,"mul",(function(){return k})),r.d(a,"sub",(function(){return X}));var i={};r.r(i),r.d(i,"create",(function(){return H})),r.d(i,"clone",(function(){return $})),r.d(i,"copy",(function(){return Y})),r.d(i,"identity",(function(){return W})),r.d(i,"fromValues",(function(){return K})),r.d(i,"set",(function(){return Q})),r.d(i,"invert",(function(){return Z})),r.d(i,"determinant",(function(){return J})),r.d(i,"multiply",(function(){return tt})),r.d(i,"rotate",(function(){return et})),r.d(i,"scale",(function(){return rt})),r.d(i,"translate",(function(){return nt})),r.d(i,"fromRotation",(function(){return at})),r.d(i,"fromScaling",(function(){return it})),r.d(i,"fromTranslation",(function(){return ut})),r.d(i,"str",(function(){return st})),r.d(i,"frob",(function(){return ot})),r.d(i,"add",(function(){return ct})),r.d(i,"subtract",(function(){return ft})),r.d(i,"multiplyScalar",(function(){return ht})),r.d(i,"multiplyScalarAndAdd",(function(){return lt})),r.d(i,"exactEquals",(function(){return dt})),r.d(i,"equals",(function(){return pt})),r.d(i,"mul",(function(){return mt})),r.d(i,"sub",(function(){return Mt}));var u={};r.r(u),r.d(u,"create",(function(){return yt})),r.d(u,"fromMat4",(function(){return xt})),r.d(u,"clone",(function(){return bt})),r.d(u,"copy",(function(){return Tt})),r.d(u,"fromValues",(function(){return vt})),r.d(u,"set",(function(){return gt})),r.d(u,"identity",(function(){return Ft})),r.d(u,"transpose",(function(){return _t})),r.d(u,"invert",(function(){return wt})),r.d(u,"adjoint",(function(){return Et})),r.d(u,"determinant",(function(){return St})),r.d(u,"multiply",(function(){return Ut})),r.d(u,"translate",(function(){return At})),r.d(u,"rotate",(function(){return Lt})),r.d(u,"scale",(function(){return Rt})),r.d(u,"fromTranslation",(function(){return Dt})),r.d(u,"fromRotation",(function(){return It})),r.d(u,"fromScaling",(function(){return Pt})),r.d(u,"fromMat2d",(function(){return Bt})),r.d(u,"fromQuat",(function(){return Ot})),r.d(u,"normalFromMat4",(function(){return Vt})),r.d(u,"projection",(function(){return Gt})),r.d(u,"str",(function(){return Ct})),r.d(u,"frob",(function(){return Nt})),r.d(u,"add",(function(){return jt})),r.d(u,"subtract",(function(){return qt})),r.d(u,"multiplyScalar",(function(){return zt})),r.d(u,"multiplyScalarAndAdd",(function(){return kt})),r.d(u,"exactEquals",(function(){return Xt})),r.d(u,"equals",(function(){return Ht})),r.d(u,"mul",(function(){return $t})),r.d(u,"sub",(function(){return Yt}));var s={};r.r(s),r.d(s,"create",(function(){return Wt})),r.d(s,"clone",(function(){return Kt})),r.d(s,"copy",(function(){return Qt})),r.d(s,"fromValues",(function(){return Zt})),r.d(s,"set",(function(){return Jt})),r.d(s,"identity",(function(){return te})),r.d(s,"transpose",(function(){return ee})),r.d(s,"invert",(function(){return re})),r.d(s,"adjoint",(function(){return ne})),r.d(s,"determinant",(function(){return ae})),r.d(s,"multiply",(function(){return ie})),r.d(s,"translate",(function(){return ue})),r.d(s,"scale",(function(){return se})),r.d(s,"rotate",(function(){return oe})),r.d(s,"rotateX",(function(){return ce})),r.d(s,"rotateY",(function(){return fe})),r.d(s,"rotateZ",(function(){return he})),r.d(s,"fromTranslation",(function(){return le})),r.d(s,"fromScaling",(function(){return de})),r.d(s,"fromRotation",(function(){return pe})),r.d(s,"fromXRotation",(function(){return me})),r.d(s,"fromYRotation",(function(){return Me})),r.d(s,"fromZRotation",(function(){return ye})),r.d(s,"fromRotationTranslation",(function(){return xe})),r.d(s,"fromQuat2",(function(){return be})),r.d(s,"getTranslation",(function(){return Te})),r.d(s,"getScaling",(function(){return ve})),r.d(s,"getRotation",(function(){return ge})),r.d(s,"fromRotationTranslationScale",(function(){return Fe})),r.d(s,"fromRotationTranslationScaleOrigin",(function(){return _e})),r.d(s,"fromQuat",(function(){return we})),r.d(s,"frustum",(function(){return Ee})),r.d(s,"perspective",(function(){return Se})),r.d(s,"perspectiveFromFieldOfView",(function(){return Ue})),r.d(s,"ortho",(function(){return Ae})),r.d(s,"lookAt",(function(){return Le})),r.d(s,"targetTo",(function(){return Re})),r.d(s,"str",(function(){return De})),r.d(s,"frob",(function(){return Ie})),r.d(s,"add",(function(){return Pe})),r.d(s,"subtract",(function(){return Be})),r.d(s,"multiplyScalar",(function(){return Oe})),r.d(s,"multiplyScalarAndAdd",(function(){return Ve})),r.d(s,"exactEquals",(function(){return Ge})),r.d(s,"equals",(function(){return Ce})),r.d(s,"mul",(function(){return Ne})),r.d(s,"sub",(function(){return je}));var o={};r.r(o),r.d(o,"create",(function(){return qe})),r.d(o,"clone",(function(){return ze})),r.d(o,"length",(function(){return ke})),r.d(o,"fromValues",(function(){return Xe})),r.d(o,"copy",(function(){return He})),r.d(o,"set",(function(){return $e})),r.d(o,"add",(function(){return Ye})),r.d(o,"subtract",(function(){return We})),r.d(o,"multiply",(function(){return Ke})),r.d(o,"divide",(function(){return Qe})),r.d(o,"ceil",(function(){return Ze})),r.d(o,"floor",(function(){return Je})),r.d(o,"min",(function(){return tr})),r.d(o,"max",(function(){return er})),r.d(o,"round",(function(){return rr})),r.d(o,"scale",(function(){return nr})),r.d(o,"scaleAndAdd",(function(){return ar})),r.d(o,"distance",(function(){return ir})),r.d(o,"squaredDistance",(function(){return ur})),r.d(o,"squaredLength",(function(){return sr})),r.d(o,"negate",(function(){return or})),r.d(o,"inverse",(function(){return cr})),r.d(o,"normalize",(function(){return fr})),r.d(o,"dot",(function(){return hr})),r.d(o,"cross",(function(){return lr})),r.d(o,"lerp",(function(){return dr})),r.d(o,"hermite",(function(){return pr})),r.d(o,"bezier",(function(){return mr})),r.d(o,"random",(function(){return Mr})),r.d(o,"transformMat4",(function(){return yr})),r.d(o,"transformMat3",(function(){return xr})),r.d(o,"transformQuat",(function(){return br})),r.d(o,"rotateX",(function(){return Tr})),r.d(o,"rotateY",(function(){return vr})),r.d(o,"rotateZ",(function(){return gr})),r.d(o,"angle",(function(){return Fr})),r.d(o,"zero",(function(){return _r})),r.d(o,"str",(function(){return wr})),r.d(o,"exactEquals",(function(){return Er})),r.d(o,"equals",(function(){return Sr})),r.d(o,"sub",(function(){return Ar})),r.d(o,"mul",(function(){return Lr})),r.d(o,"div",(function(){return Rr})),r.d(o,"dist",(function(){return Dr})),r.d(o,"sqrDist",(function(){return Ir})),r.d(o,"len",(function(){return Pr})),r.d(o,"sqrLen",(function(){return Br})),r.d(o,"forEach",(function(){return Or}));var c={};r.r(c),r.d(c,"create",(function(){return Vr})),r.d(c,"clone",(function(){return Gr})),r.d(c,"fromValues",(function(){return Cr})),r.d(c,"copy",(function(){return Nr})),r.d(c,"set",(function(){return jr})),r.d(c,"add",(function(){return qr})),r.d(c,"subtract",(function(){return zr})),r.d(c,"multiply",(function(){return kr})),r.d(c,"divide",(function(){return Xr})),r.d(c,"ceil",(function(){return Hr})),r.d(c,"floor",(function(){return $r})),r.d(c,"min",(function(){return Yr})),r.d(c,"max",(function(){return Wr})),r.d(c,"round",(function(){return Kr})),r.d(c,"scale",(function(){return Qr})),r.d(c,"scaleAndAdd",(function(){return Zr})),r.d(c,"distance",(function(){return Jr})),r.d(c,"squaredDistance",(function(){return tn})),r.d(c,"length",(function(){return en})),r.d(c,"squaredLength",(function(){return rn})),r.d(c,"negate",(function(){return nn})),r.d(c,"inverse",(function(){return an})),r.d(c,"normalize",(function(){return un})),r.d(c,"dot",(function(){return sn})),r.d(c,"cross",(function(){return on})),r.d(c,"lerp",(function(){return cn})),r.d(c,"random",(function(){return fn})),r.d(c,"transformMat4",(function(){return hn})),r.d(c,"transformQuat",(function(){return ln})),r.d(c,"zero",(function(){return dn})),r.d(c,"str",(function(){return pn})),r.d(c,"exactEquals",(function(){return mn})),r.d(c,"equals",(function(){return Mn})),r.d(c,"sub",(function(){return yn})),r.d(c,"mul",(function(){return xn})),r.d(c,"div",(function(){return bn})),r.d(c,"dist",(function(){return Tn})),r.d(c,"sqrDist",(function(){return vn})),r.d(c,"len",(function(){return gn})),r.d(c,"sqrLen",(function(){return Fn})),r.d(c,"forEach",(function(){return _n}));var f={};r.r(f),r.d(f,"create",(function(){return wn})),r.d(f,"identity",(function(){return En})),r.d(f,"setAxisAngle",(function(){return Sn})),r.d(f,"getAxisAngle",(function(){return Un})),r.d(f,"getAngle",(function(){return An})),r.d(f,"multiply",(function(){return Ln})),r.d(f,"rotateX",(function(){return Rn})),r.d(f,"rotateY",(function(){return Dn})),r.d(f,"rotateZ",(function(){return In})),r.d(f,"calculateW",(function(){return Pn})),r.d(f,"exp",(function(){return Bn})),r.d(f,"ln",(function(){return On})),r.d(f,"pow",(function(){return Vn})),r.d(f,"slerp",(function(){return Gn})),r.d(f,"random",(function(){return Cn})),r.d(f,"invert",(function(){return Nn})),r.d(f,"conjugate",(function(){return jn})),r.d(f,"fromMat3",(function(){return qn})),r.d(f,"fromEuler",(function(){return zn})),r.d(f,"str",(function(){return kn})),r.d(f,"clone",(function(){return Qn})),r.d(f,"fromValues",(function(){return Zn})),r.d(f,"copy",(function(){return Jn})),r.d(f,"set",(function(){return ta})),r.d(f,"add",(function(){return ea})),r.d(f,"mul",(function(){return ra})),r.d(f,"scale",(function(){return na})),r.d(f,"dot",(function(){return aa})),r.d(f,"lerp",(function(){return ia})),r.d(f,"length",(function(){return ua})),r.d(f,"len",(function(){return sa})),r.d(f,"squaredLength",(function(){return oa})),r.d(f,"sqrLen",(function(){return ca})),r.d(f,"normalize",(function(){return fa})),r.d(f,"exactEquals",(function(){return ha})),r.d(f,"equals",(function(){return la})),r.d(f,"rotationTo",(function(){return da})),r.d(f,"sqlerp",(function(){return pa})),r.d(f,"setAxes",(function(){return ma}));var h={};r.r(h),r.d(h,"create",(function(){return Ma})),r.d(h,"clone",(function(){return ya})),r.d(h,"fromValues",(function(){return xa})),r.d(h,"fromRotationTranslationValues",(function(){return ba})),r.d(h,"fromRotationTranslation",(function(){return Ta})),r.d(h,"fromTranslation",(function(){return va})),r.d(h,"fromRotation",(function(){return ga})),r.d(h,"fromMat4",(function(){return Fa})),r.d(h,"copy",(function(){return _a})),r.d(h,"identity",(function(){return wa})),r.d(h,"set",(function(){return Ea})),r.d(h,"getReal",(function(){return Sa})),r.d(h,"getDual",(function(){return Ua})),r.d(h,"setReal",(function(){return Aa})),r.d(h,"setDual",(function(){return La})),r.d(h,"getTranslation",(function(){return Ra})),r.d(h,"translate",(function(){return Da})),r.d(h,"rotateX",(function(){return Ia})),r.d(h,"rotateY",(function(){return Pa})),r.d(h,"rotateZ",(function(){return Ba})),r.d(h,"rotateByQuatAppend",(function(){return Oa})),r.d(h,"rotateByQuatPrepend",(function(){return Va})),r.d(h,"rotateAroundAxis",(function(){return Ga})),r.d(h,"add",(function(){return Ca})),r.d(h,"multiply",(function(){return Na})),r.d(h,"mul",(function(){return ja})),r.d(h,"scale",(function(){return qa})),r.d(h,"dot",(function(){return za})),r.d(h,"lerp",(function(){return ka})),r.d(h,"invert",(function(){return Xa})),r.d(h,"conjugate",(function(){return Ha})),r.d(h,"length",(function(){return $a})),r.d(h,"len",(function(){return Ya})),r.d(h,"squaredLength",(function(){return Wa})),r.d(h,"sqrLen",(function(){return Ka})),r.d(h,"normalize",(function(){return Qa})),r.d(h,"str",(function(){return Za})),r.d(h,"exactEquals",(function(){return Ja})),r.d(h,"equals",(function(){return ti}));var l={};r.r(l),r.d(l,"create",(function(){return ei})),r.d(l,"clone",(function(){return ri})),r.d(l,"fromValues",(function(){return ni})),r.d(l,"copy",(function(){return ai})),r.d(l,"set",(function(){return ii})),r.d(l,"add",(function(){return ui})),r.d(l,"subtract",(function(){return si})),r.d(l,"multiply",(function(){return oi})),r.d(l,"divide",(function(){return ci})),r.d(l,"ceil",(function(){return fi})),r.d(l,"floor",(function(){return hi})),r.d(l,"min",(function(){return li})),r.d(l,"max",(function(){return di})),r.d(l,"round",(function(){return pi})),r.d(l,"scale",(function(){return mi})),r.d(l,"scaleAndAdd",(function(){return Mi})),r.d(l,"distance",(function(){return yi})),r.d(l,"squaredDistance",(function(){return xi})),r.d(l,"length",(function(){return bi})),r.d(l,"squaredLength",(function(){return Ti})),r.d(l,"negate",(function(){return vi})),r.d(l,"inverse",(function(){return gi})),r.d(l,"normalize",(function(){return Fi})),r.d(l,"dot",(function(){return _i})),r.d(l,"cross",(function(){return wi})),r.d(l,"lerp",(function(){return Ei})),r.d(l,"random",(function(){return Si})),r.d(l,"transformMat2",(function(){return Ui})),r.d(l,"transformMat2d",(function(){return Ai})),r.d(l,"transformMat3",(function(){return Li})),r.d(l,"transformMat4",(function(){return Ri})),r.d(l,"rotate",(function(){return Di})),r.d(l,"angle",(function(){return Ii})),r.d(l,"zero",(function(){return Pi})),r.d(l,"str",(function(){return Bi})),r.d(l,"exactEquals",(function(){return Oi})),r.d(l,"equals",(function(){return Vi})),r.d(l,"len",(function(){return Gi})),r.d(l,"sub",(function(){return Ci})),r.d(l,"mul",(function(){return Ni})),r.d(l,"div",(function(){return ji})),r.d(l,"dist",(function(){return qi})),r.d(l,"sqrDist",(function(){return zi})),r.d(l,"sqrLen",(function(){return ki})),r.d(l,"forEach",(function(){return Xi}));var d=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function M(t){p=t}var y=Math.PI/180;function x(t){return t*y}function b(t,e){return Math.abs(t-e)<=d*Math.max(1,Math.abs(t),Math.abs(e))}function T(){var t=new p(4);return p!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function v(t){var e=new p(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function g(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function F(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function _(t,e,r,n){var a=new p(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function w(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t}function E(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function S(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=r*i-a*n;return u?(u=1/u,t[0]=i*u,t[1]=-n*u,t[2]=-a*u,t[3]=r*u,t):null}function U(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function A(t){return t[0]*t[3]-t[2]*t[1]}function L(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=r[0],o=r[1],c=r[2],f=r[3];return t[0]=n*s+i*o,t[1]=a*s+u*o,t[2]=n*c+i*f,t[3]=a*c+u*f,t}function R(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=Math.sin(r),o=Math.cos(r);return t[0]=n*o+i*s,t[1]=a*o+u*s,t[2]=n*-s+i*o,t[3]=a*-s+u*o,t}function D(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=r[0],o=r[1];return t[0]=n*s,t[1]=a*s,t[2]=i*o,t[3]=u*o,t}function I(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function P(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function B(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function O(t){return Math.hypot(t[0],t[1],t[2],t[3])}function V(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function G(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function C(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function N(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function j(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=e[0],s=e[1],o=e[2],c=e[3];return Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=d*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}function q(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function z(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var k=L,X=C;function H(){var t=new p(6);return p!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function $(t){var e=new p(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Y(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function W(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function K(t,e,r,n,a,i){var u=new p(6);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=a,u[5]=i,u}function Q(t,e,r,n,a,i,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=u,t}function Z(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=r*i-n*a;return o?(o=1/o,t[0]=i*o,t[1]=-n*o,t[2]=-a*o,t[3]=r*o,t[4]=(a*s-i*u)*o,t[5]=(n*u-r*s)*o,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=r[0],f=r[1],h=r[2],l=r[3],d=r[4],p=r[5];return t[0]=n*c+i*f,t[1]=a*c+u*f,t[2]=n*h+i*l,t[3]=a*h+u*l,t[4]=n*d+i*p+s,t[5]=a*d+u*p+o,t}function et(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=Math.sin(r),f=Math.cos(r);return t[0]=n*f+i*c,t[1]=a*f+u*c,t[2]=n*-c+i*f,t[3]=a*-c+u*f,t[4]=s,t[5]=o,t}function rt(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=r[0],f=r[1];return t[0]=n*c,t[1]=a*c,t[2]=i*f,t[3]=u*f,t[4]=s,t[5]=o,t}function nt(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=r[0],f=r[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=u,t[4]=n*c+i*f+s,t[5]=a*c+u*f+o,t}function at(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function it(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ut(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ot(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function ht(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function lt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function dt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function pt(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=e[0],c=e[1],f=e[2],h=e[3],l=e[4],p=e[5];return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-f)<=d*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(u-l)<=d*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))}var mt=tt,Mt=ft;function yt(){var t=new p(9);return p!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function xt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function bt(t){var e=new p(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Tt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function vt(t,e,r,n,a,i,u,s,o){var c=new p(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=a,c[5]=i,c[6]=u,c[7]=s,c[8]=o,c}function gt(t,e,r,n,a,i,u,s,o,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=u,t[6]=s,t[7]=o,t[8]=c,t}function Ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function _t(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function wt(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=f*u-s*c,l=-f*i+s*o,d=c*i-u*o,p=r*h+n*l+a*d;return p?(p=1/p,t[0]=h*p,t[1]=(-f*n+a*c)*p,t[2]=(s*n-a*u)*p,t[3]=l*p,t[4]=(f*r-a*o)*p,t[5]=(-s*r+a*i)*p,t[6]=d*p,t[7]=(-c*r+n*o)*p,t[8]=(u*r-n*i)*p,t):null}function Et(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8];return t[0]=u*f-s*c,t[1]=a*c-n*f,t[2]=n*s-a*u,t[3]=s*o-i*f,t[4]=r*f-a*o,t[5]=a*i-r*s,t[6]=i*c-u*o,t[7]=n*o-r*c,t[8]=r*u-n*i,t}function St(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],u=t[5],s=t[6],o=t[7],c=t[8];return e*(c*i-u*o)+r*(-c*a+u*s)+n*(o*a-i*s)}function Ut(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=e[8],l=r[0],d=r[1],p=r[2],m=r[3],M=r[4],y=r[5],x=r[6],b=r[7],T=r[8];return t[0]=l*n+d*u+p*c,t[1]=l*a+d*s+p*f,t[2]=l*i+d*o+p*h,t[3]=m*n+M*u+y*c,t[4]=m*a+M*s+y*f,t[5]=m*i+M*o+y*h,t[6]=x*n+b*u+T*c,t[7]=x*a+b*s+T*f,t[8]=x*i+b*o+T*h,t}function At(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=e[8],l=r[0],d=r[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=u,t[4]=s,t[5]=o,t[6]=l*n+d*u+c,t[7]=l*a+d*s+f,t[8]=l*i+d*o+h,t}function Lt(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=e[8],l=Math.sin(r),d=Math.cos(r);return t[0]=d*n+l*u,t[1]=d*a+l*s,t[2]=d*i+l*o,t[3]=d*u-l*n,t[4]=d*s-l*a,t[5]=d*o-l*i,t[6]=c,t[7]=f,t[8]=h,t}function Rt(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Dt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function It(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Pt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Ot(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=r+r,s=n+n,o=a+a,c=r*u,f=n*u,h=n*s,l=a*u,d=a*s,p=a*o,m=i*u,M=i*s,y=i*o;return t[0]=1-h-p,t[3]=f-y,t[6]=l+M,t[1]=f+y,t[4]=1-c-p,t[7]=d-m,t[2]=l-M,t[5]=d+m,t[8]=1-c-h,t}function Vt(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=e[9],l=e[10],d=e[11],p=e[12],m=e[13],M=e[14],y=e[15],x=r*s-n*u,b=r*o-a*u,T=r*c-i*u,v=n*o-a*s,g=n*c-i*s,F=a*c-i*o,_=f*m-h*p,w=f*M-l*p,E=f*y-d*p,S=h*M-l*m,U=h*y-d*m,A=l*y-d*M,L=x*A-b*U+T*S+v*E-g*w+F*_;return L?(L=1/L,t[0]=(s*A-o*U+c*S)*L,t[1]=(o*E-u*A-c*w)*L,t[2]=(u*U-s*E+c*_)*L,t[3]=(a*U-n*A-i*S)*L,t[4]=(r*A-a*E+i*w)*L,t[5]=(n*E-r*U-i*_)*L,t[6]=(m*F-M*g+y*v)*L,t[7]=(M*T-p*F-y*b)*L,t[8]=(p*g-m*T+y*x)*L,t):null}function Gt(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ct(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Nt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function jt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function qt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function zt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function kt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Xt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ht(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=e[0],l=e[1],p=e[2],m=e[3],M=e[4],y=e[5],x=e[6],b=e[7],T=e[8];return Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-l)<=d*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-p)<=d*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(u-M)<=d*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(s-y)<=d*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-x)<=d*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(c-b)<=d*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(f-T)<=d*Math.max(1,Math.abs(f),Math.abs(T))}var $t=Ut,Yt=qt;function Wt(){var t=new p(16);return p!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Kt(t){var e=new p(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zt(t,e,r,n,a,i,u,s,o,c,f,h,l,d,m,M){var y=new p(16);return y[0]=t,y[1]=e,y[2]=r,y[3]=n,y[4]=a,y[5]=i,y[6]=u,y[7]=s,y[8]=o,y[9]=c,y[10]=f,y[11]=h,y[12]=l,y[13]=d,y[14]=m,y[15]=M,y}function Jt(t,e,r,n,a,i,u,s,o,c,f,h,l,d,p,m,M){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=u,t[6]=s,t[7]=o,t[8]=c,t[9]=f,t[10]=h,t[11]=l,t[12]=d,t[13]=p,t[14]=m,t[15]=M,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],i=e[6],u=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=a,t[13]=u,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function re(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=e[9],l=e[10],d=e[11],p=e[12],m=e[13],M=e[14],y=e[15],x=r*s-n*u,b=r*o-a*u,T=r*c-i*u,v=n*o-a*s,g=n*c-i*s,F=a*c-i*o,_=f*m-h*p,w=f*M-l*p,E=f*y-d*p,S=h*M-l*m,U=h*y-d*m,A=l*y-d*M,L=x*A-b*U+T*S+v*E-g*w+F*_;return L?(L=1/L,t[0]=(s*A-o*U+c*S)*L,t[1]=(a*U-n*A-i*S)*L,t[2]=(m*F-M*g+y*v)*L,t[3]=(l*g-h*F-d*v)*L,t[4]=(o*E-u*A-c*w)*L,t[5]=(r*A-a*E+i*w)*L,t[6]=(M*T-p*F-y*b)*L,t[7]=(f*F-l*T+d*b)*L,t[8]=(u*U-s*E+c*_)*L,t[9]=(n*E-r*U-i*_)*L,t[10]=(p*g-m*T+y*x)*L,t[11]=(h*T-f*g-d*x)*L,t[12]=(s*w-u*S-o*_)*L,t[13]=(r*S-n*w+a*_)*L,t[14]=(m*b-p*v-M*x)*L,t[15]=(f*v-h*b+l*x)*L,t):null}function ne(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=e[4],s=e[5],o=e[6],c=e[7],f=e[8],h=e[9],l=e[10],d=e[11],p=e[12],m=e[13],M=e[14],y=e[15];return t[0]=s*(l*y-d*M)-h*(o*y-c*M)+m*(o*d-c*l),t[1]=-(n*(l*y-d*M)-h*(a*y-i*M)+m*(a*d-i*l)),t[2]=n*(o*y-c*M)-s*(a*y-i*M)+m*(a*c-i*o),t[3]=-(n*(o*d-c*l)-s*(a*d-i*l)+h*(a*c-i*o)),t[4]=-(u*(l*y-d*M)-f*(o*y-c*M)+p*(o*d-c*l)),t[5]=r*(l*y-d*M)-f*(a*y-i*M)+p*(a*d-i*l),t[6]=-(r*(o*y-c*M)-u*(a*y-i*M)+p*(a*c-i*o)),t[7]=r*(o*d-c*l)-u*(a*d-i*l)+f*(a*c-i*o),t[8]=u*(h*y-d*m)-f*(s*y-c*m)+p*(s*d-c*h),t[9]=-(r*(h*y-d*m)-f*(n*y-i*m)+p*(n*d-i*h)),t[10]=r*(s*y-c*m)-u*(n*y-i*m)+p*(n*c-i*s),t[11]=-(r*(s*d-c*h)-u*(n*d-i*h)+f*(n*c-i*s)),t[12]=-(u*(h*M-l*m)-f*(s*M-o*m)+p*(s*l-o*h)),t[13]=r*(h*M-l*m)-f*(n*M-a*m)+p*(n*l-a*h),t[14]=-(r*(s*M-o*m)-u*(n*M-a*m)+p*(n*o-a*s)),t[15]=r*(s*l-o*h)-u*(n*l-a*h)+f*(n*o-a*s),t}function ae(t){var e=t[0],r=t[1],n=t[2],a=t[3],i=t[4],u=t[5],s=t[6],o=t[7],c=t[8],f=t[9],h=t[10],l=t[11],d=t[12],p=t[13],m=t[14],M=t[15];return(e*u-r*i)*(h*M-l*m)-(e*s-n*i)*(f*M-l*p)+(e*o-a*i)*(f*m-h*p)+(r*s-n*u)*(c*M-l*d)-(r*o-a*u)*(c*m-h*d)+(n*o-a*s)*(c*p-f*d)}function ie(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=e[8],l=e[9],d=e[10],p=e[11],m=e[12],M=e[13],y=e[14],x=e[15],b=r[0],T=r[1],v=r[2],g=r[3];return t[0]=b*n+T*s+v*h+g*m,t[1]=b*a+T*o+v*l+g*M,t[2]=b*i+T*c+v*d+g*y,t[3]=b*u+T*f+v*p+g*x,b=r[4],T=r[5],v=r[6],g=r[7],t[4]=b*n+T*s+v*h+g*m,t[5]=b*a+T*o+v*l+g*M,t[6]=b*i+T*c+v*d+g*y,t[7]=b*u+T*f+v*p+g*x,b=r[8],T=r[9],v=r[10],g=r[11],t[8]=b*n+T*s+v*h+g*m,t[9]=b*a+T*o+v*l+g*M,t[10]=b*i+T*c+v*d+g*y,t[11]=b*u+T*f+v*p+g*x,b=r[12],T=r[13],v=r[14],g=r[15],t[12]=b*n+T*s+v*h+g*m,t[13]=b*a+T*o+v*l+g*M,t[14]=b*i+T*c+v*d+g*y,t[15]=b*u+T*f+v*p+g*x,t}function ue(t,e,r){var n,a,i,u,s,o,c,f,h,l,d,p,m=r[0],M=r[1],y=r[2];return e===t?(t[12]=e[0]*m+e[4]*M+e[8]*y+e[12],t[13]=e[1]*m+e[5]*M+e[9]*y+e[13],t[14]=e[2]*m+e[6]*M+e[10]*y+e[14],t[15]=e[3]*m+e[7]*M+e[11]*y+e[15]):(n=e[0],a=e[1],i=e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=e[8],l=e[9],d=e[10],p=e[11],t[0]=n,t[1]=a,t[2]=i,t[3]=u,t[4]=s,t[5]=o,t[6]=c,t[7]=f,t[8]=h,t[9]=l,t[10]=d,t[11]=p,t[12]=n*m+s*M+h*y+e[12],t[13]=a*m+o*M+l*y+e[13],t[14]=i*m+c*M+d*y+e[14],t[15]=u*m+f*M+p*y+e[15]),t}function se(t,e,r){var n=r[0],a=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function oe(t,e,r,n){var a,i,u,s,o,c,f,h,l,p,m,M,y,x,b,T,v,g,F,_,w,E,S,U,A=n[0],L=n[1],R=n[2],D=Math.hypot(A,L,R);return D<d?null:(A*=D=1/D,L*=D,R*=D,a=Math.sin(r),u=1-(i=Math.cos(r)),s=e[0],o=e[1],c=e[2],f=e[3],h=e[4],l=e[5],p=e[6],m=e[7],M=e[8],y=e[9],x=e[10],b=e[11],T=A*A*u+i,v=L*A*u+R*a,g=R*A*u-L*a,F=A*L*u-R*a,_=L*L*u+i,w=R*L*u+A*a,E=A*R*u+L*a,S=L*R*u-A*a,U=R*R*u+i,t[0]=s*T+h*v+M*g,t[1]=o*T+l*v+y*g,t[2]=c*T+p*v+x*g,t[3]=f*T+m*v+b*g,t[4]=s*F+h*_+M*w,t[5]=o*F+l*_+y*w,t[6]=c*F+p*_+x*w,t[7]=f*F+m*_+b*w,t[8]=s*E+h*S+M*U,t[9]=o*E+l*S+y*U,t[10]=c*E+p*S+x*U,t[11]=f*E+m*S+b*U,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[4],u=e[5],s=e[6],o=e[7],c=e[8],f=e[9],h=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*a+c*n,t[5]=u*a+f*n,t[6]=s*a+h*n,t[7]=o*a+l*n,t[8]=c*a-i*n,t[9]=f*a-u*n,t[10]=h*a-s*n,t[11]=l*a-o*n,t}function fe(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],u=e[1],s=e[2],o=e[3],c=e[8],f=e[9],h=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a-c*n,t[1]=u*a-f*n,t[2]=s*a-h*n,t[3]=o*a-l*n,t[8]=i*n+c*a,t[9]=u*n+f*a,t[10]=s*n+h*a,t[11]=o*n+l*a,t}function he(t,e,r){var n=Math.sin(r),a=Math.cos(r),i=e[0],u=e[1],s=e[2],o=e[3],c=e[4],f=e[5],h=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*a+c*n,t[1]=u*a+f*n,t[2]=s*a+h*n,t[3]=o*a+l*n,t[4]=c*a-i*n,t[5]=f*a-u*n,t[6]=h*a-s*n,t[7]=l*a-o*n,t}function le(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function de(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pe(t,e,r){var n,a,i,u=r[0],s=r[1],o=r[2],c=Math.hypot(u,s,o);return c<d?null:(u*=c=1/c,s*=c,o*=c,n=Math.sin(e),i=1-(a=Math.cos(e)),t[0]=u*u*i+a,t[1]=s*u*i+o*n,t[2]=o*u*i-s*n,t[3]=0,t[4]=u*s*i-o*n,t[5]=s*s*i+a,t[6]=o*s*i+u*n,t[7]=0,t[8]=u*o*i+s*n,t[9]=s*o*i-u*n,t[10]=o*o*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function me(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Me(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ye(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xe(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=n+n,o=a+a,c=i+i,f=n*s,h=n*o,l=n*c,d=a*o,p=a*c,m=i*c,M=u*s,y=u*o,x=u*c;return t[0]=1-(d+m),t[1]=h+x,t[2]=l-y,t[3]=0,t[4]=h-x,t[5]=1-(f+m),t[6]=p+M,t[7]=0,t[8]=l+y,t[9]=p-M,t[10]=1-(f+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function be(t,e){var r=new p(3),n=-e[0],a=-e[1],i=-e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=n*n+a*a+i*i+u*u;return h>0?(r[0]=2*(s*u+f*n+o*i-c*a)/h,r[1]=2*(o*u+f*a+c*n-s*i)/h,r[2]=2*(c*u+f*i+s*a-o*n)/h):(r[0]=2*(s*u+f*n+o*i-c*a),r[1]=2*(o*u+f*a+c*n-s*i),r[2]=2*(c*u+f*i+s*a-o*n)),xe(t,e,r),t}function Te(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ve(t,e){var r=e[0],n=e[1],a=e[2],i=e[4],u=e[5],s=e[6],o=e[8],c=e[9],f=e[10];return t[0]=Math.hypot(r,n,a),t[1]=Math.hypot(i,u,s),t[2]=Math.hypot(o,c,f),t}function ge(t,e){var r=new p(3);ve(r,e);var n=1/r[0],a=1/r[1],i=1/r[2],u=e[0]*n,s=e[1]*a,o=e[2]*i,c=e[4]*n,f=e[5]*a,h=e[6]*i,l=e[8]*n,d=e[9]*a,m=e[10]*i,M=u+f+m,y=0;return M>0?(y=2*Math.sqrt(M+1),t[3]=.25*y,t[0]=(h-d)/y,t[1]=(l-o)/y,t[2]=(s-c)/y):u>f&&u>m?(y=2*Math.sqrt(1+u-f-m),t[3]=(h-d)/y,t[0]=.25*y,t[1]=(s+c)/y,t[2]=(l+o)/y):f>m?(y=2*Math.sqrt(1+f-u-m),t[3]=(l-o)/y,t[0]=(s+c)/y,t[1]=.25*y,t[2]=(h+d)/y):(y=2*Math.sqrt(1+m-u-f),t[3]=(s-c)/y,t[0]=(l+o)/y,t[1]=(h+d)/y,t[2]=.25*y),t}function Fe(t,e,r,n){var a=e[0],i=e[1],u=e[2],s=e[3],o=a+a,c=i+i,f=u+u,h=a*o,l=a*c,d=a*f,p=i*c,m=i*f,M=u*f,y=s*o,x=s*c,b=s*f,T=n[0],v=n[1],g=n[2];return t[0]=(1-(p+M))*T,t[1]=(l+b)*T,t[2]=(d-x)*T,t[3]=0,t[4]=(l-b)*v,t[5]=(1-(h+M))*v,t[6]=(m+y)*v,t[7]=0,t[8]=(d+x)*g,t[9]=(m-y)*g,t[10]=(1-(h+p))*g,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function _e(t,e,r,n,a){var i=e[0],u=e[1],s=e[2],o=e[3],c=i+i,f=u+u,h=s+s,l=i*c,d=i*f,p=i*h,m=u*f,M=u*h,y=s*h,x=o*c,b=o*f,T=o*h,v=n[0],g=n[1],F=n[2],_=a[0],w=a[1],E=a[2],S=(1-(m+y))*v,U=(d+T)*v,A=(p-b)*v,L=(d-T)*g,R=(1-(l+y))*g,D=(M+x)*g,I=(p+b)*F,P=(M-x)*F,B=(1-(l+m))*F;return t[0]=S,t[1]=U,t[2]=A,t[3]=0,t[4]=L,t[5]=R,t[6]=D,t[7]=0,t[8]=I,t[9]=P,t[10]=B,t[11]=0,t[12]=r[0]+_-(S*_+L*w+I*E),t[13]=r[1]+w-(U*_+R*w+P*E),t[14]=r[2]+E-(A*_+D*w+B*E),t[15]=1,t}function we(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=r+r,s=n+n,o=a+a,c=r*u,f=n*u,h=n*s,l=a*u,d=a*s,p=a*o,m=i*u,M=i*s,y=i*o;return t[0]=1-h-p,t[1]=f+y,t[2]=l-M,t[3]=0,t[4]=f-y,t[5]=1-c-p,t[6]=d+m,t[7]=0,t[8]=l+M,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ee(t,e,r,n,a,i,u){var s=1/(r-e),o=1/(a-n),c=1/(i-u);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*o,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(a+n)*o,t[10]=(u+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=u*i*2*c,t[15]=0,t}function Se(t,e,r,n,a){var i,u=1/Math.tan(e/2);return t[0]=u/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(i=1/(n-a),t[10]=(a+n)*i,t[14]=2*a*n*i):(t[10]=-1,t[14]=-2*n),t}function Ue(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),u=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),o=2/(u+s),c=2/(a+i);return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(u-s)*o*.5,t[9]=(a-i)*c*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Ae(t,e,r,n,a,i,u){var s=1/(e-r),o=1/(n-a),c=1/(i-u);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(a+n)*o,t[14]=(u+i)*c,t[15]=1,t}function Le(t,e,r,n){var a,i,u,s,o,c,f,h,l,p,m=e[0],M=e[1],y=e[2],x=n[0],b=n[1],T=n[2],v=r[0],g=r[1],F=r[2];return Math.abs(m-v)<d&&Math.abs(M-g)<d&&Math.abs(y-F)<d?te(t):(f=m-v,h=M-g,l=y-F,a=b*(l*=p=1/Math.hypot(f,h,l))-T*(h*=p),i=T*(f*=p)-x*l,u=x*h-b*f,(p=Math.hypot(a,i,u))?(a*=p=1/p,i*=p,u*=p):(a=0,i=0,u=0),s=h*u-l*i,o=l*a-f*u,c=f*i-h*a,(p=Math.hypot(s,o,c))?(s*=p=1/p,o*=p,c*=p):(s=0,o=0,c=0),t[0]=a,t[1]=s,t[2]=f,t[3]=0,t[4]=i,t[5]=o,t[6]=h,t[7]=0,t[8]=u,t[9]=c,t[10]=l,t[11]=0,t[12]=-(a*m+i*M+u*y),t[13]=-(s*m+o*M+c*y),t[14]=-(f*m+h*M+l*y),t[15]=1,t)}function Re(t,e,r,n){var a=e[0],i=e[1],u=e[2],s=n[0],o=n[1],c=n[2],f=a-r[0],h=i-r[1],l=u-r[2],d=f*f+h*h+l*l;d>0&&(f*=d=1/Math.sqrt(d),h*=d,l*=d);var p=o*l-c*h,m=c*f-s*l,M=s*h-o*f;return(d=p*p+m*m+M*M)>0&&(p*=d=1/Math.sqrt(d),m*=d,M*=d),t[0]=p,t[1]=m,t[2]=M,t[3]=0,t[4]=h*M-l*m,t[5]=l*p-f*M,t[6]=f*m-h*p,t[7]=0,t[8]=f,t[9]=h,t[10]=l,t[11]=0,t[12]=a,t[13]=i,t[14]=u,t[15]=1,t}function De(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ie(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Pe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Be(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Oe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Ve(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function Ge(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ce(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=t[8],h=t[9],l=t[10],p=t[11],m=t[12],M=t[13],y=t[14],x=t[15],b=e[0],T=e[1],v=e[2],g=e[3],F=e[4],_=e[5],w=e[6],E=e[7],S=e[8],U=e[9],A=e[10],L=e[11],R=e[12],D=e[13],I=e[14],P=e[15];return Math.abs(r-b)<=d*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-T)<=d*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(a-v)<=d*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-g)<=d*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(u-F)<=d*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(s-_)<=d*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-w)<=d*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(c-E)<=d*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(f-S)<=d*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(h-U)<=d*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(l-A)<=d*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(p-L)<=d*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(m-R)<=d*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(M-D)<=d*Math.max(1,Math.abs(M),Math.abs(D))&&Math.abs(y-I)<=d*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(x-P)<=d*Math.max(1,Math.abs(x),Math.abs(P))}var Ne=ie,je=Be;function qe(){var t=new p(3);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ze(t){var e=new p(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ke(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Xe(t,e,r){var n=new p(3);return n[0]=t,n[1]=e,n[2]=r,n}function He(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function Ye(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function We(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ke(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Qe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Ze(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Je(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function tr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function er(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function rr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function nr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function ar(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function ir(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.hypot(r,n,a)}function ur(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a}function sr(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function or(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function cr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function fr(t,e){var r=e[0],n=e[1],a=e[2],i=r*r+n*n+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function hr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lr(t,e,r){var n=e[0],a=e[1],i=e[2],u=r[0],s=r[1],o=r[2];return t[0]=a*o-i*s,t[1]=i*u-n*o,t[2]=n*s-a*u,t}function dr(t,e,r,n){var a=e[0],i=e[1],u=e[2];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=u+n*(r[2]-u),t}function pr(t,e,r,n,a,i){var u=i*i,s=u*(2*i-3)+1,o=u*(i-2)+i,c=u*(i-1),f=u*(3-2*i);return t[0]=e[0]*s+r[0]*o+n[0]*c+a[0]*f,t[1]=e[1]*s+r[1]*o+n[1]*c+a[1]*f,t[2]=e[2]*s+r[2]*o+n[2]*c+a[2]*f,t}function mr(t,e,r,n,a,i){var u=1-i,s=u*u,o=i*i,c=s*u,f=3*i*s,h=3*o*u,l=o*i;return t[0]=e[0]*c+r[0]*f+n[0]*h+a[0]*l,t[1]=e[1]*c+r[1]*f+n[1]*h+a[1]*l,t[2]=e[2]*c+r[2]*f+n[2]*h+a[2]*l,t}function Mr(t,e){e=e||1;var r=2*m()*Math.PI,n=2*m()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t}function yr(t,e,r){var n=e[0],a=e[1],i=e[2],u=r[3]*n+r[7]*a+r[11]*i+r[15];return u=u||1,t[0]=(r[0]*n+r[4]*a+r[8]*i+r[12])/u,t[1]=(r[1]*n+r[5]*a+r[9]*i+r[13])/u,t[2]=(r[2]*n+r[6]*a+r[10]*i+r[14])/u,t}function xr(t,e,r){var n=e[0],a=e[1],i=e[2];return t[0]=n*r[0]+a*r[3]+i*r[6],t[1]=n*r[1]+a*r[4]+i*r[7],t[2]=n*r[2]+a*r[5]+i*r[8],t}function br(t,e,r){var n=r[0],a=r[1],i=r[2],u=r[3],s=e[0],o=e[1],c=e[2],f=a*c-i*o,h=i*s-n*c,l=n*o-a*s,d=a*l-i*h,p=i*f-n*l,m=n*h-a*f,M=2*u;return f*=M,h*=M,l*=M,d*=2,p*=2,m*=2,t[0]=s+f+d,t[1]=o+h+p,t[2]=c+l+m,t}function Tr(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0],i[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),i[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function vr(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),i[1]=a[1],i[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function gr(t,e,r,n){var a=[],i=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],i[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),i[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),i[2]=a[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Fr(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],u=e[1],s=e[2],o=Math.sqrt(r*r+n*n+a*a)*Math.sqrt(i*i+u*u+s*s),c=o&&hr(t,e)/o;return Math.acos(Math.min(Math.max(c,-1),1))}function _r(t){return t[0]=0,t[1]=0,t[2]=0,t}function wr(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Er(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Sr(t,e){var r=t[0],n=t[1],a=t[2],i=e[0],u=e[1],s=e[2];return Math.abs(r-i)<=d*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-s)<=d*Math.max(1,Math.abs(a),Math.abs(s))}var Ur,Ar=We,Lr=Ke,Rr=Qe,Dr=ir,Ir=ur,Pr=ke,Br=sr,Or=(Ur=qe(),function(t,e,r,n,a,i){var u,s;for(e||(e=3),r||(r=0),s=n?Math.min(n*e+r,t.length):t.length,u=r;u<s;u+=e)Ur[0]=t[u],Ur[1]=t[u+1],Ur[2]=t[u+2],a(Ur,Ur,i),t[u]=Ur[0],t[u+1]=Ur[1],t[u+2]=Ur[2];return t});function Vr(){var t=new p(4);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Gr(t){var e=new p(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Cr(t,e,r,n){var a=new p(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function Nr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function jr(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t}function qr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function zr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function kr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Xr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Hr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function $r(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Yr(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Wr(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Kr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Qr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Zr(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Jr(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return Math.hypot(r,n,a,i)}function tn(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+a*a+i*i}function en(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.hypot(e,r,n,a)}function rn(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a}function nn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function an(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function un(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=r*r+n*n+a*a+i*i;return u>0&&(u=1/Math.sqrt(u)),t[0]=r*u,t[1]=n*u,t[2]=a*u,t[3]=i*u,t}function sn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function on(t,e,r,n){var a=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],u=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],o=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],f=e[0],h=e[1],l=e[2],d=e[3];return t[0]=h*c-l*o+d*s,t[1]=-f*c+l*u-d*i,t[2]=f*o-h*u+d*a,t[3]=-f*s+h*i-l*a,t}function cn(t,e,r,n){var a=e[0],i=e[1],u=e[2],s=e[3];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t[2]=u+n*(r[2]-u),t[3]=s+n*(r[3]-s),t}function fn(t,e){var r,n,a,i,u,s;e=e||1;do{u=(r=2*m()-1)*r+(n=2*m()-1)*n}while(u>=1);do{s=(a=2*m()-1)*a+(i=2*m()-1)*i}while(s>=1);var o=Math.sqrt((1-u)/s);return t[0]=e*r,t[1]=e*n,t[2]=e*a*o,t[3]=e*i*o,t}function hn(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*i+r[12]*u,t[1]=r[1]*n+r[5]*a+r[9]*i+r[13]*u,t[2]=r[2]*n+r[6]*a+r[10]*i+r[14]*u,t[3]=r[3]*n+r[7]*a+r[11]*i+r[15]*u,t}function ln(t,e,r){var n=e[0],a=e[1],i=e[2],u=r[0],s=r[1],o=r[2],c=r[3],f=c*n+s*i-o*a,h=c*a+o*n-u*i,l=c*i+u*a-s*n,d=-u*n-s*a-o*i;return t[0]=f*c+d*-u+h*-o-l*-s,t[1]=h*c+d*-s+l*-u-f*-o,t[2]=l*c+d*-o+f*-s-h*-u,t[3]=e[3],t}function dn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function pn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function mn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Mn(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=e[0],s=e[1],o=e[2],c=e[3];return Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-o)<=d*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))}var yn=zr,xn=kr,bn=Xr,Tn=Jr,vn=tn,gn=en,Fn=rn,_n=function(){var t=Vr();return function(e,r,n,a,i,u){var s,o;for(r||(r=4),n||(n=0),o=a?Math.min(a*r+n,e.length):e.length,s=n;s<o;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],i(t,t,u),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function wn(){var t=new p(4);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function En(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Sn(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Un(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>d?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function An(t,e){var r=aa(t,e);return Math.acos(2*r*r-1)}function Ln(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=r[0],o=r[1],c=r[2],f=r[3];return t[0]=n*f+u*s+a*c-i*o,t[1]=a*f+u*o+i*s-n*c,t[2]=i*f+u*c+n*o-a*s,t[3]=u*f-n*s-a*o-i*c,t}function Rn(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],u=e[3],s=Math.sin(r),o=Math.cos(r);return t[0]=n*o+u*s,t[1]=a*o+i*s,t[2]=i*o-a*s,t[3]=u*o-n*s,t}function Dn(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],u=e[3],s=Math.sin(r),o=Math.cos(r);return t[0]=n*o-i*s,t[1]=a*o+u*s,t[2]=i*o+n*s,t[3]=u*o-a*s,t}function In(t,e,r){r*=.5;var n=e[0],a=e[1],i=e[2],u=e[3],s=Math.sin(r),o=Math.cos(r);return t[0]=n*o+a*s,t[1]=a*o-n*s,t[2]=i*o+u*s,t[3]=u*o-i*s,t}function Pn(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t}function Bn(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=Math.sqrt(r*r+n*n+a*a),s=Math.exp(i),o=u>0?s*Math.sin(u)/u:0;return t[0]=r*o,t[1]=n*o,t[2]=a*o,t[3]=s*Math.cos(u),t}function On(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=Math.sqrt(r*r+n*n+a*a),s=u>0?Math.atan2(u,i)/u:0;return t[0]=r*s,t[1]=n*s,t[2]=a*s,t[3]=.5*Math.log(r*r+n*n+a*a+i*i),t}function Vn(t,e,r){return On(t,e),na(t,t,r),Bn(t,t),t}function Gn(t,e,r,n){var a,i,u,s,o,c=e[0],f=e[1],h=e[2],l=e[3],p=r[0],m=r[1],M=r[2],y=r[3];return(i=c*p+f*m+h*M+l*y)<0&&(i=-i,p=-p,m=-m,M=-M,y=-y),1-i>d?(a=Math.acos(i),u=Math.sin(a),s=Math.sin((1-n)*a)/u,o=Math.sin(n*a)/u):(s=1-n,o=n),t[0]=s*c+o*p,t[1]=s*f+o*m,t[2]=s*h+o*M,t[3]=s*l+o*y,t}function Cn(t){var e=m(),r=m(),n=m(),a=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*r),t[1]=a*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function Nn(t,e){var r=e[0],n=e[1],a=e[2],i=e[3],u=r*r+n*n+a*a+i*i,s=u?1/u:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-a*s,t[3]=i*s,t}function jn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function qn(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var i=(a+1)%3,u=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*i+i]-e[3*u+u]+1),t[a]=.5*r,r=.5/r,t[3]=(e[3*i+u]-e[3*u+i])*r,t[i]=(e[3*i+a]+e[3*a+i])*r,t[u]=(e[3*u+a]+e[3*a+u])*r}return t}function zn(t,e,r,n){var a=.5*Math.PI/180;e*=a,r*=a,n*=a;var i=Math.sin(e),u=Math.cos(e),s=Math.sin(r),o=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return t[0]=i*o*f-u*s*c,t[1]=u*s*f+i*o*c,t[2]=u*o*c-i*s*f,t[3]=u*o*f+i*s*c,t}function kn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Xn,Hn,$n,Yn,Wn,Kn,Qn=Gr,Zn=Cr,Jn=Nr,ta=jr,ea=qr,ra=Ln,na=Qr,aa=sn,ia=cn,ua=en,sa=ua,oa=rn,ca=oa,fa=un,ha=mn,la=Mn,da=(Xn=qe(),Hn=Xe(1,0,0),$n=Xe(0,1,0),function(t,e,r){var n=hr(e,r);return n<-.999999?(lr(Xn,Hn,e),Pr(Xn)<1e-6&&lr(Xn,$n,e),fr(Xn,Xn),Sn(t,Xn,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(lr(Xn,e,r),t[0]=Xn[0],t[1]=Xn[1],t[2]=Xn[2],t[3]=1+n,fa(t,t))}),pa=(Yn=wn(),Wn=wn(),function(t,e,r,n,a,i){return Gn(Yn,e,a,i),Gn(Wn,r,n,i),Gn(t,Yn,Wn,2*i*(1-i)),t}),ma=(Kn=yt(),function(t,e,r,n){return Kn[0]=r[0],Kn[3]=r[1],Kn[6]=r[2],Kn[1]=n[0],Kn[4]=n[1],Kn[7]=n[2],Kn[2]=-e[0],Kn[5]=-e[1],Kn[8]=-e[2],fa(t,qn(t,Kn))});function Ma(){var t=new p(8);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ya(t){var e=new p(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function xa(t,e,r,n,a,i,u,s){var o=new p(8);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o[4]=a,o[5]=i,o[6]=u,o[7]=s,o}function ba(t,e,r,n,a,i,u){var s=new p(8);s[0]=t,s[1]=e,s[2]=r,s[3]=n;var o=.5*a,c=.5*i,f=.5*u;return s[4]=o*n+c*r-f*e,s[5]=c*n+f*t-o*r,s[6]=f*n+o*e-c*t,s[7]=-o*t-c*e-f*r,s}function Ta(t,e,r){var n=.5*r[0],a=.5*r[1],i=.5*r[2],u=e[0],s=e[1],o=e[2],c=e[3];return t[0]=u,t[1]=s,t[2]=o,t[3]=c,t[4]=n*c+a*o-i*s,t[5]=a*c+i*u-n*o,t[6]=i*c+n*s-a*u,t[7]=-n*u-a*s-i*o,t}function va(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function ga(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Fa(t,e){var r=wn();ge(r,e);var n=new p(3);return Te(n,e),Ta(t,r,n),t}function _a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function wa(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ea(t,e,r,n,a,i,u,s,o){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=i,t[5]=u,t[6]=s,t[7]=o,t}var Sa=Jn;function Ua(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Aa=Jn;function La(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Ra(t,e){var r=e[4],n=e[5],a=e[6],i=e[7],u=-e[0],s=-e[1],o=-e[2],c=e[3];return t[0]=2*(r*c+i*u+n*o-a*s),t[1]=2*(n*c+i*s+a*u-r*o),t[2]=2*(a*c+i*o+r*s-n*u),t}function Da(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=.5*r[0],o=.5*r[1],c=.5*r[2],f=e[4],h=e[5],l=e[6],d=e[7];return t[0]=n,t[1]=a,t[2]=i,t[3]=u,t[4]=u*s+a*c-i*o+f,t[5]=u*o+i*s-n*c+h,t[6]=u*c+n*o-a*s+l,t[7]=-n*s-a*o-i*c+d,t}function Ia(t,e,r){var n=-e[0],a=-e[1],i=-e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return Rn(t,e,r),n=t[0],a=t[1],i=t[2],u=t[3],t[4]=h*u+p*n+l*i-d*a,t[5]=l*u+p*a+d*n-h*i,t[6]=d*u+p*i+h*a-l*n,t[7]=p*u-h*n-l*a-d*i,t}function Pa(t,e,r){var n=-e[0],a=-e[1],i=-e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return Dn(t,e,r),n=t[0],a=t[1],i=t[2],u=t[3],t[4]=h*u+p*n+l*i-d*a,t[5]=l*u+p*a+d*n-h*i,t[6]=d*u+p*i+h*a-l*n,t[7]=p*u-h*n-l*a-d*i,t}function Ba(t,e,r){var n=-e[0],a=-e[1],i=-e[2],u=e[3],s=e[4],o=e[5],c=e[6],f=e[7],h=s*u+f*n+o*i-c*a,l=o*u+f*a+c*n-s*i,d=c*u+f*i+s*a-o*n,p=f*u-s*n-o*a-c*i;return In(t,e,r),n=t[0],a=t[1],i=t[2],u=t[3],t[4]=h*u+p*n+l*i-d*a,t[5]=l*u+p*a+d*n-h*i,t[6]=d*u+p*i+h*a-l*n,t[7]=p*u-h*n-l*a-d*i,t}function Oa(t,e,r){var n=r[0],a=r[1],i=r[2],u=r[3],s=e[0],o=e[1],c=e[2],f=e[3];return t[0]=s*u+f*n+o*i-c*a,t[1]=o*u+f*a+c*n-s*i,t[2]=c*u+f*i+s*a-o*n,t[3]=f*u-s*n-o*a-c*i,s=e[4],o=e[5],c=e[6],f=e[7],t[4]=s*u+f*n+o*i-c*a,t[5]=o*u+f*a+c*n-s*i,t[6]=c*u+f*i+s*a-o*n,t[7]=f*u-s*n-o*a-c*i,t}function Va(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=r[0],o=r[1],c=r[2],f=r[3];return t[0]=n*f+u*s+a*c-i*o,t[1]=a*f+u*o+i*s-n*c,t[2]=i*f+u*c+n*o-a*s,t[3]=u*f-n*s-a*o-i*c,s=r[4],o=r[5],c=r[6],f=r[7],t[4]=n*f+u*s+a*c-i*o,t[5]=a*f+u*o+i*s-n*c,t[6]=i*f+u*c+n*o-a*s,t[7]=u*f-n*s-a*o-i*c,t}function Ga(t,e,r,n){if(Math.abs(n)<d)return _a(t,e);var a=Math.hypot(r[0],r[1],r[2]);n*=.5;var i=Math.sin(n),u=i*r[0]/a,s=i*r[1]/a,o=i*r[2]/a,c=Math.cos(n),f=e[0],h=e[1],l=e[2],p=e[3];t[0]=f*c+p*u+h*o-l*s,t[1]=h*c+p*s+l*u-f*o,t[2]=l*c+p*o+f*s-h*u,t[3]=p*c-f*u-h*s-l*o;var m=e[4],M=e[5],y=e[6],x=e[7];return t[4]=m*c+x*u+M*o-y*s,t[5]=M*c+x*s+y*u-m*o,t[6]=y*c+x*o+m*s-M*u,t[7]=x*c-m*u-M*s-y*o,t}function Ca(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Na(t,e,r){var n=e[0],a=e[1],i=e[2],u=e[3],s=r[4],o=r[5],c=r[6],f=r[7],h=e[4],l=e[5],d=e[6],p=e[7],m=r[0],M=r[1],y=r[2],x=r[3];return t[0]=n*x+u*m+a*y-i*M,t[1]=a*x+u*M+i*m-n*y,t[2]=i*x+u*y+n*M-a*m,t[3]=u*x-n*m-a*M-i*y,t[4]=n*f+u*s+a*c-i*o+h*x+p*m+l*y-d*M,t[5]=a*f+u*o+i*s-n*c+l*x+p*M+d*m-h*y,t[6]=i*f+u*c+n*o-a*s+d*x+p*y+h*M-l*m,t[7]=u*f-n*s-a*o-i*c+p*x-h*m-l*M-d*y,t}var ja=Na;function qa(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var za=aa;function ka(t,e,r,n){var a=1-n;return za(e,r)<0&&(n=-n),t[0]=e[0]*a+r[0]*n,t[1]=e[1]*a+r[1]*n,t[2]=e[2]*a+r[2]*n,t[3]=e[3]*a+r[3]*n,t[4]=e[4]*a+r[4]*n,t[5]=e[5]*a+r[5]*n,t[6]=e[6]*a+r[6]*n,t[7]=e[7]*a+r[7]*n,t}function Xa(t,e){var r=Wa(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function Ha(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var $a=ua,Ya=$a,Wa=oa,Ka=Wa;function Qa(t,e){var r=Wa(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,a=e[1]/r,i=e[2]/r,u=e[3]/r,s=e[4],o=e[5],c=e[6],f=e[7],h=n*s+a*o+i*c+u*f;t[0]=n,t[1]=a,t[2]=i,t[3]=u,t[4]=(s-n*h)/r,t[5]=(o-a*h)/r,t[6]=(c-i*h)/r,t[7]=(f-u*h)/r}return t}function Za(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Ja(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ti(t,e){var r=t[0],n=t[1],a=t[2],i=t[3],u=t[4],s=t[5],o=t[6],c=t[7],f=e[0],h=e[1],l=e[2],p=e[3],m=e[4],M=e[5],y=e[6],x=e[7];return Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-h)<=d*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-l)<=d*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-p)<=d*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(u-m)<=d*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(s-M)<=d*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-y)<=d*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(c-x)<=d*Math.max(1,Math.abs(c),Math.abs(x))}function ei(){var t=new p(2);return p!=Float32Array&&(t[0]=0,t[1]=0),t}function ri(t){var e=new p(2);return e[0]=t[0],e[1]=t[1],e}function ni(t,e){var r=new p(2);return r[0]=t,r[1]=e,r}function ai(t,e){return t[0]=e[0],t[1]=e[1],t}function ii(t,e,r){return t[0]=e,t[1]=r,t}function ui(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function si(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function oi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function ci(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function fi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function hi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function li(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function di(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function pi(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function mi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Mi(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function yi(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function xi(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function bi(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Ti(t){var e=t[0],r=t[1];return e*e+r*r}function vi(t,e){return t[0]=-e[0],t[1]=-e[1],t}function gi(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Fi(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function _i(t,e){return t[0]*e[0]+t[1]*e[1]}function wi(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Ei(t,e,r,n){var a=e[0],i=e[1];return t[0]=a+n*(r[0]-a),t[1]=i+n*(r[1]-i),t}function Si(t,e){e=e||1;var r=2*m()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Ui(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t}function Ai(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t}function Li(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t}function Ri(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t}function Di(t,e,r,n){var a=e[0]-r[0],i=e[1]-r[1],u=Math.sin(n),s=Math.cos(n);return t[0]=a*s-i*u+r[0],t[1]=a*u+i*s+r[1],t}function Ii(t,e){var r=t[0],n=t[1],a=e[0],i=e[1],u=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+i*i),s=u&&(r*a+n*i)/u;return Math.acos(Math.min(Math.max(s,-1),1))}function Pi(t){return t[0]=0,t[1]=0,t}function Bi(t){return"vec2("+t[0]+", "+t[1]+")"}function Oi(t,e){return t[0]===e[0]&&t[1]===e[1]}function Vi(t,e){var r=t[0],n=t[1],a=e[0],i=e[1];return Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))}var Gi=bi,Ci=si,Ni=oi,ji=ci,qi=yi,zi=xi,ki=Ti,Xi=function(){var t=ei();return function(e,r,n,a,i,u){var s,o;for(r||(r=2),n||(n=0),o=a?Math.min(a*r+n,e.length):e.length,s=n;s<o;s+=r)t[0]=e[s],t[1]=e[s+1],i(t,t,u),e[s]=t[0],e[s+1]=t[1];return e}}();r.d(e,"glMatrix",(function(){return n})),r.d(e,"mat2",(function(){return a})),r.d(e,"mat2d",(function(){return i})),r.d(e,"mat3",(function(){return u})),r.d(e,"mat4",(function(){return s})),r.d(e,"quat",(function(){return f})),r.d(e,"quat2",(function(){return h})),r.d(e,"vec2",(function(){return l})),r.d(e,"vec3",(function(){return o})),r.d(e,"vec4",(function(){return c}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(7),a=r(8),i=r(9),u=r(10),s=r(11),o=r(12),c=r(3),f=r(16),h=r(17);window.main=new class{constructor(){this.canvas=document.createElement("canvas"),this.paused=!1,this.gfxDevice=new a.WebGlRenderer,this.camera=new i.Camera,this.dt=0,this.realTime=0,this.cameraSystem=new u.CameraSystem(this.camera),this.compositor=new s.Compositor(this.canvas,this.gfxDevice),this.globalUniforms=new c.GlobalUniforms(this.gfxDevice),this.demo=new o.Demo,this.input=new f.InputManager,this.resources=new h.ResourceManager,this._updateLoop=t=>{this.paused||(this.dt=t-this.realTime,this.realTime=t,this.resources.update(),this.cameraSystem.update(this),this.demo.update(this),this.compositor.render(),this.demo.render(this),this.input.afterFrame(),window.requestAnimationFrame(this._updateLoop))},this.init()}async init(){return console.log(`Source for this build available at ${n.GITHUB_REVISION_URL}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(n.IS_DEVELOPMENT),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),this.resources.initialize(this.gfxDevice),this.input.initialize(this),this.cameraSystem.initialize(),this.compositor.initialize(),this.globalUniforms.initialize(),this.demo.initialize(this),window.onresize=this._onResize.bind(this),this._onResize(),n.IS_DEVELOPMENT,this.resources.load("data/utaRunners.jpg","texture",(t,e)=>{console.log(e)}),this._updateLoop(window.performance.now()),0):1}setPaused(t){this.paused!==t&&(this.paused=!0,this.paused||window.requestAnimationFrame(this._updateLoop))}_onResize(){this.cameraSystem.resize(window.innerWidth,window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GIT_REVISION="9d888161c463bd21a2a0b47cfa238c5ff64cc49b",e.GIT_SHORT_REVISION=e.GIT_REVISION.slice(0,8),e.GITHUB_URL="https://github.com/themikelester/ts-boilerplate",e.GITHUB_REVISION_URL=`${e.GITHUB_URL}/commit/${e.GIT_REVISION}`,e.IS_DEVELOPMENT=!1},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=n(r(0));let i;function u(t){switch(t){case i.FLOAT:return a.Type.Float;case i.FLOAT_VEC2:return a.Type.Float2;case i.FLOAT_VEC3:return a.Type.Float3;case i.FLOAT_VEC4:return a.Type.Float4;case i.INT:return a.Type.Int;case i.INT_VEC2:return a.Type.Int2;case i.INT_VEC3:return a.Type.Int3;case i.INT_VEC4:return a.Type.Int4;case i.FLOAT_MAT3:return a.Type.Float3x3;case i.FLOAT_MAT4:return a.Type.Float4x4;case i.SAMPLER_2D:return a.Type.Texture2D;case i.SAMPLER_3D:return a.Type.Texture3D;case i.SAMPLER_CUBE:return a.Type.TextureCube;case i.UNSIGNED_INT:return a.Type.Uint;case i.UNSIGNED_INT_VEC2:return a.Type.Uint2;case i.UNSIGNED_INT_VEC3:return a.Type.Uint3;case i.UNSIGNED_INT_VEC4:return a.Type.Uint4;default:return b(`Unsupported WebGL type: ${t}`)}}function s(t){switch(t){case a.Type.Float:return 1;case a.Type.Float2:return 2;case a.Type.Float3:return 3;case a.Type.Float4:return 4;case a.Type.Int:return 1;case a.Type.Int2:return 2;case a.Type.Int3:return 3;case a.Type.Int4:return 4;case a.Type.Uint:return 1;case a.Type.Uint2:return 2;case a.Type.Uint3:return 3;case a.Type.Uint4:return 4;case a.Type.Short:return 1;case a.Type.Short2:return 2;case a.Type.Short3:return 3;case a.Type.Short4:return 4;case a.Type.Ushort:return 1;case a.Type.Ushort2:return 2;case a.Type.Ushort3:return 3;case a.Type.Ushort4:return 4;case a.Type.Char:return 1;case a.Type.Char2:return 2;case a.Type.Char3:return 3;case a.Type.Char4:return 4;case a.Type.Uchar:return 1;case a.Type.Uchar2:return 2;case a.Type.Uchar3:return 3;case a.Type.Uchar4:return 4;case a.Type.Half:return 1;case a.Type.Half2:return 2;case a.Type.Half3:return 3;case a.Type.Half4:return 4;default:return b(`Unsupported type: ${t}`)}}function o(t){switch(t){case a.Type.Float:case a.Type.Float2:case a.Type.Float3:case a.Type.Float4:return i.FLOAT;case a.Type.Int:case a.Type.Int2:case a.Type.Int3:case a.Type.Int4:return i.INT;case a.Type.Uint:case a.Type.Uint2:case a.Type.Uint3:case a.Type.Uint4:return i.UNSIGNED_INT;case a.Type.Short:case a.Type.Short2:case a.Type.Short3:case a.Type.Short4:return i.SHORT;case a.Type.Ushort:case a.Type.Ushort2:case a.Type.Ushort3:case a.Type.Ushort4:return i.UNSIGNED_SHORT;case a.Type.Char:case a.Type.Char2:case a.Type.Char3:case a.Type.Char4:return i.BYTE;case a.Type.Uchar:case a.Type.Uchar2:case a.Type.Uchar3:case a.Type.Uchar4:return i.UNSIGNED_BYTE;case a.Type.Half:case a.Type.Half2:case a.Type.Half3:case a.Type.Half4:return i.HALF_FLOAT;default:return b(`Unsupported type: ${t}`)}}function c(t){switch(t){case a.PrimitiveType.Points:return i.POINTS;case a.PrimitiveType.Lines:return i.LINES;case a.PrimitiveType.LineLoop:return i.LINE_LOOP;case a.PrimitiveType.LineStrip:return i.LINE_STRIP;case a.PrimitiveType.Triangles:return i.TRIANGLES;case a.PrimitiveType.TriangleStrip:return i.TRIANGLE_STRIP;case a.PrimitiveType.TriangleFan:return i.TRIANGLE_FAN;default:return b(`Unsupported primitive type: ${t}`)}}function f(t){switch(t){case a.Type.Uchar:return i.UNSIGNED_BYTE;case a.Type.Uint:return i.UNSIGNED_INT;case a.Type.Ushort:return i.UNSIGNED_SHORT;default:return b(`Unsupported index type: ${t}`)}}function h(t){switch(t){case a.TextureType.Texture2D:return i.TEXTURE_2D;case a.TextureType.Texture3D:return i.TEXTURE_3D;case a.TextureType.TextureCube:return i.TEXTURE_CUBE_MAP;default:return b(`Unsupported texture type: ${t}`)}}function l(t){switch(t){case a.TexelFormat.U565:return i.RGB;case a.TexelFormat.U8:return i.ALPHA;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.RGBA;case a.TexelFormat.F16:return i.ALPHA;case a.TexelFormat.F16x4:case a.TexelFormat.F32x4:return i.RGBA;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT;case a.TexelFormat.Depth24Stencil8:return i.DEPTH_STENCIL;default:return b(`Unsupported texel format: ${t}`)}}function d(t){switch(t){case a.TexelFormat.U565:return i.RGB;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:return i.RED;case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:return i.RG;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:case a.TexelFormat.U10_10_10_2:return i.RGBA;case a.TexelFormat.F16:return i.RED;case a.TexelFormat.F16x2:return i.RG;case a.TexelFormat.F16x4:return i.RGBA;case a.TexelFormat.F32x2:return i.RG;case a.TexelFormat.F32x4:return i.RGBA;case a.TexelFormat.F11_11_10:return i.RGB;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT;case a.TexelFormat.Depth24Stencil8:return i.DEPTH_STENCIL;default:return b(`Unsupported texel format: ${t}`)}}function p(t){switch(t){case a.TexelFormat.U565:return i.RGB565;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:return i.R8;case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:return i.RG8;case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:return i.RGB8;case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.RGBA8;case a.TexelFormat.U10_10_10_2:return i.RGB10_A2;case a.TexelFormat.F16:return i.R16F;case a.TexelFormat.F16x2:return i.RG16F;case a.TexelFormat.F16x3:return i.RGB16F;case a.TexelFormat.F16x4:return i.RGBA16F;case a.TexelFormat.F32x2:return i.RG32F;case a.TexelFormat.F32x3:return i.RGB32F;case a.TexelFormat.F32x4:return i.RGBA32F;case a.TexelFormat.Depth32:return i.DEPTH_COMPONENT32F;case a.TexelFormat.Depth24Stencil8:return i.DEPTH24_STENCIL8;default:return b(`Unsupported texel format: ${t}`)}}function m(t){switch(t){case a.TexelFormat.Undefined:return 0;case a.TexelFormat.U565:return i.UNSIGNED_SHORT_5_6_5;case a.TexelFormat.U8:case a.TexelFormat.U8_sRGB:case a.TexelFormat.U8x2:case a.TexelFormat.U8x2_sRGB:case a.TexelFormat.U8x3:case a.TexelFormat.U8x3_sRGB:case a.TexelFormat.U8x4:case a.TexelFormat.U8x4_sRGB:return i.UNSIGNED_BYTE;case a.TexelFormat.U10_10_10_2:return i.RGBA;case a.TexelFormat.F11_11_10:return i.FLOAT;case a.TexelFormat.F16:case a.TexelFormat.F16x2:case a.TexelFormat.F16x4:return i.HALF_FLOAT;case a.TexelFormat.F32x2:case a.TexelFormat.F32x4:case a.TexelFormat.Depth32:return i.FLOAT;case a.TexelFormat.Depth24Stencil8:return i.UNSIGNED_INT_24_8;default:return b(`Unsupported texel format: ${t}`)}}function M(t){switch(t){case a.TextureFilter.Nearest:return i.NEAREST;case a.TextureFilter.Linear:return i.LINEAR;default:return b("Unsupported texture filter: ${filter)")}}function y(t){switch(t){case a.BlendFactor.Zero:return i.ZERO;case a.BlendFactor.One:return i.One;case a.BlendFactor.Source:return i.SRC_ALPHA;case a.BlendFactor.OneMinusSource:return i.ONE_MINUS_SRC_ALPHA;default:return b(`Unsupported blend factor: ${t}`)}}function x(t,e="Assert failed"){t||b(e)}function b(t){throw console.error(t),new Error(t)}function T(t,e){return void 0!==t?t:e}function v(t){return null!=t}function g(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap}function F(t,e,r){const n=i.createShader(e);if(i.shaderSource(n,r),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){b(`${e===i.VERTEX_SHADER?"Vertex":"Fragment"} compilation failed for shader ${t}:\n  ${i.getShaderInfoLog(n)}`)}return n}function _(t,e,r){const n=t.vertexLayout.buffers[r],u=t.shader.reflection,s=Object.keys(n.layout);i.bindBuffer(i.ARRAY_BUFFER,e.buffer.glId);for(let t=0;t<s.length;t++){const r=n.layout[s[t]],o=u.attributes[s[t]];v(o)&&(e.buffer?(i.enableVertexAttribArray(o.location),i.vertexAttribPointer(o.location,o.components,o.glType,!0,n.stride,r.offset+e.offset),n.stepMode===a.StepMode.Instance&&(i.instancedArrays?i.instancedArrays.vertexAttribDivisorANGLE(o.location,1):i.vertexAttribDivisor(o.location,1))):i.disableVertexAttribArray(o.location))}}function w(t){return t.type===a.BindingType.Texture}class E{constructor(){this.objects=[],this.freeList=[],this.count=0}get(t){const e=this.objects[t];return x(void 0!==e,"Invalid ID"),e}create(t){if(++this.count,this.freeList.length>0){const e=this.freeList.pop();return this.objects[e]=t,e}return this.objects.push(t),this.objects.length-1}delete(t){--this.count,delete this.objects[t],this.freeList.push(t)}}e.WebGlRenderer=class{constructor(){this.debugEnabled=!1,this.buffers=new E,this.textures=new E,this.shaders=new E,this.renderPipelines=new E,this.resourceTables=new E,this.renderPasses=new E,this.depthStencilStates=new E}initialize(t){const e={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(i=t.getContext("webgl2",e),i||(i=t.getContext("webgl",e)),!i)return!1;this.webGlVersion=i instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(t){let e,r=0;return(e=i.getExtension("OES_vertex_array_object"))&&(r|=a.Feature.VertexArrayObject,i.createVertexArray=e.createVertexArrayOES.bind(e),i.deleteVertexArray=e.deleteVertexArrayOES.bind(e),i.bindVertexArray=e.bindVertexArrayOES.bind(e)),(e=i.getExtension("OES_texture_half_float"))&&(r|=a.Feature.TextureHalf,i.HALF_FLOAT=e.HALF_FLOAT_OES),(e=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(r|=a.Feature.AnistropicFiltering,i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,i.TEXTURE_MAX_ANISOTROPY_EXT=e.TEXTURE_MAX_ANISOTROPY_EXT),i.getExtension("OES_texture_float")&&(r|=a.Feature.TextureFloat),i.getExtension("OES_texture_float_linear")&&(r|=a.Feature.TextureFloatLinearFiltering),i.getExtension("OES_texture_half_float_linear")&&(r|=a.Feature.TextureHalfLinearFiltering),i.getExtension("OES_standard_derivatives")&&(r|=a.Feature.ShaderDerivatives),i.texSubImage2D&&(r|=a.Feature.TextureWrite),(i.instancedArrays=i.getExtension("ANGLE_instanced_arrays"))&&(r|=a.Feature.Instancing),t>=2&&(r|=a.Feature.VertexArrayObject,r|=a.Feature.TextureFloat,r|=a.Feature.TextureHalf,r|=a.Feature.Instancing),r}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:t.width,height:t.height}),x(this.defaultRenderPass===a.kDefaultRenderPass),this.current={},i.clearColor(0,0,0,1);const r=new Uint8Array([0,0,0,1]),n={usage:a.Usage.Static,type:a.TextureType.Texture2D,format:a.TexelFormat.U8x4,width:1,height:1},u=this.createTexture("DefaultTexture",n,r);return this.defaultTexture=this.textures.get(u),this.isGfxFeatureSupported(a.Feature.AnistropicFiltering)&&(this.maxAnisotropy=i.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),!0}isGfxFeatureSupported(t){return!!(this.featureFlags&t)}setDebugEnabled(t){this.debugEnabled=t}resize(t,e){const r=this.renderPasses.get(this.defaultRenderPass);r.width=t,r.height=e}beginFrame(){}endFrame(){}bindRenderPass(t){const e=this.renderPasses.get(t);i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer),i.viewport(0,0,e.width,e.height);const r=i.COLOR_BUFFER_BIT;i.clear(r)}bindPipeline(t){const e=this.renderPipelines.get(t);this.current.shader!==e.shader&&(i.useProgram(e.shader.glProgram),this.current.shader=e.shader),e.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=e.renderFormat.blendingEnabled,e.renderFormat.blendingEnabled?i.enable(i.BLEND):i.disable(i.BLEND)),!this.current.blending||this.current.srcBlendFactor==e.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==e.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=T(e.renderFormat.srcBlendFactor,a.BlendFactor.One),this.current.dstBlendFactor=T(e.renderFormat.dstBlendFactor,a.BlendFactor.OneMinusSource),i.blendFunc(y(this.current.srcBlendFactor),y(this.current.dstBlendFactor)))}draw(t,e,r,n,u){const s=c(t),o=f(r),h=a.TranslateTypeToSize(r),l=this.buffers.get(e);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l.glId),i.drawElements(s,u,o,n*h)}drawInstanced(t,e,r,n,u,s){const o=c(t),h=f(r),l=a.TranslateTypeToSize(r),d=this.buffers.get(e);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d.glId),i.instancedArrays?i.instancedArrays.drawElementsInstancedANGLE(o,u,h,n*l,s):i.drawElementsInstanced(o,u,h,n*l,s)}drawNonIndexed(t,e,r){const n=c(t);i.drawArrays(n,e,r)}setDepthStencilState(t){const e=this.depthStencilStates.get(t),r=this.current.depthStencil;r&&e.depthWriteEnabled==r.depthWriteEnabled||i.depthMask(e.depthWriteEnabled),r&&e.depthCompareFunc==r.depthCompareFunc||i.depthFunc(e.depthCompareFunc),r&&e.depthTestEnabled==r.depthTestEnabled||(e.depthTestEnabled?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST)),this.current.depthStencil=e}setCullMode(t){this.current.cullMode!=t&&(this.current.cullMode=t,t==a.CullMode.None?i.disable(i.CULL_FACE):(i.enable(i.CULL_FACE),i.cullFace(function(t){switch(t){case a.CullMode.None:return i.NONE;case a.CullMode.Back:return i.BACK;case a.CullMode.Front:return i.FRONT;default:return b(`Unsupported culling mode: ${t}`)}}(t))))}createDepthStencilState(t){const e=function(t){switch(t){case a.CompareFunc.Never:return i.NEVER;case a.CompareFunc.Less:return i.LESS;case a.CompareFunc.Equal:return i.EQUAL;case a.CompareFunc.LessEqual:return i.LEQUAL;case a.CompareFunc.Greater:return i.GREATER;case a.CompareFunc.NotEqual:return i.NOTEQUAL;case a.CompareFunc.GreaterEqual:return i.GEQUAL;case a.CompareFunc.Always:return i.ALWAYS;default:return b(`Unsupported compare func: ${t}`)}}(T(t.depthCompareFunc,a.CompareFunc.Less));return this.depthStencilStates.create({depthTestEnabled:t.depthTestEnabled,depthWriteEnabled:t.depthWriteEnabled,depthCompareFunc:e})}createResourceTable(t){const e=this.renderPipelines.get(t);let r=null;return this.isGfxFeatureSupported(a.Feature.VertexArrayObject)&&(r=i.createVertexArray()),this.resourceTables.create({pipeline:e,vao:r,buffers:[],textures:[],uniforms:[]})}removeResourceTable(t){if(this.isGfxFeatureSupported(a.Feature.VertexArrayObject)){const e=this.resourceTables.get(t);i.deleteVertexArray(e.vao)}this.resourceTables.delete(t)}bindResources(t){const e=this.resourceTables.get(t),r=e.pipeline.shader.uniformLayout,n=e.pipeline.shader.reflection,u=e.pipeline.shader.name;if(this.isGfxFeatureSupported(a.Feature.VertexArrayObject))i.bindVertexArray(e.vao);else for(let t=0;t<e.buffers.length;t++)_(e.pipeline,e.buffers[t],t);for(let t=0;t<n.uniforms.length;t++){const u=n.uniforms[t],s=r[u.name],o=e.uniforms[s.index].buffer.cpuBuffer;x(v(o));const c=new Float32Array(o.buffer,s.offset,u.size/4),f=e.pipeline.shader.uniformVals[u.name];if(!c.every((t,e)=>t===f[e]))switch(e.pipeline.shader.uniformVals[u.name].set(c),u.type){case a.Type.Float:i.uniform1fv(u.location,c);break;case a.Type.Float2:i.uniform2fv(u.location,c);break;case a.Type.Float3:i.uniform3fv(u.location,c);break;case a.Type.Float4:i.uniform4fv(u.location,c);break;case a.Type.Float3x3:i.uniformMatrix3fv(u.location,!1,c);break;case a.Type.Float4x4:i.uniformMatrix4fv(u.location,!1,c);break;default:b("Unknown shader uniform type")}}for(let t=0;t<n.textureArray.length;t++){const a=n.textureArray[t],s=r[a.name].index;void 0===e.textures[s]&&console.warn(`Shader ${u} expects texture "${a.name}" (index ${s}) to be bound`);for(let t=0;t<a.count;t++){const r=e.textures[s+t]||this.defaultTexture,n=a.location+t;i.activeTexture(i.TEXTURE0+n),i.bindTexture(r.target,r.glId)}}}setBuffer(t,e,r=0,n=0){const u=this.resourceTables.get(t),s=this.buffers.get(e),o={buffer:s,offset:n};x(r<a.kMaxShaderVertexBuffers),s.type===a.BufferType.Uniform?u.uniforms[r]=o:(u.buffers[r]=o,this.isGfxFeatureSupported(a.Feature.VertexArrayObject)&&(i.bindVertexArray(u.vao),_(u.pipeline,o,r)))}setTexture(t,e,r){const n=this.resourceTables.get(t),a=e?this.textures.get(e):null;n.textures[r]=a}setTextures(t,e,r){const n=this.resourceTables.get(t);for(let t=0;t<e.length;t++){const a=e[t]?this.textures.get(e[t]):null;n.textures[r+t]=a}}writeBufferData(t,e,r){const n=this.buffers.get(t);if(n.type===a.BufferType.Uniform){const t=ArrayBuffer.isView(r)?r.buffer:r,a=new Uint8Array(t);v(n.cpuBuffer)?n.cpuBuffer.set(a,e):b("No CPU buffer assigned to uniform buffer")}else i.bindBuffer(n.target,n.glId),i.bufferSubData(n.target,e,r)}createRenderPipeline(t,e,r,n){const i=this.shaders.get(t);if(this.debugEnabled){Object.keys(i.reflection.attributes).forEach(t=>{x(void 0!==r.buffers.find(e=>e&&void 0!==e.layout[t]),`VertexLayout does not supply attribute ${t} required by Shader '${i.name}'`)});const t=Object.keys(n).map(t=>n[t]),e=Object.keys(i.uniformLayout);for(let r=0;r<e.length;r++){const n=i.uniformLayout[e[r]];t.find(t=>t.index===n.index)||b(`ResourceLayout does not supply a texture at index ${n.index} required by uniform '${e[r]}' of Shader '${i.name}'`)}this.isGfxFeatureSupported(a.Feature.Instancing)||r.buffers.forEach(t=>{x(t.stepMode!==a.StepMode.Instance,"Instancing is not supported by this WebGL context")})}return this.renderPipelines.create({shader:i,renderFormat:e,vertexLayout:r,resourceLayout:n})}removeRenderPipeline(t){this.renderPipelines.delete(t)}createShader(t){return this._createShader(t.name,t.vertSource,t.fragSource,t.resourceLayout)}_createShader(t,e,r,n){x(void 0!==n,"A ShaderResourceLayout must be passed to createShader to define uniform binding locations.In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader");const c=function(t,e,r){const n=F(t,i.VERTEX_SHADER,e),a=F(t,i.FRAGMENT_SHADER,r),u=i.createProgram();return i.attachShader(u,n),i.attachShader(u,a),i.linkProgram(u),i.deleteShader(n),i.deleteShader(a),i.getProgramParameter(u,i.LINK_STATUS)||b(`Linking failed for shader ${t}:\n  ${i.getProgramInfoLog(u)}`),u}(t,e instanceof Array?e.join("\n#line 0\n"):e,r instanceof Array?r.join("\n#line 0\n"):r),f=function(t){const e={},r=[],n=[],c={};let f=0;const h=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);x(h<a.kMaxShaderAttributes);for(let e=0;e<h;e++){const r=i.getActiveAttrib(t,e),n=u(r.type);c[r.name]={location:e,count:r.size,components:s(n),glType:o(n),type:n}}const l=i.getProgramParameter(t,i.ACTIVE_UNIFORMS);x(l<a.kMaxShaderUniforms);for(let s=0;s<l;s++){const o=i.getActiveUniform(t,s),c=u(o.type),h=o.name.replace("[0]","");if(c>=a.TextureType.Texture2D&&c<=a.TextureType.TextureCube){const n={name:h,count:o.size,type:c,location:f,locationGl:i.getUniformLocation(t,o.name)};f+=o.size,e[h]=n,r.push(n)}else{const e={name:h,count:o.size,type:c,size:a.TranslateTypeToSize(c)*o.size,location:i.getUniformLocation(t,o.name)};n.push(e)}}return{attributes:c,uniforms:n,textures:e,textureArray:r,textureCount:f}}(c),h=Object.keys(n),l=h.map(t=>n[t]);if(this.debugEnabled){for(let e=0;e<f.uniforms.length;e++){const r=f.uniforms[e],n=l.find(t=>!w(t)&&t.layout&&t.layout[r.name]);x(void 0!==n,`Shader '${t}' expects uniform '${r.name}' to be set in a uniform buffer`);const a=n.layout[r.name].type;x(a===r.type,`Shader '${t}' expects uniform '${r.name}' to be type ${r.type} but the ShaderResourceLayout specifies type ${a}`)}for(let e=0;e<f.textureArray.length;e++){const r=f.textureArray[e],n=l.find((t,e)=>w(t)&&h[e]===r.name);x(void 0!==n,`Shader '${t}' expects texture '${r.name}', but it is not defined in the ShaderResourceLayout`),x((n.count||1)===r.count,`Shader '${t}' expects texture '${r.name}' to be an array of length ${r.count}, but the ResourceLayout specifies length ${n.count}`)}}const d={};for(let t=0;t<f.uniforms.length;t++){const e=f.uniforms[t],r=l.find(t=>!w(t)&&t.layout&&t.layout[e.name]);d[e.name]={offset:r.layout[e.name].offset,index:r.index}}for(let t=0;t<f.textureArray.length;t++){const e=f.textureArray[t],r=n[e.name];d[e.name]={offset:0,index:r.index}}const p={};for(let t=0;t<f.uniforms.length;t++){const e=f.uniforms[t];p[e.name]=new Float32Array(e.size/4)}i.useProgram(c);const m=Object.keys(f.textures);for(let t=0;t<m.length;t++){const e=f.textures[m[t]],r=Array.from(Array(e.count).keys()).map((t,r)=>e.location+r);i.uniform1iv(e.locationGl,r)}return this.current.shader=void 0,this.shaders.create({name:t,glProgram:c,reflection:f,uniformVals:p,uniformLayout:d})}removeShader(t){const e=this.shaders.get(t);i.deleteProgram(e.glProgram),this.shaders.delete(t)}createTexture(t,e,r){const n=!r||r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength,u=1===this.webGlVersion?l:d,s={target:h(e.type),format:u(e.format),internalFormat:this.webGlVersion>1?p(e.format):u(e.format),type:m(e.format),usage:e.usage,width:n?T(e.width,1):r.width,height:n?T(e.height,1):r.height,depth:e.depth||1,minFilter:M(void 0!==e.defaultMinFilter?e.defaultMinFilter:a.TextureFilter.Linear),magFilter:M(void 0!==e.defaultMagFilter?e.defaultMagFilter:a.TextureFilter.Linear),glId:i.createTexture()};if(i.bindTexture(s.target,s.glId),i.texParameteri(s.target,i.TEXTURE_MIN_FILTER,s.minFilter),i.texParameteri(s.target,i.TEXTURE_MAG_FILTER,s.magFilter),i.texParameteri(s.target,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(s.target,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),v(e.maxAnistropy)&&e.maxAnistropy>1&&this.isGfxFeatureSupported(a.Feature.AnistropicFiltering)){const t=Math.min(this.maxAnisotropy,e.maxAnistropy);i.texParameterf(i.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,t)}const o=this.webGlVersion>1?s.internalFormat:s.format;if(e.type===a.TextureType.Texture3D)i.texImage3D(s.target,0,o,s.width,s.height,s.depth,0,s.format,s.type,r);else if(n)r instanceof ArrayBuffer&&(r=new Uint8Array(r)),i.texImage2D(s.target,0,o,s.width,s.height,0,s.format,s.type,r);else if(void 0!==r)i.texImage2D(s.target,0,o,s.format,s.type,r);else{x(void 0!==s.width&&void 0!==s.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),i.texImage2D(s.target,0,o,e.width,e.height,0,s.format,s.type,null)}return this.textures.create(s)}writeTextureData(t,e){const r=this.textures.get(t);x(r.target===i.TEXTURE_2D,"Currently only 2D textures may be written to"),i.bindTexture(r.target,r.glId);const n=g(e)?e.width!==r.width:!!g(e)&&e.height!==r.height;this.isGfxFeatureSupported(a.Feature.TextureWrite)&&!n?g(e)?i.texSubImage2D(r.target,0,0,0,r.format,r.type,e):i.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,e):i.texImage2D(r.target,0,r.internalFormat,r.format,r.type,e)}removeTexture(t){const e=this.textures.get(t);i.deleteTexture(e.glId),this.textures.delete(t)}createBuffer(t,e,r,n){let u,s;x(r!=a.Usage.None);const o=function(t){switch(t){case a.BufferType.Undefined:return 0;case a.BufferType.Uniform:return i.UNIFORM_BUFFER;case a.BufferType.Vertex:return i.ARRAY_BUFFER;case a.BufferType.Index:return i.ELEMENT_ARRAY_BUFFER;case a.BufferType.Readback:return i.TRANSFORM_FEEDBACK_BUFFER}}(e),c=t=>Number.isInteger(t),f=t=>t instanceof ArrayBuffer,h=c(n)?null:n,l=c(n)?n:n.byteLength;if(x(l>0||null!==h,"Either an ArrayBuffer or size must be provided"),e!=a.BufferType.Uniform)s=i.createBuffer(),i.bindBuffer(o,s),i.bufferData(o,n,r==a.Usage.Dynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW);else if(h){const t=f(h)?h:h.buffer,e=f(h)?0:h.byteOffset;u=new Uint8Array(t,e,l)}else u=new Uint8Array(l);return this.buffers.create({name:t,type:e,target:o,usage:r,size:l,glId:s,cpuBuffer:u})}removeBuffer(t){const e=this.buffers.get(t);e.type!=a.BufferType.Uniform&&i.deleteBuffer(e.glId),this.buffers.delete(t)}readPixels(t,e,r,n,a){i.readPixels(t,e,r,n,i.RGBA,i.UNSIGNED_BYTE,a)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(5),a=r(1);e.Camera=class{constructor(t,e,r,i){this.cameraMatrix=n.mat4.create(),this.viewMatrix=n.mat4.create(),this.projectionMatrix=n.mat4.create(),this.projectionMatrixInverse=n.mat4.create(),this.viewProjMatrix=n.mat4.create(),this.viewProjMatrixInverse=n.mat4.create(),this.forward=n.vec3.create(),this.up=n.vec3.create(),this.right=n.vec3.create(),t=a.defaultValue(t,60/180*Math.PI),r=a.defaultValue(r,.1),i=a.defaultValue(i,2e3),e=a.defaultValue(e,1),this.setPerspective(t,e,r,i)}copy(t){this.fov=t.fov,this.near=t.near,this.far=t.far,this.aspect=t.aspect,n.mat4.copy(this.cameraMatrix,t.cameraMatrix),n.mat4.copy(this.viewMatrix,t.viewMatrix),n.mat4.copy(this.projectionMatrix,t.projectionMatrix),n.mat4.copy(this.projectionMatrixInverse,t.projectionMatrixInverse),n.mat4.copy(this.viewProjMatrix,t.viewProjMatrix),n.mat4.copy(this.viewProjMatrixInverse,t.viewProjMatrixInverse),n.vec3.copy(this.forward,t.forward),n.vec3.copy(this.up,t.up),n.vec3.copy(this.right,t.right)}getPos(t){return n.mat4.getTranslation(t,this.cameraMatrix)}viewMatrixUpdated(){n.mat4.invert(this.cameraMatrix,this.viewMatrix),n.vec3.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),n.vec3.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),n.vec3.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),n.mat4.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.mat4.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(t,e,r,a=1/0){this.fov=t,this.aspect=e,this.near=r,this.far=a,n.mat4.perspective(this.projectionMatrix,t,e,r,a),n.mat4.invert(this.projectionMatrixInverse,this.projectionMatrix),n.mat4.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.mat4.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(5),a=n.vec3.create();n.vec3.create(),n.vec3.create();e.CameraSystem=class{constructor(t){this.camera=t,this.camPos=n.vec3.create()}initialize(){this.resize(window.innerWidth,window.innerHeight),this.controller=new u,this.controller.camera=this.camera}resize(t,e){const r=t/e;this.camera.setPerspective(this.camera.fov,r,this.camera.near,this.camera.far)}update({globalUniforms:t,input:e,dt:r}){this.controller.update(e,r);const n=this.camera.getPos(this.camPos);t.setUniform("g_camPos",new Float32Array([n[0],n[1],n[2]])),t.setUniform("g_proj",Float32Array.from(this.camera.projectionMatrix)),t.setUniform("g_viewProj",Float32Array.from(this.camera.viewProjMatrix))}};const i=n.vec3.fromValues(0,1,0);class u{constructor(){this.x=-Math.PI/2,this.y=2,this.z=-4,this.orbitSpeed=-.05,this.xVel=0,this.yVel=0,this.zVel=0,this.translation=n.vec3.create(),this.txVel=0,this.tyVel=0,this.shouldOrbit=!0}update(t,e){t.isKeyDownEventTriggered("KeyR")&&(this.shouldOrbit=!this.shouldOrbit),t.isKeyDownEventTriggered("Numpad5")&&(this.shouldOrbit=!1,this.xVel=this.yVel=0),t.isKeyDownEventTriggered("KeyB")&&(this.shouldOrbit=!1,this.xVel=this.yVel=0,this.txVel=this.tyVel=0,this.xVel=this.yVel=this.zVel=0,n.vec3.set(this.translation,0,0,0));const r=this.shouldOrbit,u=t.invertX?-1:1,o=t.invertY?-1:1;1===t.button?(this.txVel+=t.dx*(-10-Math.min(this.z,.01))/-5e3,this.tyVel+=t.dy*(-10-Math.min(this.z,.01))/5e3):t.isDragging()?(this.xVel+=t.dx/-200*u,this.yVel+=t.dy/-200*o):r&&Math.abs(this.xVel)<Math.abs(this.orbitSpeed)&&(this.xVel+=1*this.orbitSpeed/50),this.zVel+=t.dz;let c=0,f=0;t.isKeyDown("KeyA")&&(c+=.02),t.isKeyDown("KeyD")&&(c-=.02),t.isKeyDown("KeyW")&&(f+=.02),t.isKeyDown("KeyS")&&(f-=.02);const h=t.isKeyDown("ShiftLeft")||t.isKeyDown("ShiftRight");if(h?(this.xVel+=-c,this.yVel+=-f):(this.txVel+=c,this.tyVel+=-f),this.xVel=s(this.xVel,2),this.yVel=s(this.yVel,2),0!==this.xVel||0!==this.yVel||0!==this.zVel||0!==this.txVel||0!==this.tyVel){const e=t.isDragging()||h?.92:.96;this.x+=-this.xVel/10,this.xVel*=e,this.y+=-this.yVel/10,this.yVel*=e,this.txVel*=e,this.tyVel*=e,this.z+=4*Math.max(Math.log(Math.abs(this.zVel)),0)*Math.sign(this.zVel),0===t.dz&&(this.zVel*=.85),this.z>-10&&(this.z=-10,this.zVel=0),n.vec3.set(a,this.camera.cameraMatrix[0],this.camera.cameraMatrix[1],this.camera.cameraMatrix[2]),n.vec3.scaleAndAdd(this.translation,this.translation,a,this.txVel),n.vec3.set(a,this.camera.cameraMatrix[4],this.camera.cameraMatrix[5],this.camera.cameraMatrix[6]),n.vec3.scaleAndAdd(this.translation,this.translation,a,this.tyVel);const r=a;!function(t,e,r){const n=Math.sin(r);t[0]=n*Math.cos(e),t[1]=Math.cos(r),t[2]=n*Math.sin(e)}(r,this.x,this.y),n.vec3.scale(r,r,this.z),n.vec3.add(r,r,this.translation),n.mat4.lookAt(this.camera.viewMatrix,r,this.translation,i),n.mat4.invert(this.camera.cameraMatrix,this.camera.viewMatrix),this.camera.viewMatrixUpdated()}return!1}}function s(t,e){return Math.max(-e,Math.min(t,e))}e.OrbitCameraController=u},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=n(r(0)),i=r(2),u=r(1);e.Compositor=class{constructor(t,e){this.canvas=t,this.gfxDevice=e}initialize(){for(let t in i.renderLists)i.renderLists[t].defaultDepthStateId=this.gfxDevice.createDepthStencilState(i.renderLists[t].defaultDepthState)}render(){this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(a.kDefaultRenderPass),function(t,e){const r=e.primitives.length;for(let n=0;n<r;n++){const r=e.primitives[n];if(t.bindPipeline(r.renderPipeline),t.bindResources(r.resourceTable),t.setCullMode(e.defaultCullMode),t.setDepthStencilState(e.defaultDepthStateId),u.defined(r.indexBuffer)){const e=r.indexType===a.Type.Ushort?2:4,n=u.defaultValue(r.indexBuffer.byteOffset,0)/e;t.draw(r.type,r.indexBuffer.bufferId,u.assertDefined(r.indexType),n,r.elementCount)}else t.drawNonIndexed(r.type,0,r.elementCount)}}(this.gfxDevice,i.renderLists.opaque),this.gfxDevice.endFrame();for(let t in i.renderLists)i.renderLists[t].primitives.length=0}resize(t,e,r){this.canvas.setAttribute("style",`width: ${t}px; height: ${e}px;`),this.canvas.width=t*r,this.canvas.height=e*r,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(13)),u=n(r(14)),s=r(3),o=a(r(0)),c=r(2),f=r(15);class h{constructor(){this.name="SimpleShader",this.vertSource=h.vert.sourceCode,this.fragSource=h.frag.sourceCode,this.resourceLayout=h.resourceLayout}}h.vert=i.default,h.frag=u.default,h.uniformLayout={u_color:{offset:0,type:o.Type.Float4}},h.resourceLayout={uniforms:{index:0,type:o.BindingType.UniformBuffer,layout:h.uniformLayout},globalUniforms:{index:1,type:o.BindingType.UniformBuffer,layout:s.GlobalUniforms.bufferLayout}};e.Demo=class{initialize({gfxDevice:t,globalUniforms:e}){const r={buffers:[{stride:12,layout:{a_pos:{type:o.Type.Float3,offset:0}}}]};this.shader=t.createShader(new h),this.pipeline=t.createRenderPipeline(this.shader,{blendingEnabled:!1},r,h.resourceLayout);const n=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]);this.vertexBuffer=t.createBuffer("PlaneVertices",o.BufferType.Vertex,o.Usage.Static,n),this.indexBuffer=t.createBuffer("PlaneIndices",o.BufferType.Index,o.Usage.Static,new Uint16Array([0,1,2,2,1,3]).buffer),this.uniformBuffer=new f.UniformBuffer("PlaneUniforms",t,h.uniformLayout),this.uniformBuffer.setFloats("u_color",new Float32Array([0,0,1,1])),this.uniformBuffer.write(t),this.resources=t.createResourceTable(this.pipeline),t.setBuffer(this.resources,this.vertexBuffer,0),t.setBuffer(this.resources,this.uniformBuffer.getBuffer(),0),t.setBuffer(this.resources,e.buffer,1)}update({}){}render({}){const t={renderPipeline:this.pipeline,resourceTable:this.resources,elementCount:6,indexBuffer:{bufferId:this.indexBuffer},indexType:o.Type.Ushort,type:o.PrimitiveType.Triangles};c.renderLists.opaque.push(t)}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;uniform mat4 g_viewProj;void main(){gl_Position=g_viewProj*vec4(a_pos,1.);}",uniforms:{g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"}},consts:{}}},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=n(r(0)),i=r(1);e.UniformBuffer=class{constructor(t,e,r){this.bufferSize=0,this.bufferLayout=r,this.bufferSize=0;const n=Object.keys(this.bufferLayout);for(let t=0;t<n.length;t++){const e=this.bufferLayout[n[t]];null==e.offset&&(e.offset=this.bufferSize),this.bufferSize=e.offset+a.TranslateTypeToSize(e.type)}this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.bufferView=new DataView(this.bufferData),this.buffer=e.createBuffer(t,a.BufferType.Uniform,a.Usage.Dynamic,this.bufferSize)}getBuffer(){return this.buffer}getBufferLayout(){return this.bufferLayout}setFloat(t,e){const r=i.assertDefined(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferView.setFloat32(r.offset,e,!0)}setVec2(t,e){const r=i.assertDefined(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferView.setFloat32(r.offset+0,e[0],!0),this.bufferView.setFloat32(r.offset+4,e[1],!0)}setVec3(t,e){const r=i.assertDefined(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferView.setFloat32(r.offset+0,e[0],!0),this.bufferView.setFloat32(r.offset+4,e[1],!0),this.bufferView.setFloat32(r.offset+8,e[2],!0)}setVec4(t,e){const r=i.assertDefined(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferView.setFloat32(r.offset+0,e[0],!0),this.bufferView.setFloat32(r.offset+4,e[1],!0),this.bufferView.setFloat32(r.offset+8,e[2],!0),this.bufferView.setFloat32(r.offset+12,e[3],!0)}setBytes(t,e){const r=this.bufferLayout[t];if(!r)throw new Error(`Attempted to set unknown uniform ${t}`);if(e.byteLength!==a.TranslateTypeToSize(r.type)*(r.count||1))throw new Error("Invalid size");this.bufferBytes.set(e,r.offset)}setFloats(t,e){const r=this.bufferLayout[t];if(!r)throw new Error(`Attempted to set unknown uniform ${t}`);if(e.byteLength!==a.TranslateTypeToSize(r.type)*(r.count||1))throw new Error("Invalid size");this.bufferFloats.set(e,r.offset/4)}getFloatArray(t){const e=this.bufferLayout[t];if(!e)throw new Error(`Attempted to set unknown uniform ${t}`);return new Float32Array(this.bufferData,e.offset,a.TranslateTypeToSize(e.type)/4)}write(t){t.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(t){t.removeBuffer(this.buffer)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.InputManager=class{constructor(){this.invertY=!1,this.invertX=!1,this.button=-1,this.onisdraggingchanged=null,this.listeners=[],this.scrollListeners=[],this.usePointerLock=!0,this.isInteractive=!0,this.touchGesture=0,this.prevTouchX=0,this.prevTouchY=0,this.prevPinchDist=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this._onKeyDown=t=>{if(function(t){switch(t){case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":return!0;default:return!1}}(t.code))t.preventDefault();else if(!this._hasFocus())return;this.keysDown.set(t.code,!t.repeat),this.callListeners()},this._onKeyUp=t=>{this.keysDown.delete(t.code),this.callListeners()},this._onBlur=()=>{this.keysDown.clear(),this.callListeners()},this._onWheel=t=>{t.preventDefault(),this.dz+=-4*Math.sign(t.deltaY),this.callScrollListeners()},this._onTouchChange=t=>{if(this.isInteractive)if(t.preventDefault(),1==t.touches.length){const e=this._getScaledTouches(t.touches);this.touchGesture=1,this.prevTouchX=e[0].x,this.prevTouchY=e[0].y,this.dTouchX=0,this.dTouchY=0}else if(2==t.touches.length){const e=this._getPinchValues(t.touches);this.touchGesture=2,this.prevTouchX=e.x,this.prevTouchY=e.y,this.prevPinchDist=e.dist,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0}else this.touchGesture=0},this._onTouchMove=t=>{if(this.isInteractive)if(t.preventDefault(),1==t.touches.length){const e=this._getScaledTouches(t.touches);this.touchGesture=1,this.dTouchX=e[0].x-this.prevTouchX,this.dTouchY=e[0].y-this.prevTouchY,this.onMotion(this.dTouchX,this.dTouchY),this.prevTouchX=e[0].x,this.prevTouchY=e[0].y}else if(2==t.touches.length){const e=this._getPinchValues(t.touches);this.touchGesture=2,this.dTouchX=e.x-this.prevTouchX,this.dTouchY=e.y-this.prevTouchY,this.dPinchDist=e.dist-this.prevPinchDist,this.prevTouchX=e.x,this.prevTouchY=e.y,this.prevPinchDist=e.dist}else this.touchGesture=0}}initialize({toplevel:t}){document.body.tabIndex=-1,this.toplevel=t,this.toplevel.tabIndex=-1,this.keysDown=new Map,document.addEventListener("keydown",this._onKeyDown,{capture:!0}),document.addEventListener("keyup",this._onKeyUp,{capture:!0}),window.addEventListener("blur",this._onBlur),this.toplevel.addEventListener("wheel",this._onWheel,{passive:!1}),this.toplevel.addEventListener("mousedown",t=>{this.isInteractive&&(this.button=t.button,a.takeGrab(this,t,{takePointerLock:this.usePointerLock,useGrabbingCursor:!0,releaseOnMouseUp:!0}),null!==this.onisdraggingchanged&&this.onisdraggingchanged())}),this.toplevel.addEventListener("touchstart",this._onTouchChange),this.toplevel.addEventListener("touchend",this._onTouchChange),this.toplevel.addEventListener("touchcancel",this._onTouchChange),this.toplevel.addEventListener("touchmove",this._onTouchMove),this.afterFrame()}addListener(t){this.listeners.push(t)}addScrollListener(t){this.scrollListeners.push(t)}getMouseDeltaX(){return this.dx}getMouseDeltaY(){return this.dy}getTouchDeltaX(){return 2==this.touchGesture?this.dTouchX:0}getTouchDeltaY(){return 2==this.touchGesture?this.dTouchY:0}getPinchDeltaDist(){return 2==this.touchGesture?this.dPinchDist:0}isKeyDownEventTriggered(t){return!!this.keysDown.get(t)}isKeyDown(t){return this.keysDown.has(t)}isDragging(){return 0!=this.touchGesture||a.hasGrabListener(this)}afterFrame(){this.dx=0,this.dy=0,this.dz=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this.keysDown.forEach((t,e)=>{this.keysDown.set(e,!1)})}focusViewer(){this.toplevel.focus()}_hasFocus(){return document.activeElement===document.body||document.activeElement===this.toplevel}callListeners(){for(let t=0;t<this.listeners.length;t++)this.listeners[t](this)}callScrollListeners(){for(let t=0;t<this.scrollListeners.length;t++)this.scrollListeners[t](this)}_getScaledTouches(t){const e=[],r=1e3/Math.max(1,Math.min(this.toplevel.clientWidth,this.toplevel.clientHeight));for(let n=0;n<t.length;n++)e.push({x:t[n].clientX*r,y:t[n].clientY*r});return e}_getPinchValues(t){const e=this._getScaledTouches(t);return{x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2,dist:Math.hypot(e[0].x-e[1].x,e[0].y-e[1].y)}}onMotion(t,e){this.dx+=t,this.dy+=e}onGrabReleased(){this.button=-1,null!==this.onisdraggingchanged&&this.onisdraggingchanged()}};e.GlobalCursorOverride=new class{constructor(){this.styleElem=document.createElement("style"),document.head.appendChild(this.styleElem),this.style=this.styleElem.sheet}setCursor(t){if(this.style.cssRules.length&&this.style.deleteRule(0),t){const e=`* { ${t.map(t=>`cursor: ${t} !important;`).join(" ")} }`;this.style.insertRule(e,0)}}};class n{constructor(){this.grabListener=null,this.grabOptions=null,this.lastX=-1,this.lastY=-1,this._onMouseMove=t=>{if(null===this.grabListener)return;let e,r;void 0!==t.movementX?(e=t.movementX,r=t.movementY):(e=t.pageX-this.lastX,r=t.pageY-this.lastY,this.lastX=t.pageX,this.lastY=t.pageY),this.grabListener.onMotion(e,r)},this._onMouseDown=t=>{const e=this.grabOptions.grabElement;e&&!function(t,e){let r=t;for(;null!==r;){if(r===e)return!0;r=r.parentElement}return!1}(t.target,e)&&this.releaseGrab()},this._onMouseUp=t=>{this.releaseGrab()}}hasGrabListener(t){return this.grabListener===t}isGrabbed(){return null!==this.grabListener}takeGrab(t,r,n){if(null!==this.grabListener)return;this.grabListener=t,this.grabOptions=n,n.useGrabbingCursor&&e.GlobalCursorOverride.setCursor(["grabbing","-webkit-grabbing"]),this.lastX=r.pageX,this.lastY=r.pageY,document.body.focus(),r.preventDefault();const a=r.target;n.takePointerLock&&void 0!==a.requestPointerLock&&a.requestPointerLock(),document.addEventListener("mousemove",this._onMouseMove),n.releaseOnMouseUp?document.addEventListener("mouseup",this._onMouseUp):document.addEventListener("mousedown",this._onMouseDown,{capture:!0})}releaseGrab(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousedown",this._onMouseDown,{capture:!0}),void 0!==document.exitPointerLock&&document.exitPointerLock(),e.GlobalCursorOverride.setCursor(null);const t=this.grabListener;this.grabListener=null,t.onGrabReleased(),this.grabOptions=null}}e.GrabManager=n;const a=new n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=n(r(18)),i=r(4),u=r(19),s=r(1),o={texture:new u.TextureLoader};e.ResourceManager=class{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(t){this.worker=new a.default,this.worker.onmessage=t=>this.onMessage(t),this.context={renderer:t}}onMessage(t){this.messages.push(t)}load(t,e,r){if(!s.defined(o[e]))return void r("Invalid resource type",void 0);const n="string"==typeof t?t:t.uri,a="string"==typeof t?void 0:t.headers,u=n+e;if(s.defined(this.cache[u]))r(void 0,this.cache[u]);else if(this.requests[u])this.requests[u].push(r);else{this.requests[u]=[r];const t={source:{uri:n,headers:a,type:e},status:i.ResourceStatus.LoadingAsync,transferList:[]};this.worker.postMessage([t])}}unload(t,e){const r=("string"==typeof t?t:t.uri)+e;if(s.defined(this.cache[r])){const t=this.cache[r];o[t.source.type].unloadSync(this.context,t),delete this.cache[r]}else{if(!this.requests[r])throw new Error(`Attempted to unload a resource that was never loaded: ${r}`);delete this.requests[r]}}update(){for(let t of this.messages)Array.prototype.push.apply(this.pending,t.data);for(let t of this.pending){const e=t.source.uri+t.source.type;if(s.defined(this.requests[e])||(t.status=i.ResourceStatus.Unloaded),t.status===i.ResourceStatus.LoadingSync){o[t.source.type].loadSync(this.context,t)}switch(t.status){case i.ResourceStatus.Loaded:case i.ResourceStatus.Failed:this.finished.push(t);break;case i.ResourceStatus.Unloaded:this.unloaded.push(t);break;case i.ResourceStatus.LoadingAsync:this.loadingAsync.push(t);break;case i.ResourceStatus.LoadingSync:this.loadingSync.push(t)}}this.pending.length=0;for(let t of this.finished){const e=t.source.uri+t.source.type,r=s.assertDefined(this.requests[e]).length;s.assert(r>=1),this.cache[e]=t;for(let n=0;n<r;n++)t.status===i.ResourceStatus.Failed?this.requests[e][n](t.error,void 0):this.requests[e][n](void 0,t);delete this.requests[e]}const t=[];for(let e of this.loadingAsync)Array.prototype.push.apply(t,e.transferList);this.worker.postMessage(this.loadingAsync,t);for(let t of this.unloaded){o[t.source.type].unloadSync(this.context,t)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}},function(t,e,r){t.exports=function(){return new Worker(r.p+"ResourceLoading.worker.768969d6bb2d5437133f.js")}},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});const a=r(4),i=n(r(0)),u=r(1);e.TextureLoader=class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download image");const r=t.source.uri.match(/.*\/(.+?)\./);t.name=r&&r.length>1?r[1]:"Unknown",self.createImageBitmap?(t.imageBitmap=await createImageBitmap(await e.blob()),t.transferList.push(t.imageBitmap),t.status=a.ResourceStatus.LoadingSync):(t.imageBuffer=await e.arrayBuffer(),t.transferList.push(t.imageBuffer),t.status=a.ResourceStatus.LoadingSync)}loadSync(t,e){if(e.imageBitmap)e.texture=t.renderer.createTexture(e.name,{usage:i.Usage.Static,type:i.TextureType.Texture2D,format:i.TexelFormat.U8x3,maxAnistropy:16},e.imageBitmap),e.imageBitmap.close(),delete e.imageBitmap,e.status=a.ResourceStatus.Loaded;else{if(e.imageBuffer){var r=new Blob([e.imageBuffer],{type:"image/jpeg"});let t=window.URL.createObjectURL(r);delete e.imageBuffer,e.imageElement=new Image,e.imageElement.src=t,e.status=a.ResourceStatus.LoadingSync}u.defined(e.imageElement)&&e.imageElement.complete&&(e.texture=t.renderer.createTexture(e.name,{usage:i.Usage.Static,type:i.TextureType.Texture2D,format:i.TexelFormat.U8x3,maxAnistropy:16},e.imageElement),delete e.imageElement,e.status=a.ResourceStatus.Loaded)}}unloadSync(t,e){u.defined(e.texture)&&t.renderer.removeTexture(e.texture),u.defined(e.imageBitmap)&&e.imageBitmap.close()}}}]);