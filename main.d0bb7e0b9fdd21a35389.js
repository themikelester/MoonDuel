!function(t){function e(e){for(var n,i,s=e[0],o=e[1],a=0,u=[];a<s.length;a++)i=s[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);for(c&&c(e);u.length;)u.shift()()}var n={},r={0:0,1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var s=new Promise((function(e,i){n=r[t]=[e,i]}));e.push(n[2]=s);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(t){return i.p+""+({2:"vendors~dat-gui"}[t]||t)+"."+{2:"dd338b768f90ff8ffa71"}[t]+".js"}(t);var c=new Error;o=function(e){a.onerror=a.onload=null,clearTimeout(u);var n=r[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",c.name="ChunkLoadError",c.type=i,c.request=s,n[1](c)}r[t]=void 0}};var u=setTimeout((function(){o({type:"timeout",target:a})}),12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=e,s=s.slice();for(var a=0;a<s.length;a++)e(s[a]);var c=o;i(i.s=98)}([function(t,e,n){"use strict";function r(t,e=""){if(!t){const t=new Error(`Assert fail: ${e}`);throw console.error(t.stack),t}}function i(t,e){if(null!=t)return t;throw new Error(o(e,"Missing object"))}function s(t){return null!=t}function o(t,e){return null!=t?t:e}function a(t,e){const n=t.indexOf(e);return r(n>=0),t.splice(n,1),n}n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return a}))},function(t,e,n){"use strict";n.d(e,"p",(function(){return r})),n.d(e,"q",(function(){return i})),n.d(e,"r",(function(){return s})),n.d(e,"o",(function(){return o})),n.d(e,"f",(function(){return a})),n.d(e,"m",(function(){return c})),n.d(e,"k",(function(){return u})),n.d(e,"i",(function(){return h})),n.d(e,"j",(function(){return l})),n.d(e,"d",(function(){return f})),n.d(e,"g",(function(){return d})),n.d(e,"c",(function(){return p})),n.d(e,"a",(function(){return m})),n.d(e,"n",(function(){return g})),n.d(e,"e",(function(){return y})),n.d(e,"b",(function(){return b})),n.d(e,"h",(function(){return v})),n.d(e,"l",(function(){return w}));const r=16,i=64,s=16,o=0;var a,c,u,h,l,f,d,p,m,g,y,b,v;function w(t){switch(t){case c.Float:return 4;case c.Float2:return 8;case c.Float3:return 12;case c.Float4:return 16;case c.Int:return 4;case c.Int2:return 8;case c.Int3:return 12;case c.Int4:return 16;case c.Uint:return 4;case c.Uint2:return 8;case c.Uint3:return 12;case c.Uint4:return 16;case c.Short:return 2;case c.Short2:return 4;case c.Short3:return 6;case c.Short4:return 8;case c.Ushort:return 2;case c.Ushort2:return 4;case c.Ushort3:return 6;case c.Ushort4:return 8;case c.Char:return 1;case c.Char2:return 2;case c.Char3:return 3;case c.Char4:return 4;case c.Uchar:return 1;case c.Uchar2:return 2;case c.Uchar3:return 3;case c.Uchar4:return 4;case c.Half:return 2;case c.Half2:return 4;case c.Half3:return 6;case c.Half4:return 8;case c.Float3x3:return 36;case c.Float4x4:return 64;default:throw new Error(`Unsupported type: ${t}`)}}!function(t){t[t.VertexArrayObject=1]="VertexArrayObject",t[t.TextureFloat=2]="TextureFloat",t[t.TextureHalf=4]="TextureHalf",t[t.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",t[t.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",t[t.TextureWrite=32]="TextureWrite",t[t.ShaderDerivatives=64]="ShaderDerivatives",t[t.Instancing=128]="Instancing",t[t.AnistropicFiltering=256]="AnistropicFiltering",t[t.ShaderGlsl100=512]="ShaderGlsl100",t[t.ShaderGlsl300=1024]="ShaderGlsl300"}(a||(a={})),function(t){t[t.Undefined=0]="Undefined",t[t.Float=1]="Float",t[t.Float2=2]="Float2",t[t.Float3=3]="Float3",t[t.Float4=4]="Float4",t[t.Int=5]="Int",t[t.Int2=6]="Int2",t[t.Int3=7]="Int3",t[t.Int4=8]="Int4",t[t.Uint=9]="Uint",t[t.Uint2=10]="Uint2",t[t.Uint3=11]="Uint3",t[t.Uint4=12]="Uint4",t[t.Short=13]="Short",t[t.Short2=14]="Short2",t[t.Short3=15]="Short3",t[t.Short4=16]="Short4",t[t.Ushort=17]="Ushort",t[t.Ushort2=18]="Ushort2",t[t.Ushort3=19]="Ushort3",t[t.Ushort4=20]="Ushort4",t[t.Char=21]="Char",t[t.Char2=22]="Char2",t[t.Char3=23]="Char3",t[t.Char4=24]="Char4",t[t.Uchar=25]="Uchar",t[t.Uchar2=26]="Uchar2",t[t.Uchar3=27]="Uchar3",t[t.Uchar4=28]="Uchar4",t[t.Half=29]="Half",t[t.Half2=30]="Half2",t[t.Half3=31]="Half3",t[t.Half4=32]="Half4",t[t.Float3x3=33]="Float3x3",t[t.Float3x4=34]="Float3x4",t[t.Float4x4=35]="Float4x4",t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube",t[t.Short_Norm=256]="Short_Norm",t[t.Short2_Norm=257]="Short2_Norm",t[t.Short3_Norm=258]="Short3_Norm",t[t.Short4_Norm=259]="Short4_Norm",t[t.Ushort_Norm=260]="Ushort_Norm",t[t.Ushort2_Norm=261]="Ushort2_Norm",t[t.Ushort3_Norm=262]="Ushort3_Norm",t[t.Ushort4_Norm=263]="Ushort4_Norm",t[t.Char_Norm=264]="Char_Norm",t[t.Char2_Norm=265]="Char2_Norm",t[t.Char3_Norm=266]="Char3_Norm",t[t.Char4_Norm=267]="Char4_Norm",t[t.Uchar_Norm=268]="Uchar_Norm",t[t.Uchar2_Norm=269]="Uchar2_Norm",t[t.Uchar3_Norm=270]="Uchar3_Norm",t[t.Uchar4_Norm=271]="Uchar4_Norm"}(c||(c={})),function(t){t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube"}(u||(u={})),function(t){t[t.Undefined=0]="Undefined",t[t.U565=1]="U565",t[t.U8=2]="U8",t[t.U8_sRGB=3]="U8_sRGB",t[t.U8x2=4]="U8x2",t[t.U8x2_sRGB=5]="U8x2_sRGB",t[t.U8x3=6]="U8x3",t[t.U8x3_sRGB=7]="U8x3_sRGB",t[t.U8x4=8]="U8x4",t[t.U8x4_sRGB=9]="U8x4_sRGB",t[t.U10_10_10_2=10]="U10_10_10_2",t[t.F11_11_10=11]="F11_11_10",t[t.F16=12]="F16",t[t.F16x2=13]="F16x2",t[t.F16x3=14]="F16x3",t[t.F16x4=15]="F16x4",t[t.F32x2=16]="F32x2",t[t.F32x3=17]="F32x3",t[t.F32x4=18]="F32x4",t[t.Depth32=19]="Depth32",t[t.Depth24Stencil8=20]="Depth24Stencil8"}(h||(h={})),function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(l||(l={})),function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"}(f||(f={})),function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"}(d||(d={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uniform=1]="Uniform",t[t.Vertex=2]="Vertex",t[t.Index=3]="Index",t[t.Readback=4]="Readback"}(p||(p={})),function(t){t[t.Undefined=0]="Undefined",t[t.UniformBuffer=1]="UniformBuffer",t[t.Texture=2]="Texture"}(m||(m={})),function(t){t[t.None=0]="None",t[t.Static=1]="Static",t[t.Dynamic=2]="Dynamic"}(g||(g={})),function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Front=2]="Front"}(y||(y={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Source=2]="Source",t[t.OneMinusSource=3]="OneMinusSource"}(b||(b={})),function(t){t[t.Vertex=0]="Vertex",t[t.Instance=1]="Instance"}(v||(v={}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return o}));var r={};n.r(r),n.d(r,"create",(function(){return l})),n.d(r,"fromMat4",(function(){return f})),n.d(r,"clone",(function(){return d})),n.d(r,"copy",(function(){return p})),n.d(r,"fromValues",(function(){return m})),n.d(r,"set",(function(){return g})),n.d(r,"identity",(function(){return y})),n.d(r,"transpose",(function(){return b})),n.d(r,"invert",(function(){return v})),n.d(r,"adjoint",(function(){return w})),n.d(r,"determinant",(function(){return x})),n.d(r,"multiply",(function(){return _})),n.d(r,"translate",(function(){return C})),n.d(r,"rotate",(function(){return M})),n.d(r,"scale",(function(){return A})),n.d(r,"fromTranslation",(function(){return k})),n.d(r,"fromRotation",(function(){return T})),n.d(r,"fromScaling",(function(){return S})),n.d(r,"fromMat2d",(function(){return F})),n.d(r,"fromQuat",(function(){return E})),n.d(r,"normalFromMat4",(function(){return O})),n.d(r,"projection",(function(){return j})),n.d(r,"str",(function(){return I})),n.d(r,"frob",(function(){return R})),n.d(r,"add",(function(){return B})),n.d(r,"subtract",(function(){return U})),n.d(r,"multiplyScalar",(function(){return D})),n.d(r,"multiplyScalarAndAdd",(function(){return P})),n.d(r,"exactEquals",(function(){return N})),n.d(r,"equals",(function(){return L})),n.d(r,"mul",(function(){return z})),n.d(r,"sub",(function(){return V}));var i={};n.r(i),n.d(i,"create",(function(){return q})),n.d(i,"clone",(function(){return W})),n.d(i,"copy",(function(){return H})),n.d(i,"fromValues",(function(){return G})),n.d(i,"set",(function(){return Y})),n.d(i,"identity",(function(){return X})),n.d(i,"transpose",(function(){return $})),n.d(i,"invert",(function(){return K})),n.d(i,"adjoint",(function(){return J})),n.d(i,"determinant",(function(){return Z})),n.d(i,"multiply",(function(){return Q})),n.d(i,"translate",(function(){return tt})),n.d(i,"scale",(function(){return et})),n.d(i,"rotate",(function(){return nt})),n.d(i,"rotateX",(function(){return rt})),n.d(i,"rotateY",(function(){return it})),n.d(i,"rotateZ",(function(){return st})),n.d(i,"fromTranslation",(function(){return ot})),n.d(i,"fromScaling",(function(){return at})),n.d(i,"fromRotation",(function(){return ct})),n.d(i,"fromXRotation",(function(){return ut})),n.d(i,"fromYRotation",(function(){return ht})),n.d(i,"fromZRotation",(function(){return lt})),n.d(i,"fromRotationTranslation",(function(){return ft})),n.d(i,"fromQuat2",(function(){return dt})),n.d(i,"getTranslation",(function(){return pt})),n.d(i,"getScaling",(function(){return mt})),n.d(i,"getRotation",(function(){return gt})),n.d(i,"fromRotationTranslationScale",(function(){return yt})),n.d(i,"fromRotationTranslationScaleOrigin",(function(){return bt})),n.d(i,"fromQuat",(function(){return vt})),n.d(i,"frustum",(function(){return wt})),n.d(i,"perspective",(function(){return xt})),n.d(i,"perspectiveFromFieldOfView",(function(){return _t})),n.d(i,"ortho",(function(){return Ct})),n.d(i,"lookAt",(function(){return Mt})),n.d(i,"targetTo",(function(){return At})),n.d(i,"str",(function(){return kt})),n.d(i,"frob",(function(){return Tt})),n.d(i,"add",(function(){return St})),n.d(i,"subtract",(function(){return Ft})),n.d(i,"multiplyScalar",(function(){return Et})),n.d(i,"multiplyScalarAndAdd",(function(){return Ot})),n.d(i,"exactEquals",(function(){return jt})),n.d(i,"equals",(function(){return It})),n.d(i,"mul",(function(){return Rt})),n.d(i,"sub",(function(){return Bt}));var s={};n.r(s),n.d(s,"create",(function(){return Ut})),n.d(s,"clone",(function(){return Dt})),n.d(s,"length",(function(){return Pt})),n.d(s,"fromValues",(function(){return Nt})),n.d(s,"copy",(function(){return Lt})),n.d(s,"set",(function(){return zt})),n.d(s,"add",(function(){return Vt})),n.d(s,"subtract",(function(){return qt})),n.d(s,"multiply",(function(){return Wt})),n.d(s,"divide",(function(){return Ht})),n.d(s,"ceil",(function(){return Gt})),n.d(s,"floor",(function(){return Yt})),n.d(s,"min",(function(){return Xt})),n.d(s,"max",(function(){return $t})),n.d(s,"round",(function(){return Kt})),n.d(s,"scale",(function(){return Jt})),n.d(s,"scaleAndAdd",(function(){return Zt})),n.d(s,"distance",(function(){return Qt})),n.d(s,"squaredDistance",(function(){return te})),n.d(s,"squaredLength",(function(){return ee})),n.d(s,"negate",(function(){return ne})),n.d(s,"inverse",(function(){return re})),n.d(s,"normalize",(function(){return ie})),n.d(s,"dot",(function(){return se})),n.d(s,"cross",(function(){return oe})),n.d(s,"lerp",(function(){return ae})),n.d(s,"hermite",(function(){return ce})),n.d(s,"bezier",(function(){return ue})),n.d(s,"random",(function(){return he})),n.d(s,"transformMat4",(function(){return le})),n.d(s,"transformMat3",(function(){return fe})),n.d(s,"transformQuat",(function(){return de})),n.d(s,"rotateX",(function(){return pe})),n.d(s,"rotateY",(function(){return me})),n.d(s,"rotateZ",(function(){return ge})),n.d(s,"angle",(function(){return ye})),n.d(s,"zero",(function(){return be})),n.d(s,"str",(function(){return ve})),n.d(s,"exactEquals",(function(){return we})),n.d(s,"equals",(function(){return xe})),n.d(s,"sub",(function(){return Ce})),n.d(s,"mul",(function(){return Me})),n.d(s,"div",(function(){return Ae})),n.d(s,"dist",(function(){return ke})),n.d(s,"sqrDist",(function(){return Te})),n.d(s,"len",(function(){return Se})),n.d(s,"sqrLen",(function(){return Fe})),n.d(s,"forEach",(function(){return Ee}));var o={};n.r(o),n.d(o,"create",(function(){return Oe})),n.d(o,"clone",(function(){return je})),n.d(o,"fromValues",(function(){return Ie})),n.d(o,"copy",(function(){return Re})),n.d(o,"set",(function(){return Be})),n.d(o,"add",(function(){return Ue})),n.d(o,"subtract",(function(){return De})),n.d(o,"multiply",(function(){return Pe})),n.d(o,"divide",(function(){return Ne})),n.d(o,"ceil",(function(){return Le})),n.d(o,"floor",(function(){return ze})),n.d(o,"min",(function(){return Ve})),n.d(o,"max",(function(){return qe})),n.d(o,"round",(function(){return We})),n.d(o,"scale",(function(){return He})),n.d(o,"scaleAndAdd",(function(){return Ge})),n.d(o,"distance",(function(){return Ye})),n.d(o,"squaredDistance",(function(){return Xe})),n.d(o,"length",(function(){return $e})),n.d(o,"squaredLength",(function(){return Ke})),n.d(o,"negate",(function(){return Je})),n.d(o,"inverse",(function(){return Ze})),n.d(o,"normalize",(function(){return Qe})),n.d(o,"dot",(function(){return tn})),n.d(o,"cross",(function(){return en})),n.d(o,"lerp",(function(){return nn})),n.d(o,"random",(function(){return rn})),n.d(o,"transformMat4",(function(){return sn})),n.d(o,"transformQuat",(function(){return on})),n.d(o,"zero",(function(){return an})),n.d(o,"str",(function(){return cn})),n.d(o,"exactEquals",(function(){return un})),n.d(o,"equals",(function(){return hn})),n.d(o,"sub",(function(){return ln})),n.d(o,"mul",(function(){return fn})),n.d(o,"div",(function(){return dn})),n.d(o,"dist",(function(){return pn})),n.d(o,"sqrDist",(function(){return mn})),n.d(o,"len",(function(){return gn})),n.d(o,"sqrLen",(function(){return yn})),n.d(o,"forEach",(function(){return bn}));var a={};n.r(a),n.d(a,"create",(function(){return vn})),n.d(a,"identity",(function(){return wn})),n.d(a,"setAxisAngle",(function(){return xn})),n.d(a,"getAxisAngle",(function(){return _n})),n.d(a,"getAngle",(function(){return Cn})),n.d(a,"multiply",(function(){return Mn})),n.d(a,"rotateX",(function(){return An})),n.d(a,"rotateY",(function(){return kn})),n.d(a,"rotateZ",(function(){return Tn})),n.d(a,"calculateW",(function(){return Sn})),n.d(a,"exp",(function(){return Fn})),n.d(a,"ln",(function(){return En})),n.d(a,"pow",(function(){return On})),n.d(a,"slerp",(function(){return jn})),n.d(a,"random",(function(){return In})),n.d(a,"invert",(function(){return Rn})),n.d(a,"conjugate",(function(){return Bn})),n.d(a,"fromMat3",(function(){return Un})),n.d(a,"fromEuler",(function(){return Dn})),n.d(a,"str",(function(){return Pn})),n.d(a,"clone",(function(){return Hn})),n.d(a,"fromValues",(function(){return Gn})),n.d(a,"copy",(function(){return Yn})),n.d(a,"set",(function(){return Xn})),n.d(a,"add",(function(){return $n})),n.d(a,"mul",(function(){return Kn})),n.d(a,"scale",(function(){return Jn})),n.d(a,"dot",(function(){return Zn})),n.d(a,"lerp",(function(){return Qn})),n.d(a,"length",(function(){return tr})),n.d(a,"len",(function(){return er})),n.d(a,"squaredLength",(function(){return nr})),n.d(a,"sqrLen",(function(){return rr})),n.d(a,"normalize",(function(){return ir})),n.d(a,"exactEquals",(function(){return sr})),n.d(a,"equals",(function(){return or})),n.d(a,"rotationTo",(function(){return ar})),n.d(a,"sqlerp",(function(){return cr})),n.d(a,"setAxes",(function(){return ur}));var c=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,h=Math.random;Math.PI;function l(){var t=new u(9);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function f(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function d(t){var e=new u(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function p(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function m(t,e,n,r,i,s,o,a,c){var h=new u(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=i,h[5]=s,h[6]=o,h[7]=a,h[8]=c,h}function g(t,e,n,r,i,s,o,a,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=c,t[8]=u,t}function y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function b(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function v(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=h*o-a*u,f=-h*s+a*c,d=u*s-o*c,p=n*l+r*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-h*r+i*u)*p,t[2]=(a*r-i*o)*p,t[3]=f*p,t[4]=(h*n-i*c)*p,t[5]=(-a*n+i*s)*p,t[6]=d*p,t[7]=(-u*n+r*c)*p,t[8]=(o*n-r*s)*p,t):null}function w(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8];return t[0]=o*h-a*u,t[1]=i*u-r*h,t[2]=r*a-i*o,t[3]=a*c-s*h,t[4]=n*h-i*c,t[5]=i*s-n*a,t[6]=s*u-o*c,t[7]=r*c-n*u,t[8]=n*o-r*s,t}function x(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8];return e*(u*s-o*c)+n*(-u*i+o*a)+r*(c*i-s*a)}function _(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=n[0],d=n[1],p=n[2],m=n[3],g=n[4],y=n[5],b=n[6],v=n[7],w=n[8];return t[0]=f*r+d*o+p*u,t[1]=f*i+d*a+p*h,t[2]=f*s+d*c+p*l,t[3]=m*r+g*o+y*u,t[4]=m*i+g*a+y*h,t[5]=m*s+g*c+y*l,t[6]=b*r+v*o+w*u,t[7]=b*i+v*a+w*h,t[8]=b*s+v*c+w*l,t}function C(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=f*r+d*o+u,t[7]=f*i+d*a+h,t[8]=f*s+d*c+l,t}function M(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*r+f*o,t[1]=d*i+f*a,t[2]=d*s+f*c,t[3]=d*o-f*r,t[4]=d*a-f*i,t[5]=d*c-f*s,t[6]=u,t[7]=h,t[8]=l,t}function A(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function k(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function T(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function S(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function F(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function E(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,h=r*o,l=r*a,f=i*o,d=i*a,p=i*c,m=s*o,g=s*a,y=s*c;return t[0]=1-l-p,t[3]=h-y,t[6]=f+g,t[1]=h+y,t[4]=1-u-p,t[7]=d-m,t[2]=f-g,t[5]=d+m,t[8]=1-u-l,t}function O(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],b=n*a-r*o,v=n*c-i*o,w=n*u-s*o,x=r*c-i*a,_=r*u-s*a,C=i*u-s*c,M=h*m-l*p,A=h*g-f*p,k=h*y-d*p,T=l*g-f*m,S=l*y-d*m,F=f*y-d*g,E=b*F-v*S+w*T+x*k-_*A+C*M;return E?(E=1/E,t[0]=(a*F-c*S+u*T)*E,t[1]=(c*k-o*F-u*A)*E,t[2]=(o*S-a*k+u*M)*E,t[3]=(i*S-r*F-s*T)*E,t[4]=(n*F-i*k+s*A)*E,t[5]=(r*k-n*S-s*M)*E,t[6]=(m*C-g*_+y*x)*E,t[7]=(g*w-p*C-y*v)*E,t[8]=(p*_-m*w+y*b)*E,t):null}function j(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function I(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function R(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function B(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function U(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function D(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function P(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function N(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function L(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],h=t[7],l=t[8],f=e[0],d=e[1],p=e[2],m=e[3],g=e[4],y=e[5],b=e[6],v=e[7],w=e[8];return Math.abs(n-f)<=c*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=c*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=c*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-m)<=c*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-g)<=c*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-y)<=c*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-b)<=c*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=c*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-w)<=c*Math.max(1,Math.abs(l),Math.abs(w))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var z=_,V=U;function q(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function W(t){var e=new u(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function H(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function G(t,e,n,r,i,s,o,a,c,h,l,f,d,p,m,g){var y=new u(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=i,y[5]=s,y[6]=o,y[7]=a,y[8]=c,y[9]=h,y[10]=l,y[11]=f,y[12]=d,y[13]=p,y[14]=m,y[15]=g,y}function Y(t,e,n,r,i,s,o,a,c,u,h,l,f,d,p,m,g){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=c,t[8]=u,t[9]=h,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g,t}function X(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function K(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15],b=n*a-r*o,v=n*c-i*o,w=n*u-s*o,x=r*c-i*a,_=r*u-s*a,C=i*u-s*c,M=h*m-l*p,A=h*g-f*p,k=h*y-d*p,T=l*g-f*m,S=l*y-d*m,F=f*y-d*g,E=b*F-v*S+w*T+x*k-_*A+C*M;return E?(E=1/E,t[0]=(a*F-c*S+u*T)*E,t[1]=(i*S-r*F-s*T)*E,t[2]=(m*C-g*_+y*x)*E,t[3]=(f*_-l*C-d*x)*E,t[4]=(c*k-o*F-u*A)*E,t[5]=(n*F-i*k+s*A)*E,t[6]=(g*w-p*C-y*v)*E,t[7]=(h*C-f*w+d*v)*E,t[8]=(o*S-a*k+u*M)*E,t[9]=(r*k-n*S-s*M)*E,t[10]=(p*_-m*w+y*b)*E,t[11]=(l*w-h*_-d*b)*E,t[12]=(a*A-o*T-c*M)*E,t[13]=(n*T-r*A+i*M)*E,t[14]=(m*v-p*x-g*b)*E,t[15]=(h*x-l*v+f*b)*E,t):null}function J(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],y=e[15];return t[0]=a*(f*y-d*g)-l*(c*y-u*g)+m*(c*d-u*f),t[1]=-(r*(f*y-d*g)-l*(i*y-s*g)+m*(i*d-s*f)),t[2]=r*(c*y-u*g)-a*(i*y-s*g)+m*(i*u-s*c),t[3]=-(r*(c*d-u*f)-a*(i*d-s*f)+l*(i*u-s*c)),t[4]=-(o*(f*y-d*g)-h*(c*y-u*g)+p*(c*d-u*f)),t[5]=n*(f*y-d*g)-h*(i*y-s*g)+p*(i*d-s*f),t[6]=-(n*(c*y-u*g)-o*(i*y-s*g)+p*(i*u-s*c)),t[7]=n*(c*d-u*f)-o*(i*d-s*f)+h*(i*u-s*c),t[8]=o*(l*y-d*m)-h*(a*y-u*m)+p*(a*d-u*l),t[9]=-(n*(l*y-d*m)-h*(r*y-s*m)+p*(r*d-s*l)),t[10]=n*(a*y-u*m)-o*(r*y-s*m)+p*(r*u-s*a),t[11]=-(n*(a*d-u*l)-o*(r*d-s*l)+h*(r*u-s*a)),t[12]=-(o*(l*g-f*m)-h*(a*g-c*m)+p*(a*f-c*l)),t[13]=n*(l*g-f*m)-h*(r*g-i*m)+p*(r*f-i*l),t[14]=-(n*(a*g-c*m)-o*(r*g-i*m)+p*(r*c-i*a)),t[15]=n*(a*f-c*l)-o*(r*f-i*l)+h*(r*c-i*a),t}function Z(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8],h=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15];return(e*o-n*s)*(l*g-f*m)-(e*a-r*s)*(h*g-f*p)+(e*c-i*s)*(h*m-l*p)+(n*a-r*o)*(u*g-f*d)-(n*c-i*o)*(u*m-l*d)+(r*c-i*a)*(u*p-h*d)}function Q(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],b=e[15],v=n[0],w=n[1],x=n[2],_=n[3];return t[0]=v*r+w*a+x*l+_*m,t[1]=v*i+w*c+x*f+_*g,t[2]=v*s+w*u+x*d+_*y,t[3]=v*o+w*h+x*p+_*b,v=n[4],w=n[5],x=n[6],_=n[7],t[4]=v*r+w*a+x*l+_*m,t[5]=v*i+w*c+x*f+_*g,t[6]=v*s+w*u+x*d+_*y,t[7]=v*o+w*h+x*p+_*b,v=n[8],w=n[9],x=n[10],_=n[11],t[8]=v*r+w*a+x*l+_*m,t[9]=v*i+w*c+x*f+_*g,t[10]=v*s+w*u+x*d+_*y,t[11]=v*o+w*h+x*p+_*b,v=n[12],w=n[13],x=n[14],_=n[15],t[12]=v*r+w*a+x*l+_*m,t[13]=v*i+w*c+x*f+_*g,t[14]=v*s+w*u+x*d+_*y,t[15]=v*o+w*h+x*p+_*b,t}function tt(t,e,n){var r,i,s,o,a,c,u,h,l,f,d,p,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=u,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=r*m+a*g+l*y+e[12],t[13]=i*m+c*g+f*y+e[13],t[14]=s*m+u*g+d*y+e[14],t[15]=o*m+h*g+p*y+e[15]),t}function et(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function nt(t,e,n,r){var i,s,o,a,u,h,l,f,d,p,m,g,y,b,v,w,x,_,C,M,A,k,T,S,F=r[0],E=r[1],O=r[2],j=Math.hypot(F,E,O);return j<c?null:(F*=j=1/j,E*=j,O*=j,i=Math.sin(n),o=1-(s=Math.cos(n)),a=e[0],u=e[1],h=e[2],l=e[3],f=e[4],d=e[5],p=e[6],m=e[7],g=e[8],y=e[9],b=e[10],v=e[11],w=F*F*o+s,x=E*F*o+O*i,_=O*F*o-E*i,C=F*E*o-O*i,M=E*E*o+s,A=O*E*o+F*i,k=F*O*o+E*i,T=E*O*o-F*i,S=O*O*o+s,t[0]=a*w+f*x+g*_,t[1]=u*w+d*x+y*_,t[2]=h*w+p*x+b*_,t[3]=l*w+m*x+v*_,t[4]=a*C+f*M+g*A,t[5]=u*C+d*M+y*A,t[6]=h*C+p*M+b*A,t[7]=l*C+m*M+v*A,t[8]=a*k+f*T+g*S,t[9]=u*k+d*T+y*S,t[10]=h*k+p*T+b*S,t[11]=l*k+m*T+v*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function rt(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],c=e[7],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*r,t[5]=o*i+h*r,t[6]=a*i+l*r,t[7]=c*i+f*r,t[8]=u*i-s*r,t[9]=h*i-o*r,t[10]=l*i-a*r,t[11]=f*i-c*r,t}function it(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],c=e[3],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*r,t[1]=o*i-h*r,t[2]=a*i-l*r,t[3]=c*i-f*r,t[8]=s*r+u*i,t[9]=o*r+h*i,t[10]=a*r+l*i,t[11]=c*r+f*i,t}function st(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],c=e[3],u=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*r,t[1]=o*i+h*r,t[2]=a*i+l*r,t[3]=c*i+f*r,t[4]=u*i-s*r,t[5]=h*i-o*r,t[6]=l*i-a*r,t[7]=f*i-c*r,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function at(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ct(t,e,n){var r,i,s,o=n[0],a=n[1],u=n[2],h=Math.hypot(o,a,u);return h<c?null:(o*=h=1/h,a*=h,u*=h,r=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=a*o*s+u*r,t[2]=u*o*s-a*r,t[3]=0,t[4]=o*a*s-u*r,t[5]=a*a*s+i,t[6]=u*a*s+o*r,t[7]=0,t[8]=o*u*s+a*r,t[9]=a*u*s-o*r,t[10]=u*u*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ut(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ht(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ft(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=r+r,c=i+i,u=s+s,h=r*a,l=r*c,f=r*u,d=i*c,p=i*u,m=s*u,g=o*a,y=o*c,b=o*u;return t[0]=1-(d+m),t[1]=l+b,t[2]=f-y,t[3]=0,t[4]=l-b,t[5]=1-(h+m),t[6]=p+g,t[7]=0,t[8]=f+y,t[9]=p-g,t[10]=1-(h+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function dt(t,e){var n=new u(3),r=-e[0],i=-e[1],s=-e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],f=r*r+i*i+s*s+o*o;return f>0?(n[0]=2*(a*o+l*r+c*s-h*i)/f,n[1]=2*(c*o+l*i+h*r-a*s)/f,n[2]=2*(h*o+l*s+a*i-c*r)/f):(n[0]=2*(a*o+l*r+c*s-h*i),n[1]=2*(c*o+l*i+h*r-a*s),n[2]=2*(h*o+l*s+a*i-c*r)),ft(t,e,n),t}function pt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function mt(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],c=e[8],u=e[9],h=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(c,u,h),t}function gt(t,e){var n=new u(3);mt(n,e);var r=1/n[0],i=1/n[1],s=1/n[2],o=e[0]*r,a=e[1]*i,c=e[2]*s,h=e[4]*r,l=e[5]*i,f=e[6]*s,d=e[8]*r,p=e[9]*i,m=e[10]*s,g=o+l+m,y=0;return g>0?(y=2*Math.sqrt(g+1),t[3]=.25*y,t[0]=(f-p)/y,t[1]=(d-c)/y,t[2]=(a-h)/y):o>l&&o>m?(y=2*Math.sqrt(1+o-l-m),t[3]=(f-p)/y,t[0]=.25*y,t[1]=(a+h)/y,t[2]=(d+c)/y):l>m?(y=2*Math.sqrt(1+l-o-m),t[3]=(d-c)/y,t[0]=(a+h)/y,t[1]=.25*y,t[2]=(f+p)/y):(y=2*Math.sqrt(1+m-o-l),t[3]=(a-h)/y,t[0]=(d+c)/y,t[1]=(f+p)/y,t[2]=.25*y),t}function yt(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3],c=i+i,u=s+s,h=o+o,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=o*h,y=a*c,b=a*u,v=a*h,w=r[0],x=r[1],_=r[2];return t[0]=(1-(p+g))*w,t[1]=(f+v)*w,t[2]=(d-b)*w,t[3]=0,t[4]=(f-v)*x,t[5]=(1-(l+g))*x,t[6]=(m+y)*x,t[7]=0,t[8]=(d+b)*_,t[9]=(m-y)*_,t[10]=(1-(l+p))*_,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function bt(t,e,n,r,i){var s=e[0],o=e[1],a=e[2],c=e[3],u=s+s,h=o+o,l=a+a,f=s*u,d=s*h,p=s*l,m=o*h,g=o*l,y=a*l,b=c*u,v=c*h,w=c*l,x=r[0],_=r[1],C=r[2],M=i[0],A=i[1],k=i[2],T=(1-(m+y))*x,S=(d+w)*x,F=(p-v)*x,E=(d-w)*_,O=(1-(f+y))*_,j=(g+b)*_,I=(p+v)*C,R=(g-b)*C,B=(1-(f+m))*C;return t[0]=T,t[1]=S,t[2]=F,t[3]=0,t[4]=E,t[5]=O,t[6]=j,t[7]=0,t[8]=I,t[9]=R,t[10]=B,t[11]=0,t[12]=n[0]+M-(T*M+E*A+I*k),t[13]=n[1]+A-(S*M+O*A+R*k),t[14]=n[2]+k-(F*M+j*A+B*k),t[15]=1,t}function vt(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,h=r*o,l=r*a,f=i*o,d=i*a,p=i*c,m=s*o,g=s*a,y=s*c;return t[0]=1-l-p,t[1]=h+y,t[2]=f-g,t[3]=0,t[4]=h-y,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wt(t,e,n,r,i,s,o){var a=1/(n-e),c=1/(i-r),u=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*c,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*c,t[10]=(o+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*u,t[15]=0,t}function xt(t,e,n,r,i){var s,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function _t(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),c=2/(o+a),u=2/(i+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(o-a)*c*.5,t[9]=(i-s)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Ct(t,e,n,r,i,s,o){var a=1/(e-n),c=1/(r-i),u=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*c,t[14]=(o+s)*u,t[15]=1,t}function Mt(t,e,n,r){var i,s,o,a,u,h,l,f,d,p,m=e[0],g=e[1],y=e[2],b=r[0],v=r[1],w=r[2],x=n[0],_=n[1],C=n[2];return Math.abs(m-x)<c&&Math.abs(g-_)<c&&Math.abs(y-C)<c?X(t):(l=m-x,f=g-_,d=y-C,i=v*(d*=p=1/Math.hypot(l,f,d))-w*(f*=p),s=w*(l*=p)-b*d,o=b*f-v*l,(p=Math.hypot(i,s,o))?(i*=p=1/p,s*=p,o*=p):(i=0,s=0,o=0),a=f*o-d*s,u=d*i-l*o,h=l*s-f*i,(p=Math.hypot(a,u,h))?(a*=p=1/p,u*=p,h*=p):(a=0,u=0,h=0),t[0]=i,t[1]=a,t[2]=l,t[3]=0,t[4]=s,t[5]=u,t[6]=f,t[7]=0,t[8]=o,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*m+s*g+o*y),t[13]=-(a*m+u*g+h*y),t[14]=-(l*m+f*g+d*y),t[15]=1,t)}function At(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=r[0],c=r[1],u=r[2],h=i-n[0],l=s-n[1],f=o-n[2],d=h*h+l*l+f*f;d>0&&(h*=d=1/Math.sqrt(d),l*=d,f*=d);var p=c*f-u*l,m=u*h-a*f,g=a*l-c*h;return(d=p*p+m*m+g*g)>0&&(p*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=l*g-f*m,t[5]=f*p-h*g,t[6]=h*m-l*p,t[7]=0,t[8]=h,t[9]=l,t[10]=f,t[11]=0,t[12]=i,t[13]=s,t[14]=o,t[15]=1,t}function kt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Tt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function St(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Ft(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Et(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ot(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function jt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function It(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],h=t[7],l=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],y=t[14],b=t[15],v=e[0],w=e[1],x=e[2],_=e[3],C=e[4],M=e[5],A=e[6],k=e[7],T=e[8],S=e[9],F=e[10],E=e[11],O=e[12],j=e[13],I=e[14],R=e[15];return Math.abs(n-v)<=c*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-w)<=c*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-x)<=c*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(s-_)<=c*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-C)<=c*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-M)<=c*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(u-A)<=c*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-k)<=c*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(l-T)<=c*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(f-S)<=c*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(d-F)<=c*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-E)<=c*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(m-O)<=c*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-j)<=c*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(y-I)<=c*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(b-R)<=c*Math.max(1,Math.abs(b),Math.abs(R))}var Rt=Q,Bt=Ft;function Ut(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dt(t){var e=new u(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Pt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Nt(t,e,n){var r=new u(3);return r[0]=t,r[1]=e,r[2]=n,r}function Lt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Vt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function qt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Wt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ht(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Gt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Yt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Xt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function $t(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Kt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Jt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Zt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function Qt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function te(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function ee(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function ne(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function re(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ie(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function se(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function oe(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2];return t[0]=i*c-s*a,t[1]=s*o-r*c,t[2]=r*a-i*o,t}function ae(t,e,n,r){var i=e[0],s=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t}function ce(t,e,n,r,i,s){var o=s*s,a=o*(2*s-3)+1,c=o*(s-2)+s,u=o*(s-1),h=o*(3-2*s);return t[0]=e[0]*a+n[0]*c+r[0]*u+i[0]*h,t[1]=e[1]*a+n[1]*c+r[1]*u+i[1]*h,t[2]=e[2]*a+n[2]*c+r[2]*u+i[2]*h,t}function ue(t,e,n,r,i,s){var o=1-s,a=o*o,c=s*s,u=a*o,h=3*s*a,l=3*c*o,f=c*s;return t[0]=e[0]*u+n[0]*h+r[0]*l+i[0]*f,t[1]=e[1]*u+n[1]*h+r[1]*l+i[1]*f,t[2]=e[2]*u+n[2]*h+r[2]*l+i[2]*f,t}function he(t,e){e=e||1;var n=2*h()*Math.PI,r=2*h()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function le(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function fe(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function de(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],c=e[1],u=e[2],h=i*u-s*c,l=s*a-r*u,f=r*c-i*a,d=i*f-s*l,p=s*h-r*f,m=r*l-i*h,g=2*o;return h*=g,l*=g,f*=g,d*=2,p*=2,m*=2,t[0]=a+h+d,t[1]=c+l+p,t[2]=u+f+m,t}function pe(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function me(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function ge(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function ye(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],c=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(s*s+o*o+a*a),u=c&&se(t,e)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function be(t){return t[0]=0,t[1]=0,t[2]=0,t}function ve(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function we(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function xe(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(n-s)<=c*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=c*Math.max(1,Math.abs(i),Math.abs(a))}var _e,Ce=qt,Me=Wt,Ae=Ht,ke=Qt,Te=te,Se=Pt,Fe=ee,Ee=(_e=Ut(),function(t,e,n,r,i,s){var o,a;for(e||(e=3),n||(n=0),a=r?Math.min(r*e+n,t.length):t.length,o=n;o<a;o+=e)_e[0]=t[o],_e[1]=t[o+1],_e[2]=t[o+2],i(_e,_e,s),t[o]=_e[0],t[o+1]=_e[1],t[o+2]=_e[2];return t});function Oe(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function je(t){var e=new u(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ie(t,e,n,r){var i=new u(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Be(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Ue(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function De(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Pe(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Ne(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Le(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function ze(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Ve(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function qe(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function We(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function He(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Ge(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function Ye(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return Math.hypot(n,r,i,s)}function Xe(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return n*n+r*r+i*i+s*s}function $e(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function Ke(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Je(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Ze(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Qe(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t}function tn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function en(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],s=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],u=n[2]*r[3]-n[3]*r[2],h=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*u-f*c+d*a,t[1]=-h*u+f*o-d*s,t[2]=h*c-l*o+d*i,t[3]=-h*a+l*s-f*i,t}function nn(t,e,n,r){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function rn(t,e){var n,r,i,s,o,a;e=e||1;do{o=(n=2*h()-1)*n+(r=2*h()-1)*r}while(o>=1);do{a=(i=2*h()-1)*i+(s=2*h()-1)*s}while(a>=1);var c=Math.sqrt((1-o)/a);return t[0]=e*n,t[1]=e*r,t[2]=e*i*c,t[3]=e*s*c,t}function sn(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function on(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2],u=n[3],h=u*r+a*s-c*i,l=u*i+c*r-o*s,f=u*s+o*i-a*r,d=-o*r-a*i-c*s;return t[0]=h*u+d*-o+l*-c-f*-a,t[1]=l*u+d*-a+f*-o-h*-c,t[2]=f*u+d*-c+h*-a-l*-o,t[3]=e[3],t}function an(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function cn(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function un(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function hn(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=e[0],a=e[1],u=e[2],h=e[3];return Math.abs(n-o)<=c*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=c*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-h)<=c*Math.max(1,Math.abs(s),Math.abs(h))}var ln=De,fn=Pe,dn=Ne,pn=Ye,mn=Xe,gn=$e,yn=Ke,bn=function(){var t=Oe();return function(e,n,r,i,s,o){var a,c;for(n||(n=4),r||(r=0),c=i?Math.min(i*n+r,e.length):e.length,a=r;a<c;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function vn(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xn(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function _n(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>c?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Cn(t,e){var n=Zn(t,e);return Math.acos(2*n*n-1)}function Mn(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],c=n[1],u=n[2],h=n[3];return t[0]=r*h+o*a+i*u-s*c,t[1]=i*h+o*c+s*a-r*u,t[2]=s*h+o*u+r*c-i*a,t[3]=o*h-r*a-i*c-s*u,t}function An(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+o*a,t[1]=i*c+s*a,t[2]=s*c-i*a,t[3]=o*c-r*a,t}function kn(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c-s*a,t[1]=i*c+o*a,t[2]=s*c+r*a,t[3]=o*c-i*a,t}function Tn(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+i*a,t[1]=i*c-r*a,t[2]=s*c+o*a,t[3]=o*c-s*a,t}function Sn(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Fn(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i),a=Math.exp(s),c=o>0?a*Math.sin(o)/o:0;return t[0]=n*c,t[1]=r*c,t[2]=i*c,t[3]=a*Math.cos(o),t}function En(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i),a=o>0?Math.atan2(o,s)/o:0;return t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=.5*Math.log(n*n+r*r+i*i+s*s),t}function On(t,e,n){return En(t,e),Jn(t,t,n),Fn(t,t),t}function jn(t,e,n,r){var i,s,o,a,u,h=e[0],l=e[1],f=e[2],d=e[3],p=n[0],m=n[1],g=n[2],y=n[3];return(s=h*p+l*m+f*g+d*y)<0&&(s=-s,p=-p,m=-m,g=-g,y=-y),1-s>c?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(a=1-r,u=r),t[0]=a*h+u*p,t[1]=a*l+u*m,t[2]=a*f+u*g,t[3]=a*d+u*y,t}function In(t){var e=h(),n=h(),r=h(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t}function Rn(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a,t}function Bn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Un(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*o+o]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+i]+e[3*i+s])*n,t[o]=(e[3*o+i]+e[3*i+o])*n}return t}function Dn(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(n),c=Math.cos(n),u=Math.sin(r),h=Math.cos(r);return t[0]=s*c*h-o*a*u,t[1]=o*a*h+s*c*u,t[2]=o*c*u-s*a*h,t[3]=o*c*h+s*a*u,t}function Pn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Nn,Ln,zn,Vn,qn,Wn,Hn=je,Gn=Ie,Yn=Re,Xn=Be,$n=Ue,Kn=Mn,Jn=He,Zn=tn,Qn=nn,tr=$e,er=tr,nr=Ke,rr=nr,ir=Qe,sr=un,or=hn,ar=(Nn=Ut(),Ln=Nt(1,0,0),zn=Nt(0,1,0),function(t,e,n){var r=se(e,n);return r<-.999999?(oe(Nn,Ln,e),Se(Nn)<1e-6&&oe(Nn,zn,e),ie(Nn,Nn),xn(t,Nn,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(oe(Nn,e,n),t[0]=Nn[0],t[1]=Nn[1],t[2]=Nn[2],t[3]=1+r,ir(t,t))}),cr=(Vn=vn(),qn=vn(),function(t,e,n,r,i,s){return jn(Vn,e,i,s),jn(qn,n,r,s),jn(t,Vn,qn,2*s*(1-s)),t}),ur=(Wn=l(),function(t,e,n,r){return Wn[0]=n[0],Wn[3]=n[1],Wn[6]=n[2],Wn[1]=r[0],Wn[4]=r[1],Wn[7]=r[2],Wn[2]=-e[0],Wn[5]=-e[1],Wn[8]=-e[2],ir(t,Un(t,Wn))})},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0);class i{constructor(t){this.data=t,this.offset=0,this.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength)}alloc(t){const e=this.offset;return this.offset+t>this.data.byteLength?null:(this.offset+=t,e)}write(t){const e=this.alloc(t.byteLength);return null!==e&&(this.data.set(t,e),!0)}clear(){return this.offset=0,this}finish(){const t=this.data.subarray(0,this.offset);return this.offset=0,t}}!function(t){function e(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-32768||e>32767)throw new Error("Msg.writeInt: range error");const n=Object(r.c)(t.alloc(2));return t.data[n+0]=e>>0&255,t.data[n+1]=e>>8&255,n}function n(t){const e=Object(r.c)(t.alloc(2)),n=t.data[e]+(t.data[e+1]<<8);return n>>15?4294901760|n:n}t.writeChar=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-128||e>127)throw new Error("Msg.writeChar: range error");const n=Object(r.c)(t.alloc(1));return t.data[n]=e,n},t.writeByte=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<0||e>255)throw new Error("Msg.writeChar: range error");const n=Object(r.c)(t.alloc(1));return t.data[n]=e,n},t.writeShort=e,t.writeInt=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-(2**31)||e>2**31-1)throw new Error("Msg.writeInt: range error");const n=Object(r.c)(t.alloc(4));return t.data[n+0]=e>>0&255,t.data[n+1]=e>>8&255,t.data[n+2]=e>>16&255,t.data[n+3]=e>>24&255,n},t.writeAngle16=function(t,n){return e(t,Math.floor(65536*n/(2*Math.PI)))},t.writeFloat=function(t,e){const n=Object(r.c)(t.alloc(4));return t.dataView.setFloat32(n,e,!0),n},t.writeString=function(e,n){Object(r.b)(n.length<256);const i=t.writeByte(e,n.length);for(let r=0;r<n.length;r++)t.writeByte(e,n.charCodeAt(r));return i},t.skip=function(t,e){return Object(r.c)(t.alloc(e))},t.readChar=function(t){const e=Object(r.c)(t.alloc(1)),n=t.data[e];return n>>7?4294967040|n:n},t.readByte=function(t){const e=Object(r.c)(t.alloc(1));return t.data[e]},t.peekByte=function(t){return t.data[t.offset]},t.readShort=n,t.readInt=function(t){const e=Object(r.c)(t.alloc(4));return t.data[e+0]+(t.data[e+1]<<8)+(t.data[e+2]<<16)+(t.data[e+3]<<24)},t.readAngle16=function(t){return n(t)*(2*Math.PI)/65536},t.readFloat=function(t){const e=Object(r.c)(t.alloc(4));return t.dataView.getFloat32(e,!0)},t.readString=function(e){const n=t.readByte(e),r=String.fromCharCode.apply(null,e.data.subarray(e.offset,e.offset+n));return t.skip(e,n),r}}(i||(i={}))},function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"f",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"i",(function(){return h})),n.d(e,"g",(function(){return l}));var r=2200,i=2201,s=2202,o=2300,a=2301,c=2302,u=2400,h=2401,l=2402},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"e",(function(){return s})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"f",(function(){return c})),n.d(e,"b",(function(){return u}));var r=n(2);r.b.create();const i=r.d.create();function s(t,e,n){return(1-n)*t+n*e}function o(t,e,n){return(n-t)/(e-t)}function a(t,e,n){return Math.max(Math.min(t,n),e)}function c(t){return a(t,0,1)}function u(t,e,n=6.283){return function(t,e,n=1){const r=(e-t)%n;return 2*r%n-r}(t,e,n)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(17),i=n(13),s=new a,o=new i.a;function a(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Object.assign(a.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(o.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(o.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,s=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,s=t.y,o=t.z,a=t.w,c=a*e+s*r-o*n,u=a*n+o*e-i*r,h=a*r+i*n-s*e,l=-i*e-s*n-o*r;return this.x=c*a+l*-i+u*-o-h*-s,this.y=u*a+l*-s+h*-i-c*-o,this.z=h*a+l*-o+c*-s-u*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-i*o,this.y=i*s-n*a,this.z=n*o-r*s,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return s.copy(this).projectOnVector(t),this.sub(s)},reflect:function(t){return this.sub(s.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(r.a.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}})},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return h}));var r=n(20),i=n(0),s=n(5),o=n(3),a=n(19),c=n(2);class u{constructor(){this.avatars=[],this.entities=[];for(let t=0;t<u.kAvatarCount;t++)this.avatars[t]=new r.c}static lerp(t,e,n,i){for(let s=0;s<u.kAvatarCount;s++)r.c.lerp(t.avatars[s],e.avatars[s],n.avatars[s],i);for(let r=0;r<e.entityCount;r++){const s=t.entities[r]=new a.a;a.a.lerp(s,e.entities[r],n.entities[r],i)}return t}static copy(t,e){for(let n=0;n<u.kAvatarCount;n++)r.c.copy(t.avatars[n],e.avatars[n]);for(let n=0;n<e.entityCount;n++){const r=t.entities[n]=new a.a;a.a.copy(r,e.entities[n])}return t}static serialize(t,e){o.a.writeInt(t,e.frame);for(let n=0;n<this.kAvatarCount;n++)r.c.serialize(t,e.avatars[n]);o.a.writeByte(t,e.entities.length);for(let n=0;n<e.entities.length;n++)a.a.serialize(t,e.entities[n])}static deserialize(t,e){e.frame=o.a.readInt(t);for(let n=0;n<this.kAvatarCount;n++)r.c.deserialize(t,e.avatars[n]);e.entityCount=o.a.readByte(t);for(let n=0;n<e.entityCount;n++){const r=e.entities[n]=new a.a;a.a.deserialize(t,r)}}}u.kAvatarCount=6;class h{constructor(){this.buffer=[],this.latestFrame=-1,this.bufferFrameCount=64}setSnapshot(t){Object(i.b)(t.frame>this.latestFrame-this.bufferFrameCount),this.buffer[t.frame%this.bufferFrameCount]=t,this.latestFrame=Math.max(this.latestFrame,t.frame)}getSnapshot(t=this.latestFrame){return Object(i.b)(t>this.latestFrame-this.bufferFrameCount),this.buffer[t%this.bufferFrameCount]}hasSnapshot(t=this.latestFrame){const e=this.buffer[t%this.bufferFrameCount];return Object(i.e)(e)&&e.frame===t}lerpSnapshot(t,e){var n,r;const i=Math.max(0,this.latestFrame-this.bufferFrameCount-1);if(t<i)return console.warn("Requested snapshot older than buffer length"),!1;let o=Math.floor(t);for(;o>=i&&(null===(n=this.buffer[o%this.bufferFrameCount])||void 0===n?void 0:n.frame)!==o;)o-=1;let a=Math.ceil(t);for(;a<=this.latestFrame&&(null===(r=this.buffer[a%this.bufferFrameCount])||void 0===r?void 0:r.frame)!==a;)a+=1;const c=o>=i,h=a<=this.latestFrame,l=this.buffer[o%this.bufferFrameCount],f=this.buffer[a%this.bufferFrameCount];if(c&&!h)return console.warn("Extrapolation not yet implemented"),!1;if(!c&&h)return console.warn("Extrapolation not yet implemented"),!1;if(c||h){if(l===f)return u.copy(e,l),!0;const n=Object(s.d)(o,a,t);return u.lerp(e,l,f,n),!0}return console.warn("No valid snapshot for this frame"),!1}createSnapshot({clock:t,avatar:e,world:n}){const r=this.buffer[this.latestFrame%this.bufferFrameCount],s=new u;r&&u.copy(s,r),s.frame=t.simFrame;const o=[];for(let t=0;t<u.kAvatarCount;t++)o[t]=n.get(t).data;const a=[];for(let t=u.kAvatarCount;t<n.objects.length;t++){const e=n.objects[t];if(e.free)continue;const r={id:t,origin:c.d.clone(e.data.origin),orientation:c.d.clone(e.data.orientation),modelId:Object(i.d)(e.data.modelId,0),flags:0,parent:e.data.parent};a.push(r)}return s.avatars=o,s.entities=a,s}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return o}));var r=n(1),i=n(0);function s(t){const e={};let n=0;const s=Object.keys(t);for(let o=0;o<s.length;o++){const a=t[s[o]];e[s[o]]=Object.assign(Object.assign({},a),{offset:n}),n+=r.l(a.type)*Object(i.d)(a.count,1)}return e}class o{constructor(t,e,n){this.bufferSize=0,this.bufferLayout=n;const i=Object.keys(this.bufferLayout);let s=this.bufferLayout[i[0]];for(let t=1;t<i.length;t++){const e=this.bufferLayout[i[t]];e.offset>s.offset&&(s=e)}this.bufferSize=s.offset+a(s),this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.buffer=e.createBuffer(t,r.c.Uniform,r.n.Dynamic,this.bufferSize)}getBufferView(){return{buffer:this.buffer,byteOffset:0}}getBufferLayout(){return this.bufferLayout}setFloat(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats[n.offset/4]=e}setVec2(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,n.offset/4)}setVec3(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,n.offset/4)}setVec4(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,n.offset/4)}setMat4(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,n.offset/4)}setBytes(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length!==a(n))throw new Error("Invalid size");this.bufferBytes.set(e,n.offset)}setFloats(t,e){const n=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length!==a(n)/4)throw new Error("Invalid size");this.bufferFloats.set(e,n.offset/4)}getFloatArray(t){const e=this.bufferLayout[t];if(!e)throw new Error(`Attempted to set unknown uniform ${t}`);return new Float32Array(this.bufferData,e.offset,a(e)/4)}write(t){t.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(t){t.removeBuffer(this.buffer)}}function a(t){return r.l(t.type)*Object(i.d)(t.count,1)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0);class i{on(t,e){return Object(r.e)(this.callbacks)||(this.callbacks={}),Object(r.e)(this.callbacks[t])||(this.callbacks[t]=[]),Object(r.b)(-1===this.callbacks[t].indexOf(e),"Attempted to add the same callback twice"),this.callbacks[t].push(e),this}once(t,e){const n=(...r)=>{e(...r),this.off(t,n)};return this.on(t,n),this}off(t,e){return Object(r.a)(Object(r.c)(this.callbacks)[t],e),this}fire(t,...e){if(!this.hasHandlers(t))return this;for(const n of this.callbacks[t])n(...e);return this}hasHandlers(t){return Object(r.e)(this.callbacks)&&Object(r.e)(this.callbacks[t])&&this.callbacks[t].length>0}}},function(t,e,n){"use strict";n.d(e,"c",(function(){return o}));var r=n(6),i=n(11);n.d(e,"a",(function(){return i.a}));var s=n(28);n.d(e,"b",(function(){return s.a}));class o extends r.a{constructor(t){super(),this.buffer=t}setBuffer(t){return this.buffer=t,this}set x(t){this.buffer&&(this.buffer[0]=t)}set y(t){this.buffer&&(this.buffer[1]=t)}set z(t){this.buffer&&(this.buffer[2]=t)}get x(){return this.buffer[0]}get y(){return this.buffer[1]}get z(){return this.buffer[2]}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n(6),i=new r.a,s=new l,o=new r.a(0,0,0),a=new r.a(1,1,1),c=new r.a,u=new r.a,h=new r.a;function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(l.prototype,{isMatrix4:!0,set:function(t,e,n,r,i,s,o,a,c,u,h,l,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=o,g[13]=a,g[2]=c,g[6]=u,g[10]=h,g[14]=l,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new l).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,r=1/i.setFromMatrixColumn(t,0).length(),s=1/i.setFromMatrixColumn(t,1).length(),o=1/i.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(r),c=Math.sin(r),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){var l=s*u,f=s*h,d=o*u,p=o*h;e[0]=a*u,e[4]=-a*h,e[8]=c,e[1]=f+d*c,e[5]=l-p*c,e[9]=-o*a,e[2]=p-l*c,e[6]=d+f*c,e[10]=s*a}else if("YXZ"===t.order){var m=a*u,g=a*h,y=c*u,b=c*h;e[0]=m+b*o,e[4]=y*o-g,e[8]=s*c,e[1]=s*h,e[5]=s*u,e[9]=-o,e[2]=g*o-y,e[6]=b+m*o,e[10]=s*a}else if("ZXY"===t.order){m=a*u,g=a*h,y=c*u,b=c*h;e[0]=m-b*o,e[4]=-s*h,e[8]=y+g*o,e[1]=g+y*o,e[5]=s*u,e[9]=b-m*o,e[2]=-s*c,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){l=s*u,f=s*h,d=o*u,p=o*h;e[0]=a*u,e[4]=d*c-f,e[8]=l*c+p,e[1]=a*h,e[5]=p*c+l,e[9]=f*c-d,e[2]=-c,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var v=s*a,w=s*c,x=o*a,_=o*c;e[0]=a*u,e[4]=_-v*h,e[8]=x*h+w,e[1]=h,e[5]=s*u,e[9]=-o*u,e[2]=-c*u,e[6]=w*h+x,e[10]=v-_*h}else if("XZY"===t.order){v=s*a,w=s*c,x=o*a,_=o*c;e[0]=a*u,e[4]=-h,e[8]=c*u,e[1]=v*h+_,e[5]=s*u,e[9]=w*h-x,e[2]=x*h-w,e[6]=o*u,e[10]=_*h+v}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(o,t,a)},lookAt:function(t,e,n){var r=this.elements;return h.subVectors(t,e),0===h.lengthSq()&&(h.z=1),h.normalize(),c.crossVectors(n,h),0===c.lengthSq()&&(1===Math.abs(n.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),c.crossVectors(n,h)),c.normalize(),u.crossVectors(h,c),r[0]=c.x,r[4]=u.x,r[8]=h.x,r[1]=c.y,r[5]=u.y,r[9]=h.y,r[2]=c.z,r[6]=u.z,r[10]=h.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],c=n[12],u=n[1],h=n[5],l=n[9],f=n[13],d=n[2],p=n[6],m=n[10],g=n[14],y=n[3],b=n[7],v=n[11],w=n[15],x=r[0],_=r[4],C=r[8],M=r[12],A=r[1],k=r[5],T=r[9],S=r[13],F=r[2],E=r[6],O=r[10],j=r[14],I=r[3],R=r[7],B=r[11],U=r[15];return i[0]=s*x+o*A+a*F+c*I,i[4]=s*_+o*k+a*E+c*R,i[8]=s*C+o*T+a*O+c*B,i[12]=s*M+o*S+a*j+c*U,i[1]=u*x+h*A+l*F+f*I,i[5]=u*_+h*k+l*E+f*R,i[9]=u*C+h*T+l*O+f*B,i[13]=u*M+h*S+l*j+f*U,i[2]=d*x+p*A+m*F+g*I,i[6]=d*_+p*k+m*E+g*R,i[10]=d*C+p*T+m*O+g*B,i[14]=d*M+p*S+m*j+g*U,i[3]=y*x+b*A+v*F+w*I,i[7]=y*_+b*k+v*E+w*R,i[11]=y*C+b*T+v*O+w*B,i[15]=y*M+b*S+v*j+w*U,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],s=t[1],o=t[5],a=t[9],c=t[13],u=t[2],h=t[6],l=t[10],f=t[14];return t[3]*(+i*a*h-r*c*h-i*o*l+n*c*l+r*o*f-n*a*f)+t[7]*(+e*a*f-e*c*l+i*s*l-r*s*f+r*c*u-i*a*u)+t[11]*(+e*c*h-e*o*f-i*s*h+n*s*f+i*o*u-n*c*u)+t[15]*(-r*o*u-e*a*h+e*o*l+r*s*h-n*s*l+n*a*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,r=t.elements,i=r[0],s=r[1],o=r[2],a=r[3],c=r[4],u=r[5],h=r[6],l=r[7],f=r[8],d=r[9],p=r[10],m=r[11],g=r[12],y=r[13],b=r[14],v=r[15],w=d*b*l-y*p*l+y*h*m-u*b*m-d*h*v+u*p*v,x=g*p*l-f*b*l-g*h*m+c*b*m+f*h*v-c*p*v,_=f*y*l-g*d*l+g*u*m-c*y*m-f*u*v+c*d*v,C=g*d*h-f*y*h-g*u*p+c*y*p+f*u*b-c*d*b,M=i*w+s*x+o*_+a*C;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var A=1/M;return n[0]=w*A,n[1]=(y*p*a-d*b*a-y*o*m+s*b*m+d*o*v-s*p*v)*A,n[2]=(u*b*a-y*h*a+y*o*l-s*b*l-u*o*v+s*h*v)*A,n[3]=(d*h*a-u*p*a-d*o*l+s*p*l+u*o*m-s*h*m)*A,n[4]=x*A,n[5]=(f*b*a-g*p*a+g*o*m-i*b*m-f*o*v+i*p*v)*A,n[6]=(g*h*a-c*b*a-g*o*l+i*b*l+c*o*v-i*h*v)*A,n[7]=(c*p*a-f*h*a+f*o*l-i*p*l-c*o*m+i*h*m)*A,n[8]=_*A,n[9]=(g*d*a-f*y*a-g*s*m+i*y*m+f*s*v-i*d*v)*A,n[10]=(c*y*a-g*u*a+g*s*l-i*y*l-c*s*v+i*u*v)*A,n[11]=(f*u*a-c*d*a-f*s*l+i*d*l+c*s*m-i*u*m)*A,n[12]=C*A,n[13]=(f*y*o-g*d*o+g*s*p-i*y*p-f*s*b+i*d*b)*A,n[14]=(g*u*o-c*y*o-g*s*h+i*y*h+c*s*b-i*u*b)*A,n[15]=(c*d*o-f*u*o+f*s*h-i*d*h-c*s*p+i*u*p)*A,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,s=t.x,o=t.y,a=t.z,c=i*s,u=i*o;return this.set(c*s+n,c*o-r*a,c*a+r*o,0,c*o+r*a,u*o+n,u*a-r*s,0,c*a-r*o,u*a+r*s,i*a*a+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,i=e._x,s=e._y,o=e._z,a=e._w,c=i+i,u=s+s,h=o+o,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=o*h,y=a*c,b=a*u,v=a*h,w=n.x,x=n.y,_=n.z;return r[0]=(1-(p+g))*w,r[1]=(f+v)*w,r[2]=(d-b)*w,r[3]=0,r[4]=(f-v)*x,r[5]=(1-(l+g))*x,r[6]=(m+y)*x,r[7]=0,r[8]=(d+b)*_,r[9]=(m-y)*_,r[10]=(1-(l+p))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var r=this.elements,o=i.set(r[0],r[1],r[2]).length(),a=i.set(r[4],r[5],r[6]).length(),c=i.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),t.x=r[12],t.y=r[13],t.z=r[14],s.copy(this);var u=1/o,h=1/a,l=1/c;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=h,s.elements[5]*=h,s.elements[6]*=h,s.elements[8]*=l,s.elements[9]*=l,s.elements[10]*=l,e.setFromRotationMatrix(s),n.x=o,n.y=a,n.z=c,this},makePerspective:function(t,e,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*i/(e-t),c=2*i/(n-r),u=(e+t)/(e-t),h=(n+r)/(n-r),l=-(s+i)/(s-i),f=-2*s*i/(s-i);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,n,r,i,s){var o=this.elements,a=1/(e-t),c=1/(n-r),u=1/(s-i),h=(e+t)*a,l=(n+r)*c,f=(s+i)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}})},function(t,e,n){"use strict";n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return b}));var r,i=n(22),s=n(9),o=n(0),a=n(3);!function(t){t.Receive="rec",t.Acknowledge="ack"}(r||(r={}));class c extends s.a{constructor(){super(...arguments),this.remoteSequence=-1,this.localSequence=0,this.localHistory=[],this.remoteHistory=[],this.packetBuffer=new a.a(new Uint8Array(1032))}get isOpen(){return this.socket.isOpen}initialize(t){this.socket=t,this.socket.on(i.a.Message,t=>this.receive(t.data));const e={sequence:-1,ack:-1,ackBitfield:0},n={tag:0,size:0,sendTime:-1,rcvdTime:-1};for(let t=0;t<512;t++)this.localHistory[t]=Object.assign(Object.assign({},n),{header:Object.assign({},e)}),this.remoteHistory[t]=Object.assign(Object.assign({},n),{header:Object.assign({},e)})}close(){this.socket.close()}computeStats(t){const e=performance.now();let n=0,r=0,i=0,s=0,a=0,c=0,u=1/0,h=1/0;for(let t=0;t<Math.min(this.localSequence,512);t++){const a=this.localSequence-t,h=this.localHistory[a%512];h.header.sequence===a&&(e-h.sendTime>1e3&&(Object(o.e)(h.ackTime)?n+=1:r+=1),Object(o.e)(h.ackTime)&&(i+=h.ackTime-h.sendTime,s+=1),c+=h.size,u=Math.min(u,h.sendTime))}for(let t=0;t<Math.min(this.remoteSequence,512);t++){const e=this.remoteSequence-t,n=this.remoteHistory[e%512];n.header.sequence!==e||(a+=n.size,h=Math.min(h,n.rcvdTime))}const l=r+n>0?r/(r+n)*100:0,f=s>0?i/s:0,d=c/(e-u)*8,p=a/(e-h)*8;return t.onNetChannelSample(l,f,d,p),t}allocatePacket(){return this.packetBuffer.clear(),a.a.skip(this.packetBuffer,8),this.packetBuffer}send(t,e){Object(o.b)(t===this.packetBuffer,"Pass the same buffer from allocatePacket()");const n=this.localHistory[this.localSequence%512];n.header.sequence=this.localSequence,n.header.ack=this.remoteSequence,n.header.ackBitfield=this.writeAckBitfield(this.remoteHistory),n.tag=Object(o.d)(e,this.localSequence),n.sendTime=performance.now(),n.ackTime=void 0,n.size=this.packetBuffer.offset,this.packetBuffer.dataView.setUint16(0,n.header.sequence,!0),this.packetBuffer.dataView.setUint16(2,n.header.ack,!0),this.packetBuffer.dataView.setUint32(4,n.header.ackBitfield,!0);const r=this.packetBuffer.finish();this.socket.send(r),this.localSequence=u(this.localSequence+1)}receive(t){const e=new a.a(new Uint8Array(t)),n=e.dataView.getUint16(0,!0);if(i=n,s=this.remoteSequence,i>s&&i-s<=32768||i<s&&s-i>32768){this.remoteSequence=n;const i=this.remoteHistory[n%512];i.header.sequence=e.dataView.getUint16(0,!0),i.header.ack=e.dataView.getUint16(2,!0),i.header.ackBitfield=e.dataView.getUint32(4,!0),i.size=t.byteLength,i.rcvdTime=performance.now();const s=i.header.ackBitfield;let c;for(let t=0;t<32;t++)if(s&1<<t){const e=u(i.header.ack-t),n=this.localHistory[e%512];if(n.header.sequence===e&&!Object(o.e)(n.ackTime)){const e=this.acknowledge(n);0===t&&(c=e)}}a.a.skip(e,8),this.fire(r.Receive,e,c,i.rcvdTime)}else console.debug("NetChannel: Ignoring stale packet with sequence number",n);var i,s}acknowledge(t){t.ackTime=performance.now();const e={tag:t.tag,ackTime:t.ackTime,sentTime:t.sendTime,rttTime:t.ackTime-t.sendTime};return this.fire(r.Acknowledge,e),e}writeAckBitfield(t){let e=0;for(const n of t)if(-1!==n.header.sequence){const t=u(this.remoteSequence-n.header.sequence);t<32&&(e|=1<<t)}return e}}function u(t){return(t%65536+65536)%65536}var h,l,f,d=n(23),p=n(7),m=n(16),g=n(5);!function(t){t[t.Free=0]="Free",t[t.Disconnected=1]="Disconnected",t[t.Connected=2]="Connected",t[t.Active=3]="Active",t[t.Background=4]="Background"}(h||(h={})),function(t){t.Connected="con",t.Disconnected="dis",t.Activated="act",t.ServerTimeAdjust="stime",t.ReceiveServerFrame="rsf"}(l||(l={})),function(t){t[t.ServerFrame=0]="ServerFrame",t[t.ClientFrame=1]="ClientFrame",t[t.VisChange=2]="VisChange",t[t.ConnectInfo=3]="ConnectInfo",t[t._Count=4]="_Count"}(f||(f={}));Object(o.b)(8>=f._Count,"Don't forget to update the bitmask!");class y{constructor(){this.buffer=[],this.sendParity=0,this.recvParity=0}getMessageForTransmission(t){if(!(this.buffer.length<=0))return Object(o.e)(this.sendTag)||(this.sendTag=t),this.buffer[0]}ack(t){Object(o.e)(this.sendTag)&&Math.abs(t)>=this.sendTag&&(this.buffer.shift(),this.sendTag=void 0)}send(t){t[0]|=(1&this.sendParity)<<3,this.sendParity^=1,this.buffer.push(t)}receive(t){const e=(a.a.peekByte(t)>>3&1)!=this.recvParity;return e||(this.recvParity^=1),e}}class b extends s.a{constructor(t){super(),this.clock=t,this.state=h.Free,this.lastRequestedFrame=-1,this.lastReceivedFrame=-1,this.lastTransmittedFrame=-1,this.lastAcknowledgedFrame=-1,this.lastReceivedTime=-1,this.stats=new m.b,this.snapshot=new p.b,this.userCommands=new d.b,this.reliable=new y}get ping(){return this.stats.minMaxAve[m.a.Ping][2]}initialize(t){Object(o.b)(this.state===h.Free),console.debug(`NetClient: ${this.id} is attempting to connect`),t.on(i.a.Open,()=>{console.debug(`NetClient: ${this.id} connected`),this.state=h.Connected,this.fire(l.Connected)}),t.on(i.a.Close,()=>{console.debug(`NetClient: ${this.id} disconnected`),this.state=h.Disconnected,this.fire(l.Disconnected)}),this.channel=new c,this.channel.on(r.Receive,this.onMessage.bind(this)),this.channel.on(r.Acknowledge,this.onAck.bind(this)),this.channel.initialize(t),this.stats.initialize()}async connect(t){const e=new i.b;await e.connect(t),this.id=e.clientId,this.initialize(e)}accept(t){this.id=t.peerId,this.initialize(t)}close(){this.state=h.Disconnected,this.channel.close()}setNetGraphPanel(t){this.graphPanel=t}transmitReliable(t){const e=-(this.lastTransmittedFrame+1+t),n=this.reliable.getMessageForTransmission(e);if(!n)return!0;console.debug("Transmitting reliable message");const r=this.channel.allocatePacket();return r.write(n),this.channel.send(r,e),!1}transmitClientFrame(t,e){Object(o.b)(t===e.frame),this.userCommands.setUserCommand(e);const n=this.channel.allocatePacket(),r=this.reliable.getMessageForTransmission(t);r&&n.write(r),this.sendClientFrame(n,t,e),this.channel.send(n,t),this.lastTransmittedFrame=t,this.channel.computeStats(this.stats)}sendClientFrame(t,e,n){let r=f.ClientFrame,i=0;const s=a.a.writeChar(t,r);a.a.writeInt(t,e);const c=Math.max(this.lastAcknowledgedFrame,e-5,0);for(let n=e;n>=c;n--){const e=this.userCommands.getUserCommand(n);if(!Object(o.e)(e))break;Object(o.b)(e.frame===n),i+=1,d.a.serialize(t,e)}r|=i<<4,t.data[s]=r}receiveClientFrame(t,e){const n=a.a.readByte(t)>>4,r=a.a.readInt(t);for(let e=0;e<n;e++){const n={};if(d.a.deserialize(n,t),n.frame=r-e,this.userCommands.setUserCommand(n)&&this.graphPanel){const t=0===e?m.d.Received:m.d.Filled,r=n.frame<=this.lastRequestedFrame?m.d.Late:t;this.graphPanel.setPacketStatus(n.frame,r)}}this.lastReceivedFrame=r,this.lastReceivedTime=e}transmitServerFrame(t){this.snapshot.setSnapshot(t);const e=this.lastReceivedFrame-this.lastRequestedFrame,n=this.channel.allocatePacket(),r=this.reliable.getMessageForTransmission(t.frame);r&&n.write(r);let i=f.ServerFrame;i|=(15&Object(g.c)(e,-8,7))<<4,a.a.writeByte(n,i);const s=this.lastReceivedTime>0?performance.now()-this.lastReceivedTime:0,o=Object(g.c)(Math.round(s/this.clock.simDt*255),0,255);a.a.writeByte(n,o);const c=this.clock.getCurrentServerTime()-this.clock.serverTime,u=this.clock.serverTime-this.clock.simDt*t.frame;a.a.writeByte(n,Object(g.c)(Math.round(u/this.clock.simDt*255),0,255)),a.a.writeByte(n,Object(g.c)(Math.round(c/this.clock.simDt*255),0,255)),p.a.serialize(n,t),this.channel.send(n,t.frame),this.lastTransmittedFrame=t.frame,this.channel.computeStats(this.stats)}receiveServerFrame(t,e){const n=a.a.readByte(t)>>4,r=n>>3?4294967280|n:n,i=a.a.readByte(t),s=i/255*this.clock.simDt,o=e&&i>0?e.rttTime-s:void 0,c=a.a.readByte(t)/255*this.clock.simDt,u=a.a.readByte(t)/255*this.clock.simDt,h=new p.a;if(p.a.deserialize(t,h),this.snapshot.setSnapshot(h),this.lastReceivedFrame=h.frame,o&&(!this.fastestAck||e.rttTime<this.fastestAck.rttTime)){this.fastestAck=e;const t=h.frame*this.clock.simDt+c+u+.5*o;this.fire(l.ServerTimeAdjust,t)}if(this.stats.onReceiveFrame(o,u),this.graphPanel){for(let t=this.lastRequestedFrame+1;t<h.frame;t++)this.snapshot.hasSnapshot(t)||this.graphPanel.setPacketStatus(t,m.d.Filled);const t=h.frame<=this.lastRequestedFrame?m.d.Late:m.d.Received;this.graphPanel.setPacketStatus(h.frame,t)}this.fire(l.ReceiveServerFrame,r,h)}transmitConnectionInfo(t){let e=0;Object(o.b)(t<8),e|=t<<4,e|=7&f.ConnectInfo;const n=new Uint8Array([e]);this.reliable.send(n)}receiveConnectionInfo(t){this.reliable.receive(t);this.clientIndex=a.a.readByte(t)>>4}transmitVisibilityChange(t){let e=0;t&&(e|=240),e|=7&f.VisChange;const n=new Uint8Array([e]);this.reliable.send(n)}receiveVisibilityChange(t){const e=this.reliable.receive(t),n=(-8&a.a.readByte(t))>0;e||(this.state=n?h.Active:h.Background,console.log(`[Client ${this.id}] Received new visibility status: ${n?"visible":"hidden"}`))}getSnapshot(t,e){return this.lastRequestedFrame=Math.ceil(t),this.snapshot.lerpSnapshot(t,e)}getUserCommand(t){this.lastRequestedFrame=t;let e=this.userCommands.getUserCommand(t);return this.state===h.Background?d.c:(Object(o.e)(e)||(console.warn(`[Client ${this.id}] Missing input for frame ${t}`),e=this.userCommands.getUserCommand()),Object(o.c)(e))}onAck(t){if(t.tag>0){const e=t.tag;e>this.lastAcknowledgedFrame&&(this.lastAcknowledgedFrame=e)}this.reliable.ack(t.tag)}onMessage(t,e,n){for(;t.offset<t.data.byteLength;){let r=!1;switch(7&a.a.peekByte(t)){case f.ServerFrame:this.receiveServerFrame(t,e);break;case f.ClientFrame:this.receiveClientFrame(t,n);break;case f.VisChange:this.receiveVisibilityChange(t);break;case f.ConnectInfo:this.receiveConnectionInfo(t);break;default:console.warn("Received unknown message. Ignoring."),r=!0}if(r)break}this.state===h.Connected&&(Object(o.c)(this.clientIndex),this.state=h.Active,this.fire(l.Activated))}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(17);function i(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1}Object.assign(i,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,i,s,o){var a=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3],l=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(h!==p||a!==l||c!==f||u!==d){var m=1-o,g=a*l+c*f+u*d+h*p,y=g>=0?1:-1,b=1-g*g;if(b>Number.EPSILON){var v=Math.sqrt(b),w=Math.atan2(v,g*y);m=Math.sin(m*w)/v,o=Math.sin(o*w)/v}var x=o*y;if(a=a*m+l*x,c=c*m+f*x,u=u*m+d*x,h=h*m+p*x,m===1-o){var _=1/Math.sqrt(a*a+c*c+u*u+h*h);a*=_,c*=_,u*=_,h*=_}}t[e]=a,t[e+1]=c,t[e+2]=u,t[e+3]=h}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,s=t.order,o=Math.cos,a=Math.sin,c=o(n/2),u=o(r/2),h=o(i/2),l=a(n/2),f=a(r/2),d=a(i/2);return"XYZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"YXZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"ZXY"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"ZYX"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"YZX"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h-l*f*d):"XZY"===s&&(this._x=l*u*h-c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h+l*f*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],u=n[2],h=n[6],l=n[10],f=r+a+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(h-c)*e,this._y=(s-u)*e,this._z=(o-i)*e):r>a&&r>l?(e=2*Math.sqrt(1+r-a-l),this._w=(h-c)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(s+u)/e):a>l?(e=2*Math.sqrt(1+a-r-l),this._w=(s-u)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(c+h)/e):(e=2*Math.sqrt(1+l-r-a),this._w=(o-i)/e,this._x=(s+u)/e,this._y=(c+h)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(r.a.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,s=t._w,o=e._x,a=e._y,c=e._z,u=e._w;return this._x=n*u+s*o+r*c-i*a,this._y=r*u+s*a+i*o-n*c,this._z=i*u+s*c+n*a-r*o,this._w=s*u-n*o-r*a-i*c,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,s=this._w,o=s*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var a=1-o*o;if(a<=Number.EPSILON){var c=1-e;return this._w=c*s+e*this._w,this._x=c*n+e*this._x,this._y=c*r+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),h=Math.atan2(u,o),l=Math.sin((1-e)*h)/u,f=Math.sin(e*h)/u;return this._w=s*l+this._w*f,this._x=n*l+this._x*f,this._y=r*l+this._y*f,this._z=i*l+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}})},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(1);class i{constructor(t,e,n){this.defaultCullMode=t,this.defaultDepthState=e,this.renderFormat=n,this.primitives=[]}push(t){this.primitives.push(t)}}const s={opaque:new i(r.e.Back,{depthWriteEnabled:!0,depthTestEnabled:!0},{blendingEnabled:!1}),debug:new i(r.e.None,{depthWriteEnabled:!1,depthTestEnabled:!1},{blendingEnabled:!1})}},function(t,e,n){"use strict";n.d(e,"f",(function(){return f})),n.d(e,"g",(function(){return d})),n.d(e,"e",(function(){return r.b})),n.d(e,"d",(function(){return r.a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return R}));var r=n(4);function i(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function s(t,e,n,r){i.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function o(t,e,n,r){i.call(this,t,e,n,r)}function a(t,e,n,r){i.call(this,t,e,n,r)}Object.assign(i.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var s;n:{r:if(!(t<r)){for(var o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===o)break;if(i=r,t<(r=e[++n]))break e}s=e.length;break n}if(t>=i)break t;var a=e[1];t<a&&(n=2,i=a);for(o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===o)break;if(r=i,t>=(i=e[--n-1]))break e}s=n,n=0}for(;n<s;){var c=n+s>>>1;t<e[c]?s=c:n=c+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,s=0;s!==r;++s)e[s]=n[i+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(i.prototype,{beforeStart_:i.prototype.copySampleValue_,afterEnd_:i.prototype.copySampleValue_}),s.prototype=Object.assign(Object.create(i.prototype),{constructor:s,DefaultSettings_:{endingStart:r.h,endingEnd:r.h},intervalChanged_:function(t,e,n){var i=this.parameterPositions,s=t-2,o=t+1,a=i[s],c=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case r.i:s=t,a=2*e-n;break;case r.g:a=e+i[s=i.length-2]-i[s+1];break;default:s=t,a=n}if(void 0===c)switch(this.getSettings_().endingEnd){case r.i:o=t,c=2*n-e;break;case r.g:o=1,c=n+i[1]-i[0];break;default:o=t-1,c=e}var u=.5*(n-e),h=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(c-n),this._offsetPrev=s*h,this._offsetNext=o*h},interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,u=this._offsetPrev,h=this._offsetNext,l=this._weightPrev,f=this._weightNext,d=(n-e)/(r-e),p=d*d,m=p*d,g=-l*m+2*l*p-l*d,y=(1+l)*m+(-1.5-2*l)*p+(-.5+l)*d+1,b=(-1-f)*m+(1.5+f)*p+.5*d,v=f*m-f*p,w=0;w!==o;++w)i[w]=g*s[u+w]+y*s[c+w]+b*s[a+w]+v*s[h+w];return i}}),o.prototype=Object.assign(Object.create(i.prototype),{constructor:o,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,u=(n-e)/(r-e),h=1-u,l=0;l!==o;++l)i[l]=s[c+l]*h+s[a+l]*u;return i}}),a.prototype=Object.assign(Object.create(i.prototype),{constructor:a,interpolate_:function(t){return this.copySampleValue_(t-1)}});var c={arraySlice:function(t,e,n){return c.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),s=0,o=0;o!==r;++s)for(var a=n[s]*e,c=0;c!==e;++c)i[o++]=t[a+c];return i},flattenJSON:function(t,e,n,r){for(var i=1,s=t[0];void 0!==s&&void 0===s[r];)s=t[i++];if(void 0!==s){var o=s[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=s[r])&&(e.push(s.time),n.push.apply(n,o)),s=t[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{void 0!==(o=s[r])&&(e.push(s.time),o.toArray(n,n.length)),s=t[i++]}while(void 0!==s);else do{void 0!==(o=s[r])&&(e.push(s.time),n.push(o)),s=t[i++]}while(void 0!==s)}},subclip:function(t,e,n,r,i){i=i||30;var s=t.clone();s.name=e;for(var o=[],a=0;a<s.tracks.length;++a){for(var u=s.tracks[a],h=u.getValueSize(),l=[],f=[],d=0;d<u.times.length;++d){var p=u.times[d]*i;if(!(p<n||p>=r)){l.push(u.times[d]);for(var m=0;m<h;++m)f.push(u.values[d*h+m])}}0!==l.length&&(u.times=c.convertArray(l,u.times.constructor),u.values=c.convertArray(f,u.values.constructor),o.push(u))}s.tracks=o;var g=1/0;for(a=0;a<s.tracks.length;++a)g>s.tracks[a].times[0]&&(g=s.tracks[a].times[0]);for(a=0;a<s.tracks.length;++a)s.tracks[a].shift(-1*g);return s.resetDuration(),s}};function u(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=c.convertArray(e,this.TimeBufferType),this.values=c.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}Object.assign(u,{toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:c.convertArray(t.times,Array),values:c.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e}}),Object.assign(u.prototype,{constructor:u,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:r.b,InterpolantFactoryMethodDiscrete:function(t){return new a(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new o(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new s(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case r.a:e=this.InterpolantFactoryMethodDiscrete;break;case r.b:e=this.InterpolantFactoryMethodLinear;break;case r.c:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return r.a;case this.InterpolantFactoryMethodLinear:return r.b;case this.InterpolantFactoryMethodSmooth:return r.c}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,s=r-1;i!==r&&n[i]<t;)++i;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==i||s!==r){i>=s&&(i=(s=Math.max(s,1))-1);var o=this.getValueSize();this.times=c.arraySlice(n,i,s),this.values=c.arraySlice(this.values,i*o,s*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,o=0;o!==i;o++){var a=n[o];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==s&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,s),t=!1;break}s=a}if(void 0!==r&&c.isTypedArray(r)){o=0;for(var u=r.length;o!==u;++o){var h=r[o];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,h),t=!1;break}}}return t},optimize:function(){for(var t=c.arraySlice(this.times),e=c.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===r.c,s=1,o=t.length-1,a=1;a<o;++a){var u=!1,h=t[a];if(h!==t[a+1]&&(1!==a||h!==h[0]))if(i)u=!0;else for(var l=a*n,f=l-n,d=l+n,p=0;p!==n;++p){var m=e[l+p];if(m!==e[f+p]||m!==e[d+p]){u=!0;break}}if(u){if(a!==s){t[s]=t[a];var g=a*n,y=s*n;for(p=0;p!==n;++p)e[y+p]=e[g+p]}++s}}if(o>0){t[s]=t[o];for(g=o*n,y=s*n,p=0;p!==n;++p)e[y+p]=e[g+p];++s}return s!==t.length?(this.times=c.arraySlice(t,0,s),this.values=c.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this},clone:function(){var t=c.arraySlice(this.times,0),e=c.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}});var h=n(13);function l(t,e,n,r){i.call(this,t,e,n,r)}function f(t,e,n,r){u.call(this,t,e,n,r)}function d(t,e,n,r){u.call(this,t,e,n,r)}function p(t,e,n){u.call(this,t,e,n)}function m(t,e,n,r){u.call(this,t,e,n,r)}function g(t,e,n,r){u.call(this,t,e,n,r)}function y(t,e,n,r){u.call(this,t,e,n,r)}l.prototype=Object.assign(Object.create(i.prototype),{constructor:l,interpolate_:function(t,e,n,r){for(var i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=(n-e)/(r-e),u=a+o;a!==u;a+=4)h.a.slerpFlat(i,0,s,a-o,s,a,c);return i}}),f.prototype=Object.assign(Object.create(u.prototype),{constructor:f,ValueTypeName:"quaternion",DefaultInterpolation:r.b,InterpolantFactoryMethodLinear:function(t){return new l(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),d.prototype=Object.assign(Object.create(u.prototype),{constructor:d,ValueTypeName:"vector"}),p.prototype=Object.assign(Object.create(u.prototype),{constructor:p,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:r.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),m.prototype=Object.assign(Object.create(u.prototype),{constructor:m,ValueTypeName:"color"}),g.prototype=Object.assign(Object.create(u.prototype),{constructor:g,ValueTypeName:"number"}),y.prototype=Object.assign(Object.create(u.prototype),{constructor:y,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:r.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});var b=n(17);function v(t,e,n){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.uuid=b.a.generateUUID(),this.duration<0&&this.resetDuration()}function w(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return g;case"vector":case"vector2":case"vector3":case"vector4":return d;case"color":return m;case"quaternion":return f;case"bool":case"boolean":return p;case"string":return y}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],r=[];c.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function x(t,e,n){this._mixer=t,this._clip=e,this._localRoot=n||null;for(var i=e.tracks,s=i.length,o=new Array(s),a={endingStart:r.h,endingEnd:r.h},c=0;c!==s;++c){var u=i[c].createInterpolant(null);o[c]=u,u.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=r.f,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(v,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,s=n.length;i!==s;++i)e.push(w(n[i]).scale(r));return new v(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,s=n.length;i!==s;++i)e.push(u.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){for(var i=e.length,s=[],o=0;o<i;o++){var a=[],u=[];a.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);var h=c.getKeyframeOrder(a);a=c.sortedArray(a,1,h),u=c.sortedArray(u,1,h),r||0!==a[0]||(a.push(i),u.push(u[0])),s.push(new g(".morphTargetInfluences["+e[o].name+"]",a,u).scale(1/n))}return new v(t,-1,s)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,s=0,o=t.length;s<o;s++){var a=t[s],c=a.name.match(i);if(c&&c.length>1){var u=r[l=c[1]];u||(r[l]=u=[]),u.push(a)}}var h=[];for(var l in r)h.push(v.CreateFromMorphTargetSequence(l,r[l],e,n));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var s=[],o=[];c.flattenJSON(n,s,o,r),0!==s.length&&i.push(new t(e,s,o))}},r=[],i=t.name||"default",s=t.length||-1,o=t.fps||30,a=t.hierarchy||[],u=0;u<a.length;u++){var h=a[u].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var l={},p=0;p<h.length;p++)if(h[p].morphTargets)for(var m=0;m<h[p].morphTargets.length;m++)l[h[p].morphTargets[m]]=-1;for(var y in l){var b=[],w=[];for(m=0;m!==h[p].morphTargets.length;++m){var x=h[p];b.push(x.time),w.push(x.morphTarget===y?1:0)}r.push(new g(".morphTargetInfluence["+y+"]",b,w))}s=l.length*(o||1)}else{var _=".bones["+e[u].name+"]";n(d,_+".position",h,"pos",r),n(f,_+".quaternion",h,"rot",r),n(d,_+".scale",h,"scl",r)}}return 0===r.length?null:new v(i,s,r)}}),Object.assign(v.prototype,{resetDuration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new v(this.name,this.duration,t)}}),Object.assign(x.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,s=i/r,o=r/i;t.warp(1,s,e),this.warp(o,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,i=r.time,s=this._timeScaleInterpolant,o=this.timeScale;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);var a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=t/o,c[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var s=(t-i)*n;if(s<0||0===n)return;this._startTime=null,e=n*s}e*=this._updateTimeScale(t);var o=this._updateTime(e),a=this._updateWeight(t);if(a>0)for(var c=this._interpolants,u=this._propertyBindings,h=0,l=c.length;h!==l;++h)c[h].evaluate(o),u[h].accumulate(r,a)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,i=this.loop,s=this._loopCount,o=i===r.e;if(0===t)return-1===s?e:o&&1==(1&s)?n-e:e;if(i===r.d){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=n)e=n;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=n||e<0){var a=Math.floor(e/n);e-=n*a,s+=Math.abs(a);var c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===c){var u=t<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(o&&1==(1&s))return n-e}return e},_setEndings:function(t,e,n){var i=this._interpolantSettings;n?(i.endingStart=r.i,i.endingEnd=r.i):(i.endingStart=t?this.zeroSlopeAtStart?r.i:r.h:r.g,i.endingEnd=e?this.zeroSlopeAtEnd?r.i:r.h:r.g)},_scheduleFading:function(t,e,n){var r=this._mixer,i=r.time,s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);var o=s.parameterPositions,a=s.sampleValues;return o[0]=i,a[0]=e,o[1]=i+t,a[1]=n,this}});var _=n(36),C=new RegExp("[\\[\\]\\.:\\/]","g"),M="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",A=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),k=/(WCOD+)?/.source.replace("WCOD",M),T=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),S=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),F=new RegExp("^"+A+k+T+S+"$"),E=["material","materials","bones"];function O(t,e,n){var r=n||j.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function j(t,e,n){this.path=e,this.parsedPath=n||j.parseTrackName(e),this.node=j.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function I(t,e,n){this.binding=t,this.valueSize=n;var r,i=Float64Array;switch(e){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function R(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Object.assign(O.prototype,{getValue:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}),Object.assign(j,{Composite:O,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new j.Composite(t,e,n):new j(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(C,"")},parseTrackName:function(t){var e=F.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==E.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e)return i;var s=r(i.children);if(s)return s}return null},i=r(t.children);if(i)return i}return null}}),Object.assign(j.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=j.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var s=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var a=t[r];if(void 0!==a){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(j.prototype,{_getValue_unbound:j.prototype.getValue,_setValue_unbound:j.prototype.setValue}),Object.assign(I.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,s=this.cumulativeWeight;if(0===s){for(var o=0;o!==r;++o)n[i+o]=n[o];s=e}else{var a=e/(s+=e);this._mixBufferRegion(n,i,0,a,r)}this.cumulativeWeight=s},apply:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,s=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*e;this._mixBufferRegion(n,r,o,1-i,e)}for(var a=e,c=e+e;a!==c;++a)if(n[a]!==n[a+e]){s.setValue(n,r);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=3*n;t.getValue(e,r);for(var i=n,s=r;i!==s;++i)e[i]=e[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,n,r,i){if(r>=.5)for(var s=0;s!==i;++s)t[e+s]=t[n+s]},_slerp:function(t,e,n,r){h.a.slerpFlat(t,e,t,e,t,n,r)},_lerp:function(t,e,n,r,i){for(var s=1-r,o=0;o!==i;++o){var a=e+o;t[a]=t[a]*s+t[n+o]*r}}}),R.prototype=Object.assign(Object.create(_.a.prototype),{constructor:R,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName,u=c[a];void 0===u&&(u={},c[a]=u);for(var h=0;h!==i;++h){var l=r[h],f=l.name,d=u[f];if(void 0!==d)s[h]=d;else{if(void 0!==(d=s[h])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,a,f));continue}var p=e&&e._propertyBindings[h].binding.parsedPath;++(d=new I(j.create(n,f,p),l.ValueTypeName,l.getValueSize())).referenceCount,this._addInactiveBinding(d,a,f),s[h]=d}o[h].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,s=0,o=i.length;s!==o;++s){var a=i[s];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,i=this._actionsByClip,s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{var o=s.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,s=this._actionsByClip,o=s[i],a=o.knownActions,c=a[a.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,a[u]=c,a.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,i=r[e],s=this._bindings;void 0===i&&(i={},r[e]=i),i[n]=t,t._cacheIndex=s.length,s.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,o=s[r],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[i],0===Object.keys(o).length&&delete s[r]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new o(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?v.findByName(n,t):t,s=null!==i?i.uuid:t,o=this._actionsByClip[s],a=null;if(void 0!==o){var c=o.actionByRoot[r];if(void 0!==c)return c;a=o.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var u=new x(this,i,e);return this._bindAction(u,a),this._addInactiveAction(u,s,r),u},existingAction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?v.findByName(n,t):t,s=i?i.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1,o=0;o!==n;++o){e[o]._update(r,t,i,s)}var a=this._bindings,c=this._nActiveBindings;for(o=0;o!==c;++o)a[o].apply(s);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var s=i.knownActions,o=0,a=s.length;o!==a;++o){var c=s[o];this._deactivateAction(c);var u=c._cacheIndex,h=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,e[u]=h,e.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var s=this._bindingsByRootAndName[e];if(void 0!==s)for(var o in s){var a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}})},function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return c}));var r,i,s=n(0);!function(t){t[t.Missing=0]="Missing",t[t.Received=1]="Received",t[t.Filled=2]="Filled",t[t.Late=3]="Late"}(r||(r={}));class o{constructor(){this.enabled=!1;const t=document.createElement("div");t.style.cssText="opacity:0.9;z-index:10000;pointer-events:none;display:none",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}removePanel(t){this.dom.removeChild(t.dom)}addPanel(t){const e=Math.round(window.devicePixelRatio||1),n=3*e,i=15*e,o=3*e,a=2*e,c=64*(10*e),u=30*e,h=2*n+c,l=48*e,f="#222",d=document.createElement("canvas");d.height=l,d.width=h,d.style.cssText=`height:${Math.round(l/e)}px;width:${Math.round(h/e)}px`;const p=Object(s.c)(d.getContext("2d"));p.font="bold "+9*e+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=f,p.fillRect(0,0,h,l),p.fillStyle="#EEE",p.fillText(t,o,a),this.dom.appendChild(d);const m=this,g=new Array(64).fill(r.Missing);let y=0;return{dom:d,setPacketStatus(t,e){t>y-64&&t<y&&(g[t%64]=e)},update(t,e,l,d){if(!m.enabled)return;p.fillStyle=f,p.fillRect(n,i,c,u);const b=Math.floor(e/16)-32,v=b+64-1;let w=b;for(;w<=v;){const t=16*w,s=Math.round(((t-e)/1024+.5)*c),o=n+s;if(w+=1,w>y&&(g[w%64]=r.Missing),s>0&&s<c){switch(p.fillStyle="grey",p.fillRect(o-1,i,2,u),g[w%64]){case r.Missing:continue;case r.Received:p.fillStyle="green";break;case r.Filled:p.fillStyle="yellow";break;case r.Late:p.fillStyle="purple";break;default:p.fillStyle="red"}const t=4,e=Math.min(t,o-n);p.fillRect(o-e,i+.25*u,e+t,.5*u)}}p.fillStyle="red";const x=n+.5*c;p.fillRect(x,i,4,u),p.fillStyle="yellow";const _=n+((d-e)/1024+.5)*c;p.fillRect(_,i,4,u),p.fillStyle="purple";const C=n+((l-e)/1024+.5)*c;if(p.fillRect(C,i,4,u),y=v,Object(s.e)(t)){const e=t.toFixed(1).padStart(5);p.fillStyle=f,p.fillRect(o+.5*h,a,.5*h,i-a),p.fillStyle="#EEE",p.textAlign="right",p.fillText(`Ping: ${e}`,h-o,a)}}}}}!function(t){t[t.Ping=0]="Ping",t[t.Rtt=1]="Rtt",t[t.Vrtn=2]="Vrtn",t[t.Loss=3]="Loss",t[t.Dur=4]="Dur",t[t.Delay=5]="Delay",t[t.Ahead=6]="Ahead",t[t.Down=7]="Down",t[t.Up=8]="Up",t[t._Count=9]="_Count"}(i||(i={}));const a={[i.Ping]:{name:"Ping",unit:"ms",color:"aqua"},[i.Rtt]:{name:"RTT",unit:"ms",color:"cornflowerblue"},[i.Vrtn]:{name:"Net Vrtn",unit:"ms",color:"white"},[i.Dur]:{name:"Srv Tick",unit:"ms",color:"mediumpurple"},[i.Loss]:{name:"Pkt Loss",unit:"%",color:"darkorange"},[i.Down]:{name:"Down",unit:"Kbps",color:"greenyellow"},[i.Up]:{name:"Up",unit:"Kbps",color:"hotpink"}};class c{constructor(){this.minMaxAve=[],this.history=[],this.window=187.5,this.domMinMaxAve=[],this.enabled=!1;for(let t=0;t<i._Count;t++)this.minMaxAve[t]=[],this.history[t]=[],this.domMinMaxAve[t]=[];const t=document.createElement("div");t.style.cssText="\n            display:none;\n            font-family: Monaco, monospace;\n            font-size: 9pt;\n            background:rgba(50,50,50,0.8);\n            opacity:0.9;\n            z-index:10000;\n            pointer-events:none;\n            color:white",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}initialize(){const t=document.createElement("table");t.id="NetStats",t.style.tableLayout="fixed",t.style.borderSpacing="9pt";const e=document.styleSheets[0];e.insertRule("#NetStats>tr>:nth-child(2) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(4) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(5) { opacity: 0.7; }");let n=document.createElement("tr");n.appendChild(document.createElement("th")),n.appendChild(document.createElement("th")),n.appendChild(document.createElement("th")).appendChild(document.createTextNode("   avg   ")),n.appendChild(document.createElement("th")).appendChild(document.createTextNode("   min   ")),n.appendChild(document.createElement("th")).appendChild(document.createTextNode("   max   ")),t.appendChild(n);for(const e in a){const n=Number.parseInt(e),r=Object(s.c)(a[n]);let i=document.createElement("tr");i.style.color=r.color,i.appendChild(document.createElement("td")).innerText=r.name,i.appendChild(document.createElement("td")).innerText=r.unit,this.domMinMaxAve[n][2]=i.appendChild(document.createElement("td")),this.domMinMaxAve[n][0]=i.appendChild(document.createElement("td")),this.domMinMaxAve[n][1]=i.appendChild(document.createElement("td")),t.appendChild(i)}this.dom.appendChild(t)}onReceiveFrame(t,e){if(!Object(s.e)(t)){const e=this.history[i.Ping];t=Object(s.d)(e[e.length-1],0)}const n=this.minMaxAve[i.Ping][2],r=Object(s.e)(n)?(t-n)**2:0;this.history[i.Vrtn].push(r),this.history[i.Ping].push(t),this.history[i.Dur].push(e)}onNetChannelSample(t,e,n,r){this.history[i.Loss].push(t),this.history[i.Rtt].push(e),this.history[i.Up].push(n),this.history[i.Down].push(r)}update(){var t,e,n;for(const t of this.history)for(;t.length>this.window;)t.shift();if(!this.enabled)return;if(0!==this.history[0].length)for(const r in a){const o=Number.parseInt(r);this.minMaxAve[o][0]=Math.min(...this.history[o]),this.minMaxAve[o][1]=Math.max(...this.history[o]),this.minMaxAve[o][2]=this.history[o].reduce((t,e)=>t+e,0)/this.history[o].length,o===i.Vrtn&&(this.minMaxAve[o][0]=Math.sqrt(this.minMaxAve[o][0]),this.minMaxAve[o][1]=Math.sqrt(this.minMaxAve[o][1]),this.minMaxAve[o][2]=Math.sqrt(this.minMaxAve[o][2]));const a=Object(s.d)(null===(t=this.minMaxAve[o][0])||void 0===t?void 0:t.toFixed(1),""),c=Object(s.d)(null===(e=this.minMaxAve[o][1])||void 0===e?void 0:e.toFixed(1),""),u=Object(s.d)(null===(n=this.minMaxAve[o][2])||void 0===n?void 0:n.toFixed(1),"");this.domMinMaxAve[o][0].innerText=a,this.domMinMaxAve[o][1].innerText=c,this.domMinMaxAve[o][2].innerText=u}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));for(var r=[],i=0;i<256;i++)r[i]=(i<16?"0":"")+i.toString(16);var s={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(r[255&t]+r[t>>8&255]+r[t>>16&255]+r[t>>24&255]+"-"+r[255&e]+r[e>>8&255]+"-"+r[e>>16&15|64]+r[e>>24&255]+"-"+r[63&n|128]+r[n>>8&255]+"-"+r[n>>16&255]+r[n>>24&255]+r[255&i]+r[i>>8&255]+r[i>>16&255]+r[i>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*s.DEG2RAD},radToDeg:function(t){return t*s.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,i){var s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),u=s((e+r)/2),h=o((e+r)/2),l=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);"XYX"===i?t.set(a*h,c*l,c*f,a*u):"YZY"===i?t.set(c*f,a*h,c*l,a*u):"ZXZ"===i?t.set(c*l,c*f,a*h,a*u):"XZX"===i?t.set(a*h,c*p,c*d,a*u):"YXY"===i?t.set(c*d,a*h,c*p,a*u):"ZYZ"===i?t.set(c*p,c*d,a*h,a*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}));const r="32e5a8a395a6ec43eb29cb7a95ed0fd31ec61ee4",i=(r.slice(0,8),`https://github.com/themikelester/MoonDuel/tree/${r}`),s=!1},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));var r=n(2),i=n(0),s=n(3);class o{static serialize(t,e){let n=0;Object(i.e)(e.parent)&&(n|=1),s.a.writeByte(t,n),s.a.writeShort(t,e.id),1&n&&s.a.writeShort(t,e.parent)}static deserialize(t,e){const n=s.a.readByte(t);e.id=s.a.readShort(t),1&n&&(e.parent=s.a.readShort(t))}static copy(t,e){t.id=e.id,t.parent=e.parent}static lerp(t,e,n,r){Object(i.b)(e.id===n.id),t.id=n.id,t.parent=n.parent}}class a{constructor(){this.objects=[]}add(t,e){e=Object(i.d)(e,{id:-1,origin:r.d.create(),orientation:r.d.create(),modelId:-1,flags:0});let n=this.objects.findIndex(t=>t.free);n<0&&(n=this.objects.length);const s={free:!1,data:t,baseline:e};return this.objects[n]=s,s.baseline.id=n,n}remove(t){const e=Object(i.c)(this.objects[t]);Object(i.b)(e.baseline.id===t),e.free=!0}get(t){const e=Object(i.c)(this.objects[t]);return Object(i.b)(!1===e.free),e}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return I})),n.d(e,"a",(function(){return R})),n.d(e,"c",(function(){return L})),n.d(e,"d",(function(){return z})),n.d(e,"e",(function(){return V}));var r=n(2),i=n(31),s=n(5);const o=r.d.create(),a=r.d.create();class c{constructor(){this.orientationTarget=r.d.create()}update(t,e,n,o){const c=Object.assign({},t),u=this.getCameraRelativeMovementDirection(o,a),h=r.d.length(u)>.1,l=o.actions&i.a.Walk;let f=r.d.clone(t.orientation),d=!!(t.flags&I.IsUTurning);if(t.attackType!==R.None){e-t.attackStartFrame>=69&&(c.attackType=R.None,c.attackStartFrame=0)}else o.actions&i.a.AttackSide&&(c.attackStartFrame=e,c.attackType=R.Side),o.actions&i.a.AttackVert&&(c.attackStartFrame=e,c.attackType=R.Vertical);let p=r.d.length(t.velocity);const m=l?600:3e3;let g=l?150:600;c.attackType!==R.None&&(g=10);const y=(h?m:-m)*n,b=Object(s.c)(p+y,0,g);p+=Object(s.c)(b-p,-m*n,m*n);const v=r.d.scale(r.d.create(),t.orientation,p),w=r.d.scaleAndAdd(r.d.create(),t.origin,v,n);let x=h,_=3.75*Math.PI,C=1.875*Math.PI;Math.PI;d?r.d.dot(f,this.orientationTarget)>.99&&(d=!1):r.d.dot(u,this.orientationTarget)<-.99&&(d=!0,r.d.copy(this.orientationTarget,u));let M=p>0?C:_;if(d?(x=!0,M*=2,this.orientationTarget=this.orientationTarget):h&&r.d.copy(this.orientationTarget,u),x){const e=Math.atan2(t.orientation[0],t.orientation[2]),i=Math.atan2(this.orientationTarget[0],this.orientationTarget[2]);let o=Object(s.b)(e,i);const a=M*n,c=Object(s.c)(o,-a,a);r.d.rotateY(f,t.orientation,s.a,c)}let A=t.flags&~(I.IsWalking|I.IsUTurning);return l&&(A|=I.IsWalking),d&&(A|=I.IsUTurning),c.origin=w,c.velocity=v,c.orientation=f,c.flags=A,c}getWorldRelativeMovementDirection(t,e){const n=t.horizontalAxis,i=t.verticalAxis;return r.d.normalize(e,r.d.set(e,n,0,i))}getCameraRelativeMovementDirection(t,e){const n=this.getWorldRelativeMovementDirection(t,e),i=r.d.normalize(o,r.d.set(o,t.headingX,0,t.headingZ));return r.d.set(e,n[0]*-i[2]+n[2]*i[0],0,n[0]*i[0]+n[2]*i[2])}}var u=n(21),h=n(1),l=n(14),f=n(8),d=n(0),p=n(28);function m(){p.a.call(this),this.type="Bone"}m.prototype=Object.assign(Object.create(p.a.prototype),{constructor:m,isBone:!0});var g=n(11),y=new g.a,b=new g.a;function v(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new g.a)}}Object.assign(v.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new g.a;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,s=t.length;i<s;i++){var o=t[i]?t[i].matrixWorld:b;y.multiplyMatrices(o,e[i]),y.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new v(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});var w=n(27),x=n(10);const _=r.e.fromValues(1,0,0,1),C=new x.c(r.d.create()),M=new Array(128).fill(0).map(t=>r.d.create());function A(t,e=_){const n=M;if(t){for(let e=0;e<t.bones.length;e++){const r=t.bones[e],i=r.parent;i&&(C.setBuffer(n[2*e+0]),i.getWorldPosition(C),C.setBuffer(n[2*e+1]),r.getWorldPosition(C))}w.a.renderLines(n.slice(0,2*t.bones.length),e)}}class k{constructor(){this.data=[],this.drawSkeleton=!1}initialize(t,e){this.avatars=t;for(let e=0;e<t.length;e++)this.data[e]={models:[],skinnedModels:[]};e.addFolder("Avatar").add(this,"drawSkeleton")}onResourcesLoaded(t,e){for(let n=0;n<this.avatars.length;n++){const r=this.avatars[n];for(let i=0;i<r.nodes.length;i++){const s=r.nodes[i];if(Object(d.e)(s.skinId)){const i=Object(d.c)(s.meshId);Object(d.b)(0===s.skinId),this.loadSkinnedModel(e,t,s,i,r.skeleton,n)}else Object(d.e)(s.meshId)&&this.loadModel(e,t,s,s.meshId,n)}}}createMaterial(t,e,n){const i=n.materials[e.materialIndex],s=Object(d.c)(i.technique),o=s.shaderId,a=function(t){const e={},n=[];for(const r of Object.keys(t.uniforms)){const i=t.uniforms[r];i.type===h.m.Texture2D?n.push(r):e[r]=i}const r=Object(f.b)(e),i={uniforms:{index:0,type:h.a.UniformBuffer,layout:r}};for(let t=0;t<n.length;t++){i[n[t]]={index:t,type:h.a.Texture}}return i}(s),c=new u.a(t,i.name,o,a),l=a.uniforms.layout,p=new f.a(i.name,t,l);if(c.setUniformBuffer(t,"uniforms",p),s){const e=Object(d.c)(i.values);for(const r of Object.keys(s.uniforms)){const i=s.uniforms[r],o=Object(d.d)(e[r],i.value);if(Object(d.e)(o))if(i.type===h.m.Texture2D){const e=n.textures[o.index].id;c.setTexture(t,r,e)}else i.type===h.m.Float?p.setFloat(r,o):p.setFloats(r,o)}p.setVec4("u_Color0",r.e.fromValues(.4266,.4171,.5057,1))}else p.setVec4("u_color",r.e.fromValues(0,1,0,1));return c}loadSkinnedModel(t,e,n,r,i,s){const o=e.meshes[r];for(let r of o.primitives){const o=this.createMaterial(t,r,e),a=new u.c(t,l.a.opaque,r.mesh,o);a.bindSkeleton(t,i),o.setTexture(t,"u_jointTex",a.boneTex),this.data[s].skinnedModels.push(a),n.add(a)}}loadModel(t,e,n,r,i){const s=e.meshes[r];for(let r of s.primitives){const s=this.createMaterial(t,r,e),o=new u.b(t,l.a.opaque,r.mesh,s);this.data[i].models.push(o),n.add(o)}}render(t,e){for(let n=0;n<this.avatars.length;n++){if(!this.avatars[n].active)continue;const i=this.data[n];for(let n=0;n<i.skinnedModels.length;n++){const s=i.skinnedModels[n],o=s.material.getUniformBuffer("uniforms");s.writeBonesToTex(t);const a=new Float32Array(s.matrixWorld.elements);Object(d.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_modelViewProjection",r.b.multiply(r.b.create(),e.viewProjMatrix,a)),Object(d.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_model",a),o.write(t),s.renderList.push(s.primitive)}for(let n=0;n<i.models.length;n++){const s=i.models[n],o=new Float32Array(s.matrixWorld.elements),a=s.material.getUniformBuffer("uniforms");a.setMat4("u_modelViewProjection",r.b.multiply(r.b.create(),e.viewProjMatrix,o)),a.write(t),s.renderList.push(s.primitive)}if(this.drawSkeleton&&(A(this.avatars[n].skeleton),window.server)){A(window.server.avatar.avatars[n].skeleton,r.e.fromValues(1,1,0,1))}}}}var T=n(15),S=n(4);const F=[.25,.75],E=[.15,.65];class O{constructor(t){this.targetAvatar=t}onResourcesLoaded(t,e){this.debugMenu=e.addFolder("Animation"),this.debugAnimationMixer=new T.b(this.targetAvatar);const n={that:this,togglePaused:()=>{this.debugAnimation&&(this.debugAnimation.paused=!this.debugAnimation.paused)},stop:()=>{this.debugAnimation&&(this.debugAnimation.stop(),this.debugAnimation=void 0)},get time(){if(Object(d.e)(this.that.debugAnimation)){return this.that.debugAnimation.time/this.that.debugAnimation.getClip().duration}return 0},set time(t){Object(d.e)(this.that.debugAnimation)&&(this.that.debugAnimation.paused=!0,this.that.debugAnimation.time=t*this.that.debugAnimation.getClip().duration)}};this.debugMenu.add(n,"togglePaused"),this.debugMenu.add(n,"stop"),this.debugMenu.add(n,"time",0,1,.01);const r={};for(const e of t)r[e.name]=()=>{this.debugAnimationMixer.stopAllAction(),this.debugAnimation=this.debugAnimationMixer.clipAction(e).reset().play()},this.debugMenu.add(r,e.name)}update(t){return this.debugAnimation&&this.debugAnimationMixer.update(t),this.targetAvatar.updateMatrixWorld(),this.targetAvatar.skeleton.update(),this.debugAnimation}}class j{constructor(){this.data=[],this.ready=!1}initialize(t){this.avatars=t,this.debugMenu=new O(this.avatars[0])}onResourcesLoaded(t,e){const n=Object(d.c)(t.animations.find(t=>"await1"===t.name)),r=Object(d.c)(t.animations.find(t=>"awalk1"===t.name)),i=Object(d.c)(t.animations.find(t=>"brun1"===t.name)),s=Object(d.c)(t.animations.find(t=>"aat_yoko1"===t.name)),o=Object(d.c)(t.animations.find(t=>"aat_tate1"===t.name));for(let t=0;t<this.avatars.length;t++){const e=this.avatars[t];this.data[t]={aIdle:e.animationMixer.clipAction(n),aWalk:e.animationMixer.clipAction(r),aRun:e.animationMixer.clipAction(i),aAttackSide:e.animationMixer.clipAction(s),aAttackVert:e.animationMixer.clipAction(o),startingFoot:0};const a=this.data[t];a.aIdle.play().setEffectiveWeight(1),a.aWalk.play().setEffectiveWeight(0),a.aRun.play().setEffectiveWeight(0),a.aAttackSide.setLoop(S.d,1),a.aAttackVert.setLoop(S.d,1),a.aIdle.time=t*(a.aIdle.getClip().duration/(this.avatars.length+1)),a.aWalk.time=F[a.startingFoot]*a.aWalk.getClip().duration,a.aRun.time=E[a.startingFoot]*a.aRun.getClip().duration}this.debugMenu.onResourcesLoaded(t.animations,e),this.ready=!0}update(t,e){if(!this.ready)return;const n=.001*e.renderDt;for(let i=0;i<t.length;i++){const o=this.data[i],a=this.avatars[i],c=t[i];if(!a.active)continue;if(a.local){if(this.debugMenu.update(n))continue}const u=r.d.length(c.velocity);let h=0;if(c.attackType!==R.None){const t=.001*(e.renderTime-c.attackStartFrame*e.simDt),n=c.attackType===R.Side?o.aAttackSide:o.aAttackVert;n.isRunning()||(n.reset(),n.time=t,n.play()),h=Math.min(Object(s.f)(Object(s.d)(0,.2,t)),1-Object(s.f)(Object(s.d)(.8,1.1,t)))}else o.aAttackSide.stop(),o.aAttackVert.stop(),h=0;const l=1-h;{const t=c.flags&I.IsWalking,e=(c.flags,I.IsUTurning,Object(s.f)(1-u/150)),n=Object(s.f)(Object(s.d)(t?150:0,600,u)),r=Object(s.f)(Object(s.d)(0,150,u))-o.aRun.weight;o.aIdle.weight=l*e,o.aRun.weight=l*n,o.aWalk.weight=l*r,o.aRun.timeScale=n,o.aWalk.timeScale=r}c.attackType===R.Side?o.aAttackSide.weight=1*h:o.aAttackVert.weight=1*h,u<=0&&(o.aWalk.time=F[o.startingFoot]*o.aWalk.getClip().duration,o.aRun.time=E[o.startingFoot]*o.aRun.getClip().duration,o.startingFoot=(o.startingFoot+1)%2),a.animationMixer.update(n),a.updateMatrixWorld(),a.skeleton.update()}}}var I,R,B=n(7),U=n(12),D=n(3),P=n(43);class N extends x.b{constructor(){super(...arguments),this.active=!1,this.local=!1}}!function(t){t[t.IsActive=1]="IsActive",t[t.IsWalking=2]="IsWalking",t[t.IsUTurning=4]="IsUTurning"}(I||(I={})),function(t){t[t.None=0]="None",t[t.Side=1]="Side",t[t.Vertical=2]="Vertical",t[t.Throw=3]="Throw"}(R||(R={}));class L{constructor(t=!1){this.origin=r.d.create(),this.velocity=r.d.create(),this.orientation=r.d.fromValues(0,0,1),this.flags=0,L.clear(this),this.flags=t?I.IsActive:0}static clear(t){r.d.zero(t.origin),r.d.zero(t.velocity),r.d.set(t.orientation,0,0,1),t.flags=0,t.weapon=-1,t.attackStartFrame=0,t.attackType=R.None}static lerp(t,e,n,i){r.d.lerp(t.origin,e.origin,n.origin,i),r.d.lerp(t.velocity,e.velocity,n.velocity,i),r.d.lerp(t.orientation,e.orientation,n.orientation,i),t.flags=e.flags&n.flags,t.weapon=n.weapon;const s=e.attackStartFrame-n.attackStartFrame,o=Math.max(e.attackStartFrame,n.attackStartFrame),a=Math.max(e.attackType,n.attackType);Object(d.b)(0===s||Math.abs(s)===o),t.attackStartFrame=o,t.attackType=a}static copy(t,e){r.d.copy(t.origin,e.origin),r.d.copy(t.velocity,e.velocity),r.d.copy(t.orientation,e.orientation),t.flags=e.flags,t.weapon=e.weapon,t.attackStartFrame=e.attackStartFrame,t.attackType=e.attackType}static serialize(t,e){D.a.writeFloat(t,e.origin[0]),D.a.writeFloat(t,e.origin[1]),D.a.writeFloat(t,e.origin[2]),D.a.writeFloat(t,e.velocity[0]),D.a.writeFloat(t,e.velocity[1]),D.a.writeFloat(t,e.velocity[2]),D.a.writeFloat(t,e.orientation[0]),D.a.writeFloat(t,e.orientation[1]),D.a.writeFloat(t,e.orientation[2]),D.a.writeByte(t,e.flags),D.a.writeShort(t,e.weapon),D.a.writeInt(t,e.attackStartFrame),D.a.writeByte(t,e.attackType)}static deserialize(t,e){e.origin[0]=D.a.readFloat(t),e.origin[1]=D.a.readFloat(t),e.origin[2]=D.a.readFloat(t),e.velocity[0]=D.a.readFloat(t),e.velocity[1]=D.a.readFloat(t),e.velocity[2]=D.a.readFloat(t),e.orientation[0]=D.a.readFloat(t),e.orientation[1]=D.a.readFloat(t),e.orientation[2]=D.a.readFloat(t),e.flags=D.a.readByte(t),e.weapon=D.a.readShort(t),e.attackStartFrame=D.a.readInt(t),e.attackType=D.a.readByte(t)}}class z{constructor(){this.avatars=[],this.controllers=[],this.animation=new j,this.renderer=new k;for(let t=0;t<B.a.kAvatarCount;t++)this.avatars[t]=new N,this.controllers[t]=new c;this.localAvatar=this.avatars[0]}initialize(t){t.resources.load("data/Tn.glb","gltf",(e,n)=>{if(e)return console.error("Failed to load resource",e);this.gltf=n,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars),this.renderer.initialize(this.avatars,t.debugMenu)}onJoined(t){this.localAvatar=this.avatars[t],this.localAvatar.local=!0}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const n=this.gltf.nodes[e],r=t.nodes[e];for(const e of n.children){const n=this.gltf.nodes.indexOf(e);r.add(t.nodes[n])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const n=Object(d.c)(this.gltf.skins[0]),r=n.joints.map(e=>t.nodes[e]),i=null===(e=n.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new x.a).fromArray(t));t.skeleton=new v(r,i),t.animationMixer=new T.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu),this.renderer.onResourcesLoaded(this.gltf,t.gfxDevice)}update(t){const e=t.displaySnapshot.avatars;for(let n=0;n<B.a.kAvatarCount;n++){const r=this.avatars[n],i=e[n];if(r.active=!!(i.flags&I.IsActive),r.active&&r.nodes&&i.weapon&&!Object(d.e)(r.weapon)){const e=t.weapons.getById(i.weapon);r.weapon=e,Object(d.c)(r.nodes.find(t=>"j_tn_item_r1"===t.name)).add(e.transform)}const s=new x.c(i.origin);r.position.copy(s),r.lookAt(i.origin[0]+i.orientation[0],i.origin[1]+i.orientation[1],i.origin[2]+i.orientation[2]),r.updateMatrix(),r.updateMatrixWorld()}this.animation.update(e,t.clock)}updateFixed(t){}render(t){this.renderer.render(t.gfxDevice,t.camera)}}class V{constructor(){this.avatars=[],this.controllers=[],this.animation=new j;for(let t=0;t<B.a.kAvatarCount;t++)this.avatars[t]=new N,this.controllers[t]=new c}initialize(t){for(let e=0;e<B.a.kAvatarCount;e++){const n=t.world.add(new L);Object(d.b)(n===e)}t.resources.load("data/Tn.glb","gltf",(e,n)=>{if(e)return console.error("Failed to load resource",e);this.gltf=n,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars)}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const n=this.gltf.nodes[e],r=t.nodes[e];for(const e of n.children){const n=this.gltf.nodes.indexOf(e);r.add(t.nodes[n])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const n=Object(d.c)(this.gltf.skins[0]),r=n.joints.map(e=>t.nodes[e]),i=null===(e=n.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new x.a).fromArray(t));t.skeleton=new v(r,i),t.animationMixer=new T.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu)}update(t){}updateFixed(t){const e=t.world.objects.slice(0,B.a.kAvatarCount).map(t=>t.data);for(let n=0;n<B.a.kAvatarCount;n++){const r=e[n],i=this.avatars[n];if(i.active=!!(r.flags&I.IsActive),!(r.flags&I.IsActive))continue;const s=new x.c(r.origin);i.position.copy(s),i.lookAt(r.origin[0]+r.orientation[0],r.origin[1]+r.orientation[1],r.origin[2]+r.orientation[2]),i.updateMatrix(),i.updateMatrixWorld();const o=t.net.clients[n];if(o&&o.state===U.c.Active){const e=o.getUserCommand(t.clock.simFrame),i=t.clock.simDt/1e3,s=this.controllers[n].update(r,t.clock.simFrame,i,e);Object.assign(r,s)}}this.animation.update(e,t.clock)}addAvatar(t,e){const n=t.get(e).data;Object(d.b)(!(n.flags&I.IsActive)),n.flags|=I.IsActive;const r=new P.a,i=t.add(r);r.parent=e,n.weapon=i}removeAvatar(t,e){const n=t.get(e).data;Object(d.b)((n.flags&I.IsActive)>0),Object(d.e)(n.weapon)&&t.remove(n.weapon),L.clear(n)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return c}));var r=n(1),i=n(0),s=n(10);class o{constructor(t,e,n,r){this.shader=n,this.name=e,this.layout=r,this.resources=t.createResourceTable(this.layout),this.bindings={}}destroy(t){t.removeResourceTable(this.resources)}assertReady(){for(const t of Object.keys(this.layout))Object(i.c)(this.bindings[t],`Material expects a binding for ${t}`)}getUniformBuffer(t){const e=this.bindings[t];return Object(i.c)(e,`Uniform buffer "${t}" is not bound to material "${this.name}"`),e}setUniformBuffer(t,e,n){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===r.a.UniformBuffer,"Mismatching resource type"),this.bindings[e]=n,t.setBuffer(this.resources,s.index,n.getBufferView())}setTexture(t,e,n){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===r.a.Texture,"Mismatching resource type"),Object(i.b)(!Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=n,t.setTexture(this.resources,s.index,n)}setTextureArray(t,e,n){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===r.a.Texture,"Mismatching resource type"),Object(i.b)(Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=n,t.setTextures(this.resources,s.index,n)}}class a extends s.b{constructor(t,e,n,r){super(),this.renderList=e,this.mesh=n,this.material=r,this.pipeline=t.createRenderPipeline(r.shader,e.renderFormat,n.vertexLayout,r.layout),this.vertexTable=t.createVertexTable(this.pipeline),n.vertexBuffers.forEach((e,n)=>{t.setVertexBuffer(this.vertexTable,n,e)}),this._primitive={renderPipeline:this.pipeline,resourceTable:this.material.resources,vertexTable:this.vertexTable,elementCount:this.mesh.elementCount,type:this.mesh.primitiveType,indexBuffer:this.mesh.indexBuffer,indexType:this.mesh.indexType}}get primitive(){return this.material.assertReady(),this._primitive}destroy(t){t.removeVertexTable(this.vertexTable),t.removeRenderPipeline(this.pipeline)}}class c extends a{constructor(t,e,n,r){super(t,e,n,r)}bindSkeleton(t,e){this.skeleton=e;const n={type:r.k.Texture2D,format:r.i.F32x4,usage:r.n.Dynamic,width:4,height:e.bones.length,defaultMinFilter:r.j.Nearest,defaultMagFilter:r.j.Nearest};this.boneTex=t.createTexture("BoneTex",n,this.skeleton.boneMatrices)}writeBonesToTex(t){return t.writeTextureData(this.boneTex,this.skeleton.boneMatrices),this.boneTex}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return u}));var r,i=n(9),s=n(30),o=n(0),a=n(18);!function(t){t.Open="open",t.Close="close",t.Message="message"}(r||(r={}));class c extends i.a{constructor(t){super(),this.signalSocket=t}async listen(t){this.signalSocket.on(s.b.Message,this.onMessage.bind(this,t)),this.iceServers=await this.signalSocket.requestIceServers()}async onMessage(t,e,n){console.debug("WebUDP: Received message",e),Object(o.c)(e.offer,"Expected an offer");const r=new u;r.accept(this.signalSocket,e,n),t(r)}}class u extends i.a{get isOpen(){return this.channel&&"open"===this.channel.readyState}connect(t){Object(o.b)(!Object(o.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=t;const e=new s.a,n=e.connect().then(()=>{this.clientId=e.clientId});return n.then(async()=>{const t=a.b?{}:await e.requestIceServers();this.peer=this.createPeer(t),this.peer.onconnectionstatechange=()=>{switch(this.peer.connectionState){case"connected":case"disconnected":break;case"failed":case"closed":this.close()}};const n=this.getIceCandidates(),r=this.peer.createDataChannel("webudp",{ordered:!1,maxRetransmits:0});this.setDataChannel(r);const i=await this.peer.createOffer();await this.peer.setLocalDescription(i),await n;const c={offer:Object(o.c)(this.peer.localDescription)};e.send(this.peerId,c),e.once(s.b.Message,(t,n)=>{Object(o.c)(t.answer,'Expected "answer" message from remote peer');console.debug("WebUDP: Received answer",t.answer),this.peer.setRemoteDescription(t.answer),e.close()})}),n}async accept(t,e,n){Object(o.b)(!Object(o.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=n,this.clientId=t.clientId;const r=a.b?{}:await t.requestIceServers();this.peer=this.createPeer(r);const i=this.getIceCandidates();await this.peer.setRemoteDescription(e.offer);const s=await this.peer.createAnswer();this.peer.setLocalDescription(s),await i,t.send(this.peerId,{answer:this.peer.localDescription}),this.peer.ondatachannel=t=>{this.setDataChannel(t.channel)}}send(t){return!(!this.channel||!this.isOpen)&&(this.channel.send(t),!0)}close(){Object(o.e)(this.peer)&&(this.fire(r.Close),this.channel&&this.channel.close(),this.peer&&this.peer.close(),this.peer=null,this.channel=null)}createPeer(t){return new RTCPeerConnection(t)}onDataChannelOpen(){console.debug("WebUDP: DataChannel open"),this.fire(r.Open)}onDataChannelClosed(){console.debug("WebUDP: DataChannel closed"),this.close()}onDataChannelError(t){var e;"closed"!==(null===(e=this.channel)||void 0===e?void 0:e.readyState)&&console.error("WebUdpPeer: Data channel error:",t.error)}setDataChannel(t){t.binaryType="arraybuffer",t.onopen=this.onDataChannelOpen.bind(this),t.onclose=this.onDataChannelClosed.bind(this),t.onerror=this.onDataChannelError.bind(this),t.onmessage=t=>{this.fire(r.Message,t)},this.channel=t}getIceCandidates(){return new Promise(t=>{const e=[];this.peer.onicecandidate=n=>{n.candidate?(console.debug("WebUDP: Received ICE candidate",n.candidate),e.push(n.candidate)):(console.debug("WebUDP: Received all ICE candidates"),t(e))}})}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a}));var r=n(0),i=n(3);class s{static serialize(t,e){const n=Math.atan2(e.headingZ,e.headingX);i.a.writeAngle16(t,n);let r=0;return r|=3&Math.sign(e.verticalAxis)+1<<0,r|=12&Math.sign(e.horizontalAxis)+1<<2,r|=240&e.actions<<4,i.a.writeByte(t,r),3}static deserialize(t,e){const n=i.a.readAngle16(e);t.headingX=Math.cos(n),t.headingZ=Math.sin(n);let r=i.a.readByte(e);return t.verticalAxis=((3&r)>>0)-1,t.horizontalAxis=((12&r)>>2)-1,t.actions=(240&r)>>4,3}}const o={frame:-1,headingX:0,headingZ:1,verticalAxis:0,horizontalAxis:0,actions:0};new TextEncoder,new TextDecoder;class a{constructor(){this.buffer=[],this.bufferSize=64,this.lastFrame=-1}setUserCommand(t){Object(r.b)(Number.isInteger(t.frame));const e=this.buffer[t.frame%this.bufferSize];return(!Object(r.e)(e)||e.frame!==t.frame)&&(this.buffer[t.frame%this.bufferSize]=t,this.lastFrame=t.frame,!0)}getUserCommand(t=this.lastFrame){if(Object(r.b)(Number.isInteger(t)),-1===t)return Object.assign(Object.assign({},o),{frame:t});const e=this.buffer[t%this.bufferSize];return Object(r.e)(e)&&e.frame===t?e:void 0}}},function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){var r,i=n(81),s=n(54),o=n(83),a=n(84),c=n(85);"undefined"!=typeof ArrayBuffer&&(r=n(86));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=u||h;e.protocol=3;var f=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=i(f),p={type:"error",data:"parser error"},m=n(87);function g(t,e,n){for(var r=new Array(t.length),i=a(t.length,n),s=function(t,n,i){e(n,(function(e,n){r[t]=n,i(e,r)}))},o=0;o<t.length;o++)s(o,t[o],i)}e.encodePacket=function(t,n,r,i){"function"==typeof n&&(i=n,n=!1),"function"==typeof r&&(i=r,r=null);var s=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=t.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=f[t.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return r(o.buffer)}(t,n,i);if(void 0!==m&&s instanceof m)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(l)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=new FileReader;return i.onload=function(){e.encodePacket({type:t.type,data:i.result},n,!0,r)},i.readAsArrayBuffer(t.data)}(t,n,r);var i=new Uint8Array(1);i[0]=f[t.type];var s=new m([i.buffer,t.data]);return r(s)}(t,n,i);if(s&&s.base64)return function(t,n){var r="b"+e.packets[t.type]+t.data.data;return n(r)}(t,i);var o=f[t.type];return void 0!==t.data&&(o+=r?c.encode(String(t.data),{strict:!1}):String(t.data)),i(""+o)},e.encodeBase64Packet=function(t,n){var r,i="b"+e.packets[t.type];if(void 0!==m&&t.data instanceof m){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];n(i+t)},s.readAsDataURL(t.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var o=new Uint8Array(t.data),a=new Array(o.length),c=0;c<o.length;c++)a[c]=o[c];r=String.fromCharCode.apply(null,a)}return i+=btoa(r),n(i)},e.decodePacket=function(t,n,r){if(void 0===t)return p;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&!1===(t=function(t){try{t=c.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return p;var i=t.charAt(0);return Number(i)==i&&d[i]?t.length>1?{type:d[i],data:t.substring(1)}:{type:d[i]}:p}i=new Uint8Array(t)[0];var s=o(t,1);return m&&"blob"===n&&(s=new m([s])),{type:d[i],data:s}},e.decodeBase64Packet=function(t,e){var n=d[t.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:t.substr(1)}};var i=r.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:n,data:i}},e.encodePayload=function(t,n,r){"function"==typeof n&&(r=n,n=null);var i=s(t);if(n&&i)return m&&!l?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r);if(!t.length)return r("0:");g(t,(function(t,r){e.encodePacket(t,!!i&&n,!1,(function(t){r(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return r(e.join(""))}))},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===t)return r(p,0,1);for(var s,o,a="",c=0,u=t.length;c<u;c++){var h=t.charAt(c);if(":"===h){if(""===a||a!=(s=Number(a)))return r(p,0,1);if(a!=(o=t.substr(c+1,s)).length)return r(p,0,1);if(o.length){if(i=e.decodePacket(o,n,!1),p.type===i.type&&p.data===i.data)return r(p,0,1);if(!1===r(i,c+s,u))return}c+=s,a=""}else a+=h}return""!==a?r(p,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));g(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){return n(null,t)}))}),(function(t,e){var r=e.reduce((function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2}),0),i=new Uint8Array(r),s=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);n=r.buffer}i[s++]=e?0:1;var a=n.byteLength.toString();for(o=0;o<a.length;o++)i[s++]=parseInt(a[o]);i[s++]=255;for(r=new Uint8Array(n),o=0;o<r.length;o++)i[s++]=r[o]})),n(i.buffer)}))},e.encodePayloadAsBlob=function(t,n){g(t,(function(t,n){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)o[i]=parseInt(s[i]);if(o[s.length]=255,m){var a=new m([e.buffer,o.buffer,t]);n(null,a)}}))}),(function(t,e){return n(new m(e))}))},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var i=t,s=[];i.byteLength>0;){for(var a=new Uint8Array(i),c=0===a[0],u="",h=1;255!==a[h];h++){if(u.length>310)return r(p,0,1);u+=a[h]}i=o(i,2+u.length),u=parseInt(u);var l=o(i,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var f=new Uint8Array(l);l="";for(h=0;h<f.length;h++)l+=String.fromCharCode(f[h])}s.push(l),i=o(i,u)}var d=s.length;s.forEach((function(t,i){r(e.decodePacket(t,n,!0),i,d)}))}},function(t,e,n){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=t.exports,r=function(){for(var t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,s={};r<i;r++)if((t=n[r])&&t[1]in e){for(r=0;r<t.length;r++)s[n[0][r]]=t[r];return s}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},s={request:function(t){return new Promise(function(n,i){var s=function(){this.off("change",s),n()}.bind(this);this.on("change",s);var o=(t=t||e.documentElement)[r.requestFullscreen]();o instanceof Promise&&o.then(s).catch(i)}.bind(this))},exit:function(){return new Promise(function(t,n){if(this.isFullscreen){var i=function(){this.off("change",i),t()}.bind(this);this.on("change",i);var s=e[r.exitFullscreen]();s instanceof Promise&&s.then(i).catch(n)}else t()}.bind(this))},toggle:function(t){return this.isFullscreen?this.exit():this.request(t)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,n){var r=i[t];r&&e.addEventListener(r,n,!1)},off:function(t,n){var r=i[t];r&&e.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),n?t.exports=s:window.screenfull=s):n?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var r=n(8),i=n(1),s=n(2),o=n(29),a=n(0),c=n(14);const u=s.e.fromValues(1,0,0,1),h={},l={},f=s.a.create(),d=(new Float32Array(16),s.d.create()),p=new Float32Array(196608);class m{static setContext(t,e){this.renderer=t,this.globalUniforms=e}static initialize(){const t=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),e=this.renderer.createBuffer("ObbVerts",i.c.Vertex,i.n.Static,t),n=new Uint16Array([0,1,1,3,3,2,2,0,0,4,1,5,3,7,2,6,4,5,5,7,7,6,6,4,0,2,1,1,2,3,1,3,5,5,3,7,4,6,0,0,6,2,2,6,3,3,6,7,4,0,5,5,0,1,5,7,4,4,7,6]),s=this.renderer.createBuffer("ObbIndices",i.c.Index,i.n.Static,n),a={blendingEnabled:!0,srcBlendFactor:i.b.Source,dstBlendFactor:i.b.OneMinusSource},c={buffers:[{stride:12,layout:{a_pos:{type:i.m.Float3,offset:0}}}]},u=this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!0}),f=(this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!1}),this.renderer.createDepthStencilState({depthTestEnabled:!1,depthWriteEnabled:!1}));class d{constructor(){this.name="Obb",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n\n  uniform mat3 u_extents;\n  uniform vec3 u_center;\n\n  uniform mat4 g_viewProj;\n\n  void main()\n  {\n    vec3 pos = u_center + u_extents * a_pos;\n    gl_Position = g_viewProj * vec4(pos, 1.0);\n  }\n",this.fragSource="\n  precision mediump float;\n  uniform lowp vec4 u_color;\n\n  void main()\n  {\n    gl_FragColor = u_color;\n  }\n",this.resourceLayout=d.resourceLayout}}d.uniformLayout=Object(r.b)({u_extents:{type:i.m.Float3x3},u_center:{type:i.m.Float3},u_color:{type:i.m.Float4}}),d.resourceLayout={uniforms:{index:0,type:i.a.UniformBuffer,layout:d.uniformLayout},globalUniforms:{index:1,type:i.a.UniformBuffer,layout:o.a.bufferLayout}},h.shader=this.renderer.createShader(new d),h.pipeline=this.renderer.createRenderPipeline(h.shader,{blendingEnabled:!1},c,d.resourceLayout),h.resources=this.renderer.createResourceTable(d.resourceLayout),h.vertTable=this.renderer.createVertexTable(h.pipeline),h.depthState=u,h.uniforms=new r.a("ObbUniforms",this.renderer,d.uniformLayout),h.indexBuffer=s,h.count=0,this.renderer.setVertexBuffer(h.vertTable,0,{buffer:e}),this.renderer.setBuffer(h.resources,0,h.uniforms.getBufferView()),this.renderer.setBuffer(h.resources,1,this.globalUniforms.bufferView);class p{constructor(){this.name="Points",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n  attribute vec4 a_color;\n\n  uniform mat4 g_viewProj;\n\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    v_color = a_color;\n\n    gl_Position = g_viewProj * vec4(a_pos, 1.0);\n    gl_PointSize = 4.0;\n  }\n",this.fragSource="\n  precision mediump float;\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    gl_FragColor = v_color;\n  }\n",this.resourceLayout=p.resourceLayout}}p.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:o.a.bufferLayout}};const m={buffers:[{stride:32,layout:{a_pos:{offset:0,type:i.m.Float3},a_color:{offset:16,type:i.m.Float4}}}]};l.shader=this.renderer.createShader(new p),l.pipeline=this.renderer.createRenderPipeline(l.shader,a,m,p.resourceLayout),l.resources=this.renderer.createResourceTable(p.resourceLayout),l.vertTable=this.renderer.createVertexTable(l.pipeline),l.depthState=f,l.vertexBuffer=this.renderer.createBuffer("PointsVerts",i.c.Vertex,i.n.Dynamic,32768*m.buffers[0].stride),l.count=0,this.renderer.setVertexBuffer(l.resources,0,{buffer:l.vertexBuffer}),this.renderer.setBuffer(l.resources,0,this.globalUniforms.bufferView)}static renderObbs(t,e=!1,n=u){Object(a.e)(h.pipeline)||this.initialize(),Object(a.b)(1===t.length,"Drawing multiple OBBs not yet supported. (Need to use multiple uniform buffers)"),h.uniforms.setVec4("u_color",n);for(let e of t){const t=s.a.fromMat4(f,e);h.uniforms.setFloats("u_extents",t),h.uniforms.setVec3("u_center",s.b.getTranslation(d,e))}h.uniforms.write(this.renderer);const r={renderPipeline:h.pipeline,vertexTable:h.vertTable,depthMode:h.depthState,resourceTable:h.resources,indexType:i.m.Ushort,indexBuffer:{buffer:h.indexBuffer,byteOffset:e?48:0},type:e?i.g.Triangles:i.g.Lines,elementCount:e?36:24};c.a.debug.push(r)}static renderLines(t,e){Object(a.e)(l.pipeline)||this.initialize(),console.assert(t.length<32768);for(let n=0;n<t.length;n++)p.set(t[n],8*n+0),p.set(e,8*n+4);this.renderer.writeBufferData(l.vertexBuffer,32*l.count,p.subarray(0,8*t.length)),l.count+=t.length}static flush(){if(l.count>0){const t={renderPipeline:l.pipeline,depthMode:l.depthState,resourceTable:l.resources,vertexTable:l.vertTable,type:i.g.Lines,elementCount:l.count};c.a.debug.push(t),l.count=0}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return k}));var r=n(13),i=n(6),s=n(11),o=n(36),a=n(17),c=new s.a,u=new r.a;function h(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||h.DefaultOrder}function l(){this.mask=1}function f(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}h.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=a.a.clamp,i=t.elements,s=i[0],o=i[4],c=i[8],u=i[1],h=i[5],l=i[9],f=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-f,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(u,s))):"ZYX"===e?(this._y=Math.asin(-r(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-o,h))):"YZX"===e?(this._z=Math.asin(r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(c,p))):"XZY"===e?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(c,s)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return c.makeRotationFromQuaternion(t),this.setFromRotationMatrix(c,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return u.setFromEuler(this),this.setFromQuaternion(u,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new i.a(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(l.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(f.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,s,o,a,c){var u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=i,u[5]=a,u[6]=n,u[7]=s,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,i=this.elements,s=n[0],o=n[3],a=n[6],c=n[1],u=n[4],h=n[7],l=n[2],f=n[5],d=n[8],p=r[0],m=r[3],g=r[6],y=r[1],b=r[4],v=r[7],w=r[2],x=r[5],_=r[8];return i[0]=s*p+o*y+a*w,i[3]=s*m+o*b+a*x,i[6]=s*g+o*v+a*_,i[1]=c*p+u*y+h*w,i[4]=c*m+u*b+h*x,i[7]=c*g+u*v+h*_,i[2]=l*p+f*y+d*w,i[5]=l*m+f*b+d*x,i[8]=l*g+f*v+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],c=t[7],u=t[8];return e*s*u-e*o*c-n*i*u+n*o*a+r*i*c-r*s*a},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,r=this.elements,i=n[0],s=n[1],o=n[2],a=n[3],c=n[4],u=n[5],h=n[6],l=n[7],f=n[8],d=f*c-u*l,p=u*h-f*a,m=l*a-c*h,g=i*d+s*p+o*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var y=1/g;return r[0]=d*y,r[1]=(o*l-f*s)*y,r[2]=(u*s-o*c)*y,r[3]=p*y,r[4]=(f*i-o*h)*y,r[5]=(o*a-u*i)*y,r[6]=m*y,r[7]=(s*h-l*i)*y,r[8]=(c*i-s*a)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,i,s,o){var a=Math.cos(i),c=Math.sin(i);this.set(n*a,n*c,-n*(a*s+c*o)+s+t,-r*c,r*a,-r*(-c*s+a*o)+o+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],s=r[3],o=r[6],a=r[1],c=r[4],u=r[7];return r[0]=e*i+n*a,r[3]=e*s+n*c,r[6]=e*o+n*u,r[1]=-n*i+e*a,r[4]=-n*s+e*c,r[7]=-n*o+e*u,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var d=0,p=new i.a,m=new r.a,g=new s.a,y=new i.a,b=new i.a,v=new i.a,w=new r.a,x=new i.a(1,0,0),_=new i.a(0,1,0),C=new i.a(0,0,1),M={type:"added"},A={type:"removed"};function k(){Object.defineProperty(this,"id",{value:d++}),this.uuid=a.a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=k.DefaultUp.clone();var t=new i.a,e=new h,n=new r.a,o=new i.a(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new s.a},normalMatrix:{value:new f}}),this.matrix=new s.a,this.matrixWorld=new s.a,this.matrixAutoUpdate=k.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new l,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}k.DefaultUp=new i.a(0,1,0),k.DefaultMatrixAutoUpdate=!0,k.prototype=Object.assign(Object.create(o.a.prototype),{constructor:k,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.multiply(m),this},rotateOnWorldAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.premultiply(m),this},rotateX:function(t){return this.rotateOnAxis(x,t)},rotateY:function(t){return this.rotateOnAxis(_,t)},rotateZ:function(t){return this.rotateOnAxis(C,t)},translateOnAxis:function(t,e){return p.copy(t).applyQuaternion(this.quaternion),this.position.add(p.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(x,t)},translateY:function(t){return this.translateOnAxis(_,t)},translateZ:function(t){return this.translateOnAxis(C,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(g.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?y.copy(t):y.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),b.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?g.lookAt(b,y,this.up):g.lookAt(y,b,this.up),this.quaternion.setFromRotationMatrix(g),r&&(g.extractRotation(r.matrixWorld),m.setFromRotationMatrix(g),this.quaternion.premultiply(m.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(M)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(A)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),g.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),g.multiply(t.parent.matrixWorld)),t.applyMatrix4(g),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new i.a),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new r.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(b,t,v),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new i.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(b,w,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new i.a),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var r=this.children,i=0,s=r.length;i<s;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var o=s.shapes;if(Array.isArray(o))for(var a=0,c=o.length;a<c;a++){var u=o[a];i(t.shapes,u)}else i(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(a=0,c=this.material.length;a<c;a++)h.push(i(t.materials,this.material[a]));r.material=h}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(e){var l=m(t.geometries),f=m(t.materials),d=m(t.textures),p=m(t.images);o=m(t.shapes);l.length>0&&(n.geometries=l),f.length>0&&(n.materials=f),d.length>0&&(n.textures=d),p.length>0&&(n.images=p),o.length>0&&(n.shapes=o)}return n.object=r,n;function m(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}})},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(1),i=n(8);class s{constructor(t){this.renderer=t}initialize(){this.buffer=new i.a("GlobalUniforms",this.renderer,s.bufferLayout),this.bufferView=this.buffer.getBufferView()}update(){this.buffer.write(this.renderer)}}s.bufferLayout=Object(i.b)({g_camPos:{type:r.m.Float3},g_proj:{type:r.m.Float4x4},g_viewProj:{type:r.m.Float4x4}})},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return a}));var r,i=n(60),s=n(9),o=n(0);!function(t){t.JoinedRoom="joined",t.ClientJoined="clientjoin",t.Message="message",t.RoomMessage="roomMessage"}(r||(r={}));class a extends s.a{constructor(){super(...arguments),this.connected=!1}connect(t=window.config.kSignalServerAddress){return Object(o.b)(!this.connected),new Promise(e=>{this.socket=i.connect(t),this.socket.on("connect",()=>{this.connected=!0,console.debug("SignalSocket: Connected to MoonBeacon with ID:",this.socket.id)}),this.socket.on("roomJoined",t=>{console.debug("SignalSocket: Joined room:",t),this.room=t,e()}),this.socket.on("clientJoined",t=>{console.debug("SignalSocket: Client joined:",t),this.room.clients[t.id]=t,this.fire(r.ClientJoined,t.id)}),this.socket.on("clientLeaving",(t,e)=>{console.debug("SignalSocket: Client left:",t),delete this.room.clients[t]}),this.socket.on("message",t=>{console.debug("SignalSocket: Message received",t),this.fire(r.Message,t.data,t.from)}),this.socket.on("messageRoom",t=>{this.fire(r.RoomMessage,t.data,t.from)})})}send(t,e){const n={from:this.clientId,to:t,data:e};console.debug("SignalSocket: Sending message",n),this.socket.emit("message",n)}broadcast(t){const e={from:this.clientId,data:t};this.socket.emit("messageRoom",e)}requestIceServers(){return new Promise((t,e)=>{this.socket.emit("iceServers",e=>{t({iceServers:e})})})}close(){this.socket.close()}get clients(){return Object.keys(this.room.clients)}get serverId(){return this.room.server}get clientId(){return this.socket.id}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return x})),n.d(e,"b",(function(){return C}));var r=n(0),i=n(9);const s={passive:!1,capture:!1};class o{constructor(t){var e=this.getTouchTargetCoords(t);this.x=e.x,this.y=e.y,this.id=t.identifier,this.target=t.target,this.touch=t}getTouchTargetCoords(t){for(var e=0,n=0,i=t.target;!(i instanceof HTMLElement);)i=Object(r.c)(i.parentNode);var s=i;do{e+=s.offsetLeft-s.scrollLeft,n+=s.offsetTop-s.scrollTop,s=s.offsetParent}while(s);return{x:t.pageX-e,y:t.pageY-n}}}class a{constructor(t,e){if(this.element=e.target,this.event=e,this.touches=[],this.changedTouches=[],e){var n,r=e.touches.length;for(n=0;n<r;n++)this.touches.push(new o(e.touches[n]));for(r=e.changedTouches.length,n=0;n<r;n++)this.changedTouches.push(new o(e.changedTouches[n]))}}getTouchById(t,e){var n,r=e.length;for(n=0;n<r;n++)if(e[n].id===t)return e[n];return null}}class c extends i.a{constructor(t){super(),this.element=void 0,this.onStart=t=>{t.preventDefault(),this.fire("touchstart",new a(this,t))},this.onEnd=t=>{t.preventDefault(),this.fire("touchend",new a(this,t))},this.onCancel=t=>{this.fire("touchcancel",new a(this,t))},this.onMove=t=>{t.preventDefault(),this.fire("touchmove",new a(this,t))},this.attach(t)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("touchstart",this.onStart,s),this.element.addEventListener("touchend",this.onEnd,s),this.element.addEventListener("touchmove",this.onMove,s),this.element.addEventListener("touchcancel",this.onCancel,s)}detach(){this.element&&(this.element.removeEventListener("touchstart",this.onStart,s),this.element.removeEventListener("touchend",this.onEnd,s),this.element.removeEventListener("touchmove",this.onMove,s),this.element.removeEventListener("touchcancel",this.onCancel,s)),this.element=void 0}registerAxis(t){let e,n,i;const s={value:0,options:t},o=t.source===b.TouchDragX?"x":"y";return this.on("touchstart",a=>{if(a.touches.length-1===Object(r.d)(t.index,0)){const t=a.changedTouches[0];e=t.id,n=performance.now(),i=t[o],s.value=0}}),this.on("touchend",t=>{const a=t.changedTouches.find(t=>t.id===e);if(Object(r.e)(a)){const r=t.changedTouches[0];e=r.id,n=performance.now(),i=r[o],s.value=0}}),this.on("touchmove",t=>{const a=t.changedTouches.find(t=>t.id===e);if(Object(r.e)(a)){const t=a[o],e=performance.now(),r=t-i;s.value=r,n=e}}),s}}class u extends i.a{constructor(t,e={}){super(),this.keysDown=new Map,this.handleKeyDown=this.onKeyDown.bind(this),this.handleKeyUp=this.onKeyUp.bind(this),this.attach(t),this.preventDefault=Object(r.d)(e.preventDefault,!1),this.stopPropagation=Object(r.d)(e.stopPropagation,!1)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("keydown",this.handleKeyDown,!1),this.element.addEventListener("keyup",this.handleKeyUp,!1)}detach(){this.element&&(this.element.removeEventListener("keydown",this.handleKeyDown),this.element.removeEventListener("keyup",this.handleKeyUp),this.element=void 0)}onKeyDown(t){var e=t.code;t.repeat||void 0!==e&&(this.keysDown.set(e,!0),this.fire("keydown",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}onKeyUp(t){var e=t.code;void 0!==e&&(this.keysDown.delete(e),this.fire("keyup",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}update(){this.keysDown.forEach((t,e)=>{this.keysDown.set(e,!1)})}isPressed(t){return this.keysDown.has(t)}wasPressed(t){return!!this.keysDown.get(t)}clear(){this.fire("clear",event),this.keysDown.clear()}}var h,l,f=n(26),d=n.n(f);!function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"}(h||(h={})),function(t){t.MouseUp="mouseup",t.MouseDown="mousedown",t.MouseMove="mousemove",t.MouseWheel="mousewheel"}(l||(l={}));const p={passive:!1,capture:!1};class m{constructor(t,e){Object(r.c)(e),Object(r.b)(e instanceof MouseEvent,"Expected MouseEvent");const n=t._getTargetCoords(e);if(n)this.x=n.x,this.y=n.y;else{if(!g.isPointerLocked())return;this.x=0,this.y=0}if(this.wheelDelta=0,"wheel"===e.type){const t=e;t.deltaY>0?this.wheelDelta=1:t.deltaY<0&&(this.wheelDelta=-1)}g.isPointerLocked()?(this.dx=e.movementX||0,this.dy=e.movementY||0):(this.dx=this.x-t._lastX,this.dy=this.y-t._lastY),"mousedown"!==e.type&&"mouseup"!==e.type||(this.button=e.button),this.buttons=t._buttons.slice(0),this.element=e.target,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.event=e}}class g extends i.a{constructor(t){super(),this.attached=!1,this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastButtons=[!1,!1,!1],this.onUp=this.handleUp.bind(this),this.onDown=this.handleDown.bind(this),this.onMove=this.handleMove.bind(this),this.onWheel=this.handleWheel.bind(this),this.onContextMenu=t=>{t.preventDefault()},this.attach(t)}static isPointerLocked(){return!!document.pointerLockElement}attach(t){this.target=t,this.attached||(this.attached=!0,window.addEventListener("mouseup",this.onUp,p),window.addEventListener("mousedown",this.onDown,p),window.addEventListener("mousemove",this.onMove,p),window.addEventListener("wheel",this.onWheel,p))}detach(){this.attached&&(this.attached=!1,this.target=null,window.removeEventListener("mouseup",this.onUp,p),window.removeEventListener("mousedown",this.onDown,p),window.removeEventListener("mousemove",this.onMove,p),window.removeEventListener("wheel",this.onWheel,p))}disableContextMenu(){this.target&&this.target.addEventListener("contextmenu",this.onContextMenu)}enableContextMenu(){this.target&&this.target.removeEventListener("contextmenu",this.onContextMenu)}enablePointerLock(t,e){if(document.body.requestPointerLock){if(t){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}if(e){const t=function(){e(),document.removeEventListener("pointerlockerror",t)};document.addEventListener("pointerlockerror",t,!1)}document.body.requestPointerLock()}else e&&e()}disablePointerLock(t){if(document.exitPointerLock){if(Object(r.e)(t)){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}document.exitPointerLock()}}update(){this._lastButtons[0]=this._buttons[0],this._lastButtons[1]=this._buttons[1],this._lastButtons[2]=this._buttons[2]}isPressed(t){return this._buttons[t]}wasPressed(t){return this._buttons[t]&&!this._lastButtons[t]}wasReleased(t){return!this._buttons[t]&&this._lastButtons[t]}handleUp(t){this._buttons[t.button]=!1;const e=new m(this,t);e.event&&this.fire(l.MouseUp,e)}handleDown(t){this._buttons[t.button]=!0;const e=new m(this,t);e.event&&this.fire(l.MouseDown,e)}handleMove(t){const e=new m(this,t);e.event&&(this.fire(l.MouseMove,e),this._lastX=e.x,this._lastY=e.y)}handleWheel(t){const e=new m(this,t);e.event&&this.fire(l.MouseWheel,e)}_getTargetCoords(t){const e=Object(r.c)(this.target),n=e.getBoundingClientRect(),i=Math.floor(n.left),s=Math.floor(n.top);return t.clientX<i||t.clientX>=i+e.clientWidth||t.clientY<s||t.clientY>=s+e.clientHeight?null:{x:t.clientX-i,y:t.clientY-s}}}class y{constructor(t){this.name=t}}var b;!function(t){t[t.MouseDragX=0]="MouseDragX",t[t.MouseDragY=1]="MouseDragY",t[t.MouseWheel=2]="MouseWheel",t[t.TouchDragX=3]="TouchDragX",t[t.TouchDragY=4]="TouchDragY",t[t.TouchPinch=5]="TouchPinch",t[t.TouchRotate=6]="TouchRotate",t[t.TwoTouchDragX=7]="TwoTouchDragX",t[t.TwoTouchDragY=8]="TwoTouchDragY",t[t.PadLeftStickX=9]="PadLeftStickX",t[t.PadLeftStickY=10]="PadLeftStickY",t[t.PadRightStickX=11]="PadRightStickX",t[t.PadRightStickY=12]="PadRightStickY",t[t.Key=13]="Key"}(b||(b={}));class v{constructor(){this.actions={},this.axes={}}attach(t){this.element=t,Object(r.e)(this.touch)&&this.touch.attach(t),Object(r.e)(this.keyboard)&&this.keyboard.attach(t),Object(r.e)(this.mouse)&&this.mouse.attach(t),window.addEventListener("blur",()=>{this.keyboard.clear()}),d.a.isEnabled&&d.a.onchange(()=>{this.keyboard.clear()})}detach(t){Object(r.e)(this.touch)&&this.touch.detach(),Object(r.e)(this.keyboard)&&this.keyboard.detach(),Object(r.e)(this.mouse)&&this.mouse.detach(),this.element=void 0}disableContextMenu(){this.mouse||this.enableMouse(),this.mouse.disableContextMenu()}enableContextMenu(){this.mouse||this.enableMouse(),this.mouse.enableContextMenu()}updateAxes(){for(const t in this.axes)for(const e of this.axes[t])e.func&&(e.value=e.func())}afterFrame(){this.keyboard&&this.keyboard.update(),this.mouse&&this.mouse.update()}registerKeys(t,e){this.keyboard||this.enableKeyboard(),Object(r.e)(this.actions[t])||(this.actions[t]=new y(name));const n=this.actions[t];Object(r.b)(!Object(r.e)(n.keys),"Action already has key bindings"),n.keys=e}registerMouse(t,e){this.mouse||this.enableMouse(),Object(r.e)(this.actions[t])||(this.actions[t]=new y(name));const n=this.actions[t];Object(r.b)(!Object(r.e)(n.mouseButtons),"Action already has mouse bindings"),n.mouseButtons=e}registerPadButton(t,e,n){Object(r.e)(this.actions[t])||(this.actions[t]=new y(name));const i=this.actions[t];Object(r.b)(!Object(r.e)(i.padButtons),"Action already has mouse bindings"),i.padButtons=e,i.padIndexes=n}registerAxis(t,e){Object(r.e)(this.axes[t])||(this.axes[t]=[]);const n=this.axes[t];switch(e.source){case b.Key:n.push({value:0,options:e,func:()=>{let t=0;return Object(r.e)(e.positiveKey)&&(t+=this.keyboard.isPressed(e.positiveKey)?1:0),Object(r.e)(e.negativeKey)&&(t+=this.keyboard.isPressed(e.negativeKey)?-1:0),t}});break;case b.TouchDragX:case b.TouchDragY:{Object(r.e)(this.touch)||this.enableTouches();const t=this.touch.registerAxis(e);n.push(t)}}}isPressed(t){const e=this.actions[t];if(!Object(r.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.isPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.isPressed(t))return!0;return!1}wasPressed(t){const e=this.actions[t];if(!Object(r.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.wasPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.wasPressed(t))return!0;return!1}getAxis(t){const e=Object(r.c)(this.axes[t],`No axis named "${t}"`);let n=0;for(const t of e)Math.abs(t.value)>Math.abs(n)&&(n=t.options.invert?-t.value:t.value);return n}enableMouse(){const t=Object(r.c)(this.element,"Controller must be attached to an Element");this.mouse=new g(t)}enableKeyboard(){const t=Object(r.c)(this.element,"Controller must be attached to an Element");this.keyboard=new u(t)}enableTouches(){const t=Object(r.c)(this.element,"Controller must be attached to an Element");this.touch=new c(t)}}const w=d.a.isEnabled?d.a:void 0;var x;!function(t){t[t.Walk=1]="Walk",t[t.Fullscreen=2]="Fullscreen",t[t.AttackSide=4]="AttackSide",t[t.AttackVert=8]="AttackVert"}(x||(x={}));const _={[x.Walk]:{id:"walk",name:"Walk",desc:"Hold to walk instead of run"},[x.Fullscreen]:{id:"fullscreen",name:"Toggle Fullscreen",desc:"Toggle fullscreen mode"},[x.AttackSide]:{id:"attackSide",name:"Horizontal Attack",desc:"Attack horizontally"},[x.AttackVert]:{id:"attackVert",name:"Vertical Attack",desc:"Attack vertically"}};class C{constructor(){this.controller=new v}initialize({toplevel:t}){this.controller.attach(t),this.controller.enableMouse(),this.controller.enableTouches(),this.controller.keyboard=new u(window),this.controller.registerAxis("Vertical",{source:b.Key,positiveKey:"KeyW",negativeKey:"KeyS"}),this.controller.registerAxis("Horizontal",{source:b.Key,positiveKey:"KeyD",negativeKey:"KeyA"}),this.controller.registerAxis("Horizontal",{source:b.TouchDragX}),this.controller.registerAxis("Vertical",{source:b.TouchDragY,invert:!0}),this.controller.registerKeys(_[x.Walk].id,["ShiftLeft","ShiftRight"]),this.controller.registerKeys(_[x.Fullscreen].id,["Backslash"]),this.controller.registerKeys(_[x.AttackSide].id,["KeyQ"]),this.controller.registerKeys(_[x.AttackVert].id,["KeyE"]),this.controller.registerMouse(_[x.AttackSide].id,[h.Left]),this.controller.registerMouse(_[x.AttackVert].id,[h.Right]),this.controller.disableContextMenu()}isActive(t){return this.controller.isPressed(t)}wasActive(t){return this.controller.wasPressed(t)}getAxis(t){return this.controller.getAxis(t)}update(){this.controller.updateAxes()}updateFixed({camera:t,clock:e,userCommands:n}){const r=Object.keys(_).length;let i=0;for(let t=0;t<r;t++){const e=1<<t;this.isActive(_[e].id)&&(i|=e)}const s={frame:e.simFrame,headingX:t.forward[0],headingZ:t.forward[2],horizontalAxis:this.getAxis("Horizontal"),verticalAxis:this.getAxis("Vertical"),actions:i};n.setUserCommand(s)}afterFrame(){Object(r.e)(w)&&this.wasActive("toggleFullscreen")&&w.toggle(this.controller.element),this.controller.afterFrame()}}},function(t,e,n){(function(r){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))}),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=n(68)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,n(37))},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){(function(r){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))}),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=n(88)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,n(37))},function(t,e,n){"use strict";function r(){}n.d(e,"a",(function(){return r})),Object.assign(r.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}})},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var c,u=[],h=!1,l=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var t=a(f);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new p(t,e)),1!==u.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){var r=n(70)("socket.io-parser"),i=n(24),s=n(73),o=n(48),a=n(49);function c(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=c,e.Decoder=l;var u=e.ERROR+'"encode error"';function h(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return u;n+=i}return r("encoded %j as %s",t,n),n}function l(){this.reconstructor=null}function f(t){this.reconPack=t,this.buffers=[]}function d(t){return{type:e.ERROR,data:"parser error: "+t}}c.prototype.encode=function(t,n){(r("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)?function(t,e){s.removeBlobs(t,(function(t){var n=s.deconstructPacket(t),r=h(n.packet),i=n.buffers;i.unshift(r),e(i)}))}(t,n):n([h(t)])},i(l.prototype),l.prototype.add=function(t){var n;if("string"==typeof t)n=function(t){var n=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return d("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var s="";"-"!==t.charAt(++n)&&(s+=t.charAt(n),n!=t.length););if(s!=Number(s)||"-"!==t.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(n+1))for(i.nsp="";++n;){if(","===(c=t.charAt(n)))break;if(i.nsp+=c,n===t.length)break}else i.nsp="/";var a=t.charAt(n+1);if(""!==a&&Number(a)==a){for(i.id="";++n;){var c;if(null==(c=t.charAt(n))||Number(c)!=c){--n;break}if(i.id+=t.charAt(n),n===t.length)break}i.id=Number(i.id)}if(t.charAt(++n)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(n));if(!(!1!==u&&(i.type===e.ERROR||o(u))))return d("invalid payload");i.data=u}return r("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new f(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",n))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(74),i=n(75),s=n(76);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),i=(t=a(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(c.isBuffer(e)){var n=0|d(e.length);return 0===(t=a(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?a(t,0):f(t,e);if("Buffer"===e.type&&s(e.data))return f(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(h(e),t=a(t,e<0?0:0|d(e)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|d(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function d(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function p(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return L(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(r)return L(t).length;e=(""+e).toLowerCase(),r=!0}}function m(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return F(this,e,n);case"utf8":case"utf-8":return k(this,e,n);case"ascii":return T(this,e,n);case"latin1":case"binary":return S(this,e,n);case"base64":return A(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function g(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:b(t,e,n,r,i);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):b(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(t,e,n,r,i){var s,o=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var h=-1;for(s=n;s<a;s++)if(u(t,s)===u(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(t,s+f)!==u(e,f)){l=!1;break}if(l)return s}return-1}function v(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[n+o]=a}return o}function w(t,e,n,r){return V(L(e,t.length-n),t,n,r)}function x(t,e,n,r){return V(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _(t,e,n,r){return x(t,e,n,r)}function C(t,e,n,r){return V(z(e),t,n,r)}function M(t,e,n,r){return V(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function A(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function k(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,a,c,u=t[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=t[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,n){return u(null,t,e,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,n){return function(t,e,n,r){return h(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},c.allocUnsafe=function(t){return l(null,t)},c.allocUnsafeSlow=function(t){return l(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=c.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?k(this,0,t):m.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,n,r,i){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0),a=Math.min(s,o),u=this.slice(r,i),h=t.slice(e,n),l=0;l<a;++l)if(u[l]!==h[l]){s=u[l],o=h[l];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return w(this,t,e,n);case"ascii":return x(this,t,e,n);case"latin1":case"binary":return _(this,t,e,n);case"base64":return C(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function S(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function F(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=N(t[s]);return i}function E(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function O(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,n,r,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function I(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-n,2);i<s;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function R(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-n,4);i<s;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function B(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(t,e,n,r,s){return s||B(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function D(t,e,n,r,s){return s||B(t,0,n,8),i.write(t,e,n,r,52,8),n+8}c.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=c.prototype;else{var i=e-t;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+t]}return n},c.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},c.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},c.prototype.readUInt8=function(t,e){return e||O(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||O(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||O(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||O(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||O(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){e||O(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||j(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},c.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||j(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},c.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);j(this,t,e,n,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);j(this,t,e,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,n){return U(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return U(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return D(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return D(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,s=r-n;if(this===t&&n<e&&e<r)for(i=s-1;i>=0;--i)t[i+e]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),e);return s},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var s;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=e;s<n;++s)this[s]=t;else{var o=c.isBuffer(t)?t:L(new c(t,r).toString()),a=o.length;for(s=0;s<n-e;++s)this[s+e]=o[s%a]}return this};var P=/[^+\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function L(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function z(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function V(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(50))},function(t,e,n){var r=n(79);t.exports=function(t){var e=t.xdomain,n=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||r))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(t){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},function(t,e,n){var r=n(25),i=n(24);function s(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=s,i(s.prototype),s.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(t){var e=r.decodePacket(t,this.socket.binaryType);this.onPacket(e)},s.prototype.onPacket=function(t){this.emit("packet",t)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0);class i{constructor(){this._add=[],this._folders={}}add(t,e,n,r,i){const s={args:arguments};return this._add.push(s),{onChange:t=>{s.onChange=t}}}addFolder(t){return this._folders[t]=new i,this._folders[t]}async show(){var t;if(!Object(r.e)(this._guiPromise)){if(void 0===this._gui){this._guiPromise=n.e(2).then(n.bind(null,97));const t=await this._guiPromise;this._gui=new t.GUI({load:this._saveObject})}(null===(t=this._saveObject)||void 0===t?void 0:t.closed)&&this._gui.close();for(const t of this._add){this._gui.getRoot().remember(t.args[0]);const e=this._gui.add.apply(this._gui,t.args);t.onChange&&(e.onChange(t.onChange),t.onChange(e.object[e.property]))}for(const t in this._folders)this._folders[t]._gui=this._gui.addFolder(t),this._folders[t].show();this.add=this._gui.add.bind(this._gui),this.addFolder=this._gui.addFolder.bind(this._gui),this.show=this._gui.show.bind(this._gui),this.hide=this._gui.hide.bind(this._gui)}}hide(){}update(){if(this._gui&&!this._gui.closed){for(var t in this._gui.__controllers)this._gui.__controllers[t].updateDisplay();for(const t in this._gui.__folders){const e=this._gui.__folders[t];for(const t of e.__controllers)t.updateDisplay()}}}toJSON(){return this._gui?this._gui.getSaveObject():void 0}fromJSON(t){Object(r.b)(!Object(r.e)(this._gui),"State must be loaded before the DebugMenu is shown"),this._saveObject=t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return b}));var r=n(21),i=n(8),s=n(0),o=n(1),a=n(2),c=n(14),u=n(10),h=n(7),l=n(27);const f=a.b.create();var d;!function(t){t[t.None=0]="None",t[t.Sword=1]="Sword"}(d||(d={}));class p{constructor(){this.origin=a.d.create(),this.orientation=a.d.create()}}class m{}class g extends m{loadResources(){}create(){throw new Error("Attempted to create an empty weapon")}}class y extends m{constructor(){super(...arguments),this.matTextures={},this.ready=!1}loadResources(t,e){this.attackObb=a.b.fromValues(20,0,0,0,0,5,0,0,0,0,90,0,0,0,110,1),this.readyPromise=new Promise(n=>{t.load(y.kFilename,"gltf",(t,r)=>{if(t)return console.error("Failed to load resource",t);this.onResourcesLoaded(Object(s.c)(r),e),this.ready=!0,n()})})}create(t){const e={transform:new u.b,type:d.Sword,attackObb:a.b.clone(this.attackObb)};return this.readyPromise.then(()=>{const n=new r.a(t,name,this.shader,this.resourceLayout),s=new r.b(t,c.a.opaque,this.mesh,n);s.updateWorldMatrix(!0,!1),e.transform.add(s),Object.keys(this.matTextures).forEach(e=>n.setTexture(t,e,this.matTextures[e])),n.setUniformBuffer(t,"material",this.matUniformBuf);const o=this.resourceLayout.model.layout,a=new i.a("SwordModelUniforms",t,o);n.setUniformBuffer(t,"model",a),e.model=s}),e}onResourcesLoaded(t,e){const n=t,r=n.meshes[0].primitives[0],c=n.materials[r.materialIndex],u=Object(s.c)(c.technique);this.shader=u.shaderId,this.mesh=r.mesh,this.meshNode=Object(s.c)(n.nodes.find(t=>0===t.meshId));const h=["u_model","u_modelViewProjection"],l={},f={},d=[];for(const t of Object.keys(u.uniforms)){const e=u.uniforms[t];h.includes(t)?f[t]=e:e.type===o.m.Texture2D?d.push(t):l[t]=e}const p=Object(i.b)(l),m=Object(i.b)(f),g={model:{index:0,type:o.a.UniformBuffer,layout:m},material:{index:1,type:o.a.UniformBuffer,layout:p}};for(let t=0;t<d.length;t++){g[d[t]]={index:t,type:o.a.Texture}}this.resourceLayout=g,this.matUniformBuf=new i.a(c.name,e,p);const y=Object(s.c)(c.values);for(const t of Object.keys(l).concat(d)){const e=u.uniforms[t],r=Object(s.c)(Object(s.d)(y[t],e.value),`Expected material uniform '${t}' to have a value in the material or technique`);if(e.type===o.m.Texture2D){const e=n.textures[r.index].id;this.matTextures[t]=e}else e.type===o.m.Float?this.matUniformBuf.setFloat(t,r):this.matUniformBuf.setFloats(t,r)}this.matUniformBuf.setVec4("u_Color0",a.e.fromValues(.4266,.4171,.5057,1)),this.matUniformBuf.write(e)}}y.kFilename="data/Tkwn.glb";class b{constructor(){this.weapons={},this.blueprints={[d.None]:new g,[d.Sword]:new y}}initialize({resources:t,gfxDevice:e}){this.gfxDevice=e,this.blueprints[d.Sword].loadResources(t,e);for(let t=0;t<h.a.kAvatarCount;t++)this.weapons[h.a.kAvatarCount+t]=this.blueprints[d.Sword].create(e)}updateFixed({}){for(const t in this.weapons){const e=this.weapons[t],n=this.blueprints[e.type];f.set(e.transform.matrixWorld.elements),a.b.multiply(e.attackObb,f,n.attackObb)}}render({gfxDevice:t,camera:e,displaySnapshot:n,avatar:r}){const i=n.entities;for(const n of i){const r=this.weapons[n.id];if(!Object(s.e)(r))continue;const i=r.model;if(Object(s.e)(i)){r.transform.updateWorldMatrix(!1,!0);const n=new Float32Array(i.matrixWorld.elements),s=i.material.getUniformBuffer("model");s.setMat4("u_model",n),s.setMat4("u_modelViewProjection",a.b.multiply(a.b.create(),e.viewProjMatrix,n)),s.write(t),i.renderList.push(i.primitive)}l.a.renderObbs([r.attackObb],!1,a.e.fromValues(0,1,0,1))}}getById(t){return this.weapons[t]}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(0),i=n(5);class s{constructor(){this.renderTime=0,this.serverTime=0,this.clientTime=0,this.simFrame=0,this.realDt=0,this.renderDt=0,this._simDt=16,this.paused=!1,this.speed=1,this.realTime=0,this.stepDt=0,this.clientDelay=0,this.renderDelay=0}initialize({debugMenu:t}){t.add(this,"paused"),t.add(this,"speed",.05,2,.05),t.add(this,"simDt",8,512,8),t.add(this,"step"),this.zero()}zero(){this.serverTime=0,this.clientTime=0,this.renderTime=0,this.simFrame=0}syncToServerTime(t){this.tick();const e=t-this.serverTime;return this.serverTime=t,e}setClientDelay(t){Object(r.b)(t<=0,"ClientDelay is expected to be negative"),this.clientDelay=t}setRenderDelay(t){Object(r.b)(t>=0,"RenderDelay is expected to be positive"),this.renderDelay=t}tick(){const t=performance.now();0===this.realTime&&(this.realTime=t-.5*this.simDt),this.realDt=t-this.realTime,this.realTime=t,this.serverTime+=this.realDt;const e=this.serverTime-this.clientDelay,n=e-this.clientTime;if(n>250){this.clientTime=e;const t=this.clientTime/this.simDt;this.simFrame=Math.floor(t)}else{const t=.95*this.realDt,e=1.05*this.realDt,r=Object(i.c)(n,t,e);this.clientTime+=r}const r=this.serverTime-this.renderDelay,s=r-this.renderTime;if(s>250)this.renderTime=r;else{const t=.75*this.realDt,e=1.25*this.realDt,n=Object(i.c)(s,t,e);this.renderDt=this.paused?this.stepDt:n*this.speed,this.renderTime+=this.renderDt}this.stepDt=0}updateFixed(){const t=this.clientTime-this.simDt*this.simFrame>=this.simDt;return t&&(this.simFrame+=1),t}getCurrentServerTime(){const t=performance.now()-this.realTime;return this.serverTime+t}set simDt(t){this.zero(),this._simDt=t}get simDt(){return this._simDt}step(t=1e3/60){this.paused=!0,this.stepDt=t*this.speed}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return u}));var r=n(22),i=n(12),s=n(0),o=n(16),a=n(5);class c{constructor(){this.graph=new o.c,this.clientAhead=125,this.renderDelay=125,this.averageServerFrameDiff=0,this.averageClientFrameDiff=0,this.renderDelayTimestamp=0,this.showStats=!1,this.showGraph=!1}initialize(t){this.context=t;const e=this.context.clock;this.client=new i.a(t.clock);const n=this.context.debugMenu.addFolder("Net");n.add(this,"clientAhead",0,1e3,16).onChange(()=>e.setClientDelay(-this.clientAhead)),n.add(this,"renderDelay",0,1e3,16).onChange(()=>e.setRenderDelay(this.renderDelay)),n.add(this,"showStats").onChange(t=>this.client.stats.setEnabled(t)),n.add(this,"showGraph").onChange(t=>this.graph.setEnabled(t)),this.context.toplevel.appendChild(this.graph.dom),this.context.toplevel.appendChild(this.client.stats.dom)}terminate(){this.client.close()}onConnect(t){this.context.clock.setClientDelay(-this.clientAhead),this.context.clock.setRenderDelay(this.renderDelay),this.client.on(i.b.ServerTimeAdjust,this.onServerTimeAdjust.bind(this)),this.client.on(i.b.ReceiveServerFrame,this.onServerFrame.bind(this)),this.client.on(i.b.Activated,this.onJoined.bind(this)),this.client.connect(t),this.client.on(i.b.Connected,()=>{this.graph&&this.client.setNetGraphPanel(this.graph.addPanel(`Client: ${this.client.id}`))})}onJoined(){this.context.avatar.onJoined(this.client.clientIndex)}onServerFrame(t,e){this.averageServerFrameDiff=Object(a.e)(t,this.averageServerFrameDiff,.95);const n=(1.5-this.averageServerFrameDiff)*this.context.clock.simDt;this.clientAhead=Object(a.c)(this.clientAhead+.01*n,0,250),this.context.clock.setClientDelay(-this.clientAhead);const r=1*this.context.clock.simDt,i=e.frame-this.client.lastRequestedFrame;if(this.averageClientFrameDiff=Object(a.e)(i,this.averageClientFrameDiff,.9),i<0){const t=(3-i)*this.context.clock.simDt;this.renderDelay=Object(a.c)(this.renderDelay+t,0,250),this.context.clock.setRenderDelay(this.renderDelay),this.renderDelayTimestamp=performance.now(),this.averageClientFrameDiff=3}if(performance.now()-this.renderDelayTimestamp>3e3){const t=(3-this.averageClientFrameDiff)*this.context.clock.simDt;Math.abs(t)>r&&(this.renderDelay=Object(a.c)(this.renderDelay+t,0,250),console.debug(`Adjusting renderTime by ${t} ms`),this.context.clock.setRenderDelay(this.renderDelay),this.averageClientFrameDiff=3),this.renderDelayTimestamp=performance.now()}}onServerTimeAdjust(t){const e=this.context.clock.syncToServerTime(t);console.debug(`Adjusting serverTime by ${e.toFixed(2)} ms`)}onVisibility(t){if(this.client.state===i.c.Active)if(this.client.transmitVisibilityChange(!t),this.client.transmitReliable(0),t){const t=16;let e=1;this.transmitInterval=window.setInterval(()=>{this.client.transmitReliable(e++)&&(clearInterval(this.transmitInterval),this.transmitInterval)},t)}else Object(s.e)(this.transmitInterval)&&(window.clearInterval(this.transmitInterval),this.transmitInterval=void 0)}update({}){this.client.stats.update(),this.updateNetGraph()}updateNetGraph(){var t;const e=this.context.clock;null===(t=this.client.graphPanel)||void 0===t||t.update(this.client.ping,e.serverTime,e.renderTime,e.clientTime),window.server&&window.server.net.updateNetGraph()}}class u{constructor(){this.clients=[]}initialize(t){var e;this.context=t,this.graph=null===(e=window.client)||void 0===e?void 0:e.net.graph}terminate(){this.signalSocket&&this.signalSocket.close();for(const t of this.clients)t&&t.close()}async onConnect(t){this.signalSocket=t;const e=new r.c(t);await e.listen(async t=>{const e=new i.a(this.context.clock);e.on(i.b.Connected,this.onClientConnected.bind(this,e)),e.on(i.b.Disconnected,this.onClientDisconnected.bind(this,e)),e.accept(t);let n=this.clients.indexOf(null);n<0&&(n=this.clients.length),this.clients[n]=e,e.clientIndex=n,e.transmitConnectionInfo(n)})}onClientConnected(t){console.log("Client connected:",t),this.context.avatar.addAvatar(this.context.world,t.clientIndex),this.graph&&t.setNetGraphPanel(this.graph.addPanel(`Server: ${t.id}`))}onClientDisconnected(t){var e;console.log("Client disconnected:",t),this.context.avatar.removeAvatar(this.context.world,t.clientIndex);const n=this.clients.indexOf(t);this.clients[n]=null,t.graphPanel&&(null===(e=this.graph)||void 0===e||e.removePanel(t.graphPanel))}transmitToClients(t){for(const e of this.clients)e&&e.transmitServerFrame(t)}updateNetGraph(){var t;if(this.graph)for(const e of this.clients){const n=window.client.clock.serverTime;e&&(null===(t=e.graphPanel)||void 0===t||t.update(e.ping,n,void 0,this.context.clock.getCurrentServerTime()))}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return P}));var r,i=n(61),s=n.n(i);!function(t){t[t.LoadingAsync=0]="LoadingAsync",t[t.LoadingSync=1]="LoadingSync",t[t.Loaded=2]="Loaded",t[t.Unloaded=3]="Unloaded",t[t.Failed=4]="Failed"}(r||(r={}));var o=n(1),a=n(0);var c=n(2),u=n(15),h=n(10);const l=1313821514,f=5130562;let d=new TextDecoder;function p(t){return d.decode(t)}class m{constructor(t){const e=new DataView(t,0,12),n=new DataView(t,12),r=p(new Uint8Array(t,0,4)),i=e.getUint32(4,!0);e.getUint32(8,!0);if("glTF"!==r)throw new Error("Unsupported glTF-Binary header.");if(i<2)throw new Error("Unsupported legacy binary file detected.");let s=0;for(;s<n.byteLength;){const e=n.getUint32(s,!0);s+=4;const r=n.getUint32(s,!0);switch(s+=4,r){case l:{const n=new Uint8Array(t,12+s,e);this.json=p(n)}break;case f:{const n=12+s;this.binaryChunk=new Uint8Array(t,n,e)}break;default:console.warn("Skipping unexpected glTF-Binary chunk type:",r)}s+=e}Object(a.b)(!!this.json,"glTF-Binary: JSON content not found.")}}class g{constructor(t,e){this.gltf=t,this.bufferData=e}bufferViewData(t){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const e=this.gltf.bufferViews[t],n=Object(a.c)(this.bufferData[e.buffer],`No data for buffer ${e.buffer}`),r=e.byteLength||0,i=e.byteOffset||0,s=n.buffer,o=n.byteOffset;return new Uint8Array(s,o+i,r)}accessorData(t){if(!this.gltf.accessors)throw new Error("No accessors views found.");const e=this.gltf.accessors[t],n=M[e.type];let r;const i=C[e.componentType],s=i.BYTES_PER_ELEMENT*n*e.count;if(void 0!==e.bufferView){const t=this.bufferViewData(e.bufferView);r=new i(t.buffer,t.byteOffset+Object(a.d)(e.byteOffset,0),e.count*n)}else r=new i(s);if(e.sparse){const{count:t,indices:i,values:s}=e.sparse;let o=C[i.componentType],a=this.bufferViewData(i.bufferView);const c=new o(a.buffer,a.byteOffset+(i.byteOffset||0),t);o=C[e.componentType],a=this.bufferViewData(s.bufferView);const u=new o(this.bufferViewData(s.bufferView).buffer,a.byteOffset+(s.byteOffset||0),t*n);e.bufferView&&(r=new Uint8Array(r));const h=new C[e.componentType](r.buffer);for(let e=0;e<t;e++)for(let t=0;t<n;t++)h[n*c[e]+t]=u[n*e+t]}return r}}class y extends h.b{clone(t=!1){const e=super.clone(t);return e.morphWeight=this.morphWeight,e.meshId=this.meshId,e.skinId=this.skinId,e}}function b(t,e){let n;switch(e){case 5120:n=o.m.Char;break;case 5121:n=o.m.Uchar;break;case 5122:n=o.m.Short;break;case 5123:n=o.m.Ushort;break;case 5125:n=o.m.Uint;break;case 5126:n=o.m.Float;break;default:throw new Error("Invalid GLTF component type")}switch(t){case"SCALAR":n+=0;break;case"VEC2":n+=1;break;case"VEC3":n+=2;break;case"VEC4":n+=3;break;case"MAT2":throw new Error("2x2 Matrice not yet supported");case"MAT3":n=o.m.Float3x3;break;case"MAT4":n=o.m.Float4x4}return n}function v(t){switch(t){case 5124:return o.m.Int;case 5126:return o.m.Float;case 35664:return o.m.Float2;case 35665:return o.m.Float3;case 35666:return o.m.Float4;case 35667:return o.m.Int2;case 35668:return o.m.Int3;case 35669:return o.m.Int4;case 35675:return o.m.Float3x3;case 35676:return o.m.Float4x4;case 35678:return o.m.Texture2D;default:throw new Error("Invalid GLTF component type")}}function w(t){switch(t){case 0:return o.g.Points;case 1:return o.g.Lines;case 2:return o.g.LineLoop;case 3:return o.g.LineStrip;case 4:return o.g.Triangles;case 5:return o.g.TriangleStrip;case 6:return o.g.TriangleFan;default:throw new Error("Invalid GLTF primitive mode")}}const x={9728:o.j.Nearest,9729:o.j.Linear},_={9728:o.j.Nearest,9729:o.j.Linear},C={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"a_pos",NORMAL:"a_normal",TANGENT:"a_tangent",JOINTS_0:"a_joints",WEIGHTS_0:"a_weights",COLOR_0:"a_color",TEXCOORD_0:"a_uv0",TEXCOORD_1:"a_uv1",MORPH0_POSITION:"a_posMorph0"},k={NORMAL:"HAS_NORMALS 1",TANGENT:"HAS_TANGENT 1",JOINTS_0:"HAS_JOINT_SET0 1",WEIGHTS_0:"HAS_WEIGHT_SET0 1",COLOR_0:"HAS_COLOR0 1",TEXCOORD_0:"HAS_UV_SET0 1",TEXCOORD_1:"HAS_UV_SET1 1"},T={CUBICSPLINE:void 0,LINEAR:u.e,STEP:u.d},S={translation:"position",rotation:"quaternion",scale:"scale",weights:"_UNSUPPORTED"};function F(t,e,n){const r=n,i=e.gltf;let s;if(!Object(a.e)(n.material))throw new Error("Default material not yet supported");s=Object(a.c)(t.transient.materials[n.material]);const c=[];let u=void 0;const h=[];if(Object(a.e)(r.indices)){const n=Object(a.c)(i.accessors)[r.indices];u=E(t,e,Object(a.c)(n.bufferView),o.c.Index)}let l;if(Object(a.e)(s.techniqueIndex)){l={};const e=Object(a.c)(t.transient.techniques).techniques[s.techniqueIndex],n=Object.keys(e.attributes);for(const t of n){l[e.attributes[t].semantic]=t}}else l=A;const f={buffers:[]},d={};for(let n in r.attributes){const s=Object(a.c)(i.accessors)[r.attributes[n]],u=Object(a.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),p=d[u];let m;if(Object(a.e)(p))m=f.buffers[p];else{d[u]=h.length;const n=E(t,e,u,o.c.Vertex),r=Object(a.c)(i.bufferViews)[u];m={stride:Object(a.d)(r.byteStride,0),layout:{}},h.push(n),f.buffers.push(m)}const g=k[n];Object(a.e)(g)&&c.push(g);const y=Object(a.c)(l[n],`Unknown vertex attribute semantic: ${n}`);m.layout[y]={type:b(s.type,s.componentType),offset:s.byteOffset||0}}if(r.targets){c.push("HAS_MORPH0 1"),Object(a.b)(1===r.targets.length,"Only 1 morph target is currently supported");const n=r.targets[0];for(let r in n)if("POSITION"===r){const s=Object(a.c)(i.accessors)[n[r]],c=Object(a.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),u=Object(a.c)(i.bufferViews)[c];let d=f.buffers[c];const p=E(t,e,c,o.c.Vertex);Object(a.e)(d)||(h[c]=p,d=f.buffers[c]={stride:Object(a.d)(u.byteStride,0),layout:{}});const m=l[`MORPH0_${r}`];d.layout[m]={type:b(s.type,s.componentType),offset:s.byteOffset||0}}}const p=i.accessors[Object(a.c)(r.indices,"Only indexed primitives are currently supported")],m=Object(a.c)(u,"Only indexed primitives are currently supported");return{mesh:{elementCount:p.count,vertexBuffers:h,primitiveType:w(Object(a.d)(r.mode,4)),indexType:b(p.type,p.componentType),indexBuffer:m,vertexLayout:f},materialIndex:n.material}}function E(t,e,n,r){if(Object(a.e)(t.bufferViews[n]))return t.bufferViews[n];const i=Object(a.c)(e.gltf.bufferViews)[n].name||`buffer${n}`;t.bufferData[n]=new Uint8Array(e.bufferViewData(n)).buffer,Object(a.b)(!t.transferList.includes(t.bufferData[n])),t.transferList.push(t.bufferData[n]);const s={name:i,type:r,buffer:-1};return t.bufferViews[n]=s,s}function O(t,e){return Object(a.d)(e.gltf.materials,[]).map((t,e)=>{var n;const r=null===(n=t.extensions)||void 0===n?void 0:n.KHR_techniques_webgl,i=r?r.technique:void 0,s=r?r.values:void 0;return{name:Object(a.d)(t.name,`Material${e}`),renderFormat:{blendingEnabled:!1},cullMode:t.doubleSided?o.e.None:o.e.Back,techniqueIndex:i,values:s}})}function j(t,e){var n;if(!(null===(n=e.gltf.extensionsUsed)||void 0===n?void 0:n.includes("KHR_techniques_webgl")))return;const r=Object(a.c)(e.gltf.extensions.KHR_techniques_webgl);return{shaderData:r.shaders.map((n,r)=>{const i=Object(a.c)(n.bufferView,"Shader loading from URI not yet supported"),s=new Uint8Array(e.bufferViewData(i)).buffer;return Object(a.b)(!t.transferList.includes(s)),t.transferList.push(s),s}),shaders:r.programs.map(t=>({name:t.name,fsIndex:t.fragmentShader,vsIndex:t.vertexShader})),techniques:r.techniques.map((t,e)=>{const n={};for(const e in Object(a.d)(t.uniforms,{})){const r=t.uniforms[e];n[e]=Object.assign(Object.assign({},r),{type:v(r.type)})}return{shaderIndex:t.program,attributes:Object(a.d)(t.attributes,{}),uniforms:n}})}}function I(t,e){return Object(a.d)(e.gltf.nodes,[]).map(t=>{const n=Object(a.d)(t.scale,[1,1,1]),r=Object(a.d)(t.rotation,[0,0,0,1]),i=Object(a.d)(t.translation,[0,0,0]),s={name:t.name,scale:c.d.fromValues(n[0],n[1],n[2]),rotation:c.c.fromValues(r[0],r[1],r[2],r[3]),translation:c.d.fromValues(i[0],i[1],i[2]),morphWeight:Object(a.d)(t.weights,[0])[0],transform:c.b.create(),meshId:Object(a.e)(t.mesh)?t.mesh:void 0,skinId:Object(a.e)(t.skin)?t.skin:void 0,children:[]};if(Object(a.e)(t.matrix)?(s.transform.set(t.matrix),c.b.getRotation(s.rotation,s.transform),c.b.getTranslation(s.translation,s.transform),c.b.getScaling(s.scale,s.transform)):s.transform=c.b.fromRotationTranslationScale(c.b.create(),s.rotation,s.translation,s.scale),Object(a.e)(t.children))for(let n=0;n<t.children.length;n++){const r=t.children[n];Object(a.c)(e.gltf.nodes)[r];s.children.push(r)}return s})}async function R(t,e){const n=Object(a.d)(e.gltf.images,[]),r=Object(a.d)(e.gltf.textures,[]),i=Object(a.d)(e.gltf.samplers,[]),s={type:o.k.Texture2D,format:o.i.U8x4,usage:o.n.Static},c={wrapS:10497,wrapT:10497},u=n.map(n=>{const r=Object(a.c)(n.bufferView,"Image loading from a URI is not yet supported"),i=e.bufferViewData(r);let s;if(Object(a.e)(self.createImageBitmap)){const t=new Blob([i],{type:Object(a.c)(n.mimeType)});s=createImageBitmap(t)}else s=Promise.resolve(new Uint8Array(i).buffer);return s.then(e=>(Object(a.b)(!t.transferList.includes(e)),t.transferList.push(e),e))}),h=r.map(t=>{const e=Object(a.d)(i[t.sampler],c),n=Object.assign({},s);return Object(a.e)(e.magFilter)&&(n.defaultMagFilter=x[e.magFilter],Object(a.e)(n.defaultMagFilter)||console.warn(`Unsupported texture mag filter: ${e.magFilter}`)),Object(a.e)(e.minFilter)&&(n.defaultMagFilter=_[e.minFilter],Object(a.e)(n.defaultMagFilter)||console.warn(`Unsupported texture min filter: ${e.magFilter}`)),(Object(a.e)(e.wrapS)||Object(a.e)(e.wrapT))&&(Object(a.e)(n.defaultMagFilter)||console.warn(`Texture wrapping not yet supported: ${e.magFilter}`)),{name:t.name,desc:n,imageIndex:Object(a.c)(t.source)}});return{imageData:await Promise.all(u),textures:h}}function B(t,e){let n=[];for(const r of Object(a.d)(e.gltf.animations,[])){const i=r.samplers.map(n=>{Object(a.b)(5126===e.gltf.accessors[n.input].componentType,"Non-float animation time type unsupported"),Object(a.b)(5126===e.gltf.accessors[n.output].componentType,"Non-float animation values type unsupported");const r=new Float32Array(e.accessorData(n.input)),i=new Float32Array(e.accessorData(n.output));return t.transferList.push(r.buffer,i.buffer),{times:r,values:i}}),s=[];for(const t of r.channels){const e=t.target.node;if(!Object(a.e)(e))continue;const n=S[t.target.path],o=i[t.sampler],c=Object(a.d)(r.samplers[t.sampler].interpolation,"LINEAR");s.push({targetNodeId:e,targetProperty:n,times:o.times,values:o.values,interpolation:c})}n.push({name:r.name,maxTime:r.maxTime,tracks:s})}return n}class U extends u.c{copySampleValue_(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,s=0;s!==r;s++)e[s]=n[i+s];return e}beforeStart_(t){this.copySampleValue_(t)}afterEnd_(t){this.copySampleValue_(t)}interpolate_(t,e,n,r){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,u=r-e,h=(n-e)/u,l=h*h,f=l*h,d=t*c,p=d-c,m=-2*f+3*l,g=f-l,y=1-m,b=g-l+h;for(let t=0;t!==o;t++){const e=s[p+t+o],n=s[p+t+a]*u,r=s[d+t+o],c=s[d+t]*u;i[t]=y*e+b*n+m*r+g*c}return i}}const D={texture:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download image");const n=t.source.uri.match(/.*\/(.+?)\./);t.name=n&&n.length>1?n[1]:"Unknown",self.createImageBitmap?(t.imageBitmap=await createImageBitmap(await e.blob()),t.transferList.push(t.imageBitmap),t.status=r.LoadingSync):(t.imageBuffer=await e.arrayBuffer(),t.transferList.push(t.imageBuffer),t.status=r.LoadingSync)}loadSync(t,e){if(e.imageBitmap)e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:o.n.Static,type:o.k.Texture2D,format:o.i.U8x3,maxAnistropy:16},e.imageBitmap):-1,e.imageBitmap.close(),delete e.imageBitmap,e.status=r.Loaded;else{if(e.imageBuffer){var n=new Blob([e.imageBuffer],{type:"image/jpeg"});let t=window.URL.createObjectURL(n);delete e.imageBuffer,e.imageElement=new Image,e.imageElement.src=t,e.status=r.LoadingSync}Object(a.e)(e.imageElement)&&e.imageElement.complete&&(e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:o.n.Static,type:o.k.Texture2D,format:o.i.U8x3,maxAnistropy:16},e.imageElement):-1,delete e.imageElement,e.status=r.Loaded)}}unloadSync(t,e){Object(a.e)(e.texture)&&t.renderer&&t.renderer.removeTexture(e.texture),Object(a.e)(e.imageBitmap)&&e.imageBitmap.close()}},gltf:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download GLTF");const n=await e.arrayBuffer(),i=new m(n),s=JSON.parse(i.json),o=new g(s,[i.binaryChunk]);t.nodes=[],t.meshes=[],t.materials=[],t.textures=[],t.bufferViews=[],t.animations=[],t.rootNodeIds=[],t.bufferData=[],t.transient={techniques:j(t,o),materials:O(0,o),nodes:I(0,o),animation:B(t,o),textures:await R(t,o)},function(t,e){const n=Object(a.d)(e.gltf.meshes,[]);t.meshes=[];for(let r=0;r<n.length;r++){const i=Object(a.c)(n[r]),s=[];for(let n of i.primitives)s.push(F(t,e,n));const o={name:i.name,id:r,primitives:s};t.meshes[r]=o}}(t,o),function(t,e){const n=Object(a.d)(e.gltf.skins,[]);t.skins=[];for(let r=0;r<n.length;r++){const i=n[r];let s=void 0;if(Object(a.e)(i.inverseBindMatrices)){const n=new Float32Array(e.accessorData(i.inverseBindMatrices));Object(a.b)(!t.transferList.includes(n.buffer)),t.transferList.push(n.buffer),s=[];for(let t=0;t<i.joints.length;t++)s[t]=n.subarray(16*t,16*t+16)}t.skins[r]={name:i.name,skeleton:i.skeleton,joints:i.joints,inverseBindMatrices:s}}}(t,o),function(t,e){const n=Object(a.d)(e.gltf.scene,0);if(Object(a.e)(n)){const r=Object(a.c)(e.gltf.scenes),i=Object(a.c)(r[n]);t.rootNodeIds=Object(a.d)(i.nodes,[])}}(t,o),Object(a.b)(!t.transferList.includes(n)),t.status=r.LoadingSync}loadSync(t,e){if(Object(a.e)(self.createImageBitmap))e.status=r.Loaded;else if(function(t,e){let n=!1;const i=t.transient.textures;let s=0;for(let c=0;c<i.textures.length;c++){const u=i.textures[c],h=i.imageData[u.imageIndex];if(Object(a.e)(t.textures[c]))s+=1;else{if(h instanceof ArrayBuffer){n=!0;var o=new Blob([h],{type:"image/jpeg"});let e=window.URL.createObjectURL(o);i.imageData[u.imageIndex]=new Image,i.imageData[u.imageIndex].src=e,t.status=r.LoadingSync}h.complete&&(Object(a.b)(Object(a.e)(t.textures),"This should have been defined as an empty array by loadTexturesSync()"),t.textures[c]={desc:u.desc,name:u.name,id:Object(a.e)(e.renderer)?e.renderer.createTexture(u.name,u.desc,h):-1})}}return s===i.textures.length?t.status=r.Loaded:t.status=r.LoadingSync,!n}(e,t))return;if(e.techniques=function(t,e){if(!Object(a.e)(t))return[];const n=Object(a.e)(e.renderer)?t.shaders.map(n=>{const r=t.shaderData[n.vsIndex],i=t.shaderData[n.fsIndex],s={name:n.name,vertSource:p(r),fragSource:p(i)};return e.renderer.createShader(s)}):[];return t.techniques.map(t=>({shaderId:n[t.shaderIndex],attributes:t.attributes,uniforms:t.uniforms}))}(e.transient.techniques,t),e.materials=function(t,e){return t.map(t=>({name:t.name,renderFormat:t.renderFormat,cullMode:t.cullMode,values:t.values,technique:Object(a.e)(t.techniqueIndex)?e.techniques[t.techniqueIndex]:void 0}))}(e.transient.materials,e),e.nodes=function(t){const e=t.map((t,e)=>{const n=new y;return n.name=Object(a.d)(t.name,`Node${e}`),n.position.set(t.translation[0],t.translation[1],t.translation[2]),n.quaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),n.scale.set(t.scale[0],t.scale[1],t.scale[2]),n.skinId=t.skinId,n.meshId=t.meshId,n.morphWeight=t.morphWeight,n});for(let n=0;n<e.length;n++){const r=t[n],i=e[n];for(const t of r.children)i.add(e[t])}return e}(e.transient.nodes),e.animations=function(t,e){const n=[];for(const r of t){const t=r.tracks.map(t=>{let n;switch(t.targetProperty){case"quaternion":n=u.f;break;case"position":case"scale":n=u.g;break;default:throw new Error("Unsupported animation target property")}const r=new n(`${e.nodes[t.targetNodeId].name}.${t.targetProperty}`,t.times,t.values,T[t.interpolation]);return"CUBICSPLINE"===t.interpolation&&(r.createInterpolant=function(t){return new U(this.times,this.values,this.getValueSize()/3,t)},r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),r});n.push(new u.a(r.name,r.maxTime,t))}return n}(e.transient.animation,e),e.textures=function(t,e){const n=[];if(Object(a.e)(self.createImageBitmap)&&Object(a.e)(e.renderer)){for(const r of t.textures){const i=t.imageData[r.imageIndex];Object(a.b)(i instanceof ImageBitmap),n.push({desc:r.desc,name:r.name,id:e.renderer.createTexture(r.name,r.desc,i)})}for(const e of t.imageData)e.close()}return n}(e.transient.textures,t),Object(a.e)(t.renderer))for(let n in e.bufferData){const r=e.bufferViews[n],i=e.bufferData[n];r.buffer=t.renderer.createBuffer(r.name,r.type,o.n.Static,i)}e.status===r.Loaded&&delete e.transient}unloadSync(t,e){}}};class P{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(t){this.worker=new s.a,this.worker.onmessage=t=>this.onMessage(t),this.context={renderer:t}}onMessage(t){this.messages.push(t)}load(t,e,n){if(!Object(a.e)(D[e]))return void n("Invalid resource type",void 0);const i="string"==typeof t?t:t.uri,s="string"==typeof t?void 0:t.headers,o=i+e;if(Object(a.e)(this.cache[o]))n(void 0,this.cache[o]);else if(this.requests[o])this.requests[o].push(n);else{this.requests[o]=[n];const t={source:{uri:i,headers:s,type:e},status:r.LoadingAsync,transferList:[]};this.worker.postMessage([t])}}unload(t,e){const n=("string"==typeof t?t:t.uri)+e;if(Object(a.e)(this.cache[n])){const t=this.cache[n];D[t.source.type].unloadSync(this.context,t),delete this.cache[n]}else{if(!this.requests[n])throw new Error(`Attempted to unload a resource that was never loaded: ${n}`);delete this.requests[n]}}update(){for(let t of this.messages)Array.prototype.push.apply(this.pending,t.data);for(let t of this.pending){const e=t.source.uri+t.source.type;if(Object(a.e)(this.requests[e])||(t.status=r.Unloaded),t.status===r.LoadingSync){D[t.source.type].loadSync(this.context,t)}switch(t.status){case r.Loaded:case r.Failed:this.finished.push(t);break;case r.Unloaded:this.unloaded.push(t);break;case r.LoadingAsync:this.loadingAsync.push(t);break;case r.LoadingSync:this.loadingSync.push(t)}}this.pending.length=0;for(let t of this.finished){const e=t.source.uri+t.source.type,n=Object(a.c)(this.requests[e]).length;Object(a.b)(n>=1),this.cache[e]=t;for(let i=0;i<n;i++)t.status===r.Failed?this.requests[e][i](t.error,void 0):this.requests[e][i](void 0,t);delete this.requests[e]}const t=[];for(let e of this.loadingAsync)Array.prototype.push.apply(t,e.transferList);this.worker.postMessage(this.loadingAsync,t);for(let t of this.unloaded){D[t.source.type].unloadSync(this.context,t)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),s=t.indexOf("]");-1!=i&&-1!=s&&(t=t.substring(0,i)+t.substring(i,s).replace(/:/g,";")+t.substring(s,t.length));for(var o=n.exec(t||""),a={},c=14;c--;)a[r[c]]=o[c]||"";return-1!=i&&-1!=s&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){(function(e){t.exports=function(t){return n&&e.isBuffer(t)||r&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))};var n="function"==typeof e&&"function"==typeof e.isBuffer,r="function"==typeof ArrayBuffer}).call(this,n(39).Buffer)},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(77),i=n(57),s=n(24),o=n(38),a=n(58),c=n(59),u=n(32)("socket.io-client:manager"),h=n(56),l=n(94),f=Object.prototype.hasOwnProperty;function d(t,e){if(!(this instanceof d))return new d(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||o;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=d,d.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},d.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},d.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},s(d.prototype),d.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},d.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},d.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(t,e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=a(n,"open",(function(){i.onopen(),t&&t()})),o=a(n,"error",(function(e){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var h=setTimeout((function(){u("connect attempt timed out after %d",c),s.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(s),this.subs.push(o),this},d.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(a(t,"data",c(this,"ondata"))),this.subs.push(a(t,"ping",c(this,"onping"))),this.subs.push(a(t,"pong",c(this,"onpong"))),this.subs.push(a(t,"error",c(this,"onerror"))),this.subs.push(a(t,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(t){this.decoder.add(t)},d.prototype.ondecoded=function(t){this.emit("packet",t)},d.prototype.onerror=function(t){u("error",t),this.emitAll("error",t)},d.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new i(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",s),n.on("connect",(function(){n.id=r.generateId(t)})),this.autoConnect&&s()}function s(){~h(r.connecting,n)||r.connecting.push(n)}return n},d.prototype.destroy=function(t){var e=h(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},d.prototype.packet=function(t){u("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()})))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},d.prototype.cleanup=function(){u("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(t){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();u("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(u("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(u("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(u("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){var r=n(40),i=n(80),s=n(90),o=n(91);e.polling=function(t){var e=!1,n=!1,o=!1!==t.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),e=t.hostname!==location.hostname||c!==t.port,n=t.secure!==a}if(t.xdomain=e,t.xscheme=n,"open"in new r(t)&&!t.forceJSONP)return new i(t);if(!o)throw new Error("JSONP disabled");return new s(t)},e.websocket=o},function(t,e,n){var r=n(41),i=n(33),s=n(25),o=n(34),a=n(55),c=n(35)("engine.io-client:polling");t.exports=h;var u=null!=new(n(40))({xdomain:!1}).responseType;function h(t){var e=t&&t.forceBase64;u&&!e||(this.supportsBinary=!1),r.call(this,t)}o(h,r),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(t){var e=this;function n(){c("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--r||n()}))),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){c("pre-pause writing complete"),--r||n()})))}else n()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(t){var e=this;c("polling got data %s",t);s.decodePayload(t,this.socket.binaryType,(function(t,n,r){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var t=this;function e(){c("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},h.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},h.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=a()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){(function(e){var r=n(82),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function t(n){if(!n||"object"!=typeof n)return!1;if(r(n)){for(var i=0,a=n.length;i<a;i++)if(t(n[i]))return!0;return!1}if("function"==typeof e&&e.isBuffer&&e.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||s&&n instanceof Blob||o&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return t(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&t(n[c]))return!0;return!1}}).call(this,n(39).Buffer)},function(t,e,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},o=0,a=0;function c(t){var e="";do{e=i[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function u(){var t=c(+new Date);return t!==r?(o=0,r=t):t+"."+c(o++)}for(;a<64;a++)s[i[a]]=a;u.encode=c,u.decode=function(t){var e=0;for(a=0;a<t.length;a++)e=64*e+s[t.charAt(a)];return e},t.exports=u},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e,n){var r=n(38),i=n(24),s=n(93),o=n(58),a=n(59),c=n(32)("socket.io-client:socket"),u=n(33),h=n(54);t.exports=d;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;function d(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[o(t,"open",a(this,"onopen")),o(t,"packet",a(this,"onpacket")),o(t,"close",a(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},d.prototype.emit=function(t){if(l.hasOwnProperty(t))return f.apply(this,arguments),this;var e=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:h(e))?r.BINARY_EVENT:r.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},d.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},d.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:r.CONNECT,query:t})}else this.packet({type:r.CONNECT})},d.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},d.prototype.onpacket=function(t){var e=t.nsp===this.nsp,n=t.type===r.ERROR&&"/"===t.nsp;if(e||n)switch(t.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(t);break;case r.ACK:case r.BINARY_ACK:this.onack(t);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",t.data)}},d.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},d.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var i=s(arguments);c("sending ack %j",i),e.packet({type:h(i)?r.BINARY_ACK:r.ACK,id:t,data:i})}}},d.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(t){return this.flags.compress=t,this},d.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e,n){var r=n(67),i=n(38),s=n(51),o=n(32)("socket.io-client");t.exports=e=c;var a=e.managers={};function c(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,i=r(t),c=i.source,u=i.id,h=i.path,l=a[u]&&h in a[u].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||l?(o("ignoring socket cache for %s",c),n=s(c,e)):(a[u]||(o("new io instance for %s",c),a[u]=s(c,e)),n=a[u]),i.query&&!e.query&&(e.query=i.query),n.socket(i.path,e)}e.protocol=i.protocol,e.connect=c,e.Manager=n(51),e.Socket=n(57)},function(t,e,n){t.exports=function(){return new Worker(n.p+"ResourceLoading.worker.0a3a986b6d94445571d1.js")}},function(t,e,n){"use strict";n.r(e),n.d(e,"Server",(function(){return f}));var r=n(18),i=n(20),s=n(44),o=n(45),a=n(46),c=n(7),u=n(23),h=n(42),l=n(19);class f{constructor(){this.debugMenu=new h.a,this.world=new l.b,this.avatar=new i.e,this.clock=new s.a,this.net=new o.b,this.resources=new a.a,this.snapshot=new c.b,this.userCommands=new u.b,this.init()}async init(){console.log(`Source for this build available at ${r.a}`),window.onbeforeunload=this.onUnload.bind(this),this.resources.initialize(),this.clock.initialize(this),this.net.initialize(this),this.avatar.initialize(this),r.b;return setInterval(this.tick.bind(this),16),0}onConnect(t){this.net.onConnect(t)}tick(){this.clock.tick(),this.updateFixed(),this.update()}updateFixed(){let t=0;for(;this.clock.updateFixed();){t+=1,this.avatar.updateFixed(this);const e=this.snapshot.createSnapshot(this);this.snapshot.setSnapshot(e),this.net.transmitToClients(e)}1!==t&&console.warn("[Server] Uneven fixed frame tick:",t)}update(){this.resources.update()}onUnload(){this.net.terminate()}}},,,,,function(t,e,n){var r=n(47),i=n(32)("socket.io-client:url");t.exports=function(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),n=r(t));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(e&&e.port===n.port?"":":"+n.port),n}},function(t,e,n){t.exports=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return r.colors[Math.abs(e)%r.colors.length]}function r(t){let n;function o(...t){if(!o.enabled)return;const e=o,i=Number(new Date),s=i-(n||i);e.diff=s,e.prev=n,e.curr=i,n=i,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return n;a++;const s=r.formatters[i];if("function"==typeof s){const r=t[a];n=s.call(e,r),t.splice(a,1),a--}return n}),r.formatArgs.call(e,t),(e.log||r.log).apply(e,t)}return o.namespace=t,o.enabled=r.enabled(t),o.useColors=r.useColors(),o.color=e(t),o.destroy=i,o.extend=s,"function"==typeof r.init&&r.init(o),r.instances.push(o),o}function i(){const t=r.instances.indexOf(this);return-1!==t&&(r.instances.splice(t,1),!0)}function s(t,e){const n=r(this.namespace+(void 0===e?":":e)+t);return n.log=this.log,n}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},r.disable=function(){const t=[...r.names.map(o),...r.skips.map(o).map(t=>"-"+t)].join(",");return r.enable(""),t},r.enable=function(t){let e;r.save(t),r.names=[],r.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(e=0;e<i;e++)n[e]&&("-"===(t=n[e].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$")));for(e=0;e<r.instances.length;e++){const t=r.instances[e];t.enabled=r.enabled(t.namespace)}},r.enabled=function(t){if("*"===t[t.length-1])return!0;let e,n;for(e=0,n=r.skips.length;e<n;e++)if(r.skips[e].test(t))return!1;for(e=0,n=r.names.length;e<n;e++)if(r.names[e].test(t))return!0;return!1},r.humanize=n(69),Object.keys(t).forEach(e=>{r[e]=t[e]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=e,r.enable(r.load()),r}},function(t,e){var n=1e3,r=6e4,i=60*r,s=24*i;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return o(t,e,s,"day");if(e>=i)return o(t,e,i,"hour");if(e>=r)return o(t,e,r,"minute");if(e>=n)return o(t,e,n,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=r)return Math.round(t/r)+"m";if(e>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n(71)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(s=i))})),t.splice(s,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,n(37))},function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,i=+new Date,s=i-(n||i);t.diff=s,t.prev=n,t.curr=i,n=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=e.formatters[r];if("function"==typeof i){var s=o[c];n=i.call(t,s),o.splice(c,1),c--}return n})),e.formatArgs.call(t,o);var u=r.log||e.log||console.log.bind(console);u.apply(t,o)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=i,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var s=e.instances[n];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(72),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,r=6e4,i=60*r,s=24*i;function o(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var a,c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===c&&!1===isNaN(t))return e.long?o(a=t,s,"day")||o(a,i,"hour")||o(a,r,"minute")||o(a,n,"second")||a+" ms":function(t){if(t>=s)return Math.round(t/s)+"d";if(t>=i)return Math.round(t/i)+"h";if(t>=r)return Math.round(t/r)+"m";if(t>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){var r=n(48),i=n(49),s=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);e.deconstructPacket=function(t){var e=[],n=t.data,s=t;return s.data=function t(e,n){if(!e)return e;if(i(e)){var s={_placeholder:!0,num:n.length};return n.push(e),s}if(r(e)){for(var o=new Array(e.length),a=0;a<e.length;a++)o[a]=t(e[a],n);return o}if("object"==typeof e&&!(e instanceof Date)){o={};for(var c in e)o[c]=t(e[c],n);return o}return e}(n,e),s.attachments=e.length,{packet:s,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(r(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],n);else if("object"==typeof e)for(var s in e)e[s]=t(e[s],n);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var n=0,s=t;!function t(c,u,h){if(!c)return c;if(o&&c instanceof Blob||a&&c instanceof File){n++;var l=new FileReader;l.onload=function(){h?h[u]=this.result:s=this.result,--n||e(s)},l.readAsArrayBuffer(c)}else if(r(c))for(var f=0;f<c.length;f++)t(c[f],f,c);else if("object"==typeof c&&!i(c))for(var d in c)t(c[d],d,c)}(s),n||e(s)}},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=u(t),o=r[0],a=r[1],c=new s(function(t,e,n){return 3*(e+n)/4-n}(0,o,a)),h=0,l=a>0?o-4:o;for(n=0;n<l;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],c[h++]=e>>16&255,c[h++]=e>>8&255,c[h++]=255&e;2===a&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,c[h++]=255&e);1===a&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,c[h++]=e>>8&255,c[h++]=255&e);return c},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(h(t,o,o+16383>a?a:o+16383));1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function h(t,e,n){for(var i,s,o=[],a=e;a<n;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?i-1:0,f=n?-1:1,d=t[e+l];for(l+=f,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[e+l],l+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+t[e+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=u}return(d?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,u=8*s-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(e*c-1)*Math.pow(2,i),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[n+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[n+d]=255&o,d+=p,o/=256,u-=8);t[n+d-p]|=128*m}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){t.exports=n(78),t.exports.parser=n(25)},function(t,e,n){var r=n(52),i=n(24),s=n(35)("engine.io-client:socket"),o=n(56),a=n(25),c=n(47),u=n(33);function h(t,e){if(!(this instanceof h))return new h(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=c(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=c(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=h,h.priorWebsocketSuccess=!1,i(h.prototype),h.protocol=a.protocol,h.Socket=h,h.Transport=n(41),h.transports=n(52),h.parser=n(25),h.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=a.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new r[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},h.prototype.open=function(){var t;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},h.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},h.prototype.probe=function(t){s('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(s('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(s('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;h.priorWebsocketSuccess="websocket"===e.name,s('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(s("changing transport and sending upgrade packet"),f(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())}))}else{s('probe transport "%s" failed',t);var o=new Error("probe error");o.transport=e.name,r.emit("upgradeError",o)}})))}function o(){n||(n=!0,f(),e.close(),e=null)}function a(n){var i=new Error("probe error: "+n);i.transport=e.name,o(),s('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",i)}function c(){a("transport closed")}function u(){a("socket closed")}function l(t){e&&t.name!==e.name&&(s('"%s" works - aborting "%s"',t.name,e.name),o())}function f(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",l)}h.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",u),this.once("upgrading",l),e.open()},h.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},h.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else s('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},h.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},h.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},h.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():e()})):this.upgrading?r():e()}function e(){t.onClose("forced close"),s("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},h.prototype.onError=function(t){s("socket error %j",t),h.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},h.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~o(this.transports,t[n])&&e.push(t[n]);return e}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,n){var r=n(40),i=n(53),s=n(24),o=n(34),a=n(35)("engine.io-client:polling-xhr");function c(){}function u(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function h(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(t.exports=u,t.exports.Request=h,o(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new h(t)},u.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=r},u.prototype.doPoll=function(){a("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},s(h.prototype),h.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new r(t),n=this;try{a("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&e.setRequestHeader(i,this.extraHeaders[i])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof e.status?e.status:0)}),0))},a("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){n.onError(t)}),0)}"undefined"!=typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},h.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},h.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},h.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",f);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,f,!1)}function f(){for(var t in h.requests)h.requests.hasOwnProperty(t)&&h.requests[t].abort()}},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(n-e),o=e,a=0;o<n;o++,a++)s[a]=i[o];return s.buffer}},function(t,e){function n(){}t.exports=function(t,e,r){var i=!1;return r=r||n,s.count=t,0===t?e():s;function s(t,n){if(s.count<=0)throw new Error("after called too many times");--s.count,t?(i=!0,e(t),e=r):0!==s.count||i||e(null,n)}}},function(t,e){
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var n,r,i,s=String.fromCharCode;function o(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function a(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(t,e){return s(t>>e&63|128)}function u(t,e){if(0==(4294967168&t))return s(t);var n="";return 0==(4294965248&t)?n=s(t>>6&31|192):0==(4294901760&t)?(a(t,e)||(t=65533),n=s(t>>12&15|224),n+=c(t,6)):0==(4292870144&t)&&(n=s(t>>18&7|240),n+=c(t,12),n+=c(t,6)),n+=s(63&t|128)}function h(){if(i>=r)throw Error("Invalid byte index");var t=255&n[i];if(i++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function l(t){var e,s;if(i>r)throw Error("Invalid byte index");if(i==r)return!1;if(e=255&n[i],i++,0==(128&e))return e;if(192==(224&e)){if((s=(31&e)<<6|h())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&e)){if((s=(15&e)<<12|h()<<6|h())>=2048)return a(s,t)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(s=(7&e)<<18|h()<<12|h()<<6|h())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}t.exports={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=o(t),i=r.length,s=-1,a="";++s<i;)a+=u(r[s],n);return a},decode:function(t,e){var a=!1!==(e=e||{}).strict;n=o(t),r=n.length,i=0;for(var c,u=[];!1!==(c=l(a));)u.push(c);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=s((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=s(e);return i}(u)}}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),i=r.length,s="";for(n=0;n<i;n+=3)s+=t[r[n]>>2],s+=t[(3&r[n])<<4|r[n+1]>>4],s+=t[(15&r[n+1])<<2|r[n+2]>>6],s+=t[63&r[n+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},e.decode=function(t){var e,r,i,s,o,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var h=new ArrayBuffer(a),l=new Uint8Array(h);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],i=n[t.charCodeAt(e+1)],s=n[t.charCodeAt(e+2)],o=n[t.charCodeAt(e+3)],l[u++]=r<<2|i>>4,l[u++]=(15&i)<<4|s>>2,l[u++]=(3&s)<<6|63&o;return h}}()},function(t,e){var n=void 0!==n?n:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;function o(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t}))}function a(t,e){e=e||{};var r=new n;return o(t).forEach((function(t){r.append(t)})),e.type?r.getBlob(e.type):r.getBlob()}function c(t,e){return new Blob(o(t),e||{})}"undefined"!=typeof Blob&&(a.prototype=Blob.prototype,c.prototype=Blob.prototype),t.exports=r?i?Blob:c:s?a:void 0},function(t,e,n){t.exports=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return r.colors[Math.abs(e)%r.colors.length]}function r(t){let n;function o(...t){if(!o.enabled)return;const e=o,i=Number(new Date),s=i-(n||i);e.diff=s,e.prev=n,e.curr=i,n=i,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return n;a++;const s=r.formatters[i];if("function"==typeof s){const r=t[a];n=s.call(e,r),t.splice(a,1),a--}return n}),r.formatArgs.call(e,t),(e.log||r.log).apply(e,t)}return o.namespace=t,o.enabled=r.enabled(t),o.useColors=r.useColors(),o.color=e(t),o.destroy=i,o.extend=s,"function"==typeof r.init&&r.init(o),r.instances.push(o),o}function i(){const t=r.instances.indexOf(this);return-1!==t&&(r.instances.splice(t,1),!0)}function s(t,e){const n=r(this.namespace+(void 0===e?":":e)+t);return n.log=this.log,n}function o(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},r.disable=function(){const t=[...r.names.map(o),...r.skips.map(o).map(t=>"-"+t)].join(",");return r.enable(""),t},r.enable=function(t){let e;r.save(t),r.names=[],r.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(e=0;e<i;e++)n[e]&&("-"===(t=n[e].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$")));for(e=0;e<r.instances.length;e++){const t=r.instances[e];t.enabled=r.enabled(t.namespace)}},r.enabled=function(t){if("*"===t[t.length-1])return!0;let e,n;for(e=0,n=r.skips.length;e<n;e++)if(r.skips[e].test(t))return!1;for(e=0,n=r.names.length;e<n;e++)if(r.names[e].test(t))return!0;return!1},r.humanize=n(89),Object.keys(t).forEach(e=>{r[e]=t[e]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=e,r.enable(r.load()),r}},function(t,e){var n=1e3,r=6e4,i=60*r,s=24*i;function o(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return o(t,e,s,"day");if(e>=i)return o(t,e,i,"hour");if(e>=r)return o(t,e,r,"minute");if(e>=n)return o(t,e,n,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=r)return Math.round(t/r)+"m";if(e>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){(function(e){var r=n(53),i=n(34);t.exports=h;var s,o=/\n/g,a=/\\n/g;function c(){}function u(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function h(t){if(r.call(this,t),this.query=this.query||{},!s){var e=u();s=e.___eio=e.___eio||[]}this.index=s.length;var n=this;s.push((function(t){n.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=c)}),!1)}i(h,r),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},h.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},h.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,i=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function u(){h(),e()}function h(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(t)}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),h(),t=t.replace(a,"\\\n"),this.area.value=t.replace(o,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,n(50))},function(t,e,n){(function(e){var r,i,s=n(41),o=n(25),a=n(33),c=n(34),u=n(55),h=n(35)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?r=WebSocket:"undefined"!=typeof self&&(r=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{i=n(92)}catch(t){}var l=r||i;function f(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=r&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(l=i),s.call(this,t)}t.exports=f,c(f,s),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new l(t,e):new l(t):new l(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},f.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},f.prototype.write=function(t){var n=this;this.writable=!1;for(var r=t.length,i=0,s=r;i<s;i++)!function(t){o.encodePacket(t,n.supportsBinary,(function(i){if(!n.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),n.perMessageDeflate)("string"==typeof i?e.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(s.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,s)}catch(t){h("websocket closed before onclose event")}--r||a()}))}(t[i]);function a(){n.emit("flush"),setTimeout((function(){n.writable=!0,n.emit("drain")}),0)}},f.prototype.onClose=function(){s.prototype.onClose.call(this)},f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},f.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),(t=a.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},f.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===f.prototype.name)}}).call(this,n(39).Buffer)},function(t,e){},function(t,e){t.exports=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec2 a_pos;out vec3 v_worldPos;uniform float u_gridRadius;uniform mat4 g_viewProj;void main(){v_worldPos=vec3(a_pos.x,0,a_pos.y)*u_gridRadius;gl_Position=g_viewProj*vec4(v_worldPos,1.);}",uniforms:{u_gridRadius:{variableType:"float",variableName:"u_gridRadius"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec3 v_worldPos;out vec4 o_fragColor;uniform vec4 u_baseColor;uniform vec4 u_lineColor;uniform float u_gridUnit;uniform float u_gridRadius;void main(){vec2 coord=v_worldPos.xz/u_gridUnit;vec2 grid=abs(fract(coord-0.5)-0.5)/fwidth(coord);float line=min(grid.x,grid.y);float lineAmount=1.-min(line,1.);vec4 color=mix(u_baseColor,u_lineColor,lineAmount);float opacity=smoothstep(u_gridRadius*0.7,u_gridRadius,length(v_worldPos));color=mix(color,vec4(0),opacity);o_fragColor=color;}",uniforms:{u_baseColor:{variableType:"vec4",variableName:"u_baseColor"},u_lineColor:{variableType:"vec4",variableName:"u_lineColor"},u_gridUnit:{variableType:"float",variableName:"u_gridUnit"},u_gridRadius:{variableType:"float",variableName:"u_gridRadius"}},consts:{}}},,function(t,e,n){"use strict";n.r(e);var r=n(18),i=n(1);let s;function o(t){switch(t){case s.FLOAT:return i.m.Float;case s.FLOAT_VEC2:return i.m.Float2;case s.FLOAT_VEC3:return i.m.Float3;case s.FLOAT_VEC4:return i.m.Float4;case s.INT:return i.m.Int;case s.INT_VEC2:return i.m.Int2;case s.INT_VEC3:return i.m.Int3;case s.INT_VEC4:return i.m.Int4;case s.FLOAT_MAT3:return i.m.Float3x3;case s.FLOAT_MAT4:return i.m.Float4x4;case s.SAMPLER_2D:return i.m.Texture2D;case s.SAMPLER_3D:return i.m.Texture3D;case s.SAMPLER_CUBE:return i.m.TextureCube;case s.UNSIGNED_INT:return i.m.Uint;case s.UNSIGNED_INT_VEC2:return i.m.Uint2;case s.UNSIGNED_INT_VEC3:return i.m.Uint3;case s.UNSIGNED_INT_VEC4:return i.m.Uint4;default:return w(`Unsupported WebGL type: ${t}`)}}function a(t){switch(255&t){case i.m.Float:return 1;case i.m.Float2:return 2;case i.m.Float3:return 3;case i.m.Float4:return 4;case i.m.Int:return 1;case i.m.Int2:return 2;case i.m.Int3:return 3;case i.m.Int4:return 4;case i.m.Uint:return 1;case i.m.Uint2:return 2;case i.m.Uint3:return 3;case i.m.Uint4:return 4;case i.m.Short:return 1;case i.m.Short2:return 2;case i.m.Short3:return 3;case i.m.Short4:return 4;case i.m.Ushort:return 1;case i.m.Ushort2:return 2;case i.m.Ushort3:return 3;case i.m.Ushort4:return 4;case i.m.Char:return 1;case i.m.Char2:return 2;case i.m.Char3:return 3;case i.m.Char4:return 4;case i.m.Uchar:return 1;case i.m.Uchar2:return 2;case i.m.Uchar3:return 3;case i.m.Uchar4:return 4;case i.m.Half:return 1;case i.m.Half2:return 2;case i.m.Half3:return 3;case i.m.Half4:return 4;default:return w(`Unsupported type: ${t}`)}}function c(t){switch(255&t){case i.m.Float:case i.m.Float2:case i.m.Float3:case i.m.Float4:return s.FLOAT;case i.m.Int:case i.m.Int2:case i.m.Int3:case i.m.Int4:return s.INT;case i.m.Uint:case i.m.Uint2:case i.m.Uint3:case i.m.Uint4:return s.UNSIGNED_INT;case i.m.Short:case i.m.Short2:case i.m.Short3:case i.m.Short4:return s.SHORT;case i.m.Ushort:case i.m.Ushort2:case i.m.Ushort3:case i.m.Ushort4:return s.UNSIGNED_SHORT;case i.m.Char:case i.m.Char2:case i.m.Char3:case i.m.Char4:return s.BYTE;case i.m.Uchar:case i.m.Uchar2:case i.m.Uchar3:case i.m.Uchar4:return s.UNSIGNED_BYTE;case i.m.Half:case i.m.Half2:case i.m.Half3:case i.m.Half4:return s.HALF_FLOAT;default:return w(`Unsupported type: ${t}`)}}function u(t){switch(t){case i.g.Points:return s.POINTS;case i.g.Lines:return s.LINES;case i.g.LineLoop:return s.LINE_LOOP;case i.g.LineStrip:return s.LINE_STRIP;case i.g.Triangles:return s.TRIANGLES;case i.g.TriangleStrip:return s.TRIANGLE_STRIP;case i.g.TriangleFan:return s.TRIANGLE_FAN;default:return w(`Unsupported primitive type: ${t}`)}}function h(t){switch(t){case i.m.Short_Norm:case i.m.Short2_Norm:case i.m.Short3_Norm:case i.m.Short4_Norm:case i.m.Ushort_Norm:case i.m.Ushort2_Norm:case i.m.Ushort3_Norm:case i.m.Ushort4_Norm:case i.m.Char_Norm:case i.m.Char2_Norm:case i.m.Char3_Norm:case i.m.Char4_Norm:case i.m.Uchar_Norm:case i.m.Uchar2_Norm:case i.m.Uchar3_Norm:case i.m.Uchar4_Norm:return!0;default:return!1}}function l(t){switch(t){case i.m.Uchar:return s.UNSIGNED_BYTE;case i.m.Uint:return s.UNSIGNED_INT;case i.m.Ushort:return s.UNSIGNED_SHORT;default:return w(`Unsupported index type: ${t}`)}}function f(t){switch(t){case i.k.Texture2D:return s.TEXTURE_2D;case i.k.Texture3D:return s.TEXTURE_3D;case i.k.TextureCube:return s.TEXTURE_CUBE_MAP;default:return w(`Unsupported texture type: ${t}`)}}function d(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:return s.ALPHA;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA;case i.i.F16:return s.ALPHA;case i.i.F16x4:case i.i.F32x4:return s.RGBA;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function p(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:case i.i.U8_sRGB:return s.RED;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:case i.i.U10_10_10_2:return s.RGBA;case i.i.F16:return s.RED;case i.i.F16x2:return s.RG;case i.i.F16x4:return s.RGBA;case i.i.F32x2:return s.RG;case i.i.F32x4:return s.RGBA;case i.i.F11_11_10:return s.RGB;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function m(t){switch(t){case i.i.U565:return s.RGB565;case i.i.U8:case i.i.U8_sRGB:return s.R8;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG8;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB8;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA8;case i.i.U10_10_10_2:return s.RGB10_A2;case i.i.F16:return s.R16F;case i.i.F16x2:return s.RG16F;case i.i.F16x3:return s.RGB16F;case i.i.F16x4:return s.RGBA16F;case i.i.F32x2:return s.RG32F;case i.i.F32x3:return s.RGB32F;case i.i.F32x4:return s.RGBA32F;case i.i.Depth32:return s.DEPTH_COMPONENT32F;case i.i.Depth24Stencil8:return s.DEPTH24_STENCIL8;default:return w(`Unsupported texel format: ${t}`)}}function g(t){switch(t){case i.i.Undefined:return 0;case i.i.U565:return s.UNSIGNED_SHORT_5_6_5;case i.i.U8:case i.i.U8_sRGB:case i.i.U8x2:case i.i.U8x2_sRGB:case i.i.U8x3:case i.i.U8x3_sRGB:case i.i.U8x4:case i.i.U8x4_sRGB:return s.UNSIGNED_BYTE;case i.i.U10_10_10_2:return s.RGBA;case i.i.F11_11_10:return s.FLOAT;case i.i.F16:case i.i.F16x2:case i.i.F16x4:return s.HALF_FLOAT;case i.i.F32x2:case i.i.F32x4:case i.i.Depth32:return s.FLOAT;case i.i.Depth24Stencil8:return s.UNSIGNED_INT_24_8;default:return w(`Unsupported texel format: ${t}`)}}function y(t){switch(t){case i.j.Nearest:return s.NEAREST;case i.j.Linear:return s.LINEAR;default:return w(`Unsupported texture filter: ${t}`)}}function b(t){switch(t){case i.b.Zero:return s.ZERO;case i.b.One:return s.One;case i.b.Source:return s.SRC_ALPHA;case i.b.OneMinusSource:return s.ONE_MINUS_SRC_ALPHA;default:return w(`Unsupported blend factor: ${t}`)}}function v(t,e="Assert failed"){t||w(e)}function w(t){throw console.error(t),new Error(t)}function x(t,e){return void 0!==t?t:e}function _(t){return null!=t}function C(t){return void 0!==t.height}function M(t,e,n){const r=s.createShader(e);if(s.shaderSource(r,n),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS)){const i=e===s.VERTEX_SHADER?"Vertex":"Fragment",o=n.split("\n").map((t,e)=>`${e+1}: ${t}`).join("\n");console.error(o),w(`${i} compilation failed for shader ${t}:\n  ${s.getShaderInfoLog(r)}. See source above.`)}return r}function A(t,e,n){const r=t.vertexLayout.buffers[n],o=t.shader.reflection,a=Object.keys(r.layout);s.bindBuffer(s.ARRAY_BUFFER,e.buffer.glId);for(let t=0;t<a.length;t++){const n=r.layout[a[t]],u=o.attributes[a[t]];if(_(u))if(e.buffer){const t=c(n.type),o=h(n.type);s.enableVertexAttribArray(u.location),s.vertexAttribPointer(u.location,u.components,t,o,r.stride,n.offset+e.offset),r.stepMode===i.h.Instance&&(s.instancedArrays?s.instancedArrays.vertexAttribDivisorANGLE(u.location,1):s.vertexAttribDivisor(u.location,1))}else s.disableVertexAttribArray(u.location)}}function k(t){return t.type===i.a.Texture}class T{constructor(){this.objects=[],this.freeList=[],this.count=0}get(t){const e=this.objects[t];return v(void 0!==e,"Invalid ID"),e}create(t){if(++this.count,this.freeList.length>0){const e=this.freeList.pop();return this.objects[e]=t,e}return this.objects.push(t),this.objects.length-1}delete(t){--this.count,delete this.objects[t],this.freeList.push(t)}}class S{constructor(){this.debugEnabled=!1,this.buffers=new T,this.textures=new T,this.shaders=new T,this.renderPipelines=new T,this.resourceTables=new T,this.vertexTables=new T,this.renderPasses=new T,this.depthStencilStates=new T}initialize(t){const e={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(s=t.getContext("webgl2",e),s||(s=t.getContext("webgl",e)),!s)return!1;this.webGlVersion=s instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(t){let e,n=0;return(e=s.getExtension("OES_vertex_array_object"))&&(n|=i.f.VertexArrayObject,s.createVertexArray=e.createVertexArrayOES.bind(e),s.deleteVertexArray=e.deleteVertexArrayOES.bind(e),s.bindVertexArray=e.bindVertexArrayOES.bind(e)),(e=s.getExtension("OES_texture_half_float"))&&(n|=i.f.TextureHalf,s.HALF_FLOAT=e.HALF_FLOAT_OES),(e=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(n|=i.f.AnistropicFiltering,s.MAX_TEXTURE_MAX_ANISOTROPY_EXT=e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,s.TEXTURE_MAX_ANISOTROPY_EXT=e.TEXTURE_MAX_ANISOTROPY_EXT),s.getExtension("OES_texture_float")&&(n|=i.f.TextureFloat),s.getExtension("OES_texture_float_linear")&&(n|=i.f.TextureFloatLinearFiltering),s.getExtension("OES_texture_half_float_linear")&&(n|=i.f.TextureHalfLinearFiltering),s.getExtension("OES_standard_derivatives")&&(n|=i.f.ShaderDerivatives),s.texSubImage2D&&(n|=i.f.TextureWrite),(s.instancedArrays=s.getExtension("ANGLE_instanced_arrays"))&&(n|=i.f.Instancing),n|=i.f.ShaderGlsl100,t>=2&&(n|=i.f.VertexArrayObject,n|=i.f.TextureFloat,n|=i.f.TextureHalf,n|=i.f.Instancing,n|=i.f.ShaderGlsl300),n}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:t.width,height:t.height}),v(this.defaultRenderPass===i.o),this.current={},s.clearColor(0,0,0,1);const n=new Uint8Array([0,0,0,1]),r={usage:i.n.Static,type:i.k.Texture2D,format:i.i.U8x4,width:1,height:1},o=this.createTexture("DefaultTexture",r,n);return this.defaultTexture=this.textures.get(o),this.isGfxFeatureSupported(i.f.AnistropicFiltering)&&(this.maxAnisotropy=s.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),!0}isGfxFeatureSupported(t){return!!(this.featureFlags&t)}setDebugEnabled(t){this.debugEnabled=t}resize(t,e){const n=this.renderPasses.get(this.defaultRenderPass);n.width=t,n.height=e}beginFrame(){}endFrame(){}bindRenderPass(t){const e=this.renderPasses.get(t);s.bindFramebuffer(s.FRAMEBUFFER,e.glFramebuffer),s.viewport(0,0,e.width,e.height);const n=s.COLOR_BUFFER_BIT;s.clear(n)}bindPipeline(t){const e=this.renderPipelines.get(t);this.pipeline=e,this.current.shader!==e.shader&&(s.useProgram(e.shader.glProgram),this.current.shader=e.shader),e.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=e.renderFormat.blendingEnabled,e.renderFormat.blendingEnabled?s.enable(s.BLEND):s.disable(s.BLEND)),!this.current.blending||this.current.srcBlendFactor==e.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==e.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=x(e.renderFormat.srcBlendFactor,i.b.One),this.current.dstBlendFactor=x(e.renderFormat.dstBlendFactor,i.b.OneMinusSource),s.blendFunc(b(this.current.srcBlendFactor),b(this.current.dstBlendFactor)))}draw(t,e,n,r,o){const a=u(t),c=l(n),h=i.l(n),f=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.glId),s.drawElements(a,o,c,r*h)}drawInstanced(t,e,n,r,o,a){const c=u(t),h=l(n),f=i.l(n),d=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,d.glId),s.instancedArrays?s.instancedArrays.drawElementsInstancedANGLE(c,o,h,r*f,a):s.drawElementsInstanced(c,o,h,r*f,a)}drawNonIndexed(t,e,n){const r=u(t);s.drawArrays(r,e,n)}setDepthStencilState(t){const e=this.depthStencilStates.get(t),n=this.current.depthStencil;n&&e.depthWriteEnabled==n.depthWriteEnabled||s.depthMask(e.depthWriteEnabled),n&&e.depthCompareFunc==n.depthCompareFunc||s.depthFunc(e.depthCompareFunc),n&&e.depthTestEnabled==n.depthTestEnabled||(e.depthTestEnabled?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST)),this.current.depthStencil=e}setCullMode(t){this.current.cullMode!=t&&(this.current.cullMode=t,t==i.e.None?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(function(t){switch(t){case i.e.None:return s.NONE;case i.e.Back:return s.BACK;case i.e.Front:return s.FRONT;default:return w(`Unsupported culling mode: ${t}`)}}(t))))}createDepthStencilState(t){const e=function(t){switch(t){case i.d.Never:return s.NEVER;case i.d.Less:return s.LESS;case i.d.Equal:return s.EQUAL;case i.d.LessEqual:return s.LEQUAL;case i.d.Greater:return s.GREATER;case i.d.NotEqual:return s.NOTEQUAL;case i.d.GreaterEqual:return s.GEQUAL;case i.d.Always:return s.ALWAYS;default:return w(`Unsupported compare func: ${t}`)}}(x(t.depthCompareFunc,i.d.Less));return this.depthStencilStates.create({depthTestEnabled:t.depthTestEnabled,depthWriteEnabled:t.depthWriteEnabled,depthCompareFunc:e})}createVertexTable(t){const e=this.renderPipelines.get(t);let n=null;return this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(n=s.createVertexArray()),this.vertexTables.create({pipeline:e,vao:n,buffers:[]})}removeVertexTable(t){if(this.isGfxFeatureSupported(i.f.VertexArrayObject)){const e=this.vertexTables.get(t);s.deleteVertexArray(e.vao)}this.vertexTables.delete(t)}createResourceTable(t){return this.resourceTables.create({layout:t,buffers:[],textures:[]})}removeResourceTable(t){this.resourceTables.delete(t)}bindVertices(t){const e=this.vertexTables.get(t);if(this.debugEnabled){const t=e.pipeline.shader.name,n=e.pipeline.vertexLayout.buffers.length;for(let r=0;r<n;r++)v(_(e.buffers[r]),`Shader ${t} expects a vertex buffer bound at slot ${r}`)}if(this.isGfxFeatureSupported(i.f.VertexArrayObject))s.bindVertexArray(e.vao);else for(let t=0;t<e.buffers.length;t++)A(e.pipeline,e.buffers[t],t)}bindResources(t){const e=this.resourceTables.get(t),n=this.pipeline.uniformLayout,r=this.pipeline.shader.reflection,o=this.pipeline.shader.name;for(let t=0;t<r.uniforms.length;t++){const o=r.uniforms[t],a=n[o.name],c=e.buffers[a.index].buffer.cpuBuffer;v(_(c));const u=new Float32Array(c.buffer,a.offset,o.size/4),h=this.pipeline.shader.uniformVals[o.name];if(!u.every((t,e)=>t===h[e]))switch(this.pipeline.shader.uniformVals[o.name].set(u),o.type){case i.m.Float:s.uniform1fv(o.location,u);break;case i.m.Float2:s.uniform2fv(o.location,u);break;case i.m.Float3:s.uniform3fv(o.location,u);break;case i.m.Float4:s.uniform4fv(o.location,u);break;case i.m.Float3x3:s.uniformMatrix3fv(o.location,!1,u);break;case i.m.Float4x4:s.uniformMatrix4fv(o.location,!1,u);break;default:w("Unknown shader uniform type")}}for(let t=0;t<r.textureArray.length;t++){const i=r.textureArray[t],a=n[i.name].index;void 0===e.textures[a]&&console.warn(`Shader ${o} expects texture "${i.name}" (index ${a}) to be bound`);for(let t=0;t<i.count;t++){const n=e.textures[a+t]||this.defaultTexture,r=i.location+t;s.activeTexture(s.TEXTURE0+r),s.bindTexture(n.target,n.glId)}}}setVertexBuffer(t,e,n){const r=this.vertexTables.get(t),o={buffer:this.buffers.get(n.buffer),offset:n.byteOffset||0};v(e<i.r),r.buffers[e]=o,this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(s.bindVertexArray(r.vao),A(r.pipeline,o,e))}setBuffer(t,e,n){const r=this.resourceTables.get(t),i=this.buffers.get(n.buffer);r.buffers[e]={buffer:i,offset:n.byteOffset||0}}setTexture(t,e,n){const r=this.resourceTables.get(t),i=n?this.textures.get(n):null;r.textures[e]=i}setTextures(t,e,n){const r=this.resourceTables.get(t);for(let t=0;t<n.length;t++){const i=n[t]?this.textures.get(n[t]):null;r.textures[e+t]=i}}writeBufferData(t,e,n){const r=this.buffers.get(t);if(r.type===i.c.Uniform){const t=ArrayBuffer.isView(n)?n.buffer:n,i=new Uint8Array(t);_(r.cpuBuffer)?r.cpuBuffer.set(i,e):w("No CPU buffer assigned to uniform buffer")}else s.bindBuffer(r.target,r.glId),s.bufferSubData(r.target,e,n)}createRenderPipeline(t,e,n,r){const s=this.shaders.get(t),o=Object.keys(r),a=o.map(t=>r[t]),c=s.reflection;if(this.debugEnabled){for(const t of o){const e=r[t];e.type===i.a.UniformBuffer&&v(void 0!==e.layout,`A BufferLayout must be provided for UniformBuffer "${t}" in the ResourceLayout passed to createRenderPipeline()`+"to define uniform binding locations. In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader")}for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],n=a.find(t=>!k(t)&&t.layout&&t.layout[e.name]);v(void 0!==n,`Shader '${s.name}' expects uniform '${e.name}' to be set in a uniform buffer`);const r=n.layout[e.name].type;if(v(r===e.type,`Shader '${s.name}' expects uniform '${e.name}' to be type ${e.type} but the ShaderResourceLayout specifies type ${r}`),e.count>1){const t=n.layout[e.name].count;v(void 0!==t,`Shader '${s.name}' expects uniform '${e.name}' to be an array but the ShaderResourceLayout specifies a scalar value`),v(t>=e.count,`Shader '${s.name}' expects uniform '${e.name}' to be an array of length ${e.count} but the ShaderResourceLayout specifies a length of ${t}`)}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],n=a.find((t,n)=>k(t)&&o[n]===e.name);v(void 0!==n,`Shader '${s.name}' expects texture '${e.name}', but it is not defined in the ShaderResourceLayout`),v((n.count||1)===e.count,`Shader '${s.name}' expects texture '${e.name}' to be an array of length ${e.count}, but the ResourceLayout specifies length ${n.count}`)}Object.keys(c.attributes).forEach(t=>{v(void 0!==n.buffers.find(e=>e&&void 0!==e.layout[t]),`VertexLayout does not supply attribute ${t} required by Shader '${s.name}'`)}),this.isGfxFeatureSupported(i.f.Instancing)||n.buffers.forEach(t=>{v(t.stepMode!==i.h.Instance,"Instancing is not supported by this WebGL context")})}const u={};for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],n=a.find(t=>!k(t)&&t.layout&&t.layout[e.name]);u[e.name]={offset:n.layout[e.name].offset,index:n.index}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],n=r[e.name];u[e.name]={offset:0,index:n.index}}return this.renderPipelines.create({shader:s,renderFormat:e,vertexLayout:n,resourceLayout:r,uniformLayout:u})}removeRenderPipeline(t){this.renderPipelines.delete(t)}createShader(t){return this._createShader(t.name,t.vertSource,t.fragSource)}_createShader(t,e,n){const r=function(t,e,n){const r=M(t,s.VERTEX_SHADER,e),i=M(t,s.FRAGMENT_SHADER,n),o=s.createProgram();return s.attachShader(o,r),s.attachShader(o,i),s.linkProgram(o),s.deleteShader(r),s.deleteShader(i),s.getProgramParameter(o,s.LINK_STATUS)||w(`Linking failed for shader ${t}:\n  ${s.getProgramInfoLog(o)}`),o}(t,e instanceof Array?e.join("\n#line 0\n"):e,n instanceof Array?n.join("\n#line 0\n"):n),u=function(t){const e={},n=[],r=[],u={};let h=0;const l=s.getProgramParameter(t,s.ACTIVE_ATTRIBUTES);v(l<i.p);for(let e=0;e<l;e++){const n=s.getActiveAttrib(t,e),r=o(n.type);u[n.name]={location:e,count:n.size,components:a(r),glType:c(r),type:r}}const f=s.getProgramParameter(t,s.ACTIVE_UNIFORMS);v(f<i.q);for(let a=0;a<f;a++){const c=s.getActiveUniform(t,a),u=o(c.type),l=c.name.replace("[0]","");if(u>=i.k.Texture2D&&u<=i.k.TextureCube){const r={name:l,count:c.size,type:u,location:h,locationGl:s.getUniformLocation(t,c.name)};h+=c.size,e[l]=r,n.push(r)}else{const e={name:l,count:c.size,type:u,size:i.l(u)*c.size,location:s.getUniformLocation(t,c.name)};r.push(e)}}return{attributes:u,uniforms:r,textures:e,textureArray:n,textureCount:h}}(r),h={};for(let t=0;t<u.uniforms.length;t++){const e=u.uniforms[t];h[e.name]=new Float32Array(e.size/4)}s.useProgram(r);const l=Object.keys(u.textures);for(let t=0;t<l.length;t++){const e=u.textures[l[t]],n=Array.from(Array(e.count).keys()).map((t,n)=>e.location+n);s.uniform1iv(e.locationGl,n)}return this.current.shader=void 0,this.shaders.create({name:t,glProgram:r,reflection:u,uniformVals:h})}removeShader(t){const e=this.shaders.get(t);s.deleteProgram(e.glProgram),this.shaders.delete(t)}createTexture(t,e,n){const r=!n||n.buffer instanceof ArrayBuffer&&void 0!==n.byteLength,o=1===this.webGlVersion?d:p,a={target:f(e.type),format:o(e.format),internalFormat:this.webGlVersion>1?m(e.format):o(e.format),type:g(e.format),usage:e.usage,width:r?x(e.width,1):n.width,height:r?x(e.height,1):n.height,depth:e.depth||1,minFilter:y(void 0!==e.defaultMinFilter?e.defaultMinFilter:i.j.Linear),magFilter:y(void 0!==e.defaultMagFilter?e.defaultMagFilter:i.j.Linear),glId:s.createTexture()};if(s.bindTexture(a.target,a.glId),s.texParameteri(a.target,s.TEXTURE_MIN_FILTER,a.minFilter),s.texParameteri(a.target,s.TEXTURE_MAG_FILTER,a.magFilter),s.texParameteri(a.target,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(a.target,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),_(e.maxAnistropy)&&e.maxAnistropy>1&&this.isGfxFeatureSupported(i.f.AnistropicFiltering)){const t=Math.min(this.maxAnisotropy,e.maxAnistropy);s.texParameterf(s.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,t)}const c=this.webGlVersion>1?a.internalFormat:a.format;if(e.type===i.k.Texture3D)s.texImage3D(a.target,0,c,a.width,a.height,a.depth,0,a.format,a.type,n);else if(r)n instanceof ArrayBuffer&&(n=new Uint8Array(n)),s.texImage2D(a.target,0,c,a.width,a.height,0,a.format,a.type,n);else if(void 0!==n)s.texImage2D(a.target,0,c,a.format,a.type,n);else{v(void 0!==a.width&&void 0!==a.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),s.texImage2D(a.target,0,c,e.width,e.height,0,a.format,a.type,null)}return this.textures.create(a)}writeTextureData(t,e){const n=this.textures.get(t);v(n.target===s.TEXTURE_2D,"Currently only 2D textures may be written to"),s.bindTexture(n.target,n.glId);const r=C(e)?e.width!==n.width:!!C(e)&&e.height!==n.height;this.isGfxFeatureSupported(i.f.TextureWrite)&&!r?C(e)?s.texSubImage2D(n.target,0,0,0,n.format,n.type,e):s.texSubImage2D(n.target,0,0,0,n.width,n.height,n.format,n.type,e):s.texImage2D(n.target,0,n.internalFormat,n.format,n.type,e)}removeTexture(t){const e=this.textures.get(t);s.deleteTexture(e.glId),this.textures.delete(t)}createBuffer(t,e,n,r){let o,a;v(n!=i.n.None);const c=function(t){switch(t){case i.c.Undefined:return 0;case i.c.Uniform:return s.UNIFORM_BUFFER;case i.c.Vertex:return s.ARRAY_BUFFER;case i.c.Index:return s.ELEMENT_ARRAY_BUFFER;case i.c.Readback:return s.TRANSFORM_FEEDBACK_BUFFER}}(e),u=t=>Number.isInteger(t),h=t=>t instanceof ArrayBuffer,l=u(r)?null:r,f=u(r)?r:r.byteLength;if(v(f>0||null!==l,"Either an ArrayBuffer or size must be provided"),e!=i.c.Uniform)a=s.createBuffer(),s.bindBuffer(c,a),s.bufferData(c,r,n==i.n.Dynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW);else if(l){const t=h(l)?l:l.buffer,e=h(l)?0:l.byteOffset;o=new Uint8Array(t,e,f)}else o=new Uint8Array(f);return this.buffers.create({name:t,type:e,target:c,usage:n,size:f,glId:a,cpuBuffer:o})}removeBuffer(t){const e=this.buffers.get(t);e.type!=i.c.Uniform&&s.deleteBuffer(e.glId),this.buffers.delete(t)}readPixels(t,e,n,r,i){s.readPixels(t,e,n,r,s.RGBA,s.UNSIGNED_BYTE,i)}}var F=n(2),E=n(0);class O{constructor(t,e,n=1,r=2e4){this.cameraMatrix=F.b.create(),this.viewMatrix=F.b.create(),this.projectionMatrix=F.b.create(),this.projectionMatrixInverse=F.b.create(),this.viewProjMatrix=F.b.create(),this.viewProjMatrixInverse=F.b.create(),this.forward=F.d.create(),this.up=F.d.create(),this.right=F.d.create(),t=Object(E.d)(t,60/180*Math.PI),n=Object(E.d)(n,1),r=Object(E.d)(r,2e3),e=Object(E.d)(e,1),this.setPerspective(t,e,n,r)}copy(t){this.fov=t.fov,this.near=t.near,this.far=t.far,this.aspect=t.aspect,F.b.copy(this.cameraMatrix,t.cameraMatrix),F.b.copy(this.viewMatrix,t.viewMatrix),F.b.copy(this.projectionMatrix,t.projectionMatrix),F.b.copy(this.projectionMatrixInverse,t.projectionMatrixInverse),F.b.copy(this.viewProjMatrix,t.viewProjMatrix),F.b.copy(this.viewProjMatrixInverse,t.viewProjMatrixInverse),F.d.copy(this.forward,t.forward),F.d.copy(this.up,t.up),F.d.copy(this.right,t.right)}getPos(t){return F.b.getTranslation(t,this.cameraMatrix)}viewMatrixUpdated(){F.b.invert(this.cameraMatrix,this.viewMatrix),F.d.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),F.d.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),F.d.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),F.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),F.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(t,e,n,r=1/0){this.fov=t,this.aspect=e,this.near=n,this.far=r,F.b.perspective(this.projectionMatrix,t,e,n,r),F.b.invert(this.projectionMatrixInverse,this.projectionMatrix),F.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),F.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}var j=n(42),I=n(20),R=n(5),B=n(10);const U=F.d.create(),D=F.d.create(),P=new B.c(F.d.create()),N=F.d.fromValues(0,1,0);class L{constructor(t){this.camera=t,this.camPos=F.d.create()}initialize(t){const e=window.innerWidth/window.innerHeight;this.resize(e),this.controller=new z,this.controller.camera=this.camera,this.controller.initialize(t)}resize(t){this.camera.setPerspective(this.camera.fov,t,this.camera.near,this.camera.far)}update(t){this.controller.update(t);const e=this.camera.getPos(this.camPos);t.globalUniforms.buffer.setVec3("g_camPos",e),t.globalUniforms.buffer.setMat4("g_proj",this.camera.projectionMatrix),t.globalUniforms.buffer.setMat4("g_viewProj",this.camera.viewProjMatrix)}toJSON(){return this.controller.toJSON()}fromJSON(t){return this.controller.fromJSON(t)}}class z{constructor(){this.minDistance=500,this.maxDistance=800}initialize(t){const e=P.buffer,n=F.d.add(U,e,F.d.set(U,1e3,700,0));F.b.lookAt(this.camera.viewMatrix,n,e,N),this.camera.viewMatrixUpdated(),this.heading=Math.atan2(this.camera.forward[0],this.camera.forward[2]),this.pitch=.5*Math.PI,this.distance=1e3;const r=t.debugMenu.addFolder("FollowCam");r.add(this,"pitch",0,.5*Math.PI,.01*Math.PI),r.add(this,"minDistance",500,2e3,100),r.add(this,"maxDistance",500,3e3,100)}update(t){this.follow=t.avatar.localAvatar,this.follow.getWorldPosition(P);const e=F.d.add(P.buffer,P.buffer,F.d.set(D,0,250,0)),n=this.camera.getPos(U),r=F.d.subtract(U,e,n),i=F.d.length(r),s=Math.atan2(r[2],r[0]);let o=Object(R.b)(this.heading,s);this.heading=(this.heading+o)%6.283,this.distance=Object(R.c)(i,this.minDistance,this.maxDistance);const a=function(t,e,n){const r=Math.sin(n);return t[0]=r*Math.cos(e),t[1]=Math.cos(n),t[2]=r*Math.sin(e),t}(U,this.heading+Math.PI,this.pitch),c=F.d.scale(U,a,this.distance),u=F.d.add(U,e,c);return F.b.lookAt(this.camera.viewMatrix,u,e,N),this.camera.viewMatrixUpdated(),!1}toJSON(){return""}fromJSON(t){}}var V=n(44),q=n(14);class W{constructor(t,e){this.canvas=t,this.gfxDevice=e,this.resolutionScale=1}initialize({debugMenu:t}){for(let t in q.a)q.a[t].defaultDepthStateId=this.gfxDevice.createDepthStencilState(q.a[t].defaultDepthState);t.addFolder("Compositor").add(this,"resolutionScale",1,16,1)}render(){this.width=this.canvas.clientWidth*devicePixelRatio/this.resolutionScale,this.height=this.canvas.clientHeight*devicePixelRatio/this.resolutionScale,this.width===this.canvas.width&&this.height===this.canvas.height||(this.canvas.width=this.width,this.canvas.height=this.height,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)),this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(i.o),H(this.gfxDevice,q.a.opaque),H(this.gfxDevice,q.a.debug),this.gfxDevice.endFrame();for(let t in q.a)q.a[t].primitives.length=0}resize(t,e,n){this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.canvas.style.position="absolute"}}function H(t,e){const n=e.primitives.length;for(let r=0;r<n;r++){const n=e.primitives[r];if(t.bindPipeline(n.renderPipeline),t.bindVertices(n.vertexTable),t.bindResources(n.resourceTable),t.setCullMode(e.defaultCullMode),t.setDepthStencilState(e.defaultDepthStateId),Object(E.e)(n.indexBuffer)){const e=n.indexType===i.m.Ushort?2:4,r=Object(E.d)(n.indexBuffer.byteOffset,0)/e;t.draw(n.type,n.indexBuffer.buffer,Object(E.c)(n.indexType),r,n.elementCount)}else t.drawNonIndexed(n.type,0,n.elementCount)}}var G=n(95),Y=n.n(G),X=n(96),$=n.n(X),K=n(29);class J{constructor(t,e,n){this.resourceTable=n,this.vertexTable=e,this.renderPipeline=t,this.elementCount=0,this.type=i.g.Triangles}}var Z=n(8);class Q{constructor(){this.name="GridShader",this.vertSource=Q.vert.sourceCode,this.fragSource=Q.frag.sourceCode}}Q.vert=Y.a,Q.frag=$.a,Q.UniformLayout=Object(Z.b)({u_baseColor:{type:i.m.Float4},u_lineColor:{type:i.m.Float4},u_gridUnit:{type:i.m.Float},u_gridRadius:{type:i.m.Float}}),Q.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:K.a.bufferLayout},uniforms:{index:1,type:i.a.UniformBuffer,layout:Q.UniformLayout}};class tt{constructor(){this.baseColor=F.e.fromValues(.3,.3,.3,1),this.lineColor=F.e.fromValues(1,1,1,1),this.gridUnit=100,this.gridRadius=5e3,this.enabled=!0}initialize({gfxDevice:t,globalUniforms:e,debugMenu:n}){if(!t.isGfxFeatureSupported(i.f.ShaderGlsl300))return console.warn("GLSL version 300 not supported, disabling DebugGrid"),void(this.enabled=!1);const r=t.createShader(new Q),s=Q.resourceLayout,o={buffers:[{stride:2,layout:{a_pos:{type:i.m.Char2,offset:0}}}]},a=t.createRenderPipeline(r,{blendingEnabled:!1},o,s),c=t.createBuffer("GridVertices",i.c.Vertex,i.n.Static,new Int8Array([-1,-1,1,-1,-1,1,1,1])),u=t.createBuffer("GridIndices",i.c.Index,i.n.Static,new Uint16Array([0,2,1,1,2,3])),h=t.createResourceTable(s);this.uniforms=new Z.a("GridUniforms",t,Q.UniformLayout),t.setBuffer(h,0,e.bufferView),t.setBuffer(h,1,this.uniforms.getBufferView());const l=t.createVertexTable(a);t.setVertexBuffer(l,0,{buffer:c}),this.primitive=new J(a,l,h),this.primitive.indexBuffer={buffer:u},this.primitive.indexType=i.m.Ushort,this.primitive.elementCount=6;const f=n.addFolder("DebugGrid");f.add(this,"enabled"),f.add(this,"gridUnit",1,100,10),f.add(this,"gridRadius")}render({gfxDevice:t}){this.enabled&&(this.uniforms.setVec4("u_baseColor",this.baseColor),this.uniforms.setVec4("u_lineColor",this.lineColor),this.uniforms.setFloat("u_gridUnit",this.gridUnit),this.uniforms.setFloat("u_gridRadius",this.gridRadius),this.uniforms.write(t),q.a.opaque.push(this.primitive))}}var et=n(31),nt=n(45),rt=n(46);class it{constructor(){this.clearing=!1}initialize(t){t.debugMenu.add(this,"clearState"),this.loadState(t)&&console.log("Loaded state from localStorage")}saveState({cameraSystem:t,debugMenu:e}){const n={version:1,cameraSystem:t,debugMenu:e},r=JSON.stringify(n);this.clearing||window.localStorage.setItem("state",r)}loadState({cameraSystem:t,debugMenu:e}){const n=window.localStorage.getItem("state");if(!Object(E.e)(n))return!1;const r=JSON.parse(n);if(1!==r.version)return!1;try{t.fromJSON(r.cameraSystem),e.fromJSON(r.debugMenu)}catch(t){return console.warn("Failed to load state:",t),!1}return!0}clearState(){window.localStorage.removeItem("state"),this.clearing=!0,location.reload()}update(t){r.b&&this.saveState(t)}}var st=n(23),ot=n(7),at=n(12),ct=n(43),ut=n(27);class ht{constructor(){this.canvas=document.createElement("canvas"),this.gfxDevice=new S,this.camera=new O,this.displaySnapshot=new ot.a,this.debugMenu=new j.a,this.avatar=new I.d,this.clock=new V.a,this.cameraSystem=new L(this.camera),this.compositor=new W(this.canvas,this.gfxDevice),this.debugGrid=new tt,this.globalUniforms=new K.a(this.gfxDevice),this.input=new et.b,this.net=new nt.a,this.resources=new rt.a,this.state=new it,this.userCommands=new st.b,this.weapons=new ct.b,this.init()}async init(){return console.log(`Source for this build available at ${r.a}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(r.b),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),ut.a.setContext(this.gfxDevice,this.globalUniforms),this.onResize(),this.resources.initialize(this.gfxDevice),this.clock.initialize(this),this.input.initialize(this),this.net.initialize(this),this.cameraSystem.initialize(this),this.compositor.initialize(this),this.globalUniforms.initialize(),this.avatar.initialize(this),this.weapons.initialize(this),this.debugGrid.initialize(this),this.state.initialize(this),window.onresize=this.onResize.bind(this),document.onvisibilitychange=this.onVisibility.bind(this),window.onbeforeunload=this.onUnload.bind(this),r.b&&this.debugMenu.show(),window.requestAnimationFrame(this.tick.bind(this)),0):1}onConnect(t){this.net.onConnect(t)}tick(t){this.clock.tick(),this.updateFixed(),this.update(),this.render(),this.input.afterFrame(),this.debugMenu.update(),window.requestAnimationFrame(this.tick.bind(this))}updateFixed(){for(;this.clock.updateFixed();)if(this.input.updateFixed(this),this.weapons.updateFixed(this),this.net.client.state===at.c.Active){const t=Object(E.c)(this.userCommands.getUserCommand(this.clock.simFrame));this.net.client.transmitClientFrame(this.clock.simFrame,t)}}update(){if(this.net.client.state===at.c.Active){let t=this.clock.renderTime/this.clock.simDt;this.net.client.getSnapshot(t,this.displaySnapshot)}this.input.update(),this.net.update(this),this.resources.update(),this.avatar.update(this),this.cameraSystem.update(this),this.state.update(this),this.globalUniforms.update()}render(){this.avatar.render(this),this.weapons.render(this),this.debugGrid.render(this),ut.a.flush(),this.compositor.render()}onResize(){this.cameraSystem.resize(window.innerWidth/window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}onVisibility(){const t=document.hidden;this.net.onVisibility(t)}onUnload(){this.net.terminate()}}var lt=n(62),ft=n(30);const dt={debug:t=>t.debugMenu.show()};window.config={kSignalServerAddress:r.b?"localhost:8888":"3.23.86.226:8888"},async function(){const t=new ht;window.client=t,new URLSearchParams(window.location.search).forEach((e,n)=>{const r=dt[n];r&&r(t,e)});const e=new ft.a;if(await e.connect(window.config.kSignalServerAddress),e.serverId===e.clientId){const t=new lt.Server;t.onConnect(e),window.server=t}else e.close();t.onConnect(e.serverId)}()}]);