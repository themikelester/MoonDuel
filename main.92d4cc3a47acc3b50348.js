!function(t){function e(e){for(var r,i,s=e[0],a=e[1],o=0,u=[];o<s.length;o++)i=s[o],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&u.push(n[i][0]),n[i]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r]);for(c&&c(e);u.length;)u.shift()()}var r={},n={0:0,1:0};function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(t){var e=[],r=n[t];if(0!==r)if(r)e.push(r[2]);else{var s=new Promise((function(e,i){r=n[t]=[e,i]}));e.push(r[2]=s);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=function(t){return i.p+""+({2:"vendors~dat-gui"}[t]||t)+"."+{2:"2125a9dad09271e92a81"}[t]+".js"}(t);var c=new Error;a=function(e){o.onerror=o.onload=null,clearTimeout(u);var r=n[t];if(0!==r){if(r){var i=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",c.name="ChunkLoadError",c.type=i,c.request=s,r[1](c)}n[t]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(e)},i.m=t,i.c=r,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var s=window.webpackJsonp=window.webpackJsonp||[],a=s.push.bind(s);s.push=e,s=s.slice();for(var o=0;o<s.length;o++)e(s[o]);var c=a;i(i.s=106)}([function(t,e,r){"use strict";function n(t,e=""){if(!t){const t=new Error(`Assert fail: ${e}`);throw console.error(t.stack),t}}function i(t,e){if(null!=t)return t;throw new Error(a(e,"Missing object"))}function s(t){return null!=t}function a(t,e){return null!=t?t:e}function o(t,e){const r=t.indexOf(e);return n(r>=0),t.splice(r,1),r}r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"d",(function(){return a})),r.d(e,"a",(function(){return o}))},function(t,e,r){"use strict";r.d(e,"q",(function(){return n})),r.d(e,"r",(function(){return i})),r.d(e,"s",(function(){return s})),r.d(e,"p",(function(){return a})),r.d(e,"f",(function(){return o})),r.d(e,"n",(function(){return c})),r.d(e,"k",(function(){return u})),r.d(e,"i",(function(){return h})),r.d(e,"j",(function(){return l})),r.d(e,"l",(function(){return f})),r.d(e,"d",(function(){return d})),r.d(e,"g",(function(){return p})),r.d(e,"c",(function(){return m})),r.d(e,"a",(function(){return g})),r.d(e,"o",(function(){return b})),r.d(e,"e",(function(){return y})),r.d(e,"b",(function(){return v})),r.d(e,"h",(function(){return x})),r.d(e,"m",(function(){return w}));const n=16,i=64,s=16,a=0;var o,c,u,h,l,f,d,p,m,g,b,y,v,x;function w(t){switch(t){case c.Float:return 4;case c.Float2:return 8;case c.Float3:return 12;case c.Float4:return 16;case c.Int:return 4;case c.Int2:return 8;case c.Int3:return 12;case c.Int4:return 16;case c.Uint:return 4;case c.Uint2:return 8;case c.Uint3:return 12;case c.Uint4:return 16;case c.Short:return 2;case c.Short2:return 4;case c.Short3:return 6;case c.Short4:return 8;case c.Ushort:return 2;case c.Ushort2:return 4;case c.Ushort3:return 6;case c.Ushort4:return 8;case c.Char:return 1;case c.Char2:return 2;case c.Char3:return 3;case c.Char4:return 4;case c.Uchar:return 1;case c.Uchar2:return 2;case c.Uchar3:return 3;case c.Uchar4:return 4;case c.Half:return 2;case c.Half2:return 4;case c.Half3:return 6;case c.Half4:return 8;case c.Float3x3:return 36;case c.Float4x4:return 64;default:throw new Error(`Unsupported type: ${t}`)}}!function(t){t[t.VertexArrayObject=1]="VertexArrayObject",t[t.TextureFloat=2]="TextureFloat",t[t.TextureHalf=4]="TextureHalf",t[t.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",t[t.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",t[t.TextureWrite=32]="TextureWrite",t[t.ShaderDerivatives=64]="ShaderDerivatives",t[t.Instancing=128]="Instancing",t[t.AnistropicFiltering=256]="AnistropicFiltering",t[t.ShaderGlsl100=512]="ShaderGlsl100",t[t.ShaderGlsl300=1024]="ShaderGlsl300"}(o||(o={})),function(t){t[t.Undefined=0]="Undefined",t[t.Float=1]="Float",t[t.Float2=2]="Float2",t[t.Float3=3]="Float3",t[t.Float4=4]="Float4",t[t.Int=5]="Int",t[t.Int2=6]="Int2",t[t.Int3=7]="Int3",t[t.Int4=8]="Int4",t[t.Uint=9]="Uint",t[t.Uint2=10]="Uint2",t[t.Uint3=11]="Uint3",t[t.Uint4=12]="Uint4",t[t.Short=13]="Short",t[t.Short2=14]="Short2",t[t.Short3=15]="Short3",t[t.Short4=16]="Short4",t[t.Ushort=17]="Ushort",t[t.Ushort2=18]="Ushort2",t[t.Ushort3=19]="Ushort3",t[t.Ushort4=20]="Ushort4",t[t.Char=21]="Char",t[t.Char2=22]="Char2",t[t.Char3=23]="Char3",t[t.Char4=24]="Char4",t[t.Uchar=25]="Uchar",t[t.Uchar2=26]="Uchar2",t[t.Uchar3=27]="Uchar3",t[t.Uchar4=28]="Uchar4",t[t.Half=29]="Half",t[t.Half2=30]="Half2",t[t.Half3=31]="Half3",t[t.Half4=32]="Half4",t[t.Float3x3=33]="Float3x3",t[t.Float3x4=34]="Float3x4",t[t.Float4x4=35]="Float4x4",t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube",t[t.Short_Norm=256]="Short_Norm",t[t.Short2_Norm=257]="Short2_Norm",t[t.Short3_Norm=258]="Short3_Norm",t[t.Short4_Norm=259]="Short4_Norm",t[t.Ushort_Norm=260]="Ushort_Norm",t[t.Ushort2_Norm=261]="Ushort2_Norm",t[t.Ushort3_Norm=262]="Ushort3_Norm",t[t.Ushort4_Norm=263]="Ushort4_Norm",t[t.Char_Norm=264]="Char_Norm",t[t.Char2_Norm=265]="Char2_Norm",t[t.Char3_Norm=266]="Char3_Norm",t[t.Char4_Norm=267]="Char4_Norm",t[t.Uchar_Norm=268]="Uchar_Norm",t[t.Uchar2_Norm=269]="Uchar2_Norm",t[t.Uchar3_Norm=270]="Uchar3_Norm",t[t.Uchar4_Norm=271]="Uchar4_Norm"}(c||(c={})),function(t){t[t.Texture2D=240]="Texture2D",t[t.Texture3D=241]="Texture3D",t[t.TextureCube=242]="TextureCube"}(u||(u={})),function(t){t[t.Undefined=0]="Undefined",t[t.U565=1]="U565",t[t.U8=2]="U8",t[t.U8_sRGB=3]="U8_sRGB",t[t.U8x2=4]="U8x2",t[t.U8x2_sRGB=5]="U8x2_sRGB",t[t.U8x3=6]="U8x3",t[t.U8x3_sRGB=7]="U8x3_sRGB",t[t.U8x4=8]="U8x4",t[t.U8x4_sRGB=9]="U8x4_sRGB",t[t.U10_10_10_2=10]="U10_10_10_2",t[t.F11_11_10=11]="F11_11_10",t[t.F16=12]="F16",t[t.F16x2=13]="F16x2",t[t.F16x3=14]="F16x3",t[t.F16x4=15]="F16x4",t[t.F32x2=16]="F32x2",t[t.F32x3=17]="F32x3",t[t.F32x4=18]="F32x4",t[t.Depth32=19]="Depth32",t[t.Depth24Stencil8=20]="Depth24Stencil8"}(h||(h={})),function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(l||(l={})),function(t){t[t.Clamp=0]="Clamp",t[t.Repeat=1]="Repeat"}(f||(f={})),function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessEqual=3]="LessEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterEqual=6]="GreaterEqual",t[t.Always=7]="Always"}(d||(d={})),function(t){t[t.Points=0]="Points",t[t.Lines=1]="Lines",t[t.LineLoop=2]="LineLoop",t[t.LineStrip=3]="LineStrip",t[t.Triangles=4]="Triangles",t[t.TriangleStrip=5]="TriangleStrip",t[t.TriangleFan=6]="TriangleFan"}(p||(p={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uniform=1]="Uniform",t[t.Vertex=2]="Vertex",t[t.Index=3]="Index",t[t.Readback=4]="Readback"}(m||(m={})),function(t){t[t.Undefined=0]="Undefined",t[t.UniformBuffer=1]="UniformBuffer",t[t.Texture=2]="Texture"}(g||(g={})),function(t){t[t.None=0]="None",t[t.Static=1]="Static",t[t.Dynamic=2]="Dynamic"}(b||(b={})),function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Front=2]="Front"}(y||(y={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Source=2]="Source",t[t.OneMinusSource=3]="OneMinusSource"}(v||(v={})),function(t){t[t.Vertex=0]="Vertex",t[t.Instance=1]="Instance"}(x||(x={}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return i})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return s})),r.d(e,"f",(function(){return a}));var n={};r.r(n),r.d(n,"create",(function(){return f})),r.d(n,"fromMat4",(function(){return d})),r.d(n,"clone",(function(){return p})),r.d(n,"copy",(function(){return m})),r.d(n,"fromValues",(function(){return g})),r.d(n,"set",(function(){return b})),r.d(n,"identity",(function(){return y})),r.d(n,"transpose",(function(){return v})),r.d(n,"invert",(function(){return x})),r.d(n,"adjoint",(function(){return w})),r.d(n,"determinant",(function(){return _})),r.d(n,"multiply",(function(){return M})),r.d(n,"translate",(function(){return C})),r.d(n,"rotate",(function(){return A})),r.d(n,"scale",(function(){return S})),r.d(n,"fromTranslation",(function(){return T})),r.d(n,"fromRotation",(function(){return k})),r.d(n,"fromScaling",(function(){return F})),r.d(n,"fromMat2d",(function(){return O})),r.d(n,"fromQuat",(function(){return E})),r.d(n,"normalFromMat4",(function(){return j})),r.d(n,"projection",(function(){return B})),r.d(n,"str",(function(){return R})),r.d(n,"frob",(function(){return I})),r.d(n,"add",(function(){return P})),r.d(n,"subtract",(function(){return U})),r.d(n,"multiplyScalar",(function(){return D})),r.d(n,"multiplyScalarAndAdd",(function(){return L})),r.d(n,"exactEquals",(function(){return N})),r.d(n,"equals",(function(){return V})),r.d(n,"mul",(function(){return z})),r.d(n,"sub",(function(){return q}));var i={};r.r(i),r.d(i,"create",(function(){return W})),r.d(i,"clone",(function(){return H})),r.d(i,"copy",(function(){return Y})),r.d(i,"fromValues",(function(){return G})),r.d(i,"set",(function(){return X})),r.d(i,"identity",(function(){return $})),r.d(i,"transpose",(function(){return K})),r.d(i,"invert",(function(){return J})),r.d(i,"adjoint",(function(){return Z})),r.d(i,"determinant",(function(){return Q})),r.d(i,"multiply",(function(){return tt})),r.d(i,"translate",(function(){return et})),r.d(i,"scale",(function(){return rt})),r.d(i,"rotate",(function(){return nt})),r.d(i,"rotateX",(function(){return it})),r.d(i,"rotateY",(function(){return st})),r.d(i,"rotateZ",(function(){return at})),r.d(i,"fromTranslation",(function(){return ot})),r.d(i,"fromScaling",(function(){return ct})),r.d(i,"fromRotation",(function(){return ut})),r.d(i,"fromXRotation",(function(){return ht})),r.d(i,"fromYRotation",(function(){return lt})),r.d(i,"fromZRotation",(function(){return ft})),r.d(i,"fromRotationTranslation",(function(){return dt})),r.d(i,"fromQuat2",(function(){return pt})),r.d(i,"getTranslation",(function(){return mt})),r.d(i,"getScaling",(function(){return gt})),r.d(i,"getRotation",(function(){return bt})),r.d(i,"fromRotationTranslationScale",(function(){return yt})),r.d(i,"fromRotationTranslationScaleOrigin",(function(){return vt})),r.d(i,"fromQuat",(function(){return xt})),r.d(i,"frustum",(function(){return wt})),r.d(i,"perspective",(function(){return _t})),r.d(i,"perspectiveFromFieldOfView",(function(){return Mt})),r.d(i,"ortho",(function(){return Ct})),r.d(i,"lookAt",(function(){return At})),r.d(i,"targetTo",(function(){return St})),r.d(i,"str",(function(){return Tt})),r.d(i,"frob",(function(){return kt})),r.d(i,"add",(function(){return Ft})),r.d(i,"subtract",(function(){return Ot})),r.d(i,"multiplyScalar",(function(){return Et})),r.d(i,"multiplyScalarAndAdd",(function(){return jt})),r.d(i,"exactEquals",(function(){return Bt})),r.d(i,"equals",(function(){return Rt})),r.d(i,"mul",(function(){return It})),r.d(i,"sub",(function(){return Pt}));var s={};r.r(s),r.d(s,"create",(function(){return Ut})),r.d(s,"clone",(function(){return Dt})),r.d(s,"length",(function(){return Lt})),r.d(s,"fromValues",(function(){return Nt})),r.d(s,"copy",(function(){return Vt})),r.d(s,"set",(function(){return zt})),r.d(s,"add",(function(){return qt})),r.d(s,"subtract",(function(){return Wt})),r.d(s,"multiply",(function(){return Ht})),r.d(s,"divide",(function(){return Yt})),r.d(s,"ceil",(function(){return Gt})),r.d(s,"floor",(function(){return Xt})),r.d(s,"min",(function(){return $t})),r.d(s,"max",(function(){return Kt})),r.d(s,"round",(function(){return Jt})),r.d(s,"scale",(function(){return Zt})),r.d(s,"scaleAndAdd",(function(){return Qt})),r.d(s,"distance",(function(){return te})),r.d(s,"squaredDistance",(function(){return ee})),r.d(s,"squaredLength",(function(){return re})),r.d(s,"negate",(function(){return ne})),r.d(s,"inverse",(function(){return ie})),r.d(s,"normalize",(function(){return se})),r.d(s,"dot",(function(){return ae})),r.d(s,"cross",(function(){return oe})),r.d(s,"lerp",(function(){return ce})),r.d(s,"hermite",(function(){return ue})),r.d(s,"bezier",(function(){return he})),r.d(s,"random",(function(){return le})),r.d(s,"transformMat4",(function(){return fe})),r.d(s,"transformMat3",(function(){return de})),r.d(s,"transformQuat",(function(){return pe})),r.d(s,"rotateX",(function(){return me})),r.d(s,"rotateY",(function(){return ge})),r.d(s,"rotateZ",(function(){return be})),r.d(s,"angle",(function(){return ye})),r.d(s,"zero",(function(){return ve})),r.d(s,"str",(function(){return xe})),r.d(s,"exactEquals",(function(){return we})),r.d(s,"equals",(function(){return _e})),r.d(s,"sub",(function(){return Ce})),r.d(s,"mul",(function(){return Ae})),r.d(s,"div",(function(){return Se})),r.d(s,"dist",(function(){return Te})),r.d(s,"sqrDist",(function(){return ke})),r.d(s,"len",(function(){return Fe})),r.d(s,"sqrLen",(function(){return Oe})),r.d(s,"forEach",(function(){return Ee}));var a={};r.r(a),r.d(a,"create",(function(){return je})),r.d(a,"clone",(function(){return Be})),r.d(a,"fromValues",(function(){return Re})),r.d(a,"copy",(function(){return Ie})),r.d(a,"set",(function(){return Pe})),r.d(a,"add",(function(){return Ue})),r.d(a,"subtract",(function(){return De})),r.d(a,"multiply",(function(){return Le})),r.d(a,"divide",(function(){return Ne})),r.d(a,"ceil",(function(){return Ve})),r.d(a,"floor",(function(){return ze})),r.d(a,"min",(function(){return qe})),r.d(a,"max",(function(){return We})),r.d(a,"round",(function(){return He})),r.d(a,"scale",(function(){return Ye})),r.d(a,"scaleAndAdd",(function(){return Ge})),r.d(a,"distance",(function(){return Xe})),r.d(a,"squaredDistance",(function(){return $e})),r.d(a,"length",(function(){return Ke})),r.d(a,"squaredLength",(function(){return Je})),r.d(a,"negate",(function(){return Ze})),r.d(a,"inverse",(function(){return Qe})),r.d(a,"normalize",(function(){return tr})),r.d(a,"dot",(function(){return er})),r.d(a,"cross",(function(){return rr})),r.d(a,"lerp",(function(){return nr})),r.d(a,"random",(function(){return ir})),r.d(a,"transformMat4",(function(){return sr})),r.d(a,"transformQuat",(function(){return ar})),r.d(a,"zero",(function(){return or})),r.d(a,"str",(function(){return cr})),r.d(a,"exactEquals",(function(){return ur})),r.d(a,"equals",(function(){return hr})),r.d(a,"sub",(function(){return lr})),r.d(a,"mul",(function(){return fr})),r.d(a,"div",(function(){return dr})),r.d(a,"dist",(function(){return pr})),r.d(a,"sqrDist",(function(){return mr})),r.d(a,"len",(function(){return gr})),r.d(a,"sqrLen",(function(){return br})),r.d(a,"forEach",(function(){return yr}));var o={};r.r(o),r.d(o,"create",(function(){return vr})),r.d(o,"identity",(function(){return xr})),r.d(o,"setAxisAngle",(function(){return wr})),r.d(o,"getAxisAngle",(function(){return _r})),r.d(o,"getAngle",(function(){return Mr})),r.d(o,"multiply",(function(){return Cr})),r.d(o,"rotateX",(function(){return Ar})),r.d(o,"rotateY",(function(){return Sr})),r.d(o,"rotateZ",(function(){return Tr})),r.d(o,"calculateW",(function(){return kr})),r.d(o,"exp",(function(){return Fr})),r.d(o,"ln",(function(){return Or})),r.d(o,"pow",(function(){return Er})),r.d(o,"slerp",(function(){return jr})),r.d(o,"random",(function(){return Br})),r.d(o,"invert",(function(){return Rr})),r.d(o,"conjugate",(function(){return Ir})),r.d(o,"fromMat3",(function(){return Pr})),r.d(o,"fromEuler",(function(){return Ur})),r.d(o,"str",(function(){return Dr})),r.d(o,"clone",(function(){return Hr})),r.d(o,"fromValues",(function(){return Yr})),r.d(o,"copy",(function(){return Gr})),r.d(o,"set",(function(){return Xr})),r.d(o,"add",(function(){return $r})),r.d(o,"mul",(function(){return Kr})),r.d(o,"scale",(function(){return Jr})),r.d(o,"dot",(function(){return Zr})),r.d(o,"lerp",(function(){return Qr})),r.d(o,"length",(function(){return tn})),r.d(o,"len",(function(){return en})),r.d(o,"squaredLength",(function(){return rn})),r.d(o,"sqrLen",(function(){return nn})),r.d(o,"normalize",(function(){return sn})),r.d(o,"exactEquals",(function(){return an})),r.d(o,"equals",(function(){return on})),r.d(o,"rotationTo",(function(){return cn})),r.d(o,"sqlerp",(function(){return un})),r.d(o,"setAxes",(function(){return hn}));var c={};r.r(c),r.d(c,"create",(function(){return ln})),r.d(c,"clone",(function(){return fn})),r.d(c,"fromValues",(function(){return dn})),r.d(c,"copy",(function(){return pn})),r.d(c,"set",(function(){return mn})),r.d(c,"add",(function(){return gn})),r.d(c,"subtract",(function(){return bn})),r.d(c,"multiply",(function(){return yn})),r.d(c,"divide",(function(){return vn})),r.d(c,"ceil",(function(){return xn})),r.d(c,"floor",(function(){return wn})),r.d(c,"min",(function(){return _n})),r.d(c,"max",(function(){return Mn})),r.d(c,"round",(function(){return Cn})),r.d(c,"scale",(function(){return An})),r.d(c,"scaleAndAdd",(function(){return Sn})),r.d(c,"distance",(function(){return Tn})),r.d(c,"squaredDistance",(function(){return kn})),r.d(c,"length",(function(){return Fn})),r.d(c,"squaredLength",(function(){return On})),r.d(c,"negate",(function(){return En})),r.d(c,"inverse",(function(){return jn})),r.d(c,"normalize",(function(){return Bn})),r.d(c,"dot",(function(){return Rn})),r.d(c,"cross",(function(){return In})),r.d(c,"lerp",(function(){return Pn})),r.d(c,"random",(function(){return Un})),r.d(c,"transformMat2",(function(){return Dn})),r.d(c,"transformMat2d",(function(){return Ln})),r.d(c,"transformMat3",(function(){return Nn})),r.d(c,"transformMat4",(function(){return Vn})),r.d(c,"rotate",(function(){return zn})),r.d(c,"angle",(function(){return qn})),r.d(c,"zero",(function(){return Wn})),r.d(c,"str",(function(){return Hn})),r.d(c,"exactEquals",(function(){return Yn})),r.d(c,"equals",(function(){return Gn})),r.d(c,"len",(function(){return Xn})),r.d(c,"sub",(function(){return $n})),r.d(c,"mul",(function(){return Kn})),r.d(c,"div",(function(){return Jn})),r.d(c,"dist",(function(){return Zn})),r.d(c,"sqrDist",(function(){return Qn})),r.d(c,"sqrLen",(function(){return ti})),r.d(c,"forEach",(function(){return ei}));var u=1e-6,h="undefined"!=typeof Float32Array?Float32Array:Array,l=Math.random;Math.PI;function f(){var t=new h(9);return h!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function d(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function p(t){var e=new h(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function m(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function g(t,e,r,n,i,s,a,o,c){var u=new h(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=i,u[5]=s,u[6]=a,u[7]=o,u[8]=c,u}function b(t,e,r,n,i,s,a,o,c,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t}function y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function v(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function x(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],l=h*a-o*u,f=-h*s+o*c,d=u*s-a*c,p=r*l+n*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-h*n+i*u)*p,t[2]=(o*n-i*a)*p,t[3]=f*p,t[4]=(h*r-i*c)*p,t[5]=(-o*r+i*s)*p,t[6]=d*p,t[7]=(-u*r+n*c)*p,t[8]=(a*r-n*s)*p,t):null}function w(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8];return t[0]=a*h-o*u,t[1]=i*u-n*h,t[2]=n*o-i*a,t[3]=o*c-s*h,t[4]=r*h-i*c,t[5]=i*s-r*o,t[6]=s*u-a*c,t[7]=n*c-r*u,t[8]=r*a-n*s,t}function _(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],c=t[7],u=t[8];return e*(u*s-a*c)+r*(-u*i+a*o)+n*(c*i-s*o)}function M(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=r[0],d=r[1],p=r[2],m=r[3],g=r[4],b=r[5],y=r[6],v=r[7],x=r[8];return t[0]=f*n+d*a+p*u,t[1]=f*i+d*o+p*h,t[2]=f*s+d*c+p*l,t[3]=m*n+g*a+b*u,t[4]=m*i+g*o+b*h,t[5]=m*s+g*c+b*l,t[6]=y*n+v*a+x*u,t[7]=y*i+v*o+x*h,t[8]=y*s+v*c+x*l,t}function C(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=s,t[3]=a,t[4]=o,t[5]=c,t[6]=f*n+d*a+u,t[7]=f*i+d*o+h,t[8]=f*s+d*c+l,t}function A(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*a,t[1]=d*i+f*o,t[2]=d*s+f*c,t[3]=d*a-f*n,t[4]=d*o-f*i,t[5]=d*c-f*s,t[6]=u,t[7]=h,t[8]=l,t}function S(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function T(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function k(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function F(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function O(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function E(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=r+r,o=n+n,c=i+i,u=r*a,h=n*a,l=n*o,f=i*a,d=i*o,p=i*c,m=s*a,g=s*o,b=s*c;return t[0]=1-l-p,t[3]=h-b,t[6]=f+g,t[1]=h+b,t[4]=1-u-p,t[7]=d-m,t[2]=f-g,t[5]=d+m,t[8]=1-u-l,t}function j(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],b=e[15],y=r*o-n*a,v=r*c-i*a,x=r*u-s*a,w=n*c-i*o,_=n*u-s*o,M=i*u-s*c,C=h*m-l*p,A=h*g-f*p,S=h*b-d*p,T=l*g-f*m,k=l*b-d*m,F=f*b-d*g,O=y*F-v*k+x*T+w*S-_*A+M*C;return O?(O=1/O,t[0]=(o*F-c*k+u*T)*O,t[1]=(c*S-a*F-u*A)*O,t[2]=(a*k-o*S+u*C)*O,t[3]=(i*k-n*F-s*T)*O,t[4]=(r*F-i*S+s*A)*O,t[5]=(n*S-r*k-s*C)*O,t[6]=(m*M-g*_+b*w)*O,t[7]=(g*x-p*M-b*v)*O,t[8]=(p*_-m*x+b*y)*O,t):null}function B(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function R(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function I(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function P(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function U(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function D(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function L(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function N(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function V(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],h=t[7],l=t[8],f=e[0],d=e[1],p=e[2],m=e[3],g=e[4],b=e[5],y=e[6],v=e[7],x=e[8];return Math.abs(r-f)<=u*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-d)<=u*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=u*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(s-m)<=u*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=u*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-b)<=u*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(c-y)<=u*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=u*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-x)<=u*Math.max(1,Math.abs(l),Math.abs(x))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var z=M,q=U;function W(){var t=new h(16);return h!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function H(t){var e=new h(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Y(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function G(t,e,r,n,i,s,a,o,c,u,l,f,d,p,m,g){var b=new h(16);return b[0]=t,b[1]=e,b[2]=r,b[3]=n,b[4]=i,b[5]=s,b[6]=a,b[7]=o,b[8]=c,b[9]=u,b[10]=l,b[11]=f,b[12]=d,b[13]=p,b[14]=m,b[15]=g,b}function X(t,e,r,n,i,s,a,o,c,u,h,l,f,d,p,m,g){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=u,t[9]=h,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g,t}function $(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function K(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=i,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function J(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],b=e[15],y=r*o-n*a,v=r*c-i*a,x=r*u-s*a,w=n*c-i*o,_=n*u-s*o,M=i*u-s*c,C=h*m-l*p,A=h*g-f*p,S=h*b-d*p,T=l*g-f*m,k=l*b-d*m,F=f*b-d*g,O=y*F-v*k+x*T+w*S-_*A+M*C;return O?(O=1/O,t[0]=(o*F-c*k+u*T)*O,t[1]=(i*k-n*F-s*T)*O,t[2]=(m*M-g*_+b*w)*O,t[3]=(f*_-l*M-d*w)*O,t[4]=(c*S-a*F-u*A)*O,t[5]=(r*F-i*S+s*A)*O,t[6]=(g*x-p*M-b*v)*O,t[7]=(h*M-f*x+d*v)*O,t[8]=(a*k-o*S+u*C)*O,t[9]=(n*S-r*k-s*C)*O,t[10]=(p*_-m*x+b*y)*O,t[11]=(l*x-h*_-d*y)*O,t[12]=(o*A-a*T-c*C)*O,t[13]=(r*T-n*A+i*C)*O,t[14]=(m*v-p*w-g*y)*O,t[15]=(h*w-l*v+f*y)*O,t):null}function Z(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],g=e[14],b=e[15];return t[0]=o*(f*b-d*g)-l*(c*b-u*g)+m*(c*d-u*f),t[1]=-(n*(f*b-d*g)-l*(i*b-s*g)+m*(i*d-s*f)),t[2]=n*(c*b-u*g)-o*(i*b-s*g)+m*(i*u-s*c),t[3]=-(n*(c*d-u*f)-o*(i*d-s*f)+l*(i*u-s*c)),t[4]=-(a*(f*b-d*g)-h*(c*b-u*g)+p*(c*d-u*f)),t[5]=r*(f*b-d*g)-h*(i*b-s*g)+p*(i*d-s*f),t[6]=-(r*(c*b-u*g)-a*(i*b-s*g)+p*(i*u-s*c)),t[7]=r*(c*d-u*f)-a*(i*d-s*f)+h*(i*u-s*c),t[8]=a*(l*b-d*m)-h*(o*b-u*m)+p*(o*d-u*l),t[9]=-(r*(l*b-d*m)-h*(n*b-s*m)+p*(n*d-s*l)),t[10]=r*(o*b-u*m)-a*(n*b-s*m)+p*(n*u-s*o),t[11]=-(r*(o*d-u*l)-a*(n*d-s*l)+h*(n*u-s*o)),t[12]=-(a*(l*g-f*m)-h*(o*g-c*m)+p*(o*f-c*l)),t[13]=r*(l*g-f*m)-h*(n*g-i*m)+p*(n*f-i*l),t[14]=-(r*(o*g-c*m)-a*(n*g-i*m)+p*(n*c-i*o)),t[15]=r*(o*f-c*l)-a*(n*f-i*l)+h*(n*c-i*o),t}function Q(t){var e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],c=t[7],u=t[8],h=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15];return(e*a-r*s)*(l*g-f*m)-(e*o-n*s)*(h*g-f*p)+(e*c-i*s)*(h*m-l*p)+(r*o-n*a)*(u*g-f*d)-(r*c-i*a)*(u*m-l*d)+(n*c-i*o)*(u*p-h*d)}function tt(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],m=e[12],g=e[13],b=e[14],y=e[15],v=r[0],x=r[1],w=r[2],_=r[3];return t[0]=v*n+x*o+w*l+_*m,t[1]=v*i+x*c+w*f+_*g,t[2]=v*s+x*u+w*d+_*b,t[3]=v*a+x*h+w*p+_*y,v=r[4],x=r[5],w=r[6],_=r[7],t[4]=v*n+x*o+w*l+_*m,t[5]=v*i+x*c+w*f+_*g,t[6]=v*s+x*u+w*d+_*b,t[7]=v*a+x*h+w*p+_*y,v=r[8],x=r[9],w=r[10],_=r[11],t[8]=v*n+x*o+w*l+_*m,t[9]=v*i+x*c+w*f+_*g,t[10]=v*s+x*u+w*d+_*b,t[11]=v*a+x*h+w*p+_*y,v=r[12],x=r[13],w=r[14],_=r[15],t[12]=v*n+x*o+w*l+_*m,t[13]=v*i+x*c+w*f+_*g,t[14]=v*s+x*u+w*d+_*b,t[15]=v*a+x*h+w*p+_*y,t}function et(t,e,r){var n,i,s,a,o,c,u,h,l,f,d,p,m=r[0],g=r[1],b=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*b+e[12],t[13]=e[1]*m+e[5]*g+e[9]*b+e[13],t[14]=e[2]*m+e[6]*g+e[10]*b+e[14],t[15]=e[3]*m+e[7]*g+e[11]*b+e[15]):(n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],c=e[5],u=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=s,t[3]=a,t[4]=o,t[5]=c,t[6]=u,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+o*g+l*b+e[12],t[13]=i*m+c*g+f*b+e[13],t[14]=s*m+u*g+d*b+e[14],t[15]=a*m+h*g+p*b+e[15]),t}function rt(t,e,r){var n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function nt(t,e,r,n){var i,s,a,o,c,h,l,f,d,p,m,g,b,y,v,x,w,_,M,C,A,S,T,k,F=n[0],O=n[1],E=n[2],j=Math.hypot(F,O,E);return j<u?null:(F*=j=1/j,O*=j,E*=j,i=Math.sin(r),a=1-(s=Math.cos(r)),o=e[0],c=e[1],h=e[2],l=e[3],f=e[4],d=e[5],p=e[6],m=e[7],g=e[8],b=e[9],y=e[10],v=e[11],x=F*F*a+s,w=O*F*a+E*i,_=E*F*a-O*i,M=F*O*a-E*i,C=O*O*a+s,A=E*O*a+F*i,S=F*E*a+O*i,T=O*E*a-F*i,k=E*E*a+s,t[0]=o*x+f*w+g*_,t[1]=c*x+d*w+b*_,t[2]=h*x+p*w+y*_,t[3]=l*x+m*w+v*_,t[4]=o*M+f*C+g*A,t[5]=c*M+d*C+b*A,t[6]=h*M+p*C+y*A,t[7]=l*M+m*C+v*A,t[8]=o*S+f*T+g*k,t[9]=c*S+d*T+b*k,t[10]=h*S+p*T+y*k,t[11]=l*S+m*T+v*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function it(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[4],a=e[5],o=e[6],c=e[7],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*n,t[5]=a*i+h*n,t[6]=o*i+l*n,t[7]=c*i+f*n,t[8]=u*i-s*n,t[9]=h*i-a*n,t[10]=l*i-o*n,t[11]=f*i-c*n,t}function st(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],u=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*n,t[1]=a*i-h*n,t[2]=o*i-l*n,t[3]=c*i-f*n,t[8]=s*n+u*i,t[9]=a*n+h*i,t[10]=o*n+l*i,t[11]=c*n+f*i,t}function at(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],a=e[1],o=e[2],c=e[3],u=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*n,t[1]=a*i+h*n,t[2]=o*i+l*n,t[3]=c*i+f*n,t[4]=u*i-s*n,t[5]=h*i-a*n,t[6]=l*i-o*n,t[7]=f*i-c*n,t}function ot(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ct(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ut(t,e,r){var n,i,s,a=r[0],o=r[1],c=r[2],h=Math.hypot(a,o,c);return h<u?null:(a*=h=1/h,o*=h,c*=h,n=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=a*a*s+i,t[1]=o*a*s+c*n,t[2]=c*a*s-o*n,t[3]=0,t[4]=a*o*s-c*n,t[5]=o*o*s+i,t[6]=c*o*s+a*n,t[7]=0,t[8]=a*c*s+o*n,t[9]=o*c*s-a*n,t[10]=c*c*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ht(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ft(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function dt(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=n+n,c=i+i,u=s+s,h=n*o,l=n*c,f=n*u,d=i*c,p=i*u,m=s*u,g=a*o,b=a*c,y=a*u;return t[0]=1-(d+m),t[1]=l+y,t[2]=f-b,t[3]=0,t[4]=l-y,t[5]=1-(h+m),t[6]=p+g,t[7]=0,t[8]=f+b,t[9]=p-g,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function pt(t,e){var r=new h(3),n=-e[0],i=-e[1],s=-e[2],a=e[3],o=e[4],c=e[5],u=e[6],l=e[7],f=n*n+i*i+s*s+a*a;return f>0?(r[0]=2*(o*a+l*n+c*s-u*i)/f,r[1]=2*(c*a+l*i+u*n-o*s)/f,r[2]=2*(u*a+l*s+o*i-c*n)/f):(r[0]=2*(o*a+l*n+c*s-u*i),r[1]=2*(c*a+l*i+u*n-o*s),r[2]=2*(u*a+l*s+o*i-c*n)),dt(t,e,r),t}function mt(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function gt(t,e){var r=e[0],n=e[1],i=e[2],s=e[4],a=e[5],o=e[6],c=e[8],u=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(s,a,o),t[2]=Math.hypot(c,u,h),t}function bt(t,e){var r=new h(3);gt(r,e);var n=1/r[0],i=1/r[1],s=1/r[2],a=e[0]*n,o=e[1]*i,c=e[2]*s,u=e[4]*n,l=e[5]*i,f=e[6]*s,d=e[8]*n,p=e[9]*i,m=e[10]*s,g=a+l+m,b=0;return g>0?(b=2*Math.sqrt(g+1),t[3]=.25*b,t[0]=(f-p)/b,t[1]=(d-c)/b,t[2]=(o-u)/b):a>l&&a>m?(b=2*Math.sqrt(1+a-l-m),t[3]=(f-p)/b,t[0]=.25*b,t[1]=(o+u)/b,t[2]=(d+c)/b):l>m?(b=2*Math.sqrt(1+l-a-m),t[3]=(d-c)/b,t[0]=(o+u)/b,t[1]=.25*b,t[2]=(f+p)/b):(b=2*Math.sqrt(1+m-a-l),t[3]=(o-u)/b,t[0]=(d+c)/b,t[1]=(f+p)/b,t[2]=.25*b),t}function yt(t,e,r,n){var i=e[0],s=e[1],a=e[2],o=e[3],c=i+i,u=s+s,h=a+a,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=a*h,b=o*c,y=o*u,v=o*h,x=n[0],w=n[1],_=n[2];return t[0]=(1-(p+g))*x,t[1]=(f+v)*x,t[2]=(d-y)*x,t[3]=0,t[4]=(f-v)*w,t[5]=(1-(l+g))*w,t[6]=(m+b)*w,t[7]=0,t[8]=(d+y)*_,t[9]=(m-b)*_,t[10]=(1-(l+p))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function vt(t,e,r,n,i){var s=e[0],a=e[1],o=e[2],c=e[3],u=s+s,h=a+a,l=o+o,f=s*u,d=s*h,p=s*l,m=a*h,g=a*l,b=o*l,y=c*u,v=c*h,x=c*l,w=n[0],_=n[1],M=n[2],C=i[0],A=i[1],S=i[2],T=(1-(m+b))*w,k=(d+x)*w,F=(p-v)*w,O=(d-x)*_,E=(1-(f+b))*_,j=(g+y)*_,B=(p+v)*M,R=(g-y)*M,I=(1-(f+m))*M;return t[0]=T,t[1]=k,t[2]=F,t[3]=0,t[4]=O,t[5]=E,t[6]=j,t[7]=0,t[8]=B,t[9]=R,t[10]=I,t[11]=0,t[12]=r[0]+C-(T*C+O*A+B*S),t[13]=r[1]+A-(k*C+E*A+R*S),t[14]=r[2]+S-(F*C+j*A+I*S),t[15]=1,t}function xt(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=r+r,o=n+n,c=i+i,u=r*a,h=n*a,l=n*o,f=i*a,d=i*o,p=i*c,m=s*a,g=s*o,b=s*c;return t[0]=1-l-p,t[1]=h+b,t[2]=f-g,t[3]=0,t[4]=h-b,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wt(t,e,r,n,i,s,a){var o=1/(r-e),c=1/(i-n),u=1/(s-a);return t[0]=2*s*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(i+n)*c,t[10]=(a+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*u,t[15]=0,t}function _t(t,e,r,n,i){var s,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(n-i),t[10]=(i+n)*s,t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t}function Mt(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),u=2/(i+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(a-o)*c*.5,t[9]=(i-s)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function Ct(t,e,r,n,i,s,a){var o=1/(e-r),c=1/(n-i),u=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(i+n)*c,t[14]=(a+s)*u,t[15]=1,t}function At(t,e,r,n){var i,s,a,o,c,h,l,f,d,p,m=e[0],g=e[1],b=e[2],y=n[0],v=n[1],x=n[2],w=r[0],_=r[1],M=r[2];return Math.abs(m-w)<u&&Math.abs(g-_)<u&&Math.abs(b-M)<u?$(t):(l=m-w,f=g-_,d=b-M,i=v*(d*=p=1/Math.hypot(l,f,d))-x*(f*=p),s=x*(l*=p)-y*d,a=y*f-v*l,(p=Math.hypot(i,s,a))?(i*=p=1/p,s*=p,a*=p):(i=0,s=0,a=0),o=f*a-d*s,c=d*i-l*a,h=l*s-f*i,(p=Math.hypot(o,c,h))?(o*=p=1/p,c*=p,h*=p):(o=0,c=0,h=0),t[0]=i,t[1]=o,t[2]=l,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=h,t[10]=d,t[11]=0,t[12]=-(i*m+s*g+a*b),t[13]=-(o*m+c*g+h*b),t[14]=-(l*m+f*g+d*b),t[15]=1,t)}function St(t,e,r,n){var i=e[0],s=e[1],a=e[2],o=n[0],c=n[1],u=n[2],h=i-r[0],l=s-r[1],f=a-r[2],d=h*h+l*l+f*f;d>0&&(h*=d=1/Math.sqrt(d),l*=d,f*=d);var p=c*f-u*l,m=u*h-o*f,g=o*l-c*h;return(d=p*p+m*m+g*g)>0&&(p*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=l*g-f*m,t[5]=f*p-h*g,t[6]=h*m-l*p,t[7]=0,t[8]=h,t[9]=l,t[10]=f,t[11]=0,t[12]=i,t[13]=s,t[14]=a,t[15]=1,t}function Tt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function kt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ft(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Ot(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Et(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function jt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function Bt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Rt(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],c=t[6],h=t[7],l=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],b=t[14],y=t[15],v=e[0],x=e[1],w=e[2],_=e[3],M=e[4],C=e[5],A=e[6],S=e[7],T=e[8],k=e[9],F=e[10],O=e[11],E=e[12],j=e[13],B=e[14],R=e[15];return Math.abs(r-v)<=u*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=u*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-w)<=u*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-_)<=u*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-M)<=u*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-C)<=u*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(c-A)<=u*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-S)<=u*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(l-T)<=u*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(f-k)<=u*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-F)<=u*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(p-O)<=u*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-E)<=u*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(g-j)<=u*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(b-B)<=u*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(y-R)<=u*Math.max(1,Math.abs(y),Math.abs(R))}var It=tt,Pt=Ot;function Ut(){var t=new h(3);return h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dt(t){var e=new h(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Lt(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Nt(t,e,r){var n=new h(3);return n[0]=t,n[1]=e,n[2]=r,n}function Vt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function qt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Wt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ht(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Yt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Gt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Xt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function $t(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function Kt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Jt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Zt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Qt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function te(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function ee(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function re(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function ne(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ie(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function se(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function ae(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function oe(t,e,r){var n=e[0],i=e[1],s=e[2],a=r[0],o=r[1],c=r[2];return t[0]=i*c-s*o,t[1]=s*a-n*c,t[2]=n*o-i*a,t}function ce(t,e,r,n){var i=e[0],s=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=a+n*(r[2]-a),t}function ue(t,e,r,n,i,s){var a=s*s,o=a*(2*s-3)+1,c=a*(s-2)+s,u=a*(s-1),h=a*(3-2*s);return t[0]=e[0]*o+r[0]*c+n[0]*u+i[0]*h,t[1]=e[1]*o+r[1]*c+n[1]*u+i[1]*h,t[2]=e[2]*o+r[2]*c+n[2]*u+i[2]*h,t}function he(t,e,r,n,i,s){var a=1-s,o=a*a,c=s*s,u=o*a,h=3*s*o,l=3*c*a,f=c*s;return t[0]=e[0]*u+r[0]*h+n[0]*l+i[0]*f,t[1]=e[1]*u+r[1]*h+n[1]*l+i[1]*f,t[2]=e[2]*u+r[2]*h+n[2]*l+i[2]*f,t}function le(t,e){e=e||1;var r=2*l()*Math.PI,n=2*l()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t}function fe(t,e,r){var n=e[0],i=e[1],s=e[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a,t}function de(t,e,r){var n=e[0],i=e[1],s=e[2];return t[0]=n*r[0]+i*r[3]+s*r[6],t[1]=n*r[1]+i*r[4]+s*r[7],t[2]=n*r[2]+i*r[5]+s*r[8],t}function pe(t,e,r){var n=r[0],i=r[1],s=r[2],a=r[3],o=e[0],c=e[1],u=e[2],h=i*u-s*c,l=s*o-n*u,f=n*c-i*o,d=i*f-s*l,p=s*h-n*f,m=n*l-i*h,g=2*a;return h*=g,l*=g,f*=g,d*=2,p*=2,m*=2,t[0]=o+h+d,t[1]=c+l+p,t[2]=u+f+m,t}function me(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ge(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function be(t,e,r,n){var i=[],s=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function ye(t,e){var r=t[0],n=t[1],i=t[2],s=e[0],a=e[1],o=e[2],c=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(s*s+a*a+o*o),u=c&&ae(t,e)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function ve(t){return t[0]=0,t[1]=0,t[2]=0,t}function xe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function we(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function _e(t,e){var r=t[0],n=t[1],i=t[2],s=e[0],a=e[1],o=e[2];return Math.abs(r-s)<=u*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=u*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))}var Me,Ce=Wt,Ae=Ht,Se=Yt,Te=te,ke=ee,Fe=Lt,Oe=re,Ee=(Me=Ut(),function(t,e,r,n,i,s){var a,o;for(e||(e=3),r||(r=0),o=n?Math.min(n*e+r,t.length):t.length,a=r;a<o;a+=e)Me[0]=t[a],Me[1]=t[a+1],Me[2]=t[a+2],i(Me,Me,s),t[a]=Me[0],t[a+1]=Me[1],t[a+2]=Me[2];return t});function je(){var t=new h(4);return h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Be(t){var e=new h(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Re(t,e,r,n){var i=new h(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function Ie(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Pe(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function Ue(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function De(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Le(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Ne(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Ve(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function ze(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function qe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function We(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function He(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Ye(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Ge(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Xe(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return Math.hypot(r,n,i,s)}function $e(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],s=e[3]-t[3];return r*r+n*n+i*i+s*s}function Ke(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function Je(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function Ze(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Qe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function tr(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=r*r+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=s*a,t}function er(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function rr(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],h=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*u-f*c+d*o,t[1]=-h*u+f*a-d*s,t[2]=h*c-l*a+d*i,t[3]=-h*o+l*s-f*i,t}function nr(t,e,r,n){var i=e[0],s=e[1],a=e[2],o=e[3];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=a+n*(r[2]-a),t[3]=o+n*(r[3]-o),t}function ir(t,e){var r,n,i,s,a,o;e=e||1;do{a=(r=2*l()-1)*r+(n=2*l()-1)*n}while(a>=1);do{o=(i=2*l()-1)*i+(s=2*l()-1)*s}while(o>=1);var c=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*i*c,t[3]=e*s*c,t}function sr(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*a,t}function ar(t,e,r){var n=e[0],i=e[1],s=e[2],a=r[0],o=r[1],c=r[2],u=r[3],h=u*n+o*s-c*i,l=u*i+c*n-a*s,f=u*s+a*i-o*n,d=-a*n-o*i-c*s;return t[0]=h*u+d*-a+l*-c-f*-o,t[1]=l*u+d*-o+f*-a-h*-c,t[2]=f*u+d*-c+h*-o-l*-a,t[3]=e[3],t}function or(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function cr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ur(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function hr(t,e){var r=t[0],n=t[1],i=t[2],s=t[3],a=e[0],o=e[1],c=e[2],h=e[3];return Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=u*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-c)<=u*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=u*Math.max(1,Math.abs(s),Math.abs(h))}var lr=De,fr=Le,dr=Ne,pr=Xe,mr=$e,gr=Ke,br=Je,yr=function(){var t=je();return function(e,r,n,i,s,a){var o,c;for(r||(r=4),n||(n=0),c=i?Math.min(i*r+n,e.length):e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();function vr(){var t=new h(4);return h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function xr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function wr(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function _r(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>u?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function Mr(t,e){var r=Zr(t,e);return Math.acos(2*r*r-1)}function Cr(t,e,r){var n=e[0],i=e[1],s=e[2],a=e[3],o=r[0],c=r[1],u=r[2],h=r[3];return t[0]=n*h+a*o+i*u-s*c,t[1]=i*h+a*c+s*o-n*u,t[2]=s*h+a*u+n*c-i*o,t[3]=a*h-n*o-i*c-s*u,t}function Ar(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=i*c+s*o,t[2]=s*c-i*o,t[3]=a*c-n*o,t}function Sr(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-s*o,t[1]=i*c+a*o,t[2]=s*c+n*o,t[3]=a*c-i*o,t}function Tr(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*o,t[1]=i*c-n*o,t[2]=s*c+a*o,t[3]=a*c-s*o,t}function kr(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function Fr(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=Math.sqrt(r*r+n*n+i*i),o=Math.exp(s),c=a>0?o*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=i*c,t[3]=o*Math.cos(a),t}function Or(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=Math.sqrt(r*r+n*n+i*i),o=a>0?Math.atan2(a,s)/a:0;return t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=.5*Math.log(r*r+n*n+i*i+s*s),t}function Er(t,e,r){return Or(t,e),Jr(t,t,r),Fr(t,t),t}function jr(t,e,r,n){var i,s,a,o,c,h=e[0],l=e[1],f=e[2],d=e[3],p=r[0],m=r[1],g=r[2],b=r[3];return(s=h*p+l*m+f*g+d*b)<0&&(s=-s,p=-p,m=-m,g=-g,b=-b),1-s>u?(i=Math.acos(s),a=Math.sin(i),o=Math.sin((1-n)*i)/a,c=Math.sin(n*i)/a):(o=1-n,c=n),t[0]=o*h+c*p,t[1]=o*l+c*m,t[2]=o*f+c*g,t[3]=o*d+c*b,t}function Br(t){var e=l(),r=l(),n=l(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*r),t[1]=i*Math.cos(2*Math.PI*r),t[2]=s*Math.sin(2*Math.PI*n),t[3]=s*Math.cos(2*Math.PI*n),t}function Rr(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],a=r*r+n*n+i*i+s*s,o=a?1/a:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-i*o,t[3]=s*o,t}function Ir(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Pr(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*a+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*s+a]-e[3*a+s])*r,t[s]=(e[3*s+i]+e[3*i+s])*r,t[a]=(e[3*a+i]+e[3*i+a])*r}return t}function Ur(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var s=Math.sin(e),a=Math.cos(e),o=Math.sin(r),c=Math.cos(r),u=Math.sin(n),h=Math.cos(n);return t[0]=s*c*h-a*o*u,t[1]=a*o*h+s*c*u,t[2]=a*c*u-s*o*h,t[3]=a*c*h+s*o*u,t}function Dr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Lr,Nr,Vr,zr,qr,Wr,Hr=Be,Yr=Re,Gr=Ie,Xr=Pe,$r=Ue,Kr=Cr,Jr=Ye,Zr=er,Qr=nr,tn=Ke,en=tn,rn=Je,nn=rn,sn=tr,an=ur,on=hr,cn=(Lr=Ut(),Nr=Nt(1,0,0),Vr=Nt(0,1,0),function(t,e,r){var n=ae(e,r);return n<-.999999?(oe(Lr,Nr,e),Fe(Lr)<1e-6&&oe(Lr,Vr,e),se(Lr,Lr),wr(t,Lr,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(oe(Lr,e,r),t[0]=Lr[0],t[1]=Lr[1],t[2]=Lr[2],t[3]=1+n,sn(t,t))}),un=(zr=vr(),qr=vr(),function(t,e,r,n,i,s){return jr(zr,e,i,s),jr(qr,r,n,s),jr(t,zr,qr,2*s*(1-s)),t}),hn=(Wr=f(),function(t,e,r,n){return Wr[0]=r[0],Wr[3]=r[1],Wr[6]=r[2],Wr[1]=n[0],Wr[4]=n[1],Wr[7]=n[2],Wr[2]=-e[0],Wr[5]=-e[1],Wr[8]=-e[2],sn(t,Pr(t,Wr))});function ln(){var t=new h(2);return h!=Float32Array&&(t[0]=0,t[1]=0),t}function fn(t){var e=new h(2);return e[0]=t[0],e[1]=t[1],e}function dn(t,e){var r=new h(2);return r[0]=t,r[1]=e,r}function pn(t,e){return t[0]=e[0],t[1]=e[1],t}function mn(t,e,r){return t[0]=e,t[1]=r,t}function gn(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function bn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function yn(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function vn(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function xn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function wn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function _n(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Mn(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Cn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function An(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Sn(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Tn(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function kn(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Fn(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function On(t){var e=t[0],r=t[1];return e*e+r*r}function En(t,e){return t[0]=-e[0],t[1]=-e[1],t}function jn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Bn(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Rn(t,e){return t[0]*e[0]+t[1]*e[1]}function In(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Pn(t,e,r,n){var i=e[0],s=e[1];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t}function Un(t,e){e=e||1;var r=2*l()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Dn(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function Ln(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function Nn(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function Vn(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function zn(t,e,r,n){var i=e[0]-r[0],s=e[1]-r[1],a=Math.sin(n),o=Math.cos(n);return t[0]=i*o-s*a+r[0],t[1]=i*a+s*o+r[1],t}function qn(t,e){var r=t[0],n=t[1],i=e[0],s=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+s*s),o=a&&(r*i+n*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function Wn(t){return t[0]=0,t[1]=0,t}function Hn(t){return"vec2("+t[0]+", "+t[1]+")"}function Yn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Gn(t,e){var r=t[0],n=t[1],i=e[0],s=e[1];return Math.abs(r-i)<=u*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=u*Math.max(1,Math.abs(n),Math.abs(s))}var Xn=Fn,$n=bn,Kn=yn,Jn=vn,Zn=Tn,Qn=kn,ti=On,ei=function(){var t=ln();return function(e,r,n,i,s,a){var o,c;for(r||(r=2),n||(n=0),c=i?Math.min(i*r+n,e.length):e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],s(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}}()},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{constructor(t){this.data=t,this.offset=0,this.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength)}alloc(t){const e=this.offset;return this.offset+t>this.data.byteLength?null:(this.offset+=t,e)}write(t){const e=this.alloc(t.byteLength);return null!==e&&(this.data.set(t,e),!0)}clear(){return this.offset=0,this}finish(){const t=this.data.subarray(0,this.offset);return this.offset=0,t}}!function(t){function e(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-32768||e>32767)throw new Error("Msg.writeInt: range error");const r=Object(n.c)(t.alloc(2));return t.data[r+0]=e>>0&255,t.data[r+1]=e>>8&255,r}function r(t){const e=Object(n.c)(t.alloc(2)),r=t.data[e]+(t.data[e+1]<<8);return r>>15?4294901760|r:r}t.writeChar=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-128||e>127)throw new Error("Msg.writeChar: range error");const r=Object(n.c)(t.alloc(1));return t.data[r]=e,r},t.writeByte=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<0||e>255)throw new Error("Msg.writeChar: range error");const r=Object(n.c)(t.alloc(1));return t.data[r]=e,r},t.writeShort=e,t.writeInt=function(t,e){if(!Number.isInteger(e))throw new Error("Msg.writeInt: type error");if(e<-(2**31)||e>2**31-1)throw new Error("Msg.writeInt: range error");const r=Object(n.c)(t.alloc(4));return t.data[r+0]=e>>0&255,t.data[r+1]=e>>8&255,t.data[r+2]=e>>16&255,t.data[r+3]=e>>24&255,r},t.writeAngle16=function(t,r){return e(t,Math.floor(65536*r/(2*Math.PI)))},t.writeFloat=function(t,e){const r=Object(n.c)(t.alloc(4));return t.dataView.setFloat32(r,e,!0),r},t.writeString=function(e,r){Object(n.b)(r.length<256);const i=t.writeByte(e,r.length);for(let n=0;n<r.length;n++)t.writeByte(e,r.charCodeAt(n));return i},t.skip=function(t,e){return Object(n.c)(t.alloc(e))},t.readChar=function(t){const e=Object(n.c)(t.alloc(1)),r=t.data[e];return r>>7?4294967040|r:r},t.readByte=function(t){const e=Object(n.c)(t.alloc(1));return t.data[e]},t.peekByte=function(t){return t.data[t.offset]},t.readShort=r,t.readInt=function(t){const e=Object(n.c)(t.alloc(4));return t.data[e+0]+(t.data[e+1]<<8)+(t.data[e+2]<<16)+(t.data[e+3]<<24)},t.peekInt=function(t){return t.data[t.offset+0]+(t.data[t.offset+1]<<8)+(t.data[t.offset+2]<<16)+(t.data[t.offset+3]<<24)},t.readAngle16=function(t){return r(t)*(2*Math.PI)/65536},t.readFloat=function(t){const e=Object(n.c)(t.alloc(4));return t.dataView.getFloat32(e,!0)},t.readString=function(e){const r=t.readByte(e),n=String.fromCharCode.apply(null,e.data.subarray(e.offset,e.offset+r));return t.skip(e,r),n}}(i||(i={}))},function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"f",(function(){return i})),r.d(e,"e",(function(){return s})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return c})),r.d(e,"h",(function(){return u})),r.d(e,"i",(function(){return h})),r.d(e,"g",(function(){return l}));var n=2200,i=2201,s=2202,a=2300,o=2301,c=2302,u=2400,h=2401,l=2402},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"f",(function(){return s})),r.d(e,"e",(function(){return a})),r.d(e,"c",(function(){return o})),r.d(e,"h",(function(){return c})),r.d(e,"b",(function(){return u})),r.d(e,"g",(function(){return h})),r.d(e,"d",(function(){return l}));var n=r(2);n.b.create();const i=n.e.create();function s(t,e,r){return(1-r)*t+r*e}function a(t,e,r){return(r-t)/(e-t)}function o(t,e,r){return Math.max(Math.min(t,r),e)}function c(t){return o(t,0,1)}function u(t,e,r=6.283){return function(t,e,r=1){const n=(e-t)%r;return 2*n%r-n}(t,e,r)}function h(t,e,r){const i=n.e.length(e);if(i>0){const n=r/i;t[0]+=e[0]*n,t[1]+=e[1]*n,t[2]+=e[2]*n}return t}function l(t,e,r,n,i,s,a,o,c,u){const h=Math.sin(i),l=Math.cos(i),f=Math.sin(s),d=Math.cos(s),p=Math.sin(a),m=Math.cos(a);return t[0]=e*(d*m),t[1]=e*(p*d),t[2]=e*-f,t[3]=0,t[4]=r*(h*m*f-l*p),t[5]=r*(h*p*f+l*m),t[6]=r*(h*d),t[7]=0,t[8]=n*(l*m*f+h*p),t[9]=n*(l*p*f-h*m),t[10]=n*(d*l),t[11]=0,t[12]=o,t[13]=c,t[14]=u,t[15]=1,t}},function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r(19),i=r(14),s=new o,a=new i.a;function o(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(o.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(a.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(a.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,s=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*s,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,s=t.y,a=t.z,o=t.w,c=o*e+s*n-a*r,u=o*r+a*e-i*n,h=o*n+i*r-s*e,l=-i*e-s*r-a*n;return this.x=c*o+l*-i+u*-a-h*-s,this.y=u*o+l*-s+h*-i-c*-a,this.z=h*o+l*-a+c*-s-u*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-i*a,this.y=i*s-r*o,this.z=r*a-n*s,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)},projectOnPlane:function(t){return s.copy(this).projectOnVector(t),this.sub(s)},reflect:function(t){return this.sub(s.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var r=this.dot(t)/e;return Math.acos(n.a.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}})},function(t,e,r){"use strict";r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return a}));var n=r(1),i=r(0);function s(t){const e={};let r=0;const s=Object.keys(t);for(let a=0;a<s.length;a++){const o=t[s[a]];e[s[a]]=Object.assign(Object.assign({},o),{offset:r}),r+=n.m(o.type)*Object(i.d)(o.count,1)}return e}class a{constructor(t,e,r){this.bufferSize=0,this.bufferLayout=r;const i=Object.keys(this.bufferLayout);let s=this.bufferLayout[i[0]];for(let t=1;t<i.length;t++){const e=this.bufferLayout[i[t]];e.offset>s.offset&&(s=e)}this.bufferSize=s.offset+o(s),this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.buffer=e.createBuffer(t,n.c.Uniform,n.o.Dynamic,this.bufferSize)}getBufferView(){return{buffer:this.buffer,byteOffset:0}}getBufferLayout(){return this.bufferLayout}setFloat(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats[r.offset/4]=e}setVec2(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setVec3(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setVec4(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setMat4(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);this.bufferFloats.set(e,r.offset/4)}setBytes(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length!==o(r))throw new Error("Invalid size");this.bufferBytes.set(e,r.offset)}setFloats(t,e){const r=Object(i.c)(this.bufferLayout[t],`Attempted to set unknown uniform ${t}`);if(e.length>o(r)/4)throw new Error("Invalid size");this.bufferFloats.set(e,r.offset/4)}getFloatArray(t){const e=this.bufferLayout[t];if(!e)throw new Error(`Attempted to set unknown uniform ${t}`);return new Float32Array(this.bufferData,e.offset,o(e)/4)}write(t){t.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(t){t.removeBuffer(this.buffer)}}function o(t){return n.m(t.type)*Object(i.d)(t.count,1)}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(1);class i{constructor(t,e,r){this.defaultCullMode=t,this.defaultDepthState=e,this.renderFormat=r,this.primitives=[]}push(t){this.primitives.push(t)}}const s={opaque:new i(n.e.Back,{depthWriteEnabled:!0,depthTestEnabled:!0},{blendingEnabled:!1}),skybox:new i(n.e.None,{depthWriteEnabled:!1,depthTestEnabled:!0},{blendingEnabled:!0,srcBlendFactor:n.b.Source,dstBlendFactor:n.b.OneMinusSource}),effects:new i(n.e.None,{depthWriteEnabled:!1,depthTestEnabled:!0},{blendingEnabled:!0,srcBlendFactor:n.b.Source,dstBlendFactor:n.b.One}),debug:new i(n.e.None,{depthWriteEnabled:!1,depthTestEnabled:!1},{blendingEnabled:!1})}},function(t,e,r){"use strict";r.d(e,"c",(function(){return a}));var n=r(6),i=r(13);r.d(e,"a",(function(){return i.a}));var s=r(28);r.d(e,"b",(function(){return s.a}));class a extends n.a{constructor(t){super(),this.buffer=t}setBuffer(t){return this.buffer=t,this}set x(t){this.buffer&&(this.buffer[0]=t)}set y(t){this.buffer&&(this.buffer[1]=t)}set z(t){this.buffer&&(this.buffer[2]=t)}get x(){return this.buffer[0]}get y(){return this.buffer[1]}get z(){return this.buffer[2]}}},function(t,e,r){"use strict";r.d(e,"f",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"d",(function(){return h})),r.d(e,"c",(function(){return l})),r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return p}));var n=r(2),i=r(0),s=r(5),a=r(3);class o{constructor(){this.stateBuffer=[],this.latestFrame=-1,this.bufferFrameCount=64;for(let t=0;t<this.bufferFrameCount;t++)this.stateBuffer[t]={frame:-1,entities:[]}}addState(t){const e=[],r=[],n=this.stateBuffer[t.frame%this.bufferFrameCount].frame,s=this.getNextFrame(n+1);!function(t,e,r){if(r.length=0,!Object(i.e)(t))return;Object(i.b)(t.frame<e.frame);const n=t.entities.length,s=e.entities.length;for(let a=0,o=0;a<n||o<s;){const c=t.entities[a],u=e.entities[o];a>=n||u&&c.id>u.id?o+=1:o>=s||c&&u.id>c.id?(r.push(c.id),a+=1):c.id===u.id?(a+=1,o+=1):Object(i.b)(!1,"This should never happen")}}(this.stateBuffer[n%this.bufferFrameCount],Object(i.e)(s)?this.stateBuffer[s%this.bufferFrameCount]:t,e),function(t,e,r){if(r.length=0,!Object(i.e)(t)){for(let t=0;t<e.entities.length;t++)r[t]=t;return}Object(i.b)(t.frame<e.frame);const n=t.entities.length,s=e.entities.length;for(let a=0,o=0;a<n||o<s;){const c=t.entities[a],u=e.entities[o];a>=n||u&&c.id>u.id?(r.push(o),o+=1):o>=s||c&&u.id>c.id?a+=1:c.id===u.id?(a+=1,o+=1):Object(i.b)(!1,"This should never happen")}}(this.stateBuffer[this.latestFrame%this.bufferFrameCount],t,r);const a=this.stateBuffer[t.frame%this.bufferFrameCount];return a.frame=t.frame,a.entities=t.entities.slice(),this.latestFrame=t.frame,{additions:r,removals:e}}getState(t){return Object(i.b)(Number.isInteger(t)),Object(i.b)(t>=this.latestFrame-this.bufferFrameCount),this.stateBuffer[t%this.bufferFrameCount]}lerpState(t,e){const r=this.getPreviousFrame(t),n=this.getNextFrame(t),a=Object(i.e)(r),o=Object(i.e)(n);if(a&&!o)return console.warn("Extrapolation not yet implemented"),!1;if(!a&&o)return console.warn("Extrapolation not yet implemented"),!1;if(a||o){const a=this.getState(r),o=this.getState(n);return a===o?(Object.assign(e,a),!0):(function(t,e,r,n){Object(i.b)(t.entities instanceof Array,"Result must be a valid SimState"),t.frame=Object(s.f)(e.frame,r.frame,n),t.entities.length=0;const a=e.entities.length,o=r.entities.length,c=Math.max(a,o);for(let s=0,c=0;s<a||c<o;){const u=e.entities[s],d=r.entities[c],p=h();s>=a||d&&u.id>d.id?(l(p,d),t.entities.push(p),c+=1):c>=o||u&&d.id>u.id?(l(p,u),t.entities.push(p),s+=1):u.id===d.id?(f(p,u,d,n),t.entities.push(p),s+=1,c+=1):Object(i.b)(!1,"This should never happen")}Object(i.b)(t.entities.length===c)}(e,a,o,Object(s.e)(r,n,t)),!0)}return console.warn("No valid snapshot for this frame"),!1}hasState(t){const e=this.stateBuffer[t%this.bufferFrameCount];return Object(i.e)(e)&&e.frame===t}getPreviousFrame(t){var e;const r=Math.max(0,this.latestFrame-this.bufferFrameCount);let n=Math.floor(t);for(;n>=r&&(null===(e=this.stateBuffer[n%this.bufferFrameCount])||void 0===e?void 0:e.frame)!==n;)n-=1;return n>=r?n:void 0}getNextFrame(t){var e;let r=Math.ceil(t);for(;r<=this.latestFrame&&(null===(e=this.stateBuffer[r%this.bufferFrameCount])||void 0===e?void 0:e.frame)!==r;)r+=1;return r<=this.latestFrame?r:void 0}}function c(t,e){a.a.writeInt(t,e.frame),a.a.writeByte(t,e.entities.length);for(let r=0;r<e.entities.length;r++){const n=e.entities[r];a.a.writeByte(t,n.id),a.a.writeByte(t,n.type),a.a.writeByte(t,n.flags),a.a.writeFloat(t,n.origin[0]),a.a.writeFloat(t,n.origin[1]),a.a.writeFloat(t,n.origin[2]),a.a.writeFloat(t,n.orientation[0]),a.a.writeFloat(t,n.orientation[1]),a.a.writeFloat(t,n.orientation[2]),a.a.writeChar(t,n.parent),a.a.writeByte(t,n.state),a.a.writeInt(t,n.stateStartFrame),a.a.writeFloat(t,n.speed)}}function u(t,e){e.frame=a.a.readInt(t);const r=a.a.readByte(t);for(let n=0;n<r;n++){const r=h();r.id=a.a.readByte(t),r.type=a.a.readByte(t),r.flags=a.a.readByte(t),r.origin[0]=a.a.readFloat(t),r.origin[1]=a.a.readFloat(t),r.origin[2]=a.a.readFloat(t),r.orientation[0]=a.a.readFloat(t),r.orientation[1]=a.a.readFloat(t),r.orientation[2]=a.a.readFloat(t),r.parent=a.a.readChar(t),r.state=a.a.readByte(t),r.stateStartFrame=a.a.readInt(t),r.speed=a.a.readFloat(t),e.entities.push(r)}}function h(){return{id:-1,type:-1,flags:0,origin:n.e.create(),orientation:n.e.fromValues(0,0,1),parent:-1,state:0,stateStartFrame:0,speed:0}}function l(t,e){return t.id=e.id,t.type=e.type,t.flags=e.flags,n.e.copy(t.origin,e.origin),n.e.copy(t.orientation,e.orientation),t.parent=e.parent,t.state=e.state,t.stateStartFrame=e.stateStartFrame,t.speed=e.speed,t}function f(t,e,r,i){t.id=e.id,t.type=e.type,n.e.lerp(t.origin,e.origin,r.origin,i),n.e.lerp(t.orientation,e.orientation,r.orientation,i),t.speed=Object(s.f)(e.speed,r.speed,i),t.flags=r.flags,t.parent=r.parent,t.state=r.state,t.stateStartFrame=r.stateStartFrame}var d;!function(t){t[t.Avatar=0]="Avatar",t[t.Weapon=1]="Weapon"}(d||(d={}));class p{constructor(){this.stream=new o,this.factories={},this.objects=[],this.entityId=0}registerFactory(t,e){this.factories[t]=e}createGameObject(t,e){const r=this.entityId++,n=Object.assign(h(),e,{id:r,type:t});return this.createImmediate(n)}deleteGameObject(t){}loadState(t){this.loadedState=t;let e=0,r=0;for(;e<this.loadedState.entities.length;){const t=this.loadedState.entities[e++];let n=this.objects[r++];for(;n.state.id<t.id;)n=this.objects[r++];Object(i.b)(n.state.id===t.id,`Object ${t.id} should already have been created`),l(n.state,t)}}addState(t){const{additions:e,removals:r}=this.stream.addState(t);for(const r of e){const e=t.entities[r];this.createImmediate(e)}for(const t of r){const e=Object(i.c)(this.objects.find(e=>e.state.id===t));this.deleteImmediate(e)}}captureState(t){const e={frame:t,entities:[]};for(const t of this.objects)e.entities.push(t.state);this.stream.addState(e)}createImmediate(t){const e=this.factories[t.type].createGameObject(t);return this.objects.push(e),e}deleteImmediate(t){this.factories[t.state.type].deleteGameObject(t),Object(i.a)(this.objects,t)}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return c}));var n=r(1),i=r(0),s=r(9);class a{constructor(t,e,r,n){this.shader=r,this.name=e,this.layout=n,this.resources=t.createResourceTable(this.layout),this.bindings={}}destroy(t){t.removeResourceTable(this.resources)}assertReady(){for(const t of Object.keys(this.layout))Object(i.c)(this.bindings[t],`Material expects a binding for ${t}`)}getUniformBuffer(t){const e=this.bindings[t];return Object(i.c)(e,`Uniform buffer "${t}" is not bound to material "${this.name}"`),e}setUniformBuffer(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.UniformBuffer,"Mismatching resource type"),this.bindings[e]=r,t.setBuffer(this.resources,s.index,r.getBufferView())}setTexture(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.Texture,"Mismatching resource type"),Object(i.b)(!Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=r,t.setTexture(this.resources,s.index,r)}setTextureArray(t,e,r){const s=Object(i.c)(this.layout[e],"Invalid resource name");Object(i.b)(s.type===n.a.Texture,"Mismatching resource type"),Object(i.b)(Object(i.e)(s.count),"Use Material.setTextureArray"),this.bindings[e]=r,t.setTextures(this.resources,s.index,r)}}class o extends s.b{constructor(t,e,r,n){super(),this.renderList=e,this.mesh=r,this.material=n,this.pipeline=t.createRenderPipeline(n.shader,e.renderFormat,r.vertexLayout,n.layout),this.vertexTable=t.createVertexTable(this.pipeline),r.vertexBuffers.forEach((e,r)=>{t.setVertexBuffer(this.vertexTable,r,e)}),this._primitive={renderPipeline:this.pipeline,resourceTable:this.material.resources,vertexTable:this.vertexTable,elementCount:this.mesh.elementCount,type:this.mesh.primitiveType,indexBuffer:this.mesh.indexBuffer,indexType:this.mesh.indexType}}get primitive(){return this.material.assertReady(),this._primitive}destroy(t){t.removeVertexTable(this.vertexTable),t.removeRenderPipeline(this.pipeline)}}class c extends o{constructor(t,e,r,n){super(t,e,r,n)}bindSkeleton(t,e){this.skeleton=e;const r={type:n.k.Texture2D,format:n.i.F32x4,usage:n.o.Dynamic,width:4,height:e.bones.length,defaultMinFilter:n.j.Nearest,defaultMagFilter:n.j.Nearest};this.boneTex=t.createTexture("BoneTex",r,this.skeleton.boneMatrices)}writeBonesToTex(t){return t.writeTextureData(this.boneTex,this.skeleton.boneMatrices),this.boneTex}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{on(t,e){return Object(n.e)(this.callbacks)||(this.callbacks={}),Object(n.e)(this.callbacks[t])||(this.callbacks[t]=[]),Object(n.b)(-1===this.callbacks[t].indexOf(e),"Attempted to add the same callback twice"),this.callbacks[t].push(e),this}once(t,e){const r=(...n)=>{e(...n),this.off(t,r)};return this.on(t,r),this}off(t,e){return Object(n.a)(Object(n.c)(this.callbacks)[t],e),this}fire(t,...e){if(!this.hasHandlers(t))return this;for(const r of this.callbacks[t])r(...e);return this}hasHandlers(t){return Object(n.e)(this.callbacks)&&Object(n.e)(this.callbacks[t])&&this.callbacks[t].length>0}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var n=r(6),i=new n.a,s=new l,a=new n.a(0,0,0),o=new n.a(1,1,1),c=new n.a,u=new n.a,h=new n.a;function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(l.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,s,a,o,c,u,h,l,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=c,g[6]=u,g[10]=h,g[14]=l,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new l).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/i.setFromMatrixColumn(t,0).length(),s=1/i.setFromMatrixColumn(t,1).length(),a=1/i.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=0,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),a=Math.sin(r),o=Math.cos(n),c=Math.sin(n),u=Math.cos(i),h=Math.sin(i);if("XYZ"===t.order){var l=s*u,f=s*h,d=a*u,p=a*h;e[0]=o*u,e[4]=-o*h,e[8]=c,e[1]=f+d*c,e[5]=l-p*c,e[9]=-a*o,e[2]=p-l*c,e[6]=d+f*c,e[10]=s*o}else if("YXZ"===t.order){var m=o*u,g=o*h,b=c*u,y=c*h;e[0]=m+y*a,e[4]=b*a-g,e[8]=s*c,e[1]=s*h,e[5]=s*u,e[9]=-a,e[2]=g*a-b,e[6]=y+m*a,e[10]=s*o}else if("ZXY"===t.order){m=o*u,g=o*h,b=c*u,y=c*h;e[0]=m-y*a,e[4]=-s*h,e[8]=b+g*a,e[1]=g+b*a,e[5]=s*u,e[9]=y-m*a,e[2]=-s*c,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){l=s*u,f=s*h,d=a*u,p=a*h;e[0]=o*u,e[4]=d*c-f,e[8]=l*c+p,e[1]=o*h,e[5]=p*c+l,e[9]=f*c-d,e[2]=-c,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){var v=s*o,x=s*c,w=a*o,_=a*c;e[0]=o*u,e[4]=_-v*h,e[8]=w*h+x,e[1]=h,e[5]=s*u,e[9]=-a*u,e[2]=-c*u,e[6]=x*h+w,e[10]=v-_*h}else if("XZY"===t.order){v=s*o,x=s*c,w=a*o,_=a*c;e[0]=o*u,e[4]=-h,e[8]=c*u,e[1]=v*h+_,e[5]=s*u,e[9]=x*h-w,e[2]=w*h-x,e[6]=a*u,e[10]=_*h+v}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(a,t,o)},lookAt:function(t,e,r){var n=this.elements;return h.subVectors(t,e),0===h.lengthSq()&&(h.z=1),h.normalize(),c.crossVectors(r,h),0===c.lengthSq()&&(1===Math.abs(r.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),c.crossVectors(r,h)),c.normalize(),u.crossVectors(h,c),n[0]=c.x,n[4]=u.x,n[8]=h.x,n[1]=c.y,n[5]=u.y,n[9]=h.y,n[2]=c.z,n[6]=u.z,n[10]=h.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],a=r[4],o=r[8],c=r[12],u=r[1],h=r[5],l=r[9],f=r[13],d=r[2],p=r[6],m=r[10],g=r[14],b=r[3],y=r[7],v=r[11],x=r[15],w=n[0],_=n[4],M=n[8],C=n[12],A=n[1],S=n[5],T=n[9],k=n[13],F=n[2],O=n[6],E=n[10],j=n[14],B=n[3],R=n[7],I=n[11],P=n[15];return i[0]=s*w+a*A+o*F+c*B,i[4]=s*_+a*S+o*O+c*R,i[8]=s*M+a*T+o*E+c*I,i[12]=s*C+a*k+o*j+c*P,i[1]=u*w+h*A+l*F+f*B,i[5]=u*_+h*S+l*O+f*R,i[9]=u*M+h*T+l*E+f*I,i[13]=u*C+h*k+l*j+f*P,i[2]=d*w+p*A+m*F+g*B,i[6]=d*_+p*S+m*O+g*R,i[10]=d*M+p*T+m*E+g*I,i[14]=d*C+p*k+m*j+g*P,i[3]=b*w+y*A+v*F+x*B,i[7]=b*_+y*S+v*O+x*R,i[11]=b*M+y*T+v*E+x*I,i[15]=b*C+y*k+v*j+x*P,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],a=t[5],o=t[9],c=t[13],u=t[2],h=t[6],l=t[10],f=t[14];return t[3]*(+i*o*h-n*c*h-i*a*l+r*c*l+n*a*f-r*o*f)+t[7]*(+e*o*f-e*c*l+i*s*l-n*s*f+n*c*u-i*o*u)+t[11]*(+e*c*h-e*a*f-i*s*h+r*s*f+i*a*u-r*c*u)+t[15]*(-n*a*u-e*o*h+e*a*l+n*s*h-r*s*l+r*o*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var r=this.elements,n=t.elements,i=n[0],s=n[1],a=n[2],o=n[3],c=n[4],u=n[5],h=n[6],l=n[7],f=n[8],d=n[9],p=n[10],m=n[11],g=n[12],b=n[13],y=n[14],v=n[15],x=d*y*l-b*p*l+b*h*m-u*y*m-d*h*v+u*p*v,w=g*p*l-f*y*l-g*h*m+c*y*m+f*h*v-c*p*v,_=f*b*l-g*d*l+g*u*m-c*b*m-f*u*v+c*d*v,M=g*d*h-f*b*h-g*u*p+c*b*p+f*u*y-c*d*y,C=i*x+s*w+a*_+o*M;if(0===C)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var A=1/C;return r[0]=x*A,r[1]=(b*p*o-d*y*o-b*a*m+s*y*m+d*a*v-s*p*v)*A,r[2]=(u*y*o-b*h*o+b*a*l-s*y*l-u*a*v+s*h*v)*A,r[3]=(d*h*o-u*p*o-d*a*l+s*p*l+u*a*m-s*h*m)*A,r[4]=w*A,r[5]=(f*y*o-g*p*o+g*a*m-i*y*m-f*a*v+i*p*v)*A,r[6]=(g*h*o-c*y*o-g*a*l+i*y*l+c*a*v-i*h*v)*A,r[7]=(c*p*o-f*h*o+f*a*l-i*p*l-c*a*m+i*h*m)*A,r[8]=_*A,r[9]=(g*d*o-f*b*o-g*s*m+i*b*m+f*s*v-i*d*v)*A,r[10]=(c*b*o-g*u*o+g*s*l-i*b*l-c*s*v+i*u*v)*A,r[11]=(f*u*o-c*d*o-f*s*l+i*d*l+c*s*m-i*u*m)*A,r[12]=M*A,r[13]=(f*b*a-g*d*a+g*s*p-i*b*p-f*s*y+i*d*y)*A,r[14]=(g*u*a-c*b*a-g*s*h+i*b*h+c*s*y-i*u*y)*A,r[15]=(c*d*a-f*u*a+f*s*h-i*d*h-c*s*p+i*u*p)*A,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,a=t.y,o=t.z,c=i*s,u=i*a;return this.set(c*s+r,c*a-n*o,c*o+n*a,0,c*a+n*o,u*a+r,u*o-n*s,0,c*o-n*a,u*o+n*s,i*o*o+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,s=e._y,a=e._z,o=e._w,c=i+i,u=s+s,h=a+a,l=i*c,f=i*u,d=i*h,p=s*u,m=s*h,g=a*h,b=o*c,y=o*u,v=o*h,x=r.x,w=r.y,_=r.z;return n[0]=(1-(p+g))*x,n[1]=(f+v)*x,n[2]=(d-y)*x,n[3]=0,n[4]=(f-v)*w,n[5]=(1-(l+g))*w,n[6]=(m+b)*w,n[7]=0,n[8]=(d+y)*_,n[9]=(m-b)*_,n[10]=(1-(l+p))*_,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,a=i.set(n[0],n[1],n[2]).length(),o=i.set(n[4],n[5],n[6]).length(),c=i.set(n[8],n[9],n[10]).length();this.determinant()<0&&(a=-a),t.x=n[12],t.y=n[13],t.z=n[14],s.copy(this);var u=1/a,h=1/o,l=1/c;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=h,s.elements[5]*=h,s.elements[6]*=h,s.elements[8]*=l,s.elements[9]*=l,s.elements[10]*=l,e.setFromRotationMatrix(s),r.x=a,r.y=o,r.z=c,this},makePerspective:function(t,e,r,n,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,o=2*i/(e-t),c=2*i/(r-n),u=(e+t)/(e-t),h=(r+n)/(r-n),l=-(s+i)/(s-i),f=-2*s*i/(s-i);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=l,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,s){var a=this.elements,o=1/(e-t),c=1/(r-n),u=1/(s-i),h=(e+t)*o,l=(r+n)*c,f=(s+i)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-l,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(19);function i(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}Object.assign(i,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,s,a){var o=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3],l=i[s+0],f=i[s+1],d=i[s+2],p=i[s+3];if(h!==p||o!==l||c!==f||u!==d){var m=1-a,g=o*l+c*f+u*d+h*p,b=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var v=Math.sqrt(y),x=Math.atan2(v,g*b);m=Math.sin(m*x)/v,a=Math.sin(a*x)/v}var w=a*b;if(o=o*m+l*w,c=c*m+f*w,u=u*m+d*w,h=h*m+p*w,m===1-a){var _=1/Math.sqrt(o*o+c*c+u*u+h*h);o*=_,c*=_,u*=_,h*=_}}t[e]=o,t[e+1]=c,t[e+2]=u,t[e+3]=h}}),Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(i.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,s=t.order,a=Math.cos,o=Math.sin,c=a(r/2),u=a(n/2),h=a(i/2),l=o(r/2),f=o(n/2),d=o(i/2);return"XYZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"YXZ"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"ZXY"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h-l*f*d):"ZYX"===s?(this._x=l*u*h-c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h+l*f*d):"YZX"===s?(this._x=l*u*h+c*f*d,this._y=c*f*h+l*u*d,this._z=c*u*d-l*f*h,this._w=c*u*h-l*f*d):"XZY"===s&&(this._x=l*u*h-c*f*d,this._y=c*f*h-l*u*d,this._z=c*u*d+l*f*h,this._w=c*u*h+l*f*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],s=r[8],a=r[1],o=r[5],c=r[9],u=r[2],h=r[6],l=r[10],f=n+o+l;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(h-c)*e,this._y=(s-u)*e,this._z=(a-i)*e):n>o&&n>l?(e=2*Math.sqrt(1+n-o-l),this._w=(h-c)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(s+u)/e):o>l?(e=2*Math.sqrt(1+o-n-l),this._w=(s-u)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(c+h)/e):(e=2*Math.sqrt(1+l-n-o),this._w=(a-i)/e,this._x=(s+u)/e,this._y=(c+h)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(n.a.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,s=t._w,a=e._x,o=e._y,c=e._z,u=e._w;return this._x=r*u+s*a+n*c-i*o,this._y=n*u+s*o+i*a-r*c,this._z=i*u+s*c+r*o-n*a,this._w=s*u-r*a-n*o-i*c,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,s=this._w,a=s*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=r,this._y=n,this._z=i,this;var o=1-a*a;if(o<=Number.EPSILON){var c=1-e;return this._w=c*s+e*this._w,this._x=c*r+e*this._x,this._y=c*n+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(o),h=Math.atan2(u,a),l=Math.sin((1-e)*h)/u,f=Math.sin(e*h)/u;return this._w=s*l+this._w*f,this._x=r*l+this._x*f,this._y=n*l+this._y*f,this._z=i*l+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return a})),r.d(e,"b",(function(){return o}));var n=r(0),i=r(3);class s{static serialize(t,e){const r=Math.atan2(e.headingZ,e.headingX);i.a.writeAngle16(t,r);let n=0;return n|=3&Math.sign(e.verticalAxis)+1<<0,n|=12&Math.sign(e.horizontalAxis)+1<<2,i.a.writeByte(t,n),i.a.writeByte(t,e.actions),4}static deserialize(t,e){const r=i.a.readAngle16(e);t.headingX=Math.cos(r),t.headingZ=Math.sin(r);let n=i.a.readByte(e);return t.verticalAxis=((3&n)>>0)-1,t.horizontalAxis=((12&n)>>2)-1,t.actions=i.a.readByte(e),4}}const a={frame:-1,headingX:0,headingZ:1,verticalAxis:0,horizontalAxis:0,actions:0};new TextEncoder,new TextDecoder;class o{constructor(){this.buffer=[],this.bufferSize=64,this.lastFrame=-1}setUserCommand(t){Object(n.b)(Number.isInteger(t.frame));const e=this.buffer[t.frame%this.bufferSize];return(!Object(n.e)(e)||e.frame!==t.frame)&&(this.buffer[t.frame%this.bufferSize]=t,this.lastFrame=t.frame,!0)}getUserCommand(t=this.lastFrame){if(Object(n.b)(Number.isInteger(t)),-1===t)return Object.assign(Object.assign({},a),{frame:t});const e=this.buffer[t%this.bufferSize];return Object(n.e)(e)&&e.frame===t?e:void 0}}},function(t,e,r){"use strict";r.d(e,"f",(function(){return f})),r.d(e,"g",(function(){return d})),r.d(e,"e",(function(){return n.b})),r.d(e,"d",(function(){return n.a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return R}));var n=r(4);function i(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function s(t,e,r,n){i.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function a(t,e,r,n){i.call(this,t,e,r,n)}function o(t,e,r,n){i.call(this,t,e,r,n)}Object.assign(i.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var s;r:{n:if(!(t<n)){for(var a=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,t<(n=e[++r]))break e}s=e.length;break r}if(t>=i)break t;var o=e[1];t<o&&(r=2,i=o);for(a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,t>=(i=e[--r-1]))break e}s=r,r=0}for(;r<s;){var c=r+s>>>1;t<e[c]?s=c:r=c+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,s=0;s!==n;++s)e[s]=r[i+s];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(i.prototype,{beforeStart_:i.prototype.copySampleValue_,afterEnd_:i.prototype.copySampleValue_}),s.prototype=Object.assign(Object.create(i.prototype),{constructor:s,DefaultSettings_:{endingStart:n.h,endingEnd:n.h},intervalChanged_:function(t,e,r){var i=this.parameterPositions,s=t-2,a=t+1,o=i[s],c=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case n.i:s=t,o=2*e-r;break;case n.g:o=e+i[s=i.length-2]-i[s+1];break;default:s=t,o=r}if(void 0===c)switch(this.getSettings_().endingEnd){case n.i:a=t,c=2*r-e;break;case n.g:a=1,c=r+i[1]-i[0];break;default:a=t-1,c=e}var u=.5*(r-e),h=this.valueSize;this._weightPrev=u/(e-o),this._weightNext=u/(c-r),this._offsetPrev=s*h,this._offsetNext=a*h},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,c=o-a,u=this._offsetPrev,h=this._offsetNext,l=this._weightPrev,f=this._weightNext,d=(r-e)/(n-e),p=d*d,m=p*d,g=-l*m+2*l*p-l*d,b=(1+l)*m+(-1.5-2*l)*p+(-.5+l)*d+1,y=(-1-f)*m+(1.5+f)*p+.5*d,v=f*m-f*p,x=0;x!==a;++x)i[x]=g*s[u+x]+b*s[c+x]+y*s[o+x]+v*s[h+x];return i}}),a.prototype=Object.assign(Object.create(i.prototype),{constructor:a,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,c=o-a,u=(r-e)/(n-e),h=1-u,l=0;l!==a;++l)i[l]=s[c+l]*h+s[o+l]*u;return i}}),o.prototype=Object.assign(Object.create(i.prototype),{constructor:o,interpolate_:function(t){return this.copySampleValue_(t-1)}});var c={arraySlice:function(t,e,r){return c.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),s=0,a=0;a!==n;++s)for(var o=r[s]*e,c=0;c!==e;++c)i[a++]=t[o+c];return i},flattenJSON:function(t,e,r,n){for(var i=1,s=t[0];void 0!==s&&void 0===s[n];)s=t[i++];if(void 0!==s){var a=s[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=s[n])&&(e.push(s.time),r.push.apply(r,a)),s=t[i++]}while(void 0!==s);else if(void 0!==a.toArray)do{void 0!==(a=s[n])&&(e.push(s.time),a.toArray(r,r.length)),s=t[i++]}while(void 0!==s);else do{void 0!==(a=s[n])&&(e.push(s.time),r.push(a)),s=t[i++]}while(void 0!==s)}},subclip:function(t,e,r,n,i){i=i||30;var s=t.clone();s.name=e;for(var a=[],o=0;o<s.tracks.length;++o){for(var u=s.tracks[o],h=u.getValueSize(),l=[],f=[],d=0;d<u.times.length;++d){var p=u.times[d]*i;if(!(p<r||p>=n)){l.push(u.times[d]);for(var m=0;m<h;++m)f.push(u.values[d*h+m])}}0!==l.length&&(u.times=c.convertArray(l,u.times.constructor),u.values=c.convertArray(f,u.values.constructor),a.push(u))}s.tracks=a;var g=1/0;for(o=0;o<s.tracks.length;++o)g>s.tracks[o].times[0]&&(g=s.tracks[o].times[0]);for(o=0;o<s.tracks.length;++o)s.tracks[o].shift(-1*g);return s.resetDuration(),s}};function u(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=c.convertArray(e,this.TimeBufferType),this.values=c.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}Object.assign(u,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:c.convertArray(t.times,Array),values:c.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(u.prototype,{constructor:u,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:n.b,InterpolantFactoryMethodDiscrete:function(t){return new o(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new a(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new s(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case n.a:e=this.InterpolantFactoryMethodDiscrete;break;case n.b:e=this.InterpolantFactoryMethodLinear;break;case n.c:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return n.a;case this.InterpolantFactoryMethodLinear:return n.b;case this.InterpolantFactoryMethodSmooth:return n.c}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,s=n-1;i!==n&&r[i]<t;)++i;for(;-1!==s&&r[s]>e;)--s;if(++s,0!==i||s!==n){i>=s&&(i=(s=Math.max(s,1))-1);var a=this.getValueSize();this.times=c.arraySlice(r,i,s),this.values=c.arraySlice(this.values,i*a,s*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,a=0;a!==i;a++){var o=r[a];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(null!==s&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),t=!1;break}s=o}if(void 0!==n&&c.isTypedArray(n)){a=0;for(var u=n.length;a!==u;++a){var h=n[a];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,h),t=!1;break}}}return t},optimize:function(){for(var t=c.arraySlice(this.times),e=c.arraySlice(this.values),r=this.getValueSize(),i=this.getInterpolation()===n.c,s=1,a=t.length-1,o=1;o<a;++o){var u=!1,h=t[o];if(h!==t[o+1]&&(1!==o||h!==h[0]))if(i)u=!0;else for(var l=o*r,f=l-r,d=l+r,p=0;p!==r;++p){var m=e[l+p];if(m!==e[f+p]||m!==e[d+p]){u=!0;break}}if(u){if(o!==s){t[s]=t[o];var g=o*r,b=s*r;for(p=0;p!==r;++p)e[b+p]=e[g+p]}++s}}if(a>0){t[s]=t[a];for(g=a*r,b=s*r,p=0;p!==r;++p)e[b+p]=e[g+p];++s}return s!==t.length?(this.times=c.arraySlice(t,0,s),this.values=c.arraySlice(e,0,s*r)):(this.times=t,this.values=e),this},clone:function(){var t=c.arraySlice(this.times,0),e=c.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}});var h=r(14);function l(t,e,r,n){i.call(this,t,e,r,n)}function f(t,e,r,n){u.call(this,t,e,r,n)}function d(t,e,r,n){u.call(this,t,e,r,n)}function p(t,e,r){u.call(this,t,e,r)}function m(t,e,r,n){u.call(this,t,e,r,n)}function g(t,e,r,n){u.call(this,t,e,r,n)}function b(t,e,r,n){u.call(this,t,e,r,n)}l.prototype=Object.assign(Object.create(i.prototype),{constructor:l,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,c=(r-e)/(n-e),u=o+a;o!==u;o+=4)h.a.slerpFlat(i,0,s,o-a,s,o,c);return i}}),f.prototype=Object.assign(Object.create(u.prototype),{constructor:f,ValueTypeName:"quaternion",DefaultInterpolation:n.b,InterpolantFactoryMethodLinear:function(t){return new l(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),d.prototype=Object.assign(Object.create(u.prototype),{constructor:d,ValueTypeName:"vector"}),p.prototype=Object.assign(Object.create(u.prototype),{constructor:p,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:n.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),m.prototype=Object.assign(Object.create(u.prototype),{constructor:m,ValueTypeName:"color"}),g.prototype=Object.assign(Object.create(u.prototype),{constructor:g,ValueTypeName:"number"}),b.prototype=Object.assign(Object.create(u.prototype),{constructor:b,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:n.a,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});var y=r(19);function v(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=y.a.generateUUID(),this.duration<0&&this.resetDuration()}function x(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return g;case"vector":case"vector2":case"vector3":case"vector4":return d;case"color":return m;case"quaternion":return f;case"bool":case"boolean":return p;case"string":return b}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],n=[];c.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function w(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var i=e.tracks,s=i.length,a=new Array(s),o={endingStart:n.h,endingEnd:n.h},c=0;c!==s;++c){var u=i[c].createInterpolant(null);a[c]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=n.f,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(v,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,s=r.length;i!==s;++i)e.push(x(r[i]).scale(n));return new v(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,s=r.length;i!==s;++i)e.push(u.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,s=[],a=0;a<i;a++){var o=[],u=[];o.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var h=c.getKeyframeOrder(o);o=c.sortedArray(o,1,h),u=c.sortedArray(u,1,h),n||0!==o[0]||(o.push(i),u.push(u[0])),s.push(new g(".morphTargetInfluences["+e[a].name+"]",o,u).scale(1/r))}return new v(t,-1,s)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===e)return r[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,s=0,a=t.length;s<a;s++){var o=t[s],c=o.name.match(i);if(c&&c.length>1){var u=n[l=c[1]];u||(n[l]=u=[]),u.push(o)}}var h=[];for(var l in n)h.push(v.CreateFromMorphTargetSequence(l,n[l],e,r));return h},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var s=[],a=[];c.flattenJSON(r,s,a,n),0!==s.length&&i.push(new t(e,s,a))}},n=[],i=t.name||"default",s=t.length||-1,a=t.fps||30,o=t.hierarchy||[],u=0;u<o.length;u++){var h=o[u].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var l={},p=0;p<h.length;p++)if(h[p].morphTargets)for(var m=0;m<h[p].morphTargets.length;m++)l[h[p].morphTargets[m]]=-1;for(var b in l){var y=[],x=[];for(m=0;m!==h[p].morphTargets.length;++m){var w=h[p];y.push(w.time),x.push(w.morphTarget===b?1:0)}n.push(new g(".morphTargetInfluence["+b+"]",y,x))}s=l.length*(a||1)}else{var _=".bones["+e[u].name+"]";r(d,_+".position",h,"pos",n),r(f,_+".quaternion",h,"rot",n),r(d,_+".scale",h,"scl",n)}}return 0===n.length?null:new v(i,s,n)}}),Object.assign(v.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new v(this.name,this.duration,t)}}),Object.assign(w.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,s=i/n,a=n/i;t.warp(1,s,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,s=this._timeScaleInterpolant,a=this.timeScale;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);var o=s.parameterPositions,c=s.sampleValues;return o[0]=i,o[1]=i+r,c[0]=t/a,c[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var s=(t-i)*r;if(s<0||0===r)return;this._startTime=null,e=r*s}e*=this._updateTimeScale(t);var a=this._updateTime(e),o=this._updateWeight(t);if(o>0)for(var c=this._interpolants,u=this._propertyBindings,h=0,l=c.length;h!==l;++h)c[h].evaluate(a),u[h].accumulate(n,o)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,i=this.loop,s=this._loopCount,a=i===n.e;if(0===t)return-1===s?e:a&&1==(1&s)?r-e:e;if(i===n.d){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=r||e<0){var o=Math.floor(e/r);e-=r*o,s+=Math.abs(o);var c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===c){var u=t<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=e;if(a&&1==(1&s))return r-e}return e},_setEndings:function(t,e,r){var i=this._interpolantSettings;r?(i.endingStart=n.i,i.endingEnd=n.i):(i.endingStart=t?this.zeroSlopeAtStart?n.i:n.h:n.g,i.endingEnd=e?this.zeroSlopeAtEnd?n.i:n.h:n.g)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);var a=s.parameterPositions,o=s.sampleValues;return a[0]=i,o[0]=e,a[1]=i+t,o[1]=r,this}});var _=r(35),M=new RegExp("[\\[\\]\\.:\\/]","g"),C="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",A=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),S=/(WCOD+)?/.source.replace("WCOD",C),T=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),k=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),F=new RegExp("^"+A+S+T+k+"$"),O=["material","materials","bones"];function E(t,e,r){var n=r||j.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function j(t,e,r){this.path=e,this.parsedPath=r||j.parseTrackName(e),this.node=j.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function B(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function R(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Object.assign(E.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(j,{Composite:E,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new j.Composite(t,e,r):new j(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(M,"")},parseTrackName:function(t){var e=F.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==O.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var s=n(i.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(j.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=j.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var s=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===s){s=a;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var o=t[n];if(void 0!==o){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(u=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(j.prototype,{_getValue_unbound:j.prototype.getValue,_setValue_unbound:j.prototype.setValue}),Object.assign(B.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,s=this.cumulativeWeight;if(0===s){for(var a=0;a!==n;++a)r[i+a]=r[a];s=e}else{var o=e/(s+=e);this._mixBufferRegion(r,i,0,o,n)}this.cumulativeWeight=s},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,s=this.binding;if(this.cumulativeWeight=0,i<1){var a=3*e;this._mixBufferRegion(r,n,a,1-i,e)}for(var o=e,c=e+e;o!==c;++o)if(r[o]!==r[o+e]){s.setValue(r,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,n=3*r;t.getValue(e,n);for(var i=r,s=n;i!==s;++i)e[i]=e[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,r,n,i){if(n>=.5)for(var s=0;s!==i;++s)t[e+s]=t[r+s]},_slerp:function(t,e,r,n){h.a.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var s=1-n,a=0;a!==i;++a){var o=e+a;t[o]=t[o]*s+t[r+a]*n}}}),R.prototype=Object.assign(Object.create(_.a.prototype),{constructor:R,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,s=t._propertyBindings,a=t._interpolants,o=r.uuid,c=this._bindingsByRootAndName,u=c[o];void 0===u&&(u={},c[o]=u);for(var h=0;h!==i;++h){var l=n[h],f=l.name,d=u[f];if(void 0!==d)s[h]=d;else{if(void 0!==(d=s[h])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,o,f));continue}var p=e&&e._propertyBindings[h].binding.parsedPath;++(d=new B(j.create(r,f,p),l.ValueTypeName,l.getValueSize())).referenceCount,this._addInactiveBinding(d,o,f),s[h]=d}a[h].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,s=0,a=i.length;s!==a;++s){var o=i[s];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,s=i[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=s;else{var a=s.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,s=this._actionsByClip,a=s[i],o=a.knownActions,c=o[o.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,o[u]=c,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],s=this._bindings;void 0===i&&(i={},n[e]=i),i[r]=t,t._cacheIndex=s.length,s.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],c=t._cacheIndex;o._cacheIndex=c,e[c]=o,e.pop(),delete a[i],0===Object.keys(a).length&&delete s[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new a(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?v.findByName(r,t):t,s=null!==i?i.uuid:t,a=this._actionsByClip[s],o=null;if(void 0!==a){var c=a.actionByRoot[n];if(void 0!==c)return c;o=a.knownActions[0],null===i&&(i=o._clip)}if(null===i)return null;var u=new w(this,i,e);return this._bindAction(u,o),this._addInactiveAction(u,s,n),u},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?v.findByName(r,t):t,s=i?i.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),s=this._accuIndex^=1,a=0;a!==r;++a){e[a]._update(n,t,i,s)}var o=this._bindings,c=this._nActiveBindings;for(a=0;a!==c;++a)o[a].apply(s);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var s=i.knownActions,a=0,o=s.length;a!==o;++a){var c=s[a];this._deactivateAction(c);var u=c._cacheIndex,h=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,e[u]=h,e.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var s=this._bindingsByRootAndName[e];if(void 0!==s)for(var a in s){var o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}})},function(t,e,r){"use strict";r.d(e,"c",(function(){return h})),r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return y}));var n,i=r(23),s=r(12),a=r(0),o=r(3);!function(t){t.Receive="rec",t.Acknowledge="ack"}(n||(n={}));class c extends s.a{constructor(){super(...arguments),this.remoteSequence=-1,this.localSequence=0,this.localHistory=[],this.remoteHistory=[],this.packetBuffer=new o.a(new Uint8Array(1032))}get isOpen(){return this.socket.isOpen}initialize(t){this.socket=t,this.socket.on(i.a.Message,t=>this.receive(t.data));const e={sequence:-1,ack:-1,ackBitfield:0},r={tag:0,size:0,sendTime:-1,rcvdTime:-1};for(let t=0;t<512;t++)this.localHistory[t]=Object.assign(Object.assign({},r),{header:Object.assign({},e)}),this.remoteHistory[t]=Object.assign(Object.assign({},r),{header:Object.assign({},e)})}close(){this.socket.close()}computeStats(t){const e=performance.now();let r=0,n=0,i=0,s=0,o=0,c=0,u=1/0,h=1/0;for(let t=0;t<Math.min(this.localSequence,512);t++){const o=this.localSequence-t,h=this.localHistory[o%512];h.header.sequence===o&&(e-h.sendTime>1e3&&(Object(a.e)(h.ackTime)?r+=1:n+=1),Object(a.e)(h.ackTime)&&(i+=h.ackTime-h.sendTime,s+=1),c+=h.size,u=Math.min(u,h.sendTime))}for(let t=0;t<Math.min(this.remoteSequence,512);t++){const e=this.remoteSequence-t,r=this.remoteHistory[e%512];r.header.sequence!==e||(o+=r.size,h=Math.min(h,r.rcvdTime))}const l=n+r>0?n/(n+r)*100:0,f=s>0?i/s:0,d=c/(e-u)*8,p=o/(e-h)*8;return t.onNetChannelSample(l,f,d,p),t}allocatePacket(){return this.packetBuffer.clear(),o.a.skip(this.packetBuffer,8),this.packetBuffer}send(t,e){Object(a.b)(t===this.packetBuffer,"Pass the same buffer from allocatePacket()");const r=this.localHistory[this.localSequence%512];r.header.sequence=this.localSequence,r.header.ack=this.remoteSequence,r.header.ackBitfield=this.writeAckBitfield(this.remoteHistory),r.tag=Object(a.d)(e,this.localSequence),r.sendTime=performance.now(),r.ackTime=void 0,r.size=this.packetBuffer.offset,this.packetBuffer.dataView.setUint16(0,r.header.sequence,!0),this.packetBuffer.dataView.setUint16(2,r.header.ack,!0),this.packetBuffer.dataView.setUint32(4,r.header.ackBitfield,!0);const n=this.packetBuffer.finish();this.socket.send(n),this.localSequence=u(this.localSequence+1)}receive(t){const e=new o.a(new Uint8Array(t)),r=e.dataView.getUint16(0,!0);if(i=r,s=this.remoteSequence,i>s&&i-s<=32768||i<s&&s-i>32768){this.remoteSequence=r;const i=this.remoteHistory[r%512];i.header.sequence=e.dataView.getUint16(0,!0),i.header.ack=e.dataView.getUint16(2,!0),i.header.ackBitfield=e.dataView.getUint32(4,!0),i.size=t.byteLength,i.rcvdTime=performance.now();const s=i.header.ackBitfield;let c;for(let t=0;t<32;t++)if(s&1<<t){const e=u(i.header.ack-t),r=this.localHistory[e%512];if(r.header.sequence===e&&!Object(a.e)(r.ackTime)){const e=this.acknowledge(r);0===t&&(c=e)}}o.a.skip(e,8),this.fire(n.Receive,e,c,i.rcvdTime)}else console.debug("NetChannel: Ignoring stale packet with sequence number",r);var i,s}acknowledge(t){t.ackTime=performance.now();const e={tag:t.tag,ackTime:t.ackTime,sentTime:t.sendTime,rttTime:t.ackTime-t.sendTime};return this.fire(n.Acknowledge,e),e}writeAckBitfield(t){let e=0;for(const r of t)if(-1!==r.header.sequence){const t=u(this.remoteSequence-r.header.sequence);t<32&&(e|=1<<t)}return e}}function u(t){return(t%65536+65536)%65536}var h,l,f,d=r(15),p=r(18),m=r(5),g=r(10);!function(t){t[t.Free=0]="Free",t[t.Disconnected=1]="Disconnected",t[t.Connected=2]="Connected",t[t.Active=3]="Active",t[t.Background=4]="Background"}(h||(h={})),function(t){t.Connected="con",t.Disconnected="dis",t.Activated="act",t.ServerTimeAdjust="stime",t.ReceiveServerFrame="rsf"}(l||(l={})),function(t){t[t.ServerFrame=0]="ServerFrame",t[t.ClientFrame=1]="ClientFrame",t[t.VisChange=2]="VisChange",t[t.ConnectInfo=3]="ConnectInfo",t[t._Count=4]="_Count"}(f||(f={}));Object(a.b)(8>=f._Count,"Don't forget to update the bitmask!");class b{constructor(){this.buffer=[],this.sendParity=0,this.recvParity=0}getMessageForTransmission(t){if(!(this.buffer.length<=0))return Object(a.e)(this.sendTag)||(this.sendTag=t),this.buffer[0]}ack(t){Object(a.e)(this.sendTag)&&Math.abs(t)>=this.sendTag&&(this.buffer.shift(),this.sendTag=void 0)}send(t){t[0]|=(1&this.sendParity)<<3,this.sendParity^=1,this.buffer.push(t)}receive(t){const e=(o.a.peekByte(t)>>3&1)!=this.recvParity;return e||(this.recvParity^=1),e}}class y extends s.a{constructor(t){super(),this.clock=t,this.state=h.Free,this.lastRequestedFrame=-1,this.lastReceivedFrame=-1,this.lastTransmittedFrame=-1,this.lastAcknowledgedFrame=-1,this.lastReceivedTime=-1,this.stats=new p.b,this.userCommands=new d.b,this.reliable=new b}get ping(){return this.stats.minMaxAve[p.a.Ping][2]}initialize(t){Object(a.b)(this.state===h.Free),console.debug(`NetClient: ${this.id} is attempting to connect`),t.on(i.a.Open,()=>{console.debug(`NetClient: ${this.id} connected`),this.state=h.Connected,this.fire(l.Connected)}),t.on(i.a.Close,()=>{console.debug(`NetClient: ${this.id} disconnected`),this.state=h.Disconnected,this.fire(l.Disconnected)}),this.channel=new c,this.channel.on(n.Receive,this.onMessage.bind(this)),this.channel.on(n.Acknowledge,this.onAck.bind(this)),this.channel.initialize(t),this.stats.initialize()}async connect(t){const e=new i.b;await e.connect(t),this.id=e.clientId,this.initialize(e)}accept(t){this.id=t.peerId,this.initialize(t)}close(){this.state=h.Disconnected,this.channel.close()}setNetGraphPanel(t){this.graphPanel=t}setSimStream(t){this.simStream=t}transmitReliable(t){const e=-(this.lastTransmittedFrame+1+t),r=this.reliable.getMessageForTransmission(e);if(!r)return!0;console.debug("Transmitting reliable message");const n=this.channel.allocatePacket();return n.write(r),this.channel.send(n,e),!1}transmitClientFrame(t,e){Object(a.b)(t===e.frame),this.userCommands.setUserCommand(e);const r=this.channel.allocatePacket(),n=this.reliable.getMessageForTransmission(t);n&&r.write(n),this.sendClientFrame(r,t,e),this.channel.send(r,t),this.lastTransmittedFrame=t,this.channel.computeStats(this.stats)}sendClientFrame(t,e,r){let n=f.ClientFrame,i=0;const s=o.a.writeChar(t,n);o.a.writeInt(t,e);const c=Math.max(this.lastAcknowledgedFrame,e-5,0);for(let r=e;r>=c;r--){const e=this.userCommands.getUserCommand(r);if(!Object(a.e)(e))break;Object(a.b)(e.frame===r),i+=1,d.a.serialize(t,e)}n|=i<<4,t.data[s]=n}receiveClientFrame(t,e){const r=o.a.readByte(t)>>4,n=o.a.readInt(t);for(let e=0;e<r;e++){const r={};if(d.a.deserialize(r,t),r.frame=n-e,this.userCommands.setUserCommand(r)&&this.graphPanel){const t=0===e?p.d.Received:p.d.Filled,n=r.frame<=this.lastRequestedFrame?p.d.Late:t;this.graphPanel.setPacketStatus(r.frame,n)}}this.lastReceivedFrame=n,this.lastReceivedTime=e}transmitServerFrame(t){const e=this.simStream.getState(t),r=this.lastReceivedFrame-this.lastRequestedFrame,n=this.channel.allocatePacket(),i=this.reliable.getMessageForTransmission(t);i&&n.write(i);let s=f.ServerFrame;s|=(15&Object(m.c)(r,-8,7))<<4,o.a.writeByte(n,s);const a=this.lastReceivedTime>0?performance.now()-this.lastReceivedTime:0,c=Object(m.c)(Math.round(a/this.clock.simDt*255),0,255);o.a.writeByte(n,c);const u=this.clock.getCurrentServerTime()-this.clock.serverTime,h=this.clock.serverTime-this.clock.simDt*t;o.a.writeByte(n,Object(m.c)(Math.round(h/this.clock.simDt*255),0,255)),o.a.writeByte(n,Object(m.c)(Math.round(u/this.clock.simDt*255),0,255)),Object(g.f)(n,e),this.channel.send(n,t),this.lastTransmittedFrame=t,this.channel.computeStats(this.stats)}receiveServerFrame(t,e){const r=o.a.readByte(t)>>4,n=r>>3?4294967280|r:r,i=o.a.readByte(t),s=i/255*this.clock.simDt,a=e&&i>0?e.rttTime-s:void 0,c=o.a.readByte(t)/255*this.clock.simDt,u=o.a.readByte(t)/255*this.clock.simDt,h={frame:-1,entities:[]};if(Object(g.e)(t,h),this.lastReceivedFrame=h.frame,a&&(!this.fastestAck||e.rttTime<this.fastestAck.rttTime)){this.fastestAck=e;const t=h.frame*this.clock.simDt+c+u+.5*a;this.fire(l.ServerTimeAdjust,t)}if(this.stats.onReceiveFrame(a,u),this.graphPanel){for(let t=this.lastRequestedFrame+1;t<h.frame;t++)this.simStream.hasState(t)||this.graphPanel.setPacketStatus(t,p.d.Filled);const t=h.frame<=this.lastRequestedFrame?p.d.Late:p.d.Received;this.graphPanel.setPacketStatus(h.frame,t)}this.fire(l.ReceiveServerFrame,n,h)}transmitConnectionInfo(t){let e=0;Object(a.b)(t<8),e|=t<<4,e|=7&f.ConnectInfo;const r=new Uint8Array([e]);this.reliable.send(r)}receiveConnectionInfo(t){this.reliable.receive(t);this.clientIndex=o.a.readByte(t)>>4}transmitVisibilityChange(t){let e=0;t&&(e|=240),e|=7&f.VisChange;const r=new Uint8Array([e]);this.reliable.send(r)}receiveVisibilityChange(t){const e=this.reliable.receive(t),r=(-8&o.a.readByte(t))>0;e||(this.state=r?h.Active:h.Background,console.log(`[Client ${this.id}] Received new visibility status: ${r?"visible":"hidden"}`))}getSimState(t,e){return this.lastRequestedFrame=Math.ceil(t),this.simStream.lerpState(t,e)}getUserCommand(t){this.lastRequestedFrame=t;let e=this.userCommands.getUserCommand(t);return this.state===h.Background?d.c:(Object(a.e)(e)||(console.warn(`[Client ${this.id}] Missing input for frame ${t}`),e=this.userCommands.getUserCommand()),Object(a.c)(e))}onAck(t){if(t.tag>0){const e=t.tag;e>this.lastAcknowledgedFrame&&(this.lastAcknowledgedFrame=e)}this.reliable.ack(t.tag)}onMessage(t,e,r){for(;t.offset<t.data.byteLength;){let n=!1;switch(7&o.a.peekByte(t)){case f.ServerFrame:this.receiveServerFrame(t,e);break;case f.ClientFrame:this.receiveClientFrame(t,r);break;case f.VisChange:this.receiveVisibilityChange(t);break;case f.ConnectInfo:this.receiveConnectionInfo(t);break;default:console.warn("Received unknown message. Ignoring."),n=!0}if(n)break}this.state===h.Connected&&(Object(a.c)(this.clientIndex),this.state=h.Active,this.fire(l.Activated))}}},function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return c}));var n,i,s=r(0);!function(t){t[t.Missing=0]="Missing",t[t.Received=1]="Received",t[t.Filled=2]="Filled",t[t.Late=3]="Late"}(n||(n={}));class a{constructor(){this.enabled=!1;const t=document.createElement("div");t.style.cssText="opacity:0.9;z-index:10000;pointer-events:none;display:none",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}removePanel(t){this.dom.removeChild(t.dom)}addPanel(t){const e=Math.round(window.devicePixelRatio||1),r=3*e,i=15*e,a=3*e,o=2*e,c=64*(10*e),u=30*e,h=2*r+c,l=48*e,f="#222",d=document.createElement("canvas");d.height=l,d.width=h,d.style.cssText=`height:${Math.round(l/e)}px;width:${Math.round(h/e)}px`;const p=Object(s.c)(d.getContext("2d"));p.font="bold "+9*e+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=f,p.fillRect(0,0,h,l),p.fillStyle="#EEE",p.fillText(t,a,o),this.dom.appendChild(d);const m=this,g=new Array(64).fill(n.Missing);let b=0;return{dom:d,setPacketStatus(t,e){t>b-64&&t<b&&(g[t%64]=e)},update(t,e,l,d){if(!m.enabled)return;p.fillStyle=f,p.fillRect(r,i,c,u);const y=Math.floor(e/16)-32,v=y+64-1;let x=y;for(;x<=v;){const t=16*x,s=Math.round(((t-e)/1024+.5)*c),a=r+s;if(x+=1,x>b&&(g[x%64]=n.Missing),s>0&&s<c){switch(p.fillStyle="grey",p.fillRect(a-1,i,2,u),g[x%64]){case n.Missing:continue;case n.Received:p.fillStyle="green";break;case n.Filled:p.fillStyle="yellow";break;case n.Late:p.fillStyle="purple";break;default:p.fillStyle="red"}const t=4,e=Math.min(t,a-r);p.fillRect(a-e,i+.25*u,e+t,.5*u)}}p.fillStyle="red";const w=r+.5*c;p.fillRect(w,i,4,u),p.fillStyle="yellow";const _=r+((d-e)/1024+.5)*c;p.fillRect(_,i,4,u),p.fillStyle="purple";const M=r+((l-e)/1024+.5)*c;if(p.fillRect(M,i,4,u),b=v,Object(s.e)(t)){const e=t.toFixed(1).padStart(5);p.fillStyle=f,p.fillRect(a+.5*h,o,.5*h,i-o),p.fillStyle="#EEE",p.textAlign="right",p.fillText(`Ping: ${e}`,h-a,o)}}}}}!function(t){t[t.Ping=0]="Ping",t[t.Rtt=1]="Rtt",t[t.Vrtn=2]="Vrtn",t[t.Loss=3]="Loss",t[t.Dur=4]="Dur",t[t.Delay=5]="Delay",t[t.Ahead=6]="Ahead",t[t.Down=7]="Down",t[t.Up=8]="Up",t[t._Count=9]="_Count"}(i||(i={}));const o={[i.Ping]:{name:"Ping",unit:"ms",color:"aqua"},[i.Rtt]:{name:"RTT",unit:"ms",color:"cornflowerblue"},[i.Vrtn]:{name:"Net Vrtn",unit:"ms",color:"white"},[i.Dur]:{name:"Srv Tick",unit:"ms",color:"mediumpurple"},[i.Loss]:{name:"Pkt Loss",unit:"%",color:"darkorange"},[i.Down]:{name:"Down",unit:"Kbps",color:"greenyellow"},[i.Up]:{name:"Up",unit:"Kbps",color:"hotpink"}};class c{constructor(){this.minMaxAve=[],this.history=[],this.window=187.5,this.domMinMaxAve=[],this.enabled=!1;for(let t=0;t<i._Count;t++)this.minMaxAve[t]=[],this.history[t]=[],this.domMinMaxAve[t]=[];const t=document.createElement("div");t.style.cssText="\n            display:none;\n            font-family: Monaco, monospace;\n            font-size: 9pt;\n            background:rgba(50,50,50,0.8);\n            opacity:0.9;\n            z-index:10000;\n            pointer-events:none;\n            color:white",this.dom=t}setEnabled(t){this.enabled=t,this.dom.style.display=t?"inline-block":"none"}initialize(){const t=document.createElement("table");t.id="NetStats",t.style.tableLayout="fixed",t.style.borderSpacing="9pt";const e=document.styleSheets[0];e.insertRule("#NetStats>tr>:nth-child(2) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(4) { opacity: 0.7; }"),e.insertRule("#NetStats>tr>:nth-child(5) { opacity: 0.7; }");let r=document.createElement("tr");r.appendChild(document.createElement("th")),r.appendChild(document.createElement("th")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   avg   ")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   min   ")),r.appendChild(document.createElement("th")).appendChild(document.createTextNode("   max   ")),t.appendChild(r);for(const e in o){const r=Number.parseInt(e),n=Object(s.c)(o[r]);let i=document.createElement("tr");i.style.color=n.color,i.appendChild(document.createElement("td")).innerText=n.name,i.appendChild(document.createElement("td")).innerText=n.unit,this.domMinMaxAve[r][2]=i.appendChild(document.createElement("td")),this.domMinMaxAve[r][0]=i.appendChild(document.createElement("td")),this.domMinMaxAve[r][1]=i.appendChild(document.createElement("td")),t.appendChild(i)}this.dom.appendChild(t)}onReceiveFrame(t,e){if(!Object(s.e)(t)){const e=this.history[i.Ping];t=Object(s.d)(e[e.length-1],0)}const r=this.minMaxAve[i.Ping][2],n=Object(s.e)(r)?(t-r)**2:0;this.history[i.Vrtn].push(n),this.history[i.Ping].push(t),this.history[i.Dur].push(e)}onNetChannelSample(t,e,r,n){this.history[i.Loss].push(t),this.history[i.Rtt].push(e),this.history[i.Up].push(r),this.history[i.Down].push(n)}update(){var t,e,r;for(const t of this.history)for(;t.length>this.window;)t.shift();if(!this.enabled)return;if(0!==this.history[0].length)for(const n in o){const a=Number.parseInt(n);this.minMaxAve[a][0]=Math.min(...this.history[a]),this.minMaxAve[a][1]=Math.max(...this.history[a]),this.minMaxAve[a][2]=this.history[a].reduce((t,e)=>t+e,0)/this.history[a].length,a===i.Vrtn&&(this.minMaxAve[a][0]=Math.sqrt(this.minMaxAve[a][0]),this.minMaxAve[a][1]=Math.sqrt(this.minMaxAve[a][1]),this.minMaxAve[a][2]=Math.sqrt(this.minMaxAve[a][2]));const o=Object(s.d)(null===(t=this.minMaxAve[a][0])||void 0===t?void 0:t.toFixed(1),""),c=Object(s.d)(null===(e=this.minMaxAve[a][1])||void 0===e?void 0:e.toFixed(1),""),u=Object(s.d)(null===(r=this.minMaxAve[a][2])||void 0===r?void 0:r.toFixed(1),"");this.domMinMaxAve[a][0].innerText=o,this.domMinMaxAve[a][1].innerText=c,this.domMinMaxAve[a][2].innerText=u}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));for(var n=[],i=0;i<256;i++)n[i]=(i<16?"0":"")+i.toString(16);var s={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&e]+n[e>>8&255]+"-"+n[e>>16&15|64]+n[e>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&i]+n[i>>8&255]+n[i>>16&255]+n[i>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*s.DEG2RAD},radToDeg:function(t){return t*s.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,r,n,i){var s=Math.cos,a=Math.sin,o=s(r/2),c=a(r/2),u=s((e+n)/2),h=a((e+n)/2),l=s((e-n)/2),f=a((e-n)/2),d=s((n-e)/2),p=a((n-e)/2);"XYX"===i?t.set(o*h,c*l,c*f,o*u):"YZY"===i?t.set(c*f,o*h,c*l,o*u):"ZXZ"===i?t.set(c*l,c*f,o*h,o*u):"XZX"===i?t.set(o*h,c*p,c*d,o*u):"YXY"===i?t.set(c*d,o*h,c*p,o*u):"ZYZ"===i?t.set(c*p,c*d,o*h,o*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s}));const n="d717b468c711708410410473d92b56c682224ef3",i=(n.slice(0,8),`https://github.com/themikelester/MoonDuel/tree/${n}`),s=!1},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(1),i=r(7);class s{constructor(t){this.renderer=t}initialize(){this.buffer=new i.a("GlobalUniforms",this.renderer,s.bufferLayout),this.bufferView=this.buffer.getBufferView()}update(){this.buffer.write(this.renderer)}}s.bufferLayout=Object(i.b)({g_camPos:{type:n.n.Float3},g_proj:{type:n.n.Float4x4},g_viewProj:{type:n.n.Float4x4}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return w})),r.d(e,"b",(function(){return M}));var n=r(0),i=r(12);const s={passive:!1,capture:!1};class a{constructor(t){var e=this.getTouchTargetCoords(t);this.x=e.x,this.y=e.y,this.id=t.identifier,this.target=t.target,this.touch=t}getTouchTargetCoords(t){for(var e=0,r=0,i=t.target;!(i instanceof HTMLElement);)i=Object(n.c)(i.parentNode);var s=i;do{e+=s.offsetLeft-s.scrollLeft,r+=s.offsetTop-s.scrollTop,s=s.offsetParent}while(s);return{x:t.pageX-e,y:t.pageY-r}}}class o{constructor(t,e){if(this.element=e.target,this.event=e,this.touches=[],this.changedTouches=[],e){var r,n=e.touches.length;for(r=0;r<n;r++)this.touches.push(new a(e.touches[r]));for(n=e.changedTouches.length,r=0;r<n;r++)this.changedTouches.push(new a(e.changedTouches[r]))}}getTouchById(t,e){var r,n=e.length;for(r=0;r<n;r++)if(e[r].id===t)return e[r];return null}}class c extends i.a{constructor(t){super(),this.element=void 0,this.onStart=t=>{t.preventDefault(),this.fire("touchstart",new o(this,t))},this.onEnd=t=>{t.preventDefault(),this.fire("touchend",new o(this,t))},this.onCancel=t=>{this.fire("touchcancel",new o(this,t))},this.onMove=t=>{t.preventDefault(),this.fire("touchmove",new o(this,t))},this.attach(t)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("touchstart",this.onStart,s),this.element.addEventListener("touchend",this.onEnd,s),this.element.addEventListener("touchmove",this.onMove,s),this.element.addEventListener("touchcancel",this.onCancel,s)}detach(){this.element&&(this.element.removeEventListener("touchstart",this.onStart,s),this.element.removeEventListener("touchend",this.onEnd,s),this.element.removeEventListener("touchmove",this.onMove,s),this.element.removeEventListener("touchcancel",this.onCancel,s)),this.element=void 0}registerAxis(t){let e,r,i;const s={value:0,options:t},a=t.source===y.TouchDragX?"x":"y";return this.on("touchstart",o=>{if(o.touches.length-1===Object(n.d)(t.index,0)){const t=o.changedTouches[0];e=t.id,r=performance.now(),i=t[a],s.value=0}}),this.on("touchend",t=>{const o=t.changedTouches.find(t=>t.id===e);if(Object(n.e)(o)){const n=t.changedTouches[0];e=n.id,r=performance.now(),i=n[a],s.value=0}}),this.on("touchmove",t=>{const o=t.changedTouches.find(t=>t.id===e);if(Object(n.e)(o)){const t=o[a],e=performance.now(),n=t-i;s.value=n,r=e}}),s}}class u extends i.a{constructor(t,e={}){super(),this.keysDown=new Map,this.handleKeyDown=this.onKeyDown.bind(this),this.handleKeyUp=this.onKeyUp.bind(this),this.attach(t),this.preventDefault=Object(n.d)(e.preventDefault,!1),this.stopPropagation=Object(n.d)(e.stopPropagation,!1)}attach(t){this.element&&this.detach(),this.element=t,this.element.addEventListener("keydown",this.handleKeyDown,!1),this.element.addEventListener("keyup",this.handleKeyUp,!1)}detach(){this.element&&(this.element.removeEventListener("keydown",this.handleKeyDown),this.element.removeEventListener("keyup",this.handleKeyUp),this.element=void 0)}onKeyDown(t){var e=t.code;t.repeat||void 0!==e&&(this.keysDown.set(e,!0),this.fire("keydown",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}onKeyUp(t){var e=t.code;void 0!==e&&(this.keysDown.delete(e),this.fire("keyup",t),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation())}update(){this.keysDown.forEach((t,e)=>{this.keysDown.set(e,!1)})}isPressed(t){return this.keysDown.has(t)}wasPressed(t){return!!this.keysDown.get(t)}clear(){this.fire("clear",event),this.keysDown.clear()}}var h,l,f=r(27),d=r.n(f);!function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"}(h||(h={})),function(t){t.MouseUp="mouseup",t.MouseDown="mousedown",t.MouseMove="mousemove",t.MouseWheel="mousewheel"}(l||(l={}));const p={passive:!1,capture:!1};class m{constructor(t,e){Object(n.c)(e),Object(n.b)(e instanceof MouseEvent,"Expected MouseEvent");const r=t._getTargetCoords(e);if(r)this.x=r.x,this.y=r.y;else{if(!g.isPointerLocked())return;this.x=0,this.y=0}if(this.wheelDelta=0,"wheel"===e.type){const t=e;t.deltaY>0?this.wheelDelta=1:t.deltaY<0&&(this.wheelDelta=-1)}g.isPointerLocked()?(this.dx=e.movementX||0,this.dy=e.movementY||0):(this.dx=this.x-t._lastX,this.dy=this.y-t._lastY),"mousedown"!==e.type&&"mouseup"!==e.type||(this.button=e.button),this.buttons=t._buttons.slice(0),this.element=e.target,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.event=e}}class g extends i.a{constructor(t){super(),this.attached=!1,this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastButtons=[!1,!1,!1],this.onUp=this.handleUp.bind(this),this.onDown=this.handleDown.bind(this),this.onMove=this.handleMove.bind(this),this.onWheel=this.handleWheel.bind(this),this.onContextMenu=t=>{t.preventDefault()},this.attach(t)}static isPointerLocked(){return!!document.pointerLockElement}attach(t){this.target=t,this.attached||(this.attached=!0,window.addEventListener("mouseup",this.onUp,p),window.addEventListener("mousedown",this.onDown,p),window.addEventListener("mousemove",this.onMove,p),window.addEventListener("wheel",this.onWheel,p))}detach(){this.attached&&(this.attached=!1,this.target=null,window.removeEventListener("mouseup",this.onUp,p),window.removeEventListener("mousedown",this.onDown,p),window.removeEventListener("mousemove",this.onMove,p),window.removeEventListener("wheel",this.onWheel,p))}disableContextMenu(){this.target&&this.target.addEventListener("contextmenu",this.onContextMenu)}enableContextMenu(){this.target&&this.target.removeEventListener("contextmenu",this.onContextMenu)}enablePointerLock(t,e){if(document.body.requestPointerLock){if(t){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}if(e){const t=function(){e(),document.removeEventListener("pointerlockerror",t)};document.addEventListener("pointerlockerror",t,!1)}document.body.requestPointerLock()}else e&&e()}disablePointerLock(t){if(document.exitPointerLock){if(Object(n.e)(t)){const e=function(){t(),document.removeEventListener("pointerlockchange",e)};document.addEventListener("pointerlockchange",e,!1)}document.exitPointerLock()}}update(){this._lastButtons[0]=this._buttons[0],this._lastButtons[1]=this._buttons[1],this._lastButtons[2]=this._buttons[2]}isPressed(t){return this._buttons[t]}wasPressed(t){return this._buttons[t]&&!this._lastButtons[t]}wasReleased(t){return!this._buttons[t]&&this._lastButtons[t]}handleUp(t){this._buttons[t.button]=!1;const e=new m(this,t);e.event&&this.fire(l.MouseUp,e)}handleDown(t){this._buttons[t.button]=!0;const e=new m(this,t);e.event&&this.fire(l.MouseDown,e)}handleMove(t){const e=new m(this,t);e.event&&(this.fire(l.MouseMove,e),this._lastX=e.x,this._lastY=e.y)}handleWheel(t){const e=new m(this,t);e.event&&this.fire(l.MouseWheel,e)}_getTargetCoords(t){const e=Object(n.c)(this.target),r=e.getBoundingClientRect(),i=Math.floor(r.left),s=Math.floor(r.top);return t.clientX<i||t.clientX>=i+e.clientWidth||t.clientY<s||t.clientY>=s+e.clientHeight?null:{x:t.clientX-i,y:t.clientY-s}}}class b{constructor(t){this.name=t}}var y;!function(t){t[t.MouseDragX=0]="MouseDragX",t[t.MouseDragY=1]="MouseDragY",t[t.MouseWheel=2]="MouseWheel",t[t.TouchDragX=3]="TouchDragX",t[t.TouchDragY=4]="TouchDragY",t[t.TouchPinch=5]="TouchPinch",t[t.TouchRotate=6]="TouchRotate",t[t.TwoTouchDragX=7]="TwoTouchDragX",t[t.TwoTouchDragY=8]="TwoTouchDragY",t[t.PadLeftStickX=9]="PadLeftStickX",t[t.PadLeftStickY=10]="PadLeftStickY",t[t.PadRightStickX=11]="PadRightStickX",t[t.PadRightStickY=12]="PadRightStickY",t[t.Key=13]="Key"}(y||(y={}));class v{constructor(){this.actions={},this.axes={}}attach(t){this.element=t,Object(n.e)(this.touch)&&this.touch.attach(t),Object(n.e)(this.keyboard)&&this.keyboard.attach(t),Object(n.e)(this.mouse)&&this.mouse.attach(t),window.addEventListener("blur",()=>{this.keyboard.clear()}),d.a.isEnabled&&d.a.onchange(()=>{this.keyboard.clear()})}detach(t){Object(n.e)(this.touch)&&this.touch.detach(),Object(n.e)(this.keyboard)&&this.keyboard.detach(),Object(n.e)(this.mouse)&&this.mouse.detach(),this.element=void 0}disableContextMenu(){this.mouse||this.enableMouse(),this.mouse.disableContextMenu()}enableContextMenu(){this.mouse||this.enableMouse(),this.mouse.enableContextMenu()}updateAxes(){for(const t in this.axes)for(const e of this.axes[t])e.func&&(e.value=e.func())}afterFrame(){this.keyboard&&this.keyboard.update(),this.mouse&&this.mouse.update()}registerKeys(t,e){this.keyboard||this.enableKeyboard(),Object(n.e)(this.actions[t])||(this.actions[t]=new b(name));const r=this.actions[t];Object(n.b)(!Object(n.e)(r.keys),"Action already has key bindings"),r.keys=e}registerMouse(t,e){this.mouse||this.enableMouse(),Object(n.e)(this.actions[t])||(this.actions[t]=new b(name));const r=this.actions[t];Object(n.b)(!Object(n.e)(r.mouseButtons),"Action already has mouse bindings"),r.mouseButtons=e}registerPadButton(t,e,r){Object(n.e)(this.actions[t])||(this.actions[t]=new b(name));const i=this.actions[t];Object(n.b)(!Object(n.e)(i.padButtons),"Action already has mouse bindings"),i.padButtons=e,i.padIndexes=r}registerAxis(t,e){Object(n.e)(this.axes[t])||(this.axes[t]=[]);const r=this.axes[t];switch(e.source){case y.Key:r.push({value:0,options:e,func:()=>{let t=0;return Object(n.e)(e.positiveKey)&&(t+=this.keyboard.isPressed(e.positiveKey)?1:0),Object(n.e)(e.negativeKey)&&(t+=this.keyboard.isPressed(e.negativeKey)?-1:0),t}});break;case y.TouchDragX:case y.TouchDragY:{Object(n.e)(this.touch)||this.enableTouches();const t=this.touch.registerAxis(e);r.push(t)}}}isPressed(t){const e=this.actions[t];if(!Object(n.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.isPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.isPressed(t))return!0;return!1}wasPressed(t){const e=this.actions[t];if(!Object(n.e)(e))return!1;if(e.keys)for(const t of e.keys)if(this.keyboard.wasPressed(t))return!0;if(e.mouseButtons)for(const t of e.mouseButtons)if(this.mouse.wasPressed(t))return!0;return!1}getAxis(t){const e=Object(n.c)(this.axes[t],`No axis named "${t}"`);let r=0;for(const t of e)Math.abs(t.value)>Math.abs(r)&&(r=t.options.invert?-t.value:t.value);return r}enableMouse(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.mouse=new g(t)}enableKeyboard(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.keyboard=new u(t)}enableTouches(){const t=Object(n.c)(this.element,"Controller must be attached to an Element");this.touch=new c(t)}}const x=d.a.isEnabled?d.a:void 0;var w;!function(t){t[t.Walk=1]="Walk",t[t.Fullscreen=2]="Fullscreen",t[t.AttackSide=4]="AttackSide",t[t.AttackVert=8]="AttackVert",t[t.AttackPunch=16]="AttackPunch",t[t.TargetLeft=32]="TargetLeft",t[t.TargetRight=64]="TargetRight"}(w||(w={}));const _={[w.Walk]:{id:"walk",name:"Walk",desc:"Hold to walk instead of run"},[w.Fullscreen]:{id:"fullscreen",name:"Toggle Fullscreen",desc:"Toggle fullscreen mode"},[w.AttackSide]:{id:"attackSide",name:"Horizontal Attack",desc:"Attack horizontally"},[w.AttackVert]:{id:"attackVert",name:"Vertical Attack",desc:"Attack vertically"},[w.AttackPunch]:{id:"attackPunch",name:"Punch Attack",desc:"Attack sidestep"},[w.TargetLeft]:{id:"targetLeft",name:"Target Left",desc:"Target next player to the left"},[w.TargetRight]:{id:"targetRight",name:"Target Right",desc:"Target next player to the right"}};class M{constructor(){this.controller=new v}initialize({toplevel:t}){this.controller.attach(t),this.controller.enableMouse(),this.controller.enableTouches(),this.controller.keyboard=new u(window),this.controller.registerAxis("Vertical",{source:y.Key,positiveKey:"KeyW",negativeKey:"KeyS"}),this.controller.registerAxis("Horizontal",{source:y.Key,positiveKey:"KeyD",negativeKey:"KeyA"}),this.controller.registerAxis("Horizontal",{source:y.TouchDragX}),this.controller.registerAxis("Vertical",{source:y.TouchDragY,invert:!0}),this.controller.registerKeys(_[w.Walk].id,["ShiftLeft","ShiftRight"]),this.controller.registerKeys(_[w.Fullscreen].id,["Backslash"]),this.controller.registerKeys(_[w.AttackSide].id,["ArrowRight"]),this.controller.registerKeys(_[w.AttackVert].id,["ArrowUp"]),this.controller.registerKeys(_[w.AttackPunch].id,["ArrowLeft"]),this.controller.registerKeys(_[w.TargetLeft].id,["Q"]),this.controller.registerKeys(_[w.TargetRight].id,["E"]),this.controller.disableContextMenu()}isActive(t){return this.controller.isPressed(t)}wasActive(t){return this.controller.wasPressed(t)}getAxis(t){return this.controller.getAxis(t)}updateFixed({camera:t,clock:e,userCommands:r}){this.controller.updateAxes();const n=Object.keys(_).length;let i=0;for(let t=0;t<n;t++){const e=1<<t;this.isActive(_[e].id)&&(i|=e)}const s={frame:e.simFrame,headingX:t.forward[0],headingZ:t.forward[2],horizontalAxis:this.getAxis("Horizontal"),verticalAxis:this.getAxis("Vertical"),actions:i};r.setUserCommand(s)}afterFrame(){Object(n.e)(x)&&this.wasActive("toggleFullscreen")&&x.toggle(this.controller.element),this.controller.afterFrame()}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return c})),r.d(e,"b",(function(){return u}));var n,i=r(12),s=r(30),a=r(0),o=r(20);!function(t){t.Open="open",t.Close="close",t.Message="message"}(n||(n={}));class c extends i.a{constructor(t){super(),this.signalSocket=t}async listen(t){this.signalSocket.on(s.b.Message,this.onMessage.bind(this,t)),this.iceServers=await this.signalSocket.requestIceServers()}async onMessage(t,e,r){console.debug("WebUDP: Received message",e),Object(a.c)(e.offer,"Expected an offer");const n=new u;n.accept(this.signalSocket,e,r),t(n)}}class u extends i.a{get isOpen(){return this.channel&&"open"===this.channel.readyState}connect(t){Object(a.b)(!Object(a.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=t;const e=new s.a,r=e.connect().then(()=>{this.clientId=e.clientId});return r.then(async()=>{const t=o.b?{}:await e.requestIceServers();this.peer=this.createPeer(t),this.peer.onconnectionstatechange=()=>{switch(this.peer.connectionState){case"connected":case"disconnected":break;case"failed":case"closed":this.close()}};const r=this.getIceCandidates(),n=this.peer.createDataChannel("webudp",{ordered:!1,maxRetransmits:0});this.setDataChannel(n);const i=await this.peer.createOffer();await this.peer.setLocalDescription(i),await r;const c={offer:Object(a.c)(this.peer.localDescription)};e.send(this.peerId,c),e.once(s.b.Message,(t,r)=>{Object(a.c)(t.answer,'Expected "answer" message from remote peer');console.debug("WebUDP: Received answer",t.answer),this.peer.setRemoteDescription(t.answer),e.close()})}),r}async accept(t,e,r){Object(a.b)(!Object(a.e)(this.peer),"WebUdpSocket.connect/listen() may only be called once"),this.peerId=r,this.clientId=t.clientId;const n=o.b?{}:await t.requestIceServers();this.peer=this.createPeer(n);const i=this.getIceCandidates();await this.peer.setRemoteDescription(e.offer);const s=await this.peer.createAnswer();this.peer.setLocalDescription(s),await i,t.send(this.peerId,{answer:this.peer.localDescription}),this.peer.ondatachannel=t=>{this.setDataChannel(t.channel)}}send(t){return!(!this.channel||!this.isOpen)&&(this.channel.send(t),!0)}close(){Object(a.e)(this.peer)&&(this.fire(n.Close),this.channel&&this.channel.close(),this.peer&&this.peer.close(),this.peer=null,this.channel=null)}createPeer(t){return new RTCPeerConnection(t)}onDataChannelOpen(){console.debug("WebUDP: DataChannel open"),this.fire(n.Open)}onDataChannelClosed(){console.debug("WebUDP: DataChannel closed"),this.close()}onDataChannelError(t){var e;"closed"!==(null===(e=this.channel)||void 0===e?void 0:e.readyState)&&console.error("WebUdpPeer: Data channel error:",t.error)}setDataChannel(t){t.binaryType="arraybuffer",t.onopen=this.onDataChannelOpen.bind(this),t.onclose=this.onDataChannelClosed.bind(this),t.onerror=this.onDataChannelError.bind(this),t.onmessage=t=>{this.fire(n.Message,t)},this.channel=t}getIceCandidates(){return new Promise(t=>{const e=[];this.peer.onicecandidate=r=>{r.candidate?(console.debug("WebUDP: Received ICE candidate",r.candidate),e.push(r.candidate)):(console.debug("WebUDP: Received all ICE candidates"),t(e))}})}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return x}));var n=r(7),i=r(1),s=r(2),a=r(21),o=r(0),c=r(8);const u=s.f.fromValues(1,0,0,1),h=s.f.fromValues(0,1,0,1),l=s.f.fromValues(0,0,1,1),f={},d={},p={},m={},g=s.a.create(),b=(new Float32Array(16),s.e.create()),y=new Float32Array(196608),v="\n  precision mediump float;\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    gl_FragColor = v_color;\n  }\n";class x{static setContext(t,e){this.renderer=t,this.globalUniforms=e}static initialize(){const t=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),e=this.renderer.createBuffer("ObbVerts",i.c.Vertex,i.o.Static,t),r=new Uint16Array([0,1,1,3,3,2,2,0,0,4,1,5,3,7,2,6,4,5,5,7,7,6,6,4,0,2,1,1,2,3,1,3,5,5,3,7,4,6,0,0,6,2,2,6,3,3,6,7,4,0,5,5,0,1,5,7,4,4,7,6]),s=this.renderer.createBuffer("ObbIndices",i.c.Index,i.o.Static,r),o=[];for(let t=0;t<32;t++){const e=4*t;o.push(e+0,e+1,e+2,e+2,e+1,e+3)}const c=this.renderer.createBuffer("QuadIndices",i.c.Index,i.o.Static,new Uint16Array(o)),u={buffers:[{stride:12,layout:{a_pos:{type:i.n.Float3,offset:0}}}]},h={blendingEnabled:!0,srcBlendFactor:i.b.Source,dstBlendFactor:i.b.OneMinusSource},l={blendingEnabled:!1},g=this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!0}),b=(this.renderer.createDepthStencilState({depthTestEnabled:!0,depthWriteEnabled:!1}),this.renderer.createDepthStencilState({depthTestEnabled:!1,depthWriteEnabled:!1}));class y{constructor(){this.name="Obb",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n\n  uniform mat3 u_extents;\n  uniform vec3 u_center;\n\n  uniform mat4 g_viewProj;\n\n  void main()\n  {\n    vec3 pos = u_center + u_extents * a_pos;\n    gl_Position = g_viewProj * vec4(pos, 1.0);\n  }\n",this.fragSource="\n  precision mediump float;\n  uniform lowp vec4 u_color;\n\n  void main()\n  {\n    gl_FragColor = u_color;\n  }\n",this.resourceLayout=y.resourceLayout}}y.uniformLayout=Object(n.b)({u_extents:{type:i.n.Float3x3},u_center:{type:i.n.Float3},u_color:{type:i.n.Float4}}),y.resourceLayout={uniforms:{index:0,type:i.a.UniformBuffer,layout:y.uniformLayout},globalUniforms:{index:1,type:i.a.UniformBuffer,layout:a.a.bufferLayout}},f.shader=this.renderer.createShader(new y),f.pipeline=this.renderer.createRenderPipeline(f.shader,l,u,y.resourceLayout),f.resources=this.renderer.createResourceTable(y.resourceLayout),f.vertTable=this.renderer.createVertexTable(f.pipeline),f.depthState=g,f.uniforms=new n.a("ObbUniforms",this.renderer,y.uniformLayout),f.indexBuffer=s,f.count=0,this.renderer.setVertexBuffer(f.vertTable,0,{buffer:e}),this.renderer.setBuffer(f.resources,0,f.uniforms.getBufferView()),this.renderer.setBuffer(f.resources,1,this.globalUniforms.bufferView);class x{constructor(){this.name="Points",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n  attribute vec4 a_color;\n\n  uniform mat4 g_viewProj;\n\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    v_color = a_color;\n\n    gl_Position = g_viewProj * vec4(a_pos, 1.0);\n    gl_PointSize = 4.0;\n  }\n",this.fragSource=v,this.resourceLayout=x.resourceLayout}}x.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:a.a.bufferLayout}};const w={buffers:[{stride:32,layout:{a_pos:{offset:0,type:i.n.Float3},a_color:{offset:16,type:i.n.Float4}}}]};d.shader=this.renderer.createShader(new x),d.pipeline=this.renderer.createRenderPipeline(d.shader,h,w,x.resourceLayout),d.resources=this.renderer.createResourceTable(x.resourceLayout),d.vertTable=this.renderer.createVertexTable(d.pipeline),d.depthState=b,d.vertexBuffer=this.renderer.createBuffer("PointsVerts",i.c.Vertex,i.o.Dynamic,32768*w.buffers[0].stride),d.count=0,this.renderer.setVertexBuffer(d.vertTable,0,{buffer:d.vertexBuffer}),this.renderer.setBuffer(d.resources,0,this.globalUniforms.bufferView),m.shader=this.renderer.createShader(new x),m.pipeline=this.renderer.createRenderPipeline(m.shader,h,w,x.resourceLayout),m.resources=this.renderer.createResourceTable(x.resourceLayout),m.vertTable=this.renderer.createVertexTable(m.pipeline),m.depthState=b,m.indexBuffer=c,m.vertexBuffer=this.renderer.createBuffer("QuadVerts",i.c.Vertex,i.o.Dynamic,128*w.buffers[0].stride),m.count=0,this.renderer.setVertexBuffer(m.vertTable,0,{buffer:m.vertexBuffer}),this.renderer.setBuffer(m.resources,0,this.globalUniforms.bufferView);class _{constructor(){this.name="Sphere",this.vertSource="\n  precision highp float;\n\n  attribute vec3 a_pos;\n\n  // Instanced\n  attribute vec3 a_origin;\n  attribute float a_radius;\n  attribute vec4 a_color;\n\n  uniform mat4 g_viewProj;\n\n  varying lowp vec4 v_color;\n\n  void main()\n  {\n    v_color = a_color;\n\n    vec3 pos = a_origin + a_radius * a_pos;\n    gl_Position = g_viewProj * vec4(pos, 1.0);\n  }\n",this.fragSource=v,this.resourceLayout=_.resourceLayout}}_.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:a.a.bufferLayout}};const M={buffers:[{stride:12,layout:{a_pos:{offset:0,type:i.n.Float3}}},{stride:32,layout:{a_origin:{offset:0,type:i.n.Float3},a_radius:{offset:12,type:i.n.Float},a_color:{offset:16,type:i.n.Float4}},stepMode:i.h.Instance}]};p.shader=this.renderer.createShader(new _),p.depthState=g,p.resources=this.renderer.createResourceTable(_.resourceLayout),p.pipeline=this.renderer.createRenderPipeline(p.shader,l,M,_.resourceLayout),p.vertTable=this.renderer.createVertexTable(p.pipeline),p.vertexBuffer=this.renderer.createBuffer("Spheres",i.c.Vertex,i.o.Dynamic,32*M.buffers[1].stride),p.indexBuffer=s,p.count=0,this.renderer.setVertexBuffer(p.vertTable,0,{buffer:e}),this.renderer.setVertexBuffer(p.vertTable,1,{buffer:p.vertexBuffer}),this.renderer.setBuffer(p.resources,0,this.globalUniforms.bufferView)}static renderObbs(t,e=!1,r=u){if(!Object(o.e)(f.pipeline))return void this.initialize();Object(o.b)(t.length<=1,"Drawing multiple OBBs not yet supported. (Need to use multiple uniform buffers)"),f.uniforms.setVec4("u_color",r);for(let e of t){const t=s.a.fromMat4(g,e);f.uniforms.setFloats("u_extents",t),f.uniforms.setVec3("u_center",s.b.getTranslation(b,e))}f.uniforms.write(this.renderer);const n={renderPipeline:f.pipeline,vertexTable:f.vertTable,depthMode:f.depthState,resourceTable:f.resources,indexType:i.n.Ushort,indexBuffer:{buffer:f.indexBuffer,byteOffset:e?48:0},type:e?i.g.Triangles:i.g.Lines,elementCount:e?36:24};c.a.debug.push(n)}static renderLines(t,e=h){if(Object(o.e)(f.pipeline)){console.assert(t.length<32768);for(let r=0;r<t.length;r++)y.set(t[r],8*r+0),y.set(e,8*r+4);this.renderer.writeBufferData(d.vertexBuffer,32*d.count,y.subarray(0,8*t.length)),d.count+=t.length}else this.initialize()}static renderQuads(t,e=h){if(Object(o.e)(f.pipeline)){console.assert(4*t.length<32768);for(let r=0;r<t.length;r++)y.set(t[r],8*r+0),y.set(e,8*r+4);this.renderer.writeBufferData(m.vertexBuffer,4*m.count*32,y.subarray(0,8*t.length)),m.count+=t.length/4}else this.initialize()}static renderSpheres(t,e=l){if(Object(o.e)(f.pipeline)){console.assert(t.length<32);for(let r=0;r<t.length;r++)y.set(t[r],8*r+0),y.set(e,8*r+4);this.renderer.writeBufferData(p.vertexBuffer,32*p.count,y.subarray(0,8*t.length)),p.count+=t.length}else this.initialize()}static flush(){if(d.count>0){const t={renderPipeline:d.pipeline,depthMode:d.depthState,resourceTable:d.resources,vertexTable:d.vertTable,type:i.g.Lines,elementCount:d.count};c.a.debug.push(t),d.count=0}if(p.count>0){const t={renderPipeline:p.pipeline,depthMode:p.depthState,resourceTable:p.resources,vertexTable:p.vertTable,type:i.g.Lines,elementCount:24,instanceCount:p.count,indexBuffer:{buffer:p.indexBuffer},indexType:i.n.Ushort};c.a.debug.push(t),p.count=0}if(m.count>0){const t={renderPipeline:m.pipeline,depthMode:m.depthState,resourceTable:m.resources,vertexTable:m.vertTable,type:i.g.Triangles,elementCount:6*m.count,indexBuffer:{buffer:m.indexBuffer},indexType:i.n.Ushort};c.a.debug.push(t),m.count=0}}}},function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks["$"+t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,r){var n,i=r(79),s=r(53),a=r(81),o=r(82),c=r(83);"undefined"!=typeof ArrayBuffer&&(n=r(84));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=u||h;e.protocol=3;var f=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=i(f),p={type:"error",data:"parser error"},m=r(85);function g(t,e,r){for(var n=new Array(t.length),i=o(t.length,r),s=function(t,r,i){e(r,(function(e,r){n[t]=r,i(e,n)}))},a=0;a<t.length;a++)s(a,t[a],i)}e.encodePacket=function(t,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var s=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=t.data,s=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=f[t.type];for(var o=0;o<s.length;o++)a[o+1]=s[o];return n(a.buffer)}(t,r,i);if(void 0!==m&&s instanceof m)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);if(l)return function(t,r,n){if(!r)return e.encodeBase64Packet(t,n);var i=new FileReader;return i.onload=function(){e.encodePacket({type:t.type,data:i.result},r,!0,n)},i.readAsArrayBuffer(t.data)}(t,r,n);var i=new Uint8Array(1);i[0]=f[t.type];var s=new m([i.buffer,t.data]);return n(s)}(t,r,i);if(s&&s.base64)return function(t,r){var n="b"+e.packets[t.type]+t.data.data;return r(n)}(t,i);var a=f[t.type];return void 0!==t.data&&(a+=n?c.encode(String(t.data),{strict:!1}):String(t.data)),i(""+a)},e.encodeBase64Packet=function(t,r){var n,i="b"+e.packets[t.type];if(void 0!==m&&t.data instanceof m){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];r(i+t)},s.readAsDataURL(t.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var a=new Uint8Array(t.data),o=new Array(a.length),c=0;c<a.length;c++)o[c]=a[c];n=String.fromCharCode.apply(null,o)}return i+=btoa(n),r(i)},e.decodePacket=function(t,r,n){if(void 0===t)return p;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),r);if(n&&!1===(t=function(t){try{t=c.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return p;var i=t.charAt(0);return Number(i)==i&&d[i]?t.length>1?{type:d[i],data:t.substring(1)}:{type:d[i]}:p}i=new Uint8Array(t)[0];var s=a(t,1);return m&&"blob"===r&&(s=new m([s])),{type:d[i],data:s}},e.decodeBase64Packet=function(t,e){var r=d[t.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:t.substr(1)}};var i=n.decode(t.substr(1));return"blob"===e&&m&&(i=new m([i])),{type:r,data:i}},e.encodePayload=function(t,r,n){"function"==typeof r&&(n=r,r=null);var i=s(t);if(r&&i)return m&&!l?e.encodePayloadAsBlob(t,n):e.encodePayloadAsArrayBuffer(t,n);if(!t.length)return n("0:");g(t,(function(t,n){e.encodePacket(t,!!i&&r,!1,(function(t){n(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return n(e.join(""))}))},e.decodePayload=function(t,r,n){if("string"!=typeof t)return e.decodePayloadAsBinary(t,r,n);var i;if("function"==typeof r&&(n=r,r=null),""===t)return n(p,0,1);for(var s,a,o="",c=0,u=t.length;c<u;c++){var h=t.charAt(c);if(":"===h){if(""===o||o!=(s=Number(o)))return n(p,0,1);if(o!=(a=t.substr(c+1,s)).length)return n(p,0,1);if(a.length){if(i=e.decodePacket(a,r,!1),p.type===i.type&&p.data===i.data)return n(p,0,1);if(!1===n(i,c+s,u))return}c+=s,o=""}else o+=h}return""!==o?n(p,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,r){if(!t.length)return r(new ArrayBuffer(0));g(t,(function(t,r){e.encodePacket(t,!0,!0,(function(t){return r(null,t)}))}),(function(t,e){var n=e.reduce((function(t,e){var r;return t+(r="string"==typeof e?e.length:e.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),s=0;return e.forEach((function(t){var e="string"==typeof t,r=t;if(e){for(var n=new Uint8Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);r=n.buffer}i[s++]=e?0:1;var o=r.byteLength.toString();for(a=0;a<o.length;a++)i[s++]=parseInt(o[a]);i[s++]=255;for(n=new Uint8Array(r),a=0;a<n.length;a++)i[s++]=n[a]})),r(i.buffer)}))},e.encodePayloadAsBlob=function(t,r){g(t,(function(t,r){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);t=n.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),a=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)a[i]=parseInt(s[i]);if(a[s.length]=255,m){var o=new m([e.buffer,a.buffer,t]);r(null,o)}}))}),(function(t,e){return r(new m(e))}))},e.decodePayloadAsBinary=function(t,r,n){"function"==typeof r&&(n=r,r=null);for(var i=t,s=[];i.byteLength>0;){for(var o=new Uint8Array(i),c=0===o[0],u="",h=1;255!==o[h];h++){if(u.length>310)return n(p,0,1);u+=o[h]}i=a(i,2+u.length),u=parseInt(u);var l=a(i,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var f=new Uint8Array(l);l="";for(h=0;h<f.length;h++)l+=String.fromCharCode(f[h])}s.push(l),i=a(i,u)}var d=s.length;s.forEach((function(t,i){n(e.decodePacket(t,r,!0),i,d)}))}},function(t,e,r){
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},r=t.exports,n=function(){for(var t,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=r.length,s={};n<i;n++)if((t=r[n])&&t[1]in e){for(n=0;n<t.length;n++)s[r[0][n]]=t[n];return s}return!1}(),i={change:n.fullscreenchange,error:n.fullscreenerror},s={request:function(t){return new Promise(function(r,i){var s=function(){this.off("change",s),r()}.bind(this);this.on("change",s);var a=(t=t||e.documentElement)[n.requestFullscreen]();a instanceof Promise&&a.then(s).catch(i)}.bind(this))},exit:function(){return new Promise(function(t,r){if(this.isFullscreen){var i=function(){this.off("change",i),t()}.bind(this);this.on("change",i);var s=e[n.exitFullscreen]();s instanceof Promise&&s.then(i).catch(r)}else t()}.bind(this))},toggle:function(t){return this.isFullscreen?this.exit():this.request(t)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,r){var n=i[t];n&&e.addEventListener(n,r,!1)},off:function(t,r){var n=i[t];n&&e.removeEventListener(n,r,!1)},raw:n};n?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(e[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[n.fullscreenEnabled])}}}),r?t.exports=s:window.screenfull=s):r?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},function(t,e,r){"use strict";r.d(e,"a",(function(){return S}));var n=r(14),i=r(6),s=r(13),a=r(35),o=r(19),c=new s.a,u=new n.a;function h(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||h.DefaultOrder}function l(){this.mask=1}function f(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}h.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],h.DefaultOrder="XYZ",Object.defineProperties(h.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(h.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=o.a.clamp,i=t.elements,s=i[0],a=i[4],c=i[8],u=i[1],h=i[5],l=i[9],f=i[2],d=i[6],p=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(c,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-f,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(u,s))):"ZYX"===e?(this._y=Math.asin(-n(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,s)):(this._x=0,this._z=Math.atan2(-a,h))):"YZX"===e?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(c,p))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(c,s)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return c.makeRotationFromQuaternion(t),this.setFromRotationMatrix(c,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return u.setFromEuler(this),this.setFromQuaternion(u,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new i.a(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(l.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(f.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,s,a,o,c){var u=this.elements;return u[0]=t,u[1]=n,u[2]=a,u[3]=e,u[4]=i,u[5]=o,u[6]=r,u[7]=s,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},extractBasis:function(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,s=r[0],a=r[3],o=r[6],c=r[1],u=r[4],h=r[7],l=r[2],f=r[5],d=r[8],p=n[0],m=n[3],g=n[6],b=n[1],y=n[4],v=n[7],x=n[2],w=n[5],_=n[8];return i[0]=s*p+a*b+o*x,i[3]=s*m+a*y+o*w,i[6]=s*g+a*v+o*_,i[1]=c*p+u*b+h*x,i[4]=c*m+u*y+h*w,i[7]=c*g+u*v+h*_,i[2]=l*p+f*b+d*x,i[5]=l*m+f*y+d*w,i[8]=l*g+f*v+d*_,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],c=t[7],u=t[8];return e*s*u-e*a*c-r*i*u+r*a*o+n*i*c-n*s*o},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var r=t.elements,n=this.elements,i=r[0],s=r[1],a=r[2],o=r[3],c=r[4],u=r[5],h=r[6],l=r[7],f=r[8],d=f*c-u*l,p=u*h-f*o,m=l*o-c*h,g=i*d+s*p+a*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var b=1/g;return n[0]=d*b,n[1]=(a*l-f*s)*b,n[2]=(u*s-a*c)*b,n[3]=p*b,n[4]=(f*i-a*h)*b,n[5]=(a*o-u*i)*b,n[6]=m*b,n[7]=(s*h-l*i)*b,n[8]=(c*i-s*o)*b,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,s,a){var o=Math.cos(i),c=Math.sin(i);this.set(r*o,r*c,-r*(o*s+c*a)+s+t,-n*c,n*o,-n*(-c*s+o*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],s=n[3],a=n[6],o=n[1],c=n[4],u=n[7];return n[0]=e*i+r*o,n[3]=e*s+r*c,n[6]=e*a+r*u,n[1]=-r*i+e*o,n[4]=-r*s+e*c,n[7]=-r*a+e*u,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var d=0,p=new i.a,m=new n.a,g=new s.a,b=new i.a,y=new i.a,v=new i.a,x=new n.a,w=new i.a(1,0,0),_=new i.a(0,1,0),M=new i.a(0,0,1),C={type:"added"},A={type:"removed"};function S(){Object.defineProperty(this,"id",{value:d++}),this.uuid=o.a.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=S.DefaultUp.clone();var t=new i.a,e=new h,r=new n.a,a=new i.a(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new s.a},normalMatrix:{value:new f}}),this.matrix=new s.a,this.matrixWorld=new s.a,this.matrixAutoUpdate=S.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new l,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}S.DefaultUp=new i.a(0,1,0),S.DefaultMatrixAutoUpdate=!0,S.prototype=Object.assign(Object.create(a.a.prototype),{constructor:S,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.multiply(m),this},rotateOnWorldAxis:function(t,e){return m.setFromAxisAngle(t,e),this.quaternion.premultiply(m),this},rotateX:function(t){return this.rotateOnAxis(w,t)},rotateY:function(t){return this.rotateOnAxis(_,t)},rotateZ:function(t){return this.rotateOnAxis(M,t)},translateOnAxis:function(t,e){return p.copy(t).applyQuaternion(this.quaternion),this.position.add(p.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(w,t)},translateY:function(t){return this.translateOnAxis(_,t)},translateZ:function(t){return this.translateOnAxis(M,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(g.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?b.copy(t):b.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),y.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?g.lookAt(y,b,this.up):g.lookAt(b,y,this.up),this.quaternion.setFromRotationMatrix(g),n&&(g.extractRotation(n.matrixWorld),m.setFromRotationMatrix(g),this.quaternion.premultiply(m.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(C)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(A)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),g.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),g.multiply(t.parent.matrixWorld)),t.applyMatrix4(g),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new i.a),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new n.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(y,t,v),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new i.a),this.updateMatrixWorld(!0),this.matrixWorld.decompose(y,x,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new i.a),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var n=this.children,i=0,s=n.length;i<s;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var a=s.shapes;if(Array.isArray(a))for(var o=0,c=a.length;o<c;o++){var u=a[o];i(t.shapes,u)}else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(o=0,c=this.material.length;o<c;o++)h.push(i(t.materials,this.material[o]));n.material=h}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(e){var l=m(t.geometries),f=m(t.materials),d=m(t.textures),p=m(t.images);a=m(t.shapes);l.length>0&&(r.geometries=l),f.length>0&&(r.materials=f),d.length>0&&(r.textures=d),p.length>0&&(r.images=p),a.length>0&&(r.shapes=a)}return r.object=n,r;function m(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}})},function(t,e,r){"use strict";r.d(e,"a",(function(){return z})),r.d(e,"b",(function(){return et})),r.d(e,"c",(function(){return rt}));var n,i=r(2),s=r(22),a=r(5),o=r(10),c=r(0);!function(t){t[t.None=0]="None",t[t.AttackSide=1]="AttackSide",t[t.AttackVertical=2]="AttackVertical",t[t.AttackPunch=3]="AttackPunch",t[t.AttackThrow=4]="AttackThrow",t[t.Struck=5]="Struck"}(n||(n={}));const u={[n.AttackVertical]:new class{constructor(){this.duration=90,this.attackPeriod=[36,44],this.safePeriod=[9,36],this.safeFrom=n.AttackSide}},[n.AttackSide]:new class{constructor(){this.attackPeriod=[29,46],this.safePeriod=[9,36],this.duration=90,this.safeFrom=n.AttackPunch}},[n.AttackPunch]:new class{constructor(){this.attackPeriod=[36,46],this.safePeriod=[9,36],this.duration=90,this.safeFrom=n.AttackVertical}}};class h{constructor(t,e){this.instigator=t,this.weapon=Object(c.c)(t.weapon),this.type=e,this.def=Object(c.c)(u[e])}}function l(t,e,r){const i=r.simFrame-t.state.stateStartFrame;if((t.attack?t.attack.def.safeFrom:n.None)===e.type){const e=t.attack.def.safePeriod;if(i>=e[0]&&i<=e[1])return!1}return!t.hitBy.includes(e)}const f=i.e.create(),d=i.e.create();class p{constructor(){this.orientationTarget=i.e.create(),this.hitVelocity=i.e.create()}update(t,e,r,u,l){const p=t.state,m=Object(o.c)(Object(o.d)(),p),g=p,b=this.getCameraRelativeMovementDirection(l,d),y=i.e.length(b)>.1,v=l.actions&s.a.Walk;let x=i.e.clone(m.orientation),w=!!(m.flags&z.IsUTurning);if(Object(c.e)(t.attack)){r-m.stateStartFrame>=t.attack.def.duration&&(g.state=n.None,g.stateStartFrame=r,t.attack=null)}else{let e;l.actions&s.a.AttackSide&&(e=n.AttackSide),l.actions&s.a.AttackVert&&(e=n.AttackVertical),l.actions&s.a.AttackPunch&&(e=n.AttackPunch),e&&(g.state=e,g.stateStartFrame=r,t.attack=new h(t,e))}if(m.state===n.Struck){const e=r-m.stateStartFrame;if(0===this.hitVelocity[0]&&0===this.hitVelocity[1]&&0===this.hitVelocity[2]){const e=t.hitBy[0].instigator,r=i.e.sub(f,m.origin,e.state.origin),n=Math.sqrt(r[0]*r[0]+r[2]*r[2])||.001,s=i.e.set(d,r[0]/n,2,r[2]/n);i.e.scale(this.hitVelocity,s,1e3),Object(c.b)(!Number.isNaN(this.hitVelocity[0])),Object(c.b)(!Number.isNaN(this.hitVelocity[1])),Object(c.b)(!Number.isNaN(this.hitVelocity[2]))}this.hitVelocity[1]+=-9800*u;const s=i.e.scaleAndAdd(i.e.create(),m.origin,this.hitVelocity,u);return s[1]<0&&(this.hitVelocity[1]=0),e>34&&s[1]<=0&&(t.hitBy.length=0,g.state=n.None,g.stateStartFrame=r,i.e.zero(this.hitVelocity)),g.origin=s,g.speed=0,g.orientation=x,g.flags=z.IsActive,g}let _=m.speed;const M=v?600:3e3;let C=v?150:600;g.state!==n.None&&(C=10);const A=(y?M:-M)*u,S=Object(a.c)(_+A,0,C);_+=Object(a.c)(S-_,-M*u,M*u);const T=i.e.scale(i.e.create(),m.orientation,_),k=i.e.scaleAndAdd(i.e.create(),m.origin,T,u);let F=y,O=3.75*Math.PI,E=1.875*Math.PI;Math.PI;w?i.e.dot(x,this.orientationTarget)>.99&&(w=!1):i.e.dot(b,this.orientationTarget)<-.99&&(w=!0,i.e.copy(this.orientationTarget,b));let j=_>0?E:O;if(w?(F=!0,j*=2,this.orientationTarget=this.orientationTarget):y&&i.e.copy(this.orientationTarget,b),F){const t=Math.atan2(m.orientation[0],m.orientation[2]),e=Math.atan2(this.orientationTarget[0],this.orientationTarget[2]);let r=Object(a.b)(t,e);const n=j*u,s=Object(a.c)(r,-n,n);i.e.rotateY(x,m.orientation,a.a,s)}let B=m.flags&~(z.IsWalking|z.IsUTurning);return v&&(B|=z.IsWalking),w&&(B|=z.IsUTurning),g.origin=k,g.speed=_,g.orientation=x,g.flags=B,g}getWorldRelativeMovementDirection(t,e){const r=t.horizontalAxis,n=t.verticalAxis;return i.e.normalize(e,i.e.set(e,r,0,n))}getCameraRelativeMovementDirection(t,e){const r=this.getWorldRelativeMovementDirection(t,e),n=i.e.normalize(f,i.e.set(f,t.headingX,0,t.headingZ));return i.e.set(e,r[0]*-n[2]+r[2]*n[0],0,r[0]*n[0]+r[2]*n[2])}}var m=r(11),g=r(1),b=r(8),y=r(7),v=r(28);function x(){v.a.call(this),this.type="Bone"}x.prototype=Object.assign(Object.create(v.a.prototype),{constructor:x,isBone:!0});var w=r(13),_=new w.a,M=new w.a;function C(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new w.a)}}Object.assign(C.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new w.a;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,s=t.length;i<s;i++){var a=t[i]?t[i].matrixWorld:M;_.multiplyMatrices(a,e[i]),_.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new C(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});var A=r(24),S=r(9);const T=i.f.fromValues(1,0,0,1),k=new S.c(i.e.create()),F=new Array(128).fill(0).map(t=>i.e.create());function O(t,e=T){const r=F;if(t){for(let e=0;e<t.bones.length;e++){const n=t.bones[e],i=n.parent;i&&(k.setBuffer(r[2*e+0]),i.getWorldPosition(k),k.setBuffer(r[2*e+1]),n.getWorldPosition(k))}A.a.renderLines(r.slice(0,2*t.bones.length),e)}}const E=i.f.create(),j=i.f.create(),B=i.e.create();class R{constructor(){this.data=[],this.drawSkeleton=!1}initialize(t,e){this.avatars=t;for(let e=0;e<t.length;e++)this.data[e]={models:[],skinnedModels:[]};e.addFolder("Avatar").add(this,"drawSkeleton")}onResourcesLoaded(t,e){for(let r=0;r<this.avatars.length;r++){const n=this.avatars[r];for(let i=0;i<n.nodes.length;i++){const s=n.nodes[i];if(Object(c.e)(s.skinId)){const i=Object(c.c)(s.meshId);Object(c.b)(0===s.skinId),this.loadSkinnedModel(e,t,s,i,n.skeleton,r)}else Object(c.e)(s.meshId)&&this.loadModel(e,t,s,s.meshId,r)}}}createMaterial(t,e,r){const n=r.materials[e.materialIndex],s=Object(c.c)(n.technique),a=s.shaderId,o=function(t){const e={},r=[];for(const n of Object.keys(t.uniforms)){const i=t.uniforms[n];i.type===g.n.Texture2D?r.push(n):e[n]=i}const n=Object(y.b)(e),i={uniforms:{index:0,type:g.a.UniformBuffer,layout:n}};for(let t=0;t<r.length;t++){i[r[t]]={index:t,type:g.a.Texture}}return i}(s),u=new m.a(t,n.name,a,o),h=o.uniforms.layout,l=new y.a(n.name,t,h);if(u.setUniformBuffer(t,"uniforms",l),s){const e=Object(c.c)(n.values);for(const n of Object.keys(s.uniforms)){const i=s.uniforms[n],a=Object(c.d)(e[n],i.value);if(Object(c.e)(a))if(i.type===g.n.Texture2D){const e=r.textures[a.index].id;u.setTexture(t,n,e)}else i.type===g.n.Float?l.setFloat(n,a):l.setFloats(n,a)}l.setVec4("u_Color0",i.f.fromValues(.4266,.4171,.5057,1))}else l.setVec4("u_color",i.f.fromValues(0,1,0,1));return u}loadSkinnedModel(t,e,r,n,i,s){const a=e.meshes[n];for(let n of a.primitives){const a=this.createMaterial(t,n,e),o=new m.c(t,b.a.opaque,n.mesh,a);o.bindSkeleton(t,i),a.setTexture(t,"u_jointTex",o.boneTex),this.data[s].skinnedModels.push(o),r.add(o)}}loadModel(t,e,r,n,i){const s=e.meshes[n];for(let n of s.primitives){const s=this.createMaterial(t,n,e),a=new m.b(t,b.a.opaque,n.mesh,s);this.data[i].models.push(a),r.add(a)}}render(t,e,r){for(let n=0;n<this.avatars.length;n++){if(!this.avatars[n].isActive)continue;const s=this.data[n];for(let n=0;n<s.skinnedModels.length;n++){const a=s.skinnedModels[n],o=a.material.getUniformBuffer("uniforms");a.writeBonesToTex(t);const u=new Float32Array(a.matrixWorld.elements),h=i.e.set(B,u[12],u[13],u[14]);Object(c.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_modelViewProjection",i.b.multiply(i.b.create(),e.viewProjMatrix,u)),Object(c.e)(o.getBufferLayout().u_modelViewProjection)&&o.setMat4("u_model",u),I(o,r,h),o.write(t),a.renderList.push(a.primitive)}for(let n=0;n<s.models.length;n++){const a=s.models[n],o=new Float32Array(a.matrixWorld.elements),c=i.e.set(B,o[12],o[13],o[14]),u=a.material.getUniformBuffer("uniforms");u.setMat4("u_modelViewProjection",i.b.multiply(i.b.create(),e.viewProjMatrix,o)),I(u,r,c),u.write(t),a.renderList.push(a.primitive)}if(this.drawSkeleton&&(O(this.avatars[n].skeleton),window.server)){O(window.server.avatar.avatars[n].skeleton,i.f.fromValues(1,1,0,1))}}}}function I(t,e,r){const n=i.f.copy(E,e.actorColor.diffuse),s=i.f.copy(j,e.actorColor.ambient),a=e.localLights[0],o=i.e.distance(r,a.position),c=Math.max(.001,a.power),u=Math.min(1,o/c),h=.2*(1-u*u);i.f.scaleAndAdd(n,n,a.color,h),i.f.scaleAndAdd(s,s,a.color,h),t.setVec4("u_Color0",s),t.setVec4("u_KonstColor0",n),t.setFloats("u_LightTransforms",[1,0,0,0,0,1,0,0,0,0,1,0,e.baseLight.position[0],e.baseLight.position[1],e.baseLight.position[2],1,1,0,0,0,0,1,0,0,0,0,1,0,a.position[0],a.position[1],a.position[2],1]),t.setFloats("u_LightColors",[1,0,0,1,1,0,0,1])}var P=r(16),U=r(4);const D=[.25,.75],L=[.15,.65];class N{constructor(t){this.targetAvatar=t}onResourcesLoaded(t,e){this.debugMenu=e.addFolder("Animation"),this.debugAnimationMixer=new P.b(this.targetAvatar);const r={that:this,togglePaused:()=>{this.debugAnimation&&(this.debugAnimation.paused=!this.debugAnimation.paused)},stop:()=>{this.debugAnimation&&(this.debugAnimation.stop(),this.debugAnimation=void 0)},get time(){if(Object(c.e)(this.that.debugAnimation)){return this.that.debugAnimation.time/this.that.debugAnimation.getClip().duration}return 0},set time(t){Object(c.e)(this.that.debugAnimation)&&(this.that.debugAnimation.paused=!0,this.that.debugAnimation.time=t*this.that.debugAnimation.getClip().duration)},get frame(){if(Object(c.e)(this.that.debugAnimation)){return this.that.debugAnimation.time/.016}return 0},set frame(t){Object(c.e)(this.that.debugAnimation)&&(this.that.debugAnimation.paused=!0,this.that.debugAnimation.time=.016*t%this.that.debugAnimation.getClip().duration)}};this.debugMenu.add(r,"togglePaused"),this.debugMenu.add(r,"stop"),this.debugMenu.add(r,"time",0,1,.01),this.debugMenu.add(r,"frame",0,100,1);const n={};for(const e of t)n[e.name]=()=>{this.debugAnimationMixer.stopAllAction(),this.debugAnimation=this.debugAnimationMixer.clipAction(e,this.targetAvatar).reset().play()},this.debugMenu.add(n,e.name)}update(t,e){return this.targetAvatar=t,this.debugAnimation&&this.debugAnimationMixer.update(e),this.targetAvatar.updateMatrixWorld(),this.targetAvatar.skeleton.update(),this.debugAnimation}}class V{constructor(){this.data=[],this.ready=!1}initialize(t){this.avatars=t,this.debugMenu=new N(this.avatars[0])}onResourcesLoaded(t,e){const r=Object(c.c)(t.animations.find(t=>"akamae1"===t.name)),n=Object(c.c)(t.animations.find(t=>"awalk1"===t.name)),i=Object(c.c)(t.animations.find(t=>"brun1"===t.name)),s=Object(c.c)(t.animations.find(t=>"bat_yoko1"===t.name)),a=Object(c.c)(t.animations.find(t=>"bat_jump1"===t.name)),o=Object(c.c)(t.animations.find(t=>"bat_syoutei_l1"===t.name)),u=Object(c.c)(t.animations.find(t=>"ahakai1"===t.name));for(let t=0;t<this.avatars.length;t++){const e=this.avatars[t];this.data[t]={aIdle:e.animationMixer.clipAction(r),aWalk:e.animationMixer.clipAction(n),aRun:e.animationMixer.clipAction(i),aAttackSide:e.animationMixer.clipAction(s),aAttackVert:e.animationMixer.clipAction(a),aAttackPunch:e.animationMixer.clipAction(o),aStruck:e.animationMixer.clipAction(u),startingFoot:0};const c=this.data[t];c.aIdle.play().setEffectiveWeight(1),c.aWalk.play().setEffectiveWeight(0),c.aRun.play().setEffectiveWeight(0),c.aAttackSide.play().setEffectiveWeight(0),c.aAttackVert.play().setEffectiveWeight(0),c.aAttackPunch.play().setEffectiveWeight(0),c.aStruck.play().setEffectiveWeight(0),c.aAttackSide.setLoop(U.d,1),c.aAttackVert.setLoop(U.d,1),c.aAttackPunch.setLoop(U.d,1),c.aIdle.time=t*(c.aIdle.getClip().duration/(this.avatars.length+1)),c.aWalk.time=D[c.startingFoot]*c.aWalk.getClip().duration,c.aRun.time=L[c.startingFoot]*c.aRun.getClip().duration}this.debugMenu.onResourcesLoaded(t.animations,e),this.ready=!0}apply(t,e,r){const i=t.state;let s=1;const o=r.renderTime/1e3,c=o,u=.001*(r.renderTime-i.stateStartFrame*r.simDt);let h=0;h=i.state===n.AttackSide||i.state===n.AttackVertical||i.state===n.AttackPunch?Math.min(Object(a.h)(Object(a.e)(0,.2,u)),1-Object(a.h)(Object(a.e)(.9,1,u/e.aAttackSide.getClip().duration))):0,s-=h;let l=0;i.state===n.Struck&&(l=Math.min(Object(a.h)(Object(a.e)(0,.1,u)),1-Object(a.h)(Object(a.e)(.444,.544,u)))),s-=l;let f=s*Object(a.h)(Object(a.e)(0,600,i.speed)),d=s*Object(a.h)(Object(a.e)(600,0,i.speed));e.aRun.time=c%e.aRun.getClip().duration,e.aIdle.time=o%e.aIdle.getClip().duration,e.aAttackSide.time=u%e.aAttackSide.getClip().duration,e.aAttackVert.time=u%e.aAttackVert.getClip().duration,e.aAttackPunch.time=u%e.aAttackPunch.getClip().duration,e.aStruck.time=u%e.aStruck.getClip().duration,e.aRun.weight=f,e.aIdle.weight=d,e.aAttackSide.weight=i.state===n.AttackSide?h:0,e.aAttackVert.weight=i.state===n.AttackVertical?h:0,e.aAttackPunch.weight=i.state===n.AttackPunch?h:0,e.aStruck.weight=l,t.animationMixer.update(0),t.updateMatrixWorld(),t.skeleton.update()}update(t){if(!this.ready)return;const e=.001*t.renderDt;for(let r=0;r<this.avatars.length;r++){const n=this.data[r],i=this.avatars[r];if(i.local){if(this.debugMenu.update(i,e))continue}i.isActive&&this.apply(i,n,t)}}}var z,q=r(15);class W{constructor(){this.command=new q.a}getUserCommand(t){return this.command.frame=t,this.command.headingX=0,this.command.headingZ=0,this.command.verticalAxis=0,this.command.horizontalAxis=0,this.command.actions=0,this.command}}class H extends W{constructor(){super(...arguments),this.command=new q.a}getUserCommand(t){return this.command.frame=t,this.command.headingX=0,this.command.headingZ=0,this.command.verticalAxis=0,this.command.horizontalAxis=0,this.command.actions=s.a.AttackSide,this.command}}class Y extends W{constructor(){super(...arguments),this.command=new q.a}getUserCommand(t){return this.command.frame=t,this.command.headingX=0,this.command.headingZ=0,this.command.verticalAxis=0,this.command.horizontalAxis=0,this.command.actions=s.a.AttackVert,this.command}}class G{constructor(t,e){this.avatarSystem=t,this.avatars=e,this.bots=[]}addBot(t,e){const r=this.avatarSystem.addAvatar(t);t.avatar=this.avatars[r],e&&i.e.copy(t.avatar.state.origin,e),e&&i.e.normalize(t.avatar.state.orientation,i.e.negate(t.avatar.state.orientation,e)),this.bots.push(t)}}class X extends S.b{constructor(){super(...arguments),this.local=!1,this.bounds=i.b.create(),this.hitBy=[]}get isActive(){return this.state&&(this.state.flags&z.IsActive)>0}}!function(t){t[t.IsActive=1]="IsActive",t[t.IsWalking=2]="IsWalking",t[t.IsUTurning=4]="IsUTurning"}(z||(z={}));const $=i.b.fromValues(40,0,0,0,0,110,0,0,0,0,40,0,0,110,10,1),K=i.b.create(),J=i.e.create(),Z=i.e.create(),Q=new S.c(J),tt=new S.c(Z);class et{constructor(){this.avatars=[],this.animation=new V,this.renderer=new R;for(let t=0;t<8;t++)this.avatars[t]=new X;this.localAvatar=this.avatars[0]}initialize(t){t.world.registerFactory(o.a.Avatar,this),t.resources.load("data/Tn.glb","gltf",(e,r)=>{if(e)return console.error("Failed to load resource",e);this.gltf=r,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars),this.renderer.initialize(this.avatars,t.debugMenu)}onJoined(t){this.localAvatar=this.avatars[t],this.localAvatar.local=!0}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const r=this.gltf.nodes[e],n=t.nodes[e];for(const e of r.children){const r=this.gltf.nodes.indexOf(e);n.add(t.nodes[r])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const r=Object(c.c)(this.gltf.skins[0]),n=r.joints.map(e=>t.nodes[e]),i=null===(e=r.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new S.a).fromArray(t));t.skeleton=new C(n,i),t.animationMixer=new P.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu),this.renderer.onResourcesLoaded(this.gltf,t.gfxDevice)}update(t){for(const e of this.avatars){const r=e.state;if(!r||!e.nodes)continue;if(!e.weapon){const r=8+e.id,n=t.world.objects[r];e.weapon=n,Object(c.c)(e.nodes.find(t=>"j_tn_item_r1"===t.name)).add(e.weapon.transform)}const n=new S.c(r.origin);e.position.copy(n),e.lookAt(r.origin[0]+r.orientation[0],r.origin[1]+r.orientation[1],r.origin[2]+r.orientation[2]),e.updateMatrix(),e.updateMatrixWorld()}this.animation.update(t.clock)}updateFixed(t){}render(t){this.renderer.render(t.gfxDevice,t.camera,t.environment.getCurrentEnvironment())}createGameObject(t){const e=t.id;Object(c.b)(e<8);const r=this.avatars[e];return r.state=t,r}deleteGameObject(){}}class rt{constructor(){this.avatars=[],this.controllers=[],this.bots=new G(this,this.avatars),this.animation=new V}initialize(t){t.world.registerFactory(o.a.Avatar,this);for(let e=0;e<8;e++)this.avatars[e]=t.world.createGameObject(o.a.Avatar);for(let e=0;e<8;e++)this.avatars[e].weapon=t.world.createGameObject(o.a.Weapon,{parent:e});t.resources.load("data/Tn.glb","gltf",(e,r)=>{if(e)return console.error("Failed to load resource",e);this.gltf=r,this.onResourcesLoaded(t)}),this.animation.initialize(this.avatars),this.bots.addBot(new H,i.e.set(J,-500,0,500)),this.bots.addBot(new Y,i.e.set(J,-500,0,-500))}onResourcesLoaded(t){var e;for(const t of this.avatars){t.nodes=this.gltf.nodes.map(t=>t.clone(!1));for(let e=0;e<t.nodes.length;e++){const r=this.gltf.nodes[e],n=t.nodes[e];for(const e of r.children){const r=this.gltf.nodes.indexOf(e);n.add(t.nodes[r])}}for(const e of this.gltf.rootNodeIds.slice(0,1))t.add(t.nodes[e]);const r=Object(c.c)(this.gltf.skins[0]),n=r.joints.map(e=>t.nodes[e]),i=null===(e=r.inverseBindMatrices)||void 0===e?void 0:e.map(t=>(new S.a).fromArray(t));t.skeleton=new C(n,i),Object(c.c)(t.nodes.find(t=>"j_tn_item_r1"===t.name)).add(t.weapon.transform),t.animationMixer=new P.b(t)}this.animation.onResourcesLoaded(this.gltf,t.debugMenu)}update(t){}updateFixed(t){var e,r;for(let e=0;e<8;e++){const r=this.avatars[e],n=r.state;if(!r.isActive)continue;const i=r.client.getUserCommand(t.clock.simFrame),s=t.clock.simDt/1e3;this.controllers[e].update(r,this.avatars,t.clock.simFrame,s,i);const a=new S.c(n.origin);r.position.copy(a),r.lookAt(n.origin[0]+n.orientation[0],n.origin[1]+n.orientation[1],n.origin[2]+n.orientation[2]),r.updateMatrix(),r.updateMatrixWorld()}this.animation.update(t.clock);for(let n=0;n<8;n++){const s=this.avatars[n],a=s.state;if(!s.isActive||!s.skeleton)continue;const o=Object(c.c)(s.skeleton.getBoneByName("j_tn_atama1")),u=Object(c.c)(s.skeleton.getBoneByName("j_tn_kosi1")),h=Object(c.c)(s.skeleton.getBoneByName("j_tn_asi_l3")),l=Object(c.c)(s.skeleton.getBoneByName("j_tn_asi_r3"));null===(e=o)||void 0===e||e.getWorldPosition(Q),null===(r=u)||void 0===r||r.getWorldPosition(tt);const f=Q.buffer,d=tt.buffer,p=Math.min(h.matrixWorld.elements[13],l.matrixWorld.elements[13])-10,m=t.staticCollision.groundHeight(d,1e3);p<m&&(a.origin[1]+=m-p);const g=J;if(t.staticCollision.wallCheck({a:f,b:d,radius:60},g)&&i.e.add(a.origin,a.origin,g),K.set(s.matrixWorld.elements),i.b.multiply(s.bounds,K,$),s.collisionId=t.collision.addTargetObb(s.bounds,s),Object(c.e)(s.attack)){const e=t.clock.simFrame-s.state.stateStartFrame,r=s.attack.def.attackPeriod;e>=r[0]&&e<=r[1]&&t.collision.addAttackRegion({verts:s.weapon.attackQuad},s.attack)}}}updateFixedLate({collision:t,clock:e}){for(const r of this.avatars)if(r.isActive&&r.skeleton){const i=t.getHitsForTarget(r.collisionId);if(i.length>0){for(const t of i){const n=t.owner;l(r,n,e)&&r.hitBy.push(n)}r.hitBy.length>0&&r.state.state!==n.Struck&&(r.state.state=n.Struck,r.state.stateStartFrame=e.simFrame)}}}createGameObject(t){const e=new X;e.state=t;const r=this.avatars.length;return this.controllers[r]=new p,this.avatars[r]=e,e}deleteGameObject(){}addAvatar(t){const e=Object(c.c)(this.avatars.findIndex(t=>!t.isActive),"Out of avatars");return this.avatars[e].state.flags|=z.IsActive,this.avatars[e].client=t,e}removeAvatar(t){const e=Object(c.c)(this.avatars.find(e=>e.client===t));e.client=null,e.state.flags&=~z.IsActive}}},function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return o}));var n,i=r(59),s=r(12),a=r(0);!function(t){t.JoinedRoom="joined",t.ClientJoined="clientjoin",t.Message="message",t.RoomMessage="roomMessage"}(n||(n={}));class o extends s.a{constructor(){super(...arguments),this.connected=!1}connect(t=window.config.kSignalServerAddress){return Object(a.b)(!this.connected),new Promise(e=>{this.socket=i.connect(t),this.socket.on("connect",()=>{this.connected=!0,console.debug("SignalSocket: Connected to MoonBeacon with ID:",this.socket.id)}),this.socket.on("roomJoined",t=>{console.debug("SignalSocket: Joined room:",t),this.room=t,e()}),this.socket.on("clientJoined",t=>{console.debug("SignalSocket: Client joined:",t),this.room.clients[t.id]=t,this.fire(n.ClientJoined,t.id)}),this.socket.on("clientLeaving",(t,e)=>{console.debug("SignalSocket: Client left:",t),delete this.room.clients[t]}),this.socket.on("message",t=>{console.debug("SignalSocket: Message received",t),this.fire(n.Message,t.data,t.from)}),this.socket.on("messageRoom",t=>{this.fire(n.RoomMessage,t.data,t.from)})})}send(t,e){const r={from:this.clientId,to:t,data:e};console.debug("SignalSocket: Sending message",r),this.socket.emit("message",r)}broadcast(t){const e={from:this.clientId,data:t};this.socket.emit("messageRoom",e)}requestIceServers(){return new Promise((t,e)=>{this.socket.emit("iceServers",e=>{t({iceServers:e})})})}close(){this.socket.close()}get clients(){return Object.keys(this.room.clients)}get serverId(){return this.room.server}get clientId(){return this.socket.id}}},function(t,e,r){(function(n){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))}),e.splice(i,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=r(66)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,r(36))},function(t,e){e.encode=function(t){var e="";for(var r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e},e.decode=function(t){for(var e={},r=t.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},function(t,e){t.exports=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e,r){(function(n){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))}),e.splice(i,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=r(86)(e);const{formatters:i}=t.exports;i.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,r(36))},function(t,e,r){"use strict";function n(){}r.d(e,"a",(function(){return n})),Object.assign(n.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}})},function(t,e){var r,n,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var c,u=[],h=!1,l=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var t=o(f);h=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new p(t,e)),1!==u.length||h||o(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){var n=r(68)("socket.io-parser"),i=r(25),s=r(71),a=r(47),o=r(48);function c(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=c,e.Decoder=l;var u=e.ERROR+'"encode error"';function h(t){var r=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return u;r+=i}return n("encoded %j as %s",t,r),r}function l(){this.reconstructor=null}function f(t){this.reconPack=t,this.buffers=[]}function d(t){return{type:e.ERROR,data:"parser error: "+t}}c.prototype.encode=function(t,r){(n("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)?function(t,e){s.removeBlobs(t,(function(t){var r=s.deconstructPacket(t),n=h(r.packet),i=r.buffers;i.unshift(n),e(i)}))}(t,r):r([h(t)])},i(l.prototype),l.prototype.add=function(t){var r;if("string"==typeof t)r=function(t){var r=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return d("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var s="";"-"!==t.charAt(++r)&&(s+=t.charAt(r),r!=t.length););if(s!=Number(s)||"-"!==t.charAt(r))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(r+1))for(i.nsp="";++r;){if(","===(c=t.charAt(r)))break;if(i.nsp+=c,r===t.length)break}else i.nsp="/";var o=t.charAt(r+1);if(""!==o&&Number(o)==o){for(i.id="";++r;){var c;if(null==(c=t.charAt(r))||Number(c)!=c){--r;break}if(i.id+=t.charAt(r),r===t.length)break}i.id=Number(i.id)}if(t.charAt(++r)){var u=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(r));if(!(!1!==u&&(i.type===e.ERROR||a(u))))return d("invalid payload");i.data=u}return n("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?(this.reconstructor=new f(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!o(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(72),i=r(73),s=r(74);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,r){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return u(this,t,e,r)}function u(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,r),i=(t=o(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(c.isBuffer(e)){var r=0|d(e.length);return 0===(t=o(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?o(t,0):f(t,e);if("Buffer"===e.type&&s(e.data))return f(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(h(e),t=o(t,e<0?0:0|d(e)),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function f(t,e){var r=e.length<0?0:0|d(e.length);t=o(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return F(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return k(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function b(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:y(t,e,r,n,i);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):y(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(t,e,r,n,i){var s,a=1,o=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,o/=2,c/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(t,s)===u(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*a}else-1!==h&&(s-=s-h),h=-1}else for(r+c>o&&(r=o-c),s=r;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(t,s+f)!==u(e,f)){l=!1;break}if(l)return s}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(e.substr(2*a,2),16);if(isNaN(o))return a;t[r+a]=o}return a}function x(t,e,r,n){return z(N(e,t.length-r),t,r,n)}function w(t,e,r,n){return z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return w(t,e,r,n)}function M(t,e,r,n){return z(V(e),t,r,n)}function C(t,e,r,n){return z(function(t,e){for(var r,n,i,s=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function A(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,a,o,c,u=t[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=r)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=t[i+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=t[i+1],a=t[i+2],128==(192&s)&&128==(192&a)&&(c=(15&u)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=t[i+1],a=t[i+2],o=t[i+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(c=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}e.Buffer=c,e.SlowBuffer=function(t){+t!=t&&(t=0);return c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,r){return u(null,t,e,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,r){return function(t,e,r,n){return h(e),e<=0?o(t,e):void 0!==r?"string"==typeof n?o(t,e).fill(r,n):o(t,e).fill(r):o(t,e)}(null,t,e,r)},c.allocUnsafe=function(t){return l(null,t)},c.allocUnsafeSlow=function(t){return l(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=c.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?S(this,0,t):m.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,r,n,i){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),o=Math.min(s,a),u=this.slice(n,i),h=t.slice(e,r),l=0;l<o;++l)if(u[l]!==h[l]){s=u[l],a=h[l];break}return s<a?-1:a<s?1:0},c.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},c.prototype.indexOf=function(t,e,r){return b(this,t,e,r,!0)},c.prototype.lastIndexOf=function(t,e,r){return b(this,t,e,r,!1)},c.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return v(this,t,e,r);case"utf8":case"utf-8":return x(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return M(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function k(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function F(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=L(t[s]);return i}function O(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function E(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,r,n,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function B(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-r,2);i<s;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function R(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-r,4);i<s;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function I(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function P(t,e,r,n,s){return s||I(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function U(t,e,r,n,s){return s||I(t,0,r,8),i.write(t,e,r,n,52,8),r+8}c.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=c.prototype;else{var i=e-t;r=new c(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+t]}return r},c.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},c.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},c.prototype.readUInt8=function(t,e){return e||E(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||E(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||E(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||E(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||E(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},c.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||E(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return e||E(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||E(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(t,e){e||E(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(t,e){return e||E(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||E(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||E(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||E(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},c.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},c.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var s=0,a=1,o=0;for(this[e]=255&t;++s<r&&(a*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+r},c.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);j(this,t,e,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[e+s]=255&t;--s>=0&&(a*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+r},c.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,r){return P(this,t,e,!0,r)},c.prototype.writeFloatBE=function(t,e,r){return P(this,t,e,!1,r)},c.prototype.writeDoubleLE=function(t,e,r){return U(this,t,e,!0,r)},c.prototype.writeDoubleBE=function(t,e,r){return U(this,t,e,!1,r)},c.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,s=n-r;if(this===t&&r<e&&e<n)for(i=s-1;i>=0;--i)t[i+e]=this[i+r];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+s),e);return s},c.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var s;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(s=e;s<r;++s)this[s]=t;else{var a=c.isBuffer(t)?t:N(new c(t,n).toString()),o=a.length;for(s=0;s<r-e;++s)this[s+e]=a[s%o]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function L(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function V(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(D,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(49))},function(t,e,r){var n=r(77);t.exports=function(t){var e=t.xdomain,r=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||n))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(t){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},function(t,e,r){var n=r(26),i=r(25);function s(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=s,i(s.prototype),s.prototype.onError=function(t,e){var r=new Error(t);return r.type="TransportError",r.description=e,this.emit("error",r),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)},s.prototype.onPacket=function(t){this.emit("packet",t)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0);class i{constructor(){this._add=[],this._addColor=[],this._folders={}}add(t,e,r,n,i){const s={args:arguments};return this._add.push(s),{onChange:t=>{s.onChange=t}}}addColor(t,e){const r={args:arguments};return this._addColor.push(r),{onChange:t=>{r.onChange=t}}}addFolder(t){return this._folders[t]=new i,this._folders[t]}async show(){var t;if(!Object(n.e)(this._guiPromise)){if(void 0===this._gui){this._guiPromise=r.e(2).then(r.bind(null,105));const t=await this._guiPromise;this._gui=new t.GUI({load:this._saveObject})}(null===(t=this._saveObject)||void 0===t?void 0:t.closed)&&this._gui.close();for(const t of this._add){this._gui.getRoot().remember(t.args[0]);const e=this._gui.add.apply(this._gui,t.args);t.onChange&&(e.onChange(t.onChange),t.onChange(e.object[e.property]))}for(const t of this._addColor){this._gui.getRoot().remember(t.args[0]);const e=this._gui.addColor.apply(this._gui,t.args);t.onChange&&(e.onChange(t.onChange),t.onChange(e.object[e.property]))}for(const t in this._folders)this._folders[t]._gui=this._gui.addFolder(t),this._folders[t].show();this.add=this._gui.add.bind(this._gui),this.addFolder=this._gui.addFolder.bind(this._gui),this.show=this._gui.show.bind(this._gui),this.hide=this._gui.hide.bind(this._gui)}}hide(){}update(){if(this._gui&&!this._gui.closed){for(var t in this._gui.__controllers)this._gui.__controllers[t].updateDisplay();for(const t in this._gui.__folders){const e=this._gui.__folders[t];for(const t of e.__controllers)t.updateDisplay()}}}toJSON(){return this._gui?this._gui.getSaveObject():void 0}fromJSON(t){Object(n.b)(!Object(n.e)(this._gui),"State must be loaded before the DebugMenu is shown"),this._saveObject=t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r(0),i=r(5);class s{constructor(){this.renderTime=0,this.serverTime=0,this.clientTime=0,this.simFrame=0,this.realDt=0,this.renderDt=0,this.simDt=16,this.realTime=0,this.clientDelay=0,this.renderDelay=0,this.paused=!1,this.speed=1,this.stepDt=0}initialize({debugMenu:t}){var e;(null===(e=window.client)||void 0===e?void 0:e.debugMenu)===t&&(t.add(this,"paused").onChange(()=>{window.server&&(window.server.clock.paused=this.paused)}),t.add(this,"speed",.05,2,.05).onChange(()=>{window.server&&(window.server.clock.speed=this.speed)}),t.add(this,"step").onChange(()=>{window.server&&window.server.clock.step()})),this.zero()}zero(){this.serverTime=0,this.clientTime=0,this.renderTime=0,this.simFrame=0}syncToServerTime(t){this.tick();const e=t-this.serverTime;return this.serverTime=t,e}setClientDelay(t){Object(n.b)(t<=0,"ClientDelay is expected to be negative"),this.clientDelay=t}setRenderDelay(t){Object(n.b)(t>=0,"RenderDelay is expected to be positive"),this.renderDelay=t}tick(){const t=performance.now();this.realDt=t-this.realTime,this.realTime=t,this.realDt*=this.speed,this.paused&&(this.realDt=this.stepDt),this.serverTime+=this.realDt;const e=this.serverTime-this.clientDelay,r=e-this.clientTime;if(r>250){this.clientTime=e;const t=this.clientTime/this.simDt;this.simFrame=Math.floor(t)}else{const t=.95*this.realDt,e=1.05*this.realDt,n=Object(i.c)(r,t,e);this.clientTime+=n}const n=this.serverTime-this.renderDelay,s=n-this.renderTime;if(s>250)this.renderTime=n;else{const t=.75*this.realDt,e=1.25*this.realDt;this.renderDt=Object(i.c)(s,t,e),this.renderTime+=this.renderDt}this.stepDt=0}updateFixed(){const t=this.clientTime-this.simDt*this.simFrame>=this.simDt;return t&&(this.simFrame+=1),t}getCurrentServerTime(){const t=performance.now()-this.realTime;return this.serverTime+t}step(t=this.simDt){this.paused=!0,this.stepDt=t}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return u}));var n=r(23),i=r(17),s=r(0),a=r(18),o=r(5);class c{constructor(){this.graph=new a.c,this.clientAhead=125,this.renderDelay=125,this.averageServerFrameDiff=0,this.averageClientFrameDiff=0,this.renderDelayTimestamp=0,this.showStats=!1,this.showGraph=!1}initialize(t){this.context=t;const e=this.context.clock;this.client=new i.a(t.clock),this.client.setSimStream(t.world.stream);const r=this.context.debugMenu.addFolder("Net");r.add(this,"clientAhead",0,1e3,16).onChange(()=>e.setClientDelay(-this.clientAhead)),r.add(this,"renderDelay",0,1e3,16).onChange(()=>e.setRenderDelay(this.renderDelay)),r.add(this,"showStats").onChange(t=>this.client.stats.setEnabled(t)),r.add(this,"showGraph").onChange(t=>this.graph.setEnabled(t)),this.context.toplevel.appendChild(this.graph.dom),this.context.toplevel.appendChild(this.client.stats.dom)}terminate(){this.client.close()}onConnect(t){this.context.clock.setClientDelay(-this.clientAhead),this.context.clock.setRenderDelay(this.renderDelay),this.client.on(i.b.ServerTimeAdjust,this.onServerTimeAdjust.bind(this)),this.client.on(i.b.ReceiveServerFrame,this.onServerFrame.bind(this)),this.client.on(i.b.Activated,this.onJoined.bind(this)),this.client.connect(t),this.client.on(i.b.Connected,()=>{this.graph&&this.client.setNetGraphPanel(this.graph.addPanel(`Client: ${this.client.id}`))})}onJoined(){this.context.avatar.onJoined(this.client.clientIndex)}onServerFrame(t,e){this.context.world.addState(e),this.averageServerFrameDiff=Object(o.f)(t,this.averageServerFrameDiff,.95);const r=(1.5-this.averageServerFrameDiff)*this.context.clock.simDt;this.clientAhead=Object(o.c)(this.clientAhead+.01*r,0,250),this.context.clock.setClientDelay(-this.clientAhead);const n=1*this.context.clock.simDt,i=e.frame-this.client.lastRequestedFrame;if(this.averageClientFrameDiff=Object(o.f)(i,this.averageClientFrameDiff,.9),i<0){const t=(3-i)*this.context.clock.simDt;this.renderDelay=Object(o.c)(this.renderDelay+t,0,250),this.context.clock.setRenderDelay(this.renderDelay),this.renderDelayTimestamp=performance.now(),this.averageClientFrameDiff=3}if(performance.now()-this.renderDelayTimestamp>3e3){const t=(3-this.averageClientFrameDiff)*this.context.clock.simDt;Math.abs(t)>n&&(this.renderDelay=Object(o.c)(this.renderDelay+t,0,250),console.debug(`Adjusting renderTime by ${t} ms`),this.context.clock.setRenderDelay(this.renderDelay),this.averageClientFrameDiff=3),this.renderDelayTimestamp=performance.now()}}onServerTimeAdjust(t){const e=this.context.clock.syncToServerTime(t);console.debug(`Adjusting serverTime by ${e.toFixed(2)} ms`)}onVisibility(t){if(this.client.state===i.c.Active)if(this.client.transmitVisibilityChange(!t),this.client.transmitReliable(0),t){const t=16;let e=1;this.transmitInterval=window.setInterval(()=>{this.client.transmitReliable(e++)&&(clearInterval(this.transmitInterval),this.transmitInterval)},t)}else Object(s.e)(this.transmitInterval)&&(window.clearInterval(this.transmitInterval),this.transmitInterval=void 0)}update({}){this.client.stats.update(),this.updateNetGraph()}updateNetGraph(){var t;const e=this.context.clock;null===(t=this.client.graphPanel)||void 0===t||t.update(this.client.ping,e.serverTime,e.renderTime,e.clientTime),window.server&&window.server.net.updateNetGraph()}}class u{constructor(){this.clients=[]}initialize(t){var e;this.context=t,this.graph=null===(e=window.client)||void 0===e?void 0:e.net.graph}terminate(){this.signalSocket&&this.signalSocket.close();for(const t of this.clients)t&&t.close()}async onConnect(t){this.signalSocket=t;const e=new n.c(t);await e.listen(async t=>{const e=new i.a(this.context.clock);e.setSimStream(this.context.world.stream),e.on(i.b.Connected,this.onClientConnected.bind(this,e)),e.on(i.b.Disconnected,this.onClientDisconnected.bind(this,e)),e.accept(t);let r=this.clients.indexOf(null);r<0&&(r=this.clients.length),this.clients[r]=e})}onClientConnected(t){console.log("Client connected:",t);const e=this.context.avatar.addAvatar(t);t.clientIndex=e,t.transmitConnectionInfo(e),this.graph&&t.setNetGraphPanel(this.graph.addPanel(`Server: ${t.id}`))}onClientDisconnected(t){var e;console.log("Client disconnected:",t),this.context.avatar.removeAvatar(t);const r=this.clients.indexOf(t);this.clients[r]=null,t.graphPanel&&(null===(e=this.graph)||void 0===e||e.removePanel(t.graphPanel))}transmitToClients(t){for(const e of this.clients)e&&e.transmitServerFrame(t)}updateNetGraph(){var t;if(this.graph)for(const e of this.clients){const r=window.client.clock.serverTime;e&&(null===(t=e.graphPanel)||void 0===t||t.update(e.ping,r,void 0,this.context.clock.getCurrentServerTime()))}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return v}));var n=r(11),i=r(7),s=r(0),a=r(1),o=r(2),c=r(8),u=r(9),h=r(29),l=r(10);const f=o.b.create();o.e.create(),o.e.create();var d,p;!function(t){t[t.None=0]="None",t[t.Sword=1]="Sword"}(d||(d={})),function(t){t[t.IsActive=1]="IsActive"}(p||(p={}));class m{constructor(t,e,r){this.transform=new u.b,this.attackQuad=[o.e.create(),o.e.create(),o.e.create(),o.e.create()],this.state=r,this.type=t}get isActive(){return this.state.flags&p.IsActive}}class g{}class b extends g{loadResources(){}create(){throw new Error("Attempted to create an empty weapon")}}class y extends g{constructor(){super(),this.matTextures={},this.ready=!1,this.attackObb=o.b.fromValues(20,0,0,0,0,5,0,0,0,0,90,0,0,0,110,1),this.attackLine=[o.e.fromValues(22,0,20),o.e.fromValues(18,0,200)]}loadResources(t,e){e&&(this.readyPromise=new Promise(r=>{t.load(y.kFilename,"gltf",(t,n)=>{if(t)return console.error("Failed to load resource",t);this.onResourcesLoaded(Object(s.c)(n),e),this.ready=!0,r()})}))}create(t,e){const r=new m(d.Sword,this.attackObb,t);return e&&this.readyPromise.then(()=>{const t=new n.a(e,name,this.shader,this.resourceLayout),s=new n.b(e,c.a.opaque,this.mesh,t);s.updateWorldMatrix(!0,!1),r.transform.add(s),Object.keys(this.matTextures).forEach(r=>t.setTexture(e,r,this.matTextures[r])),t.setUniformBuffer(e,"material",this.matUniformBuf);const a=this.resourceLayout.model.layout,o=new i.a("SwordModelUniforms",e,a);t.setUniformBuffer(e,"model",o),r.model=s}),r}onResourcesLoaded(t,e){const r=t,n=r.meshes[0].primitives[0],o=r.materials[n.materialIndex],c=Object(s.c)(o.technique);this.shader=c.shaderId,this.mesh=n.mesh,this.meshNode=Object(s.c)(r.nodes.find(t=>0===t.meshId));const u=["u_model","u_modelViewProjection"],h={},l={},f=[];for(const t of Object.keys(c.uniforms)){const e=c.uniforms[t];u.includes(t)?l[t]=e:e.type===a.n.Texture2D?f.push(t):h[t]=e}const d=Object(i.b)(h),p=Object(i.b)(l),m={model:{index:0,type:a.a.UniformBuffer,layout:p},material:{index:1,type:a.a.UniformBuffer,layout:d}};for(let t=0;t<f.length;t++){m[f[t]]={index:t,type:a.a.Texture}}this.resourceLayout=m,this.matUniformBuf=new i.a(o.name,e,d);const g=Object(s.c)(o.values);for(const t of Object.keys(h).concat(f)){const e=c.uniforms[t],n=Object(s.c)(Object(s.d)(g[t],e.value),`Expected material uniform '${t}' to have a value in the material or technique`);if(e.type===a.n.Texture2D){const e=r.textures[n.index].id;this.matTextures[t]=e}else e.type===a.n.Float?this.matUniformBuf.setFloat(t,n):this.matUniformBuf.setFloats(t,n)}this.matUniformBuf.write(e)}}y.kFilename="data/Tkwn.glb";class v{constructor(t){this.weapons=[],t.registerFactory(l.a.Weapon,this),this.blueprints={[d.None]:new b,[d.Sword]:new y}}initialize({resources:t,gfxDevice:e}){this.gfxDevice=e,this.blueprints[d.Sword].loadResources(t,e)}createGameObject(t){const e=this.blueprints[d.Sword].create(t,this.gfxDevice);return this.weapons.push(e),e}deleteGameObject(){}updateFixed({world:t,collision:e}){for(const e in this.weapons){const r=this.weapons[e],n=this.blueprints[r.type],i=t.objects.find(t=>t.state.id===r.state.parent);r.state.flags=i.state.flags&h.a.IsActive,r.isActive&&(o.e.copy(r.attackQuad[2],r.attackQuad[0]),o.e.copy(r.attackQuad[3],r.attackQuad[1]),f.set(r.transform.matrixWorld.elements),o.e.transformMat4(r.attackQuad[0],n.attackLine[0],f),o.e.transformMat4(r.attackQuad[1],n.attackLine[1],f))}}render({gfxDevice:t,camera:e,environment:r},n=!1){if(this.blueprints[d.Sword].ready){const e=r.getCurrentEnvironment(),n=this.blueprints[d.Sword].matUniformBuf;n.setVec4("u_Color0",e.actorColor.ambient),n.setVec4("u_KonstColor0",e.actorColor.diffuse),n.setFloats("u_LightTransforms",[1,0,0,0,0,1,0,0,0,0,1,0,e.baseLight.position[0],e.baseLight.position[1],e.baseLight.position[2],1]),n.write(t)}for(const r of this.weapons){if(!r.isActive)continue;const n=r.model;if(Object(s.e)(n)){r.transform.updateWorldMatrix(!1,!0);const i=new Float32Array(n.matrixWorld.elements),s=n.material.getUniformBuffer("model");s.setMat4("u_model",i),s.setMat4("u_modelViewProjection",o.b.multiply(o.b.create(),e.viewProjMatrix,i)),s.write(t),n.renderList.push(n.primitive)}}}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return L}));var n,i=r(60),s=r.n(i);!function(t){t[t.LoadingAsync=0]="LoadingAsync",t[t.LoadingSync=1]="LoadingSync",t[t.Loaded=2]="Loaded",t[t.Unloaded=3]="Unloaded",t[t.Failed=4]="Failed"}(n||(n={}));var a=r(1),o=r(0);var c=r(2),u=r(16),h=r(9);const l=1313821514,f=5130562;let d=new TextDecoder;function p(t){return d.decode(t)}class m{constructor(t){const e=new DataView(t,0,12),r=new DataView(t,12),n=p(new Uint8Array(t,0,4)),i=e.getUint32(4,!0);e.getUint32(8,!0);if("glTF"!==n)throw new Error("Unsupported glTF-Binary header.");if(i<2)throw new Error("Unsupported legacy binary file detected.");let s=0;for(;s<r.byteLength;){const e=r.getUint32(s,!0);s+=4;const n=r.getUint32(s,!0);switch(s+=4,n){case l:{const r=new Uint8Array(t,12+s,e);this.json=p(r)}break;case f:{const r=12+s;this.binaryChunk=new Uint8Array(t,r,e)}break;default:console.warn("Skipping unexpected glTF-Binary chunk type:",n)}s+=e}Object(o.b)(!!this.json,"glTF-Binary: JSON content not found.")}}class g{constructor(t,e){this.gltf=t,this.bufferData=e}bufferViewData(t){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const e=this.gltf.bufferViews[t],r=Object(o.c)(this.bufferData[e.buffer],`No data for buffer ${e.buffer}`),n=e.byteLength||0,i=e.byteOffset||0,s=r.buffer,a=r.byteOffset;return new Uint8Array(s,a+i,n)}accessorData(t){if(!this.gltf.accessors)throw new Error("No accessors views found.");const e=this.gltf.accessors[t],r=A[e.type];let n;const i=C[e.componentType],s=i.BYTES_PER_ELEMENT*r*e.count;if(void 0!==e.bufferView){const t=this.bufferViewData(e.bufferView);n=new i(t.buffer,t.byteOffset+Object(o.d)(e.byteOffset,0),e.count*r)}else n=new i(s);if(e.sparse){const{count:t,indices:i,values:s}=e.sparse;let a=C[i.componentType],o=this.bufferViewData(i.bufferView);const c=new a(o.buffer,o.byteOffset+(i.byteOffset||0),t);a=C[e.componentType],o=this.bufferViewData(s.bufferView);const u=new a(this.bufferViewData(s.bufferView).buffer,o.byteOffset+(s.byteOffset||0),t*r);e.bufferView&&(n=new Uint8Array(n));const h=new C[e.componentType](n.buffer);for(let e=0;e<t;e++)for(let t=0;t<r;t++)h[r*c[e]+t]=u[r*e+t]}return n}}class b extends h.b{clone(t=!1){const e=super.clone(t);return e.morphWeight=this.morphWeight,e.meshId=this.meshId,e.skinId=this.skinId,e}}function y(t,e){let r;switch(e){case 5120:r=a.n.Char;break;case 5121:r=a.n.Uchar;break;case 5122:r=a.n.Short;break;case 5123:r=a.n.Ushort;break;case 5125:r=a.n.Uint;break;case 5126:r=a.n.Float;break;default:throw new Error("Invalid GLTF component type")}switch(t){case"SCALAR":r+=0;break;case"VEC2":r+=1;break;case"VEC3":r+=2;break;case"VEC4":r+=3;break;case"MAT2":throw new Error("2x2 Matrice not yet supported");case"MAT3":r=a.n.Float3x3;break;case"MAT4":r=a.n.Float4x4}return r}function v(t){switch(t){case 5124:return a.n.Int;case 5126:return a.n.Float;case 35664:return a.n.Float2;case 35665:return a.n.Float3;case 35666:return a.n.Float4;case 35667:return a.n.Int2;case 35668:return a.n.Int3;case 35669:return a.n.Int4;case 35675:return a.n.Float3x3;case 35676:return a.n.Float4x4;case 35678:return a.n.Texture2D;default:throw new Error("Invalid GLTF component type")}}function x(t){switch(t){case 0:return a.g.Points;case 1:return a.g.Lines;case 2:return a.g.LineLoop;case 3:return a.g.LineStrip;case 4:return a.g.Triangles;case 5:return a.g.TriangleStrip;case 6:return a.g.TriangleFan;default:throw new Error("Invalid GLTF primitive mode")}}const w={9728:a.j.Nearest,9729:a.j.Linear},_={9728:a.j.Nearest,9729:a.j.Linear},M={33071:a.l.Clamp,10497:a.l.Repeat},C={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S={POSITION:"a_pos",NORMAL:"a_normal",TANGENT:"a_tangent",JOINTS_0:"a_joints",WEIGHTS_0:"a_weights",COLOR_0:"a_color",TEXCOORD_0:"a_uv0",TEXCOORD_1:"a_uv1",MORPH0_POSITION:"a_posMorph0"},T={NORMAL:"HAS_NORMALS 1",TANGENT:"HAS_TANGENT 1",JOINTS_0:"HAS_JOINT_SET0 1",WEIGHTS_0:"HAS_WEIGHT_SET0 1",COLOR_0:"HAS_COLOR0 1",TEXCOORD_0:"HAS_UV_SET0 1",TEXCOORD_1:"HAS_UV_SET1 1"},k={CUBICSPLINE:void 0,LINEAR:u.e,STEP:u.d},F={translation:"position",rotation:"quaternion",scale:"scale",weights:"_UNSUPPORTED"};function O(t,e,r){const n=r,i=e.gltf;let s=Object(o.e)(r.material)?Object(o.c)(t.transient.materials[r.material]):void 0;const c=[];let u=void 0;const h=[];if(Object(o.e)(n.indices)){const r=Object(o.c)(i.accessors)[n.indices];u=E(t,e,Object(o.c)(r.bufferView),a.c.Index)}let l;if(s&&Object(o.e)(s.techniqueIndex)){l={};const e=Object(o.c)(t.transient.techniques).techniques[s.techniqueIndex],r=Object.keys(e.attributes);for(const t of r){l[e.attributes[t].semantic]=t}}else l=S;const f={buffers:[]},d={};for(let r in n.attributes){const s=Object(o.c)(i.accessors)[n.attributes[r]],u=Object(o.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),p=d[u];let m;if(Object(o.e)(p))m=f.buffers[p];else{d[u]=h.length;const r=E(t,e,u,a.c.Vertex),n=Object(o.c)(i.bufferViews)[u];m={stride:Object(o.d)(n.byteStride,0),layout:{}},h.push(r),f.buffers.push(m)}const g=T[r];Object(o.e)(g)&&c.push(g);const b=Object(o.c)(l[r],`Unknown vertex attribute semantic: ${r}`);m.layout[b]={type:y(s.type,s.componentType),offset:s.byteOffset||0}}if(n.targets){c.push("HAS_MORPH0 1"),Object(o.b)(1===n.targets.length,"Only 1 morph target is currently supported");const r=n.targets[0];for(let n in r)if("POSITION"===n){const s=Object(o.c)(i.accessors)[r[n]],c=Object(o.c)(s.bufferView,"Undefined accessor buffers are not yet implemented"),u=Object(o.c)(i.bufferViews)[c];let d=f.buffers[c];const p=E(t,e,c,a.c.Vertex);Object(o.e)(d)||(h[c]=p,d=f.buffers[c]={stride:Object(o.d)(u.byteStride,0),layout:{}});const m=l[`MORPH0_${n}`];d.layout[m]={type:y(s.type,s.componentType),offset:s.byteOffset||0}}}const p=i.accessors[Object(o.c)(n.indices,"Only indexed primitives are currently supported")],m=Object(o.c)(u,"Only indexed primitives are currently supported");return{mesh:{elementCount:p.count,vertexBuffers:h,primitiveType:x(Object(o.d)(n.mode,4)),indexType:y(p.type,p.componentType),indexBuffer:m,vertexLayout:f},materialIndex:r.material}}function E(t,e,r,n){if(Object(o.e)(t.bufferViews[r]))return t.bufferViews[r];const i=Object(o.c)(e.gltf.bufferViews)[r].name||`buffer${r}`;t.bufferData[r]=new Uint8Array(e.bufferViewData(r)).buffer,Object(o.b)(!t.transferList.includes(t.bufferData[r])),t.transferList.push(t.bufferData[r]);const s={name:i,type:n,buffer:-1};return t.bufferViews[r]=s,s}function j(t,e){return Object(o.d)(e.gltf.materials,[]).map((t,e)=>{var r;const n=null===(r=t.extensions)||void 0===r?void 0:r.KHR_techniques_webgl,i=n?n.technique:void 0,s=n?n.values:void 0;return{name:Object(o.d)(t.name,`Material${e}`),renderFormat:{blendingEnabled:!1},cullMode:t.doubleSided?a.e.None:a.e.Back,techniqueIndex:i,values:s}})}function B(t,e){var r;if(!(null===(r=e.gltf.extensionsUsed)||void 0===r?void 0:r.includes("KHR_techniques_webgl")))return;const n=Object(o.c)(e.gltf.extensions.KHR_techniques_webgl);return{shaderData:n.shaders.map((r,n)=>{const i=Object(o.c)(r.bufferView,"Shader loading from URI not yet supported"),s=new Uint8Array(e.bufferViewData(i)).buffer;return Object(o.b)(!t.transferList.includes(s)),t.transferList.push(s),s}),shaders:n.programs.map(t=>({name:t.name,fsIndex:t.fragmentShader,vsIndex:t.vertexShader})),techniques:n.techniques.map((t,e)=>{const r={};for(const e in Object(o.d)(t.uniforms,{})){const n=t.uniforms[e];r[e]=Object.assign(Object.assign({},n),{type:v(n.type)})}return{shaderIndex:t.program,attributes:Object(o.d)(t.attributes,{}),uniforms:r}})}}function R(t,e){return Object(o.d)(e.gltf.nodes,[]).map(t=>{const r=Object(o.d)(t.scale,[1,1,1]),n=Object(o.d)(t.rotation,[0,0,0,1]),i=Object(o.d)(t.translation,[0,0,0]),s={name:t.name,scale:c.e.fromValues(r[0],r[1],r[2]),rotation:c.c.fromValues(n[0],n[1],n[2],n[3]),translation:c.e.fromValues(i[0],i[1],i[2]),morphWeight:Object(o.d)(t.weights,[0])[0],transform:c.b.create(),meshId:Object(o.e)(t.mesh)?t.mesh:void 0,skinId:Object(o.e)(t.skin)?t.skin:void 0,children:[]};if(Object(o.e)(t.matrix)?(s.transform.set(t.matrix),c.b.getRotation(s.rotation,s.transform),c.b.getTranslation(s.translation,s.transform),c.b.getScaling(s.scale,s.transform)):s.transform=c.b.fromRotationTranslationScale(c.b.create(),s.rotation,s.translation,s.scale),Object(o.e)(t.children))for(let r=0;r<t.children.length;r++){const n=t.children[r];Object(o.c)(e.gltf.nodes)[n];s.children.push(n)}return s})}async function I(t,e){const r=Object(o.d)(e.gltf.images,[]),n=Object(o.d)(e.gltf.textures,[]),i=Object(o.d)(e.gltf.samplers,[]),s={type:a.k.Texture2D,format:a.i.U8x4,usage:a.o.Static},c={wrapS:10497,wrapT:10497},u=r.map(r=>{const n=Object(o.c)(r.bufferView,"Image loading from a URI is not yet supported"),i=e.bufferViewData(n);let s;if(Object(o.e)(self.createImageBitmap)){const t=new Blob([i],{type:Object(o.c)(r.mimeType)});s=createImageBitmap(t)}else s=Promise.resolve(new Uint8Array(i).buffer);return s.then(e=>(Object(o.b)(!t.transferList.includes(e)),t.transferList.push(e),e))}),h=n.map(t=>{const e=Object(o.d)(i[t.sampler],c),r=Object.assign({},s);return Object(o.e)(e.magFilter)&&(r.defaultMagFilter=w[e.magFilter],Object(o.e)(r.defaultMagFilter)||console.warn(`Unsupported texture mag filter: ${e.magFilter}`)),Object(o.e)(e.minFilter)&&(r.defaultMagFilter=_[e.minFilter],Object(o.e)(r.defaultMagFilter)||console.warn(`Unsupported texture min filter: ${e.magFilter}`)),Object(o.e)(e.wrapS)&&(r.defaultWrapS=M[e.wrapS],Object(o.e)(r.defaultWrapS)||console.warn(`Unsupported texture wrap mode: ${e.wrapS}`)),Object(o.e)(e.wrapT)&&(r.defaultWrapT=M[e.wrapT],Object(o.e)(r.defaultWrapT)||console.warn(`Unsupported texture wrap mode: ${e.wrapS}`)),{name:t.name,desc:r,imageIndex:Object(o.c)(t.source)}});return{imageData:await Promise.all(u),textures:h}}function P(t,e){let r=[];for(const n of Object(o.d)(e.gltf.animations,[])){const i=n.samplers.map(r=>{Object(o.b)(5126===e.gltf.accessors[r.input].componentType,"Non-float animation time type unsupported"),Object(o.b)(5126===e.gltf.accessors[r.output].componentType,"Non-float animation values type unsupported");const n=new Float32Array(e.accessorData(r.input)),i=new Float32Array(e.accessorData(r.output));return t.transferList.push(n.buffer,i.buffer),{times:n,values:i}}),s=[];for(const t of n.channels){const e=t.target.node;if(!Object(o.e)(e))continue;const r=F[t.target.path],a=i[t.sampler],c=Object(o.d)(n.samplers[t.sampler].interpolation,"LINEAR");s.push({targetNodeId:e,targetProperty:r,times:a.times,values:a.values,interpolation:c})}r.push({name:n.name,maxTime:n.maxTime,tracks:s})}return r}class U extends u.c{copySampleValue_(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n*3+n,s=0;s!==n;s++)e[s]=r[i+s];return e}beforeStart_(t){this.copySampleValue_(t)}afterEnd_(t){this.copySampleValue_(t)}interpolate_(t,e,r,n){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=2*a,c=3*a,u=n-e,h=(r-e)/u,l=h*h,f=l*h,d=t*c,p=d-c,m=-2*f+3*l,g=f-l,b=1-m,y=g-l+h;for(let t=0;t!==a;t++){const e=s[p+t+a],r=s[p+t+o]*u,n=s[d+t+a],c=s[d+t]*u;i[t]=b*e+y*r+m*n+g*c}return i}}const D={texture:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download image");const r=t.source.uri.match(/.*\/(.+?)\./);t.name=r&&r.length>1?r[1]:"Unknown",self.createImageBitmap?(t.imageBitmap=await createImageBitmap(await e.blob()),t.transferList.push(t.imageBitmap),t.status=n.LoadingSync):(t.imageBuffer=await e.arrayBuffer(),t.transferList.push(t.imageBuffer),t.status=n.LoadingSync)}loadSync(t,e){if(e.imageBitmap)e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:a.o.Static,type:a.k.Texture2D,format:a.i.U8x4,maxAnistropy:16},e.imageBitmap):-1,e.imageBitmap.close(),delete e.imageBitmap,e.status=n.Loaded;else{if(e.imageBuffer){var r=new Blob([e.imageBuffer],{type:"image/jpeg"});let t=window.URL.createObjectURL(r);delete e.imageBuffer,e.imageElement=new Image,e.imageElement.src=t,e.status=n.LoadingSync}Object(o.e)(e.imageElement)&&e.imageElement.complete&&(e.texture=t.renderer?t.renderer.createTexture(e.name,{usage:a.o.Static,type:a.k.Texture2D,format:a.i.U8x4,maxAnistropy:16},e.imageElement):-1,delete e.imageElement,e.status=n.Loaded)}}unloadSync(t,e){Object(o.e)(e.texture)&&t.renderer&&t.renderer.removeTexture(e.texture),Object(o.e)(e.imageBitmap)&&e.imageBitmap.close()}},gltf:new class{async loadAsync(t){const e=await fetch(t.source.uri);if(200!=e.status)throw new Error("Failed to download GLTF");const r=await e.arrayBuffer(),i=new m(r),s=JSON.parse(i.json),a=new g(s,[i.binaryChunk]);t.nodes=[],t.meshes=[],t.materials=[],t.textures=[],t.bufferViews=[],t.animations=[],t.rootNodeIds=[],t.bufferData=[],t.transient={techniques:B(t,a),materials:j(0,a),nodes:R(0,a),animation:P(t,a),textures:await I(t,a)},function(t,e){const r=Object(o.d)(e.gltf.meshes,[]);t.meshes=[];for(let n=0;n<r.length;n++){const i=Object(o.c)(r[n]),s=[];for(let r of i.primitives)s.push(O(t,e,r));const a={name:i.name,id:n,primitives:s};t.meshes[n]=a}}(t,a),function(t,e){const r=Object(o.d)(e.gltf.skins,[]);t.skins=[];for(let n=0;n<r.length;n++){const i=r[n];let s=void 0;if(Object(o.e)(i.inverseBindMatrices)){const r=new Float32Array(e.accessorData(i.inverseBindMatrices));Object(o.b)(!t.transferList.includes(r.buffer)),t.transferList.push(r.buffer),s=[];for(let t=0;t<i.joints.length;t++)s[t]=r.subarray(16*t,16*t+16)}t.skins[n]={name:i.name,skeleton:i.skeleton,joints:i.joints,inverseBindMatrices:s}}}(t,a),function(t,e){const r=Object(o.d)(e.gltf.scene,0);if(Object(o.e)(r)){const n=Object(o.c)(e.gltf.scenes),i=Object(o.c)(n[r]);t.rootNodeIds=Object(o.d)(i.nodes,[])}}(t,a),Object(o.b)(!t.transferList.includes(r)),t.status=n.LoadingSync}loadSync(t,e){if(Object(o.e)(self.createImageBitmap))e.status=n.Loaded;else if(function(t,e){let r=!1;const i=t.transient.textures;let s=0;for(let c=0;c<i.textures.length;c++){const u=i.textures[c],h=i.imageData[u.imageIndex];if(Object(o.e)(t.textures[c]))s+=1;else{if(h instanceof ArrayBuffer){r=!0;var a=new Blob([h],{type:"image/jpeg"});let e=window.URL.createObjectURL(a);i.imageData[u.imageIndex]=new Image,i.imageData[u.imageIndex].src=e,t.status=n.LoadingSync}h.complete&&(Object(o.b)(Object(o.e)(t.textures),"This should have been defined as an empty array by loadTexturesSync()"),t.textures[c]={desc:u.desc,name:u.name,id:Object(o.e)(e.renderer)?e.renderer.createTexture(u.name,u.desc,h):-1})}}return s===i.textures.length?t.status=n.Loaded:t.status=n.LoadingSync,!r}(e,t))return;if(e.techniques=function(t,e){if(!Object(o.e)(t))return[];const r=Object(o.e)(e.renderer)?t.shaders.map(r=>{const n=t.shaderData[r.vsIndex],i=t.shaderData[r.fsIndex],s={name:r.name,vertSource:p(n),fragSource:p(i)};return e.renderer.createShader(s)}):[];return t.techniques.map(t=>({shaderId:r[t.shaderIndex],attributes:t.attributes,uniforms:t.uniforms}))}(e.transient.techniques,t),e.materials=function(t,e){return t.map(t=>({name:t.name,renderFormat:t.renderFormat,cullMode:t.cullMode,values:t.values,technique:Object(o.e)(t.techniqueIndex)?e.techniques[t.techniqueIndex]:void 0}))}(e.transient.materials,e),e.nodes=function(t){const e=t.map((t,e)=>{const r=new b;return r.name=Object(o.d)(t.name,`Node${e}`),r.position.set(t.translation[0],t.translation[1],t.translation[2]),r.quaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),r.scale.set(t.scale[0],t.scale[1],t.scale[2]),r.updateWorldMatrix(!0,!1),r.skinId=t.skinId,r.meshId=t.meshId,r.morphWeight=t.morphWeight,r});for(let r=0;r<e.length;r++){const n=t[r],i=e[r];for(const t of n.children)i.add(e[t])}return e}(e.transient.nodes),e.animations=function(t,e){const r=[];for(const n of t){const t=n.tracks.map(t=>{let r;switch(t.targetProperty){case"quaternion":r=u.f;break;case"position":case"scale":r=u.g;break;default:throw new Error("Unsupported animation target property")}const n=new r(`${e.nodes[t.targetNodeId].name}.${t.targetProperty}`,t.times,t.values,k[t.interpolation]);return"CUBICSPLINE"===t.interpolation&&(n.createInterpolant=function(t){return new U(this.times,this.values,this.getValueSize()/3,t)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),n});r.push(new u.a(n.name,n.maxTime,t))}return r}(e.transient.animation,e),e.textures=function(t,e){const r=[];if(Object(o.e)(self.createImageBitmap)&&Object(o.e)(e.renderer)){for(const n of t.textures){const i=t.imageData[n.imageIndex];Object(o.b)(i instanceof ImageBitmap),r.push({desc:n.desc,name:n.name,id:e.renderer.createTexture(n.name,n.desc,i)})}for(const e of t.imageData)e.close()}return r}(e.transient.textures,t),Object(o.e)(t.renderer))for(let r in e.bufferData){const n=e.bufferViews[r],i=e.bufferData[r];n.buffer=t.renderer.createBuffer(n.name,n.type,a.o.Static,i)}e.status===n.Loaded&&delete e.transient}unloadSync(t,e){}}};class L{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(t){this.worker=new s.a,this.worker.onmessage=t=>this.onMessage(t),this.context={renderer:t}}onMessage(t){this.messages.push(t)}load(t,e,r){if(!Object(o.e)(D[e]))return void r("Invalid resource type",void 0);const i="string"==typeof t?t:t.uri,s="string"==typeof t?void 0:t.headers,a=i+e;if(Object(o.e)(this.cache[a]))r(void 0,this.cache[a]);else if(this.requests[a])this.requests[a].push(r);else{this.requests[a]=[r];const t={source:{uri:i,headers:s,type:e},status:n.LoadingAsync,transferList:[]};this.worker.postMessage([t])}}unload(t,e){const r=("string"==typeof t?t:t.uri)+e;if(Object(o.e)(this.cache[r])){const t=this.cache[r];D[t.source.type].unloadSync(this.context,t),delete this.cache[r]}else{if(!this.requests[r])throw new Error(`Attempted to unload a resource that was never loaded: ${r}`);delete this.requests[r]}}update(){for(let t of this.messages)Array.prototype.push.apply(this.pending,t.data);for(let t of this.pending){const e=t.source.uri+t.source.type;if(Object(o.e)(this.requests[e])||(t.status=n.Unloaded),t.status===n.LoadingSync){D[t.source.type].loadSync(this.context,t)}switch(t.status){case n.Loaded:case n.Failed:this.finished.push(t);break;case n.Unloaded:this.unloaded.push(t);break;case n.LoadingAsync:this.loadingAsync.push(t);break;case n.LoadingSync:this.loadingSync.push(t)}}this.pending.length=0;for(let t of this.finished){const e=t.source.uri+t.source.type,r=Object(o.c)(this.requests[e]).length;Object(o.b)(r>=1),this.cache[e]=t;for(let i=0;i<r;i++)t.status===n.Failed?this.requests[e][i](t.error,void 0):this.requests[e][i](void 0,t);delete this.requests[e]}const t=[];for(let e of this.loadingAsync)Array.prototype.push.apply(t,e.transferList);this.worker.postMessage(this.loadingAsync,t);for(let t of this.unloaded){D[t.source.type].unloadSync(this.context,t)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}},function(t,e){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),s=t.indexOf("]");-1!=i&&-1!=s&&(t=t.substring(0,i)+t.substring(i,s).replace(/:/g,";")+t.substring(s,t.length));for(var a=r.exec(t||""),o={},c=14;c--;)o[n[c]]=a[c]||"";return-1!=i&&-1!=s&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){(function(e){t.exports=function(t){return r&&e.isBuffer(t)||n&&(t instanceof ArrayBuffer||function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}(t))};var r="function"==typeof e&&"function"==typeof e.isBuffer,n="function"==typeof ArrayBuffer}).call(this,r(38).Buffer)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){var n=r(75),i=r(56),s=r(25),a=r(37),o=r(57),c=r(58),u=r(31)("socket.io-client:manager"),h=r(55),l=r(92),f=Object.prototype.hasOwnProperty;function d(t,e){if(!(this instanceof d))return new d(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=e.parser||a;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=d,d.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},d.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},d.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},s(d.prototype),d.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},d.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},d.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(t,e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=o(r,"open",(function(){i.onopen(),t&&t()})),a=o(r,"error",(function(e){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var r=new Error("Connection error");r.data=e,t(r)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var h=setTimeout((function(){u("connect attempt timed out after %d",c),s.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(s),this.subs.push(a),this},d.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(o(t,"data",c(this,"ondata"))),this.subs.push(o(t,"ping",c(this,"onping"))),this.subs.push(o(t,"pong",c(this,"onpong"))),this.subs.push(o(t,"error",c(this,"onerror"))),this.subs.push(o(t,"close",c(this,"onclose"))),this.subs.push(o(this.decoder,"decoded",c(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(t){this.decoder.add(t)},d.prototype.ondecoded=function(t){this.emit("packet",t)},d.prototype.onerror=function(t){u("error",t),this.emitAll("error",t)},d.prototype.socket=function(t,e){var r=this.nsps[t];if(!r){r=new i(this,t,e),this.nsps[t]=r;var n=this;r.on("connecting",s),r.on("connect",(function(){r.id=n.generateId(t)})),this.autoConnect&&s()}function s(){~h(n.connecting,r)||n.connecting.push(r)}return r},d.prototype.destroy=function(t){var e=h(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},d.prototype.packet=function(t){u("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(r){for(var n=0;n<r.length;n++)e.engine.write(r[n],t.options);e.encoding=!1,e.processPacketQueue()})))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},d.prototype.cleanup=function(){u("cleanup");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(t){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();u("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var r=setTimeout((function(){t.skipReconnect||(u("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(u("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(u("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(r)}})}},d.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,r){var n=r(39),i=r(78),s=r(88),a=r(89);e.polling=function(t){var e=!1,r=!1,a=!1!==t.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,c=location.port;c||(c=o?443:80),e=t.hostname!==location.hostname||c!==t.port,r=t.secure!==o}if(t.xdomain=e,t.xscheme=r,"open"in new n(t)&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new s(t)},e.websocket=a},function(t,e,r){var n=r(40),i=r(32),s=r(26),a=r(33),o=r(54),c=r(34)("engine.io-client:polling");t.exports=h;var u=null!=new(r(39))({xdomain:!1}).responseType;function h(t){var e=t&&t.forceBase64;u&&!e||(this.supportsBinary=!1),n.call(this,t)}a(h,n),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(t){var e=this;function r(){c("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--n||r()}))),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){c("pre-pause writing complete"),--n||r()})))}else r()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(t){var e=this;c("polling got data %s",t);s.decodePayload(t,this.socket.binaryType,(function(t,r,n){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var t=this;function e(){c("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},h.prototype.write=function(t){var e=this;this.writable=!1;var r=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,r)}))},h.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(t[this.timestampParam]=o()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(r=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t}},function(t,e,r){(function(e){var n=r(80),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function t(r){if(!r||"object"!=typeof r)return!1;if(n(r)){for(var i=0,o=r.length;i<o;i++)if(t(r[i]))return!0;return!1}if("function"==typeof e&&e.isBuffer&&e.isBuffer(r)||"function"==typeof ArrayBuffer&&r instanceof ArrayBuffer||s&&r instanceof Blob||a&&r instanceof File)return!0;if(r.toJSON&&"function"==typeof r.toJSON&&1===arguments.length)return t(r.toJSON(),!0);for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&t(r[c]))return!0;return!1}}).call(this,r(38).Buffer)},function(t,e,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},a=0,o=0;function c(t){var e="";do{e=i[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function u(){var t=c(+new Date);return t!==n?(a=0,n=t):t+"."+c(a++)}for(;o<64;o++)s[i[o]]=o;u.encode=c,u.decode=function(t){var e=0;for(o=0;o<t.length;o++)e=64*e+s[t.charAt(o)];return e},t.exports=u},function(t,e){var r=[].indexOf;t.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}},function(t,e,r){var n=r(37),i=r(25),s=r(91),a=r(57),o=r(58),c=r(31)("socket.io-client:socket"),u=r(32),h=r(53);t.exports=d;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;function d(t,e,r){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",o(this,"onopen")),a(t,"packet",o(this,"onpacket")),a(t,"close",o(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},d.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},d.prototype.emit=function(t){if(l.hasOwnProperty(t))return f.apply(this,arguments),this;var e=s(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:h(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},d.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},d.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},d.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},d.prototype.onpacket=function(t){var e=t.nsp===this.nsp,r=t.type===n.ERROR&&"/"===t.nsp;if(e||r)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},d.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},d.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var i=s(arguments);c("sending ack %j",i),e.packet({type:h(i)?n.BINARY_ACK:n.ACK,id:t,data:i})}}},d.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(t){return this.flags.compress=t,this},d.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e,r){return t.on(e,r),{destroy:function(){t.removeListener(e,r)}}}},function(t,e){var r=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return e.apply(t,n.concat(r.call(arguments)))}}},function(t,e,r){var n=r(65),i=r(37),s=r(50),a=r(31)("socket.io-client");t.exports=e=c;var o=e.managers={};function c(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,i=n(t),c=i.source,u=i.id,h=i.path,l=o[u]&&h in o[u].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||l?(a("ignoring socket cache for %s",c),r=s(c,e)):(o[u]||(a("new io instance for %s",c),o[u]=s(c,e)),r=o[u]),i.query&&!e.query&&(e.query=i.query),r.socket(i.path,e)}e.protocol=i.protocol,e.connect=c,e.Manager=r(50),e.Socket=r(56)},function(t,e,r){t.exports=function(){return new Worker(r.p+"ResourceLoading.worker.c5d9026587ecd8e2f754.js")}},function(t,e,r){"use strict";r.r(e),r.d(e,"Server",(function(){return R}));var n=r(20),i=r(29),s=r(42),a=r(43),o=r(45),c=r(15),u=r(41),h=r(10),l=r(44),f=r(2);const d=f.e.create(),p=f.e.create(),m=f.e.create(),g=f.e.create(),b=f.e.create(),y=f.e.create(),v=f.e.create(),x=f.e.create(),w=f.e.create();function _(t,e,r,n){let i,s,a,o,c,u,h=1/0,l=-1/0,_=0;const M=t.halfLengths[0],C=t.halfLengths[1],A=t.halfLengths[2],S=f.e.subtract(d,e,t.center),T=f.e.subtract(p,r,t.center),k=f.e.subtract(m,n,t.center),F=f.e.subtract(g,T,S),O=f.e.subtract(b,k,T),E=f.e.subtract(y,S,k);function j(t,e,r){h=Math.min(t,e,r),l=Math.max(t,e,r)}function B(t,e,r,n){i=t*S[1]-e*S[2],a=t*k[1]-e*k[2],i<a?(h=i,l=a):(h=a,l=i),_=r*C+n*A}function R(t,e,r,n){i=-t*S[0]+e*S[2],a=-t*k[0]+e*k[2],i<a?(h=i,l=a):(h=a,l=i),_=r*M+n*A}function I(t,e,r,n){s=t*T[0]-e*T[1],a=t*k[0]-e*k[1],a<s?(h=a,l=s):(h=s,l=a),_=r*M+n*C}if(o=Math.abs(F[0]),c=Math.abs(F[1]),u=Math.abs(F[2]),B(F[2],F[1],u,c),h>_||l<-_)return!1;if(R(F[2],F[0],u,o),h>_||l<-_)return!1;if(I(F[1],F[0],c,o),h>_||l<-_)return!1;if(o=Math.abs(O[0]),c=Math.abs(O[1]),u=Math.abs(O[2]),B(O[2],O[1],u,c),h>_||l<-_)return!1;if(R(O[2],O[0],u,o),h>_||l<-_)return!1;if(function(t,e,r,n){i=t*S[0]-e*S[1],s=t*T[0]-e*T[1],i<s?(h=i,l=s):(h=s,l=i),_=r*M+n*C}(O[1],O[0],c,o),h>_||l<-_)return!1;if(o=Math.abs(E[0]),c=Math.abs(E[1]),u=Math.abs(E[2]),function(t,e,r,n){i=t*S[1]-e*S[2],s=t*T[1]-e*T[2],i<s?(h=i,l=s):(h=s,l=i),_=r*C+n*A}(E[2],E[1],u,c),h>_||l<-_)return!1;if(function(t,e,r,n){i=-t*S[0]+e*S[2],s=-t*T[0]+e*T[2],i<s?(h=i,l=s):(h=s,l=i),_=r*M+n*A}(E[2],E[0],u,o),h>_||l<-_)return!1;if(I(E[1],E[0],c,o),h>_||l<-_)return!1;if(j(S[0],T[0],k[0]),h>M||l<-M)return!1;if(j(S[1],T[1],k[1]),h>C||l<-C)return!1;if(j(S[2],T[2],k[2]),h>A||l<-A)return!1;const P=f.e.cross(v,F,O);return!!function(t,e,r){let n;const i=x,s=w;for(n=0;n<=2;n++)t[n]>0?(i[n]=-r[n],s[n]=r[n]):(i[n]=r[n],s[n]=-r[n]);return!(f.e.dot(t,i)+e>0)&&f.e.dot(t,s)+e>=0}(P,-f.e.dot(P,S),t.halfLengths)}var M=r(0),C=r(24);class A{constructor(){this.center=f.e.create(),this.bases=[f.e.create(),f.e.create(),f.e.create()],this.halfLengths=f.e.create()}setFromMatrix(t){return f.b.getTranslation(this.center,t),f.e.set(this.bases[0],t[0],t[1],t[2]),f.e.set(this.bases[1],t[4],t[5],t[6]),f.e.set(this.bases[2],t[8],t[9],t[10]),this.halfLengths[0]=f.e.length(this.bases[0]),this.halfLengths[1]=f.e.length(this.bases[1]),this.halfLengths[2]=f.e.length(this.bases[2]),f.e.scale(this.bases[0],this.bases[0],1/this.halfLengths[0]),f.e.scale(this.bases[1],this.bases[1],1/this.halfLengths[1]),f.e.scale(this.bases[2],this.bases[2],1/this.halfLengths[2]),this}toMatrix(t){return f.b.set(t,this.halfLengths[0]*this.bases[0][0],this.halfLengths[0]*this.bases[0][1],this.halfLengths[0]*this.bases[0][2],0,this.halfLengths[1]*this.bases[1][0],this.halfLengths[1]*this.bases[1][1],this.halfLengths[1]*this.bases[1][2],0,this.halfLengths[2]*this.bases[2][0],this.halfLengths[2]*this.bases[2][1],this.halfLengths[2]*this.bases[2][2],0,this.center[0],this.center[1],this.center[2],1),t}createWorldToObbMatrix(t){const e=f.e.dot(this.center,this.bases[0]),r=f.e.dot(this.center,this.bases[1]),n=f.e.dot(this.center,this.bases[2]);return f.b.set(t,this.bases[0][0],this.bases[1][0],this.bases[2][0],0,this.bases[0][1],this.bases[1][1],this.bases[2][1],0,this.bases[0][2],this.bases[1][2],this.bases[2][2],0,-e,-r,-n,1),t}}const S=f.b.create(),T=f.e.create(),k=f.e.create(),F=f.e.create(),O=f.e.create(),E={center:f.e.create(),halfLengths:f.e.create()};class j{constructor(){this.attacks=[],this.attackOwners=[],this.targets=[],this.targetOwners=[],this.hitCache=[];for(let t=0;t<8;t++)this.hitCache[t]=f.e.create()}addAttackRegion(t,e){this.attacks.push(t),this.attackOwners.push(e)}addTargetObb(t,e){t instanceof A||(t=(new A).setFromMatrix(t));const r=this.targets.length;return this.targets.push(t),this.targetOwners.push(e),r}getHitsForTarget(t){const e=this.targets[t],r=[];let n=0;const i=e.createWorldToObbMatrix(S);for(let t=0;t<this.attacks.length;t++){const s=this.attacks[t],a=f.e.transformMat4(T,s.verts[0],i),o=f.e.transformMat4(k,s.verts[1],i),c=f.e.transformMat4(F,s.verts[2],i),u=f.e.transformMat4(O,s.verts[3],i),h=E;h.halfLengths=e.halfLengths;let l=_(h,a,o,c);if(l||(l=_(h,o,c,u)),l){Object(M.b)(n<8,"Too many hits in one frame");const e=this.hitCache[n++];r.push({owner:this.attackOwners[t],pos:e})}}return r}clear(){this.attacks.length=0,this.targets.length=0,this.attackOwners.length=0,this.targetOwners.length=0}debugRender(){const t=this.targets.map(t=>t.toMatrix(f.b.create())),e=[];for(const t of this.attacks)e.push(t.verts[0],t.verts[1],t.verts[2],t.verts[3]);C.a.renderObbs(t.slice(0,1)),C.a.renderQuads(e)}}class B{setStageRadius(t){this.outerRadius=t,this.outerRadiusSquared=this.outerRadius*this.outerRadius}groundHeight(t,e){return f.e.dot(t,t)>this.outerRadiusSquared?-1e4:0}wallCheck(t,e){const r=t.a[0]*t.a[0]+t.a[2]*t.a[2],n=t.b[0]*t.b[0]+t.b[2]*t.b[2],i=Math.max(r,n),s=Math.sqrt(i)+t.radius;if(s>this.outerRadius){const i=r>n?t.a:t.b,a=this.outerRadius/s-1;return e[0]=i[0]*a,e[1]=0,e[2]=i[2]*a,!0}return!1}debugRender(){}}class R{constructor(){this.debugMenu=new u.a,this.world=new h.b,this.collision=new j,this.staticCollision=new B,this.avatar=new i.c,this.weapon=new l.a(this.world),this.clock=new s.a,this.net=new a.b,this.resources=new o.a,this.userCommands=new c.b,this.init()}async init(){console.log(`Source for this build available at ${n.a}`),window.onbeforeunload=this.onUnload.bind(this),this.resources.initialize(),this.clock.initialize(this),this.net.initialize(this),this.avatar.initialize(this),this.weapon.initialize(this),this.staticCollision.setStageRadius(2e3),n.b;return setInterval(this.tick.bind(this),16),0}onConnect(t){this.net.onConnect(t)}tick(){this.clock.tick(),this.updateFixed(),this.update()}updateFixed(){let t=0;for(;this.clock.updateFixed();)t+=1,this.collision.clear(),this.avatar.updateFixed(this),this.weapon.updateFixed(this),this.avatar.updateFixedLate(this),this.world.captureState(this.clock.simFrame),this.net.transmitToClients(this.clock.simFrame);1!==t&&console.warn("[Server] Uneven fixed frame tick:",t)}update(){this.resources.update(),this.collision.debugRender()}onUnload(){this.net.terminate()}}},,,,function(t,e,r){var n=r(46),i=r(31)("socket.io-client:url");t.exports=function(t,e){var r=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),i("parse %s",t),r=n(t));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var s=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port,r.href=r.protocol+"://"+s+(e&&e.port===r.port?"":":"+r.port),r}},function(t,e,r){t.exports=function(t){function e(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let r;function a(...t){if(!a.enabled)return;const e=a,i=Number(new Date),s=i-(r||i);e.diff=s,e.prev=r,e.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;o++;const s=n.formatters[i];if("function"==typeof s){const n=t[o];r=s.call(e,n),t.splice(o,1),o--}return r}),n.formatArgs.call(e,t),(e.log||n.log).apply(e,t)}return a.namespace=t,a.enabled=n.enabled(t),a.useColors=n.useColors(),a.color=e(t),a.destroy=i,a.extend=s,"function"==typeof n.init&&n.init(a),n.instances.push(a),a}function i(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function s(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function a(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(a),...n.skips.map(a).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(e=0;e<i;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=r(67),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function a(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}t.exports=function(t,e){e=e||{};var o=typeof t;if("string"===o&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===o&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return a(t,e,s,"day");if(e>=i)return a(t,e,i,"hour");if(e>=n)return a(t,e,n,"minute");if(e>=r)return a(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){(function(n){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==n&&"env"in n&&(t=n.env.DEBUG),t}(e=t.exports=r(69)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.diff),!r)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(s=i))})),t.splice(s,0,n)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,r(36))},function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,i=+new Date,s=i-(r||i);t.diff=s,t.prev=r,t.curr=i,r=i;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=e.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;c++;var i=e.formatters[n];if("function"==typeof i){var s=a[c];r=i.call(t,s),a.splice(c,1),c--}return r})),e.formatArgs.call(t,a);var u=n.log||e.log||console.log.bind(console);u.apply(t,a)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=i,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var s=e.instances[r];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r(70),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function a(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var o,c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===c&&!1===isNaN(t))return e.long?a(o=t,s,"day")||a(o,i,"hour")||a(o,n,"minute")||a(o,r,"second")||o+" ms":function(t){if(t>=s)return Math.round(t/s)+"d";if(t>=i)return Math.round(t/i)+"h";if(t>=n)return Math.round(t/n)+"m";if(t>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){var n=r(47),i=r(48),s=Object.prototype.toString,a="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);e.deconstructPacket=function(t){var e=[],r=t.data,s=t;return s.data=function t(e,r){if(!e)return e;if(i(e)){var s={_placeholder:!0,num:r.length};return r.push(e),s}if(n(e)){for(var a=new Array(e.length),o=0;o<e.length;o++)a[o]=t(e[o],r);return a}if("object"==typeof e&&!(e instanceof Date)){a={};for(var c in e)a[c]=t(e[c],r);return a}return e}(r,e),s.attachments=e.length,{packet:s,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,r){if(!e)return e;if(e&&e._placeholder)return r[e.num];if(n(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],r);else if("object"==typeof e)for(var s in e)e[s]=t(e[s],r);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var r=0,s=t;!function t(c,u,h){if(!c)return c;if(a&&c instanceof Blob||o&&c instanceof File){r++;var l=new FileReader;l.onload=function(){h?h[u]=this.result:s=this.result,--r||e(s)},l.readAsArrayBuffer(c)}else if(n(c))for(var f=0;f<c.length;f++)t(c[f],f,c);else if("object"==typeof c&&!i(c))for(var d in c)t(c[d],d,c)}(s),r||e(s)}},function(t,e,r){"use strict";e.byteLength=function(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,n=u(t),a=n[0],o=n[1],c=new s(function(t,e,r){return 3*(e+r)/4-r}(0,a,o)),h=0,l=o>0?a-4:a;for(r=0;r<l;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],c[h++]=e>>16&255,c[h++]=e>>8&255,c[h++]=255&e;2===o&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,c[h++]=255&e);1===o&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,c[h++]=e>>8&255,c[h++]=255&e);return c},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,s=[],a=0,o=r-i;a<o;a+=16383)s.push(h(t,a,a+16383>o?o:a+16383));1===i?(e=t[r-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return s.join("")};for(var n=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=a.length;o<c;++o)n[o]=a[o],i[a.charCodeAt(o)]=o;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t,e,r){for(var i,s,a=[],o=e;o<r;o+=3)i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),a.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var s,a,o=8*i-n-1,c=(1<<o)-1,u=c>>1,h=-7,l=r?i-1:0,f=r?-1:1,d=t[e+l];for(l+=f,s=d&(1<<-h)-1,d>>=-h,h+=o;h>0;s=256*s+t[e+l],l+=f,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+t[e+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),s-=u}return(d?-1:1)*a*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var a,o,c,u=8*s-i-1,h=(1<<u)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(a++,c/=2),a+l>=h?(o=0,a=h):a+l>=1?(o=(e*c-1)*Math.pow(2,i),a+=l):(o=e*Math.pow(2,l-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&o,d+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;t[r+d]=255&a,d+=p,a/=256,u-=8);t[r+d-p]|=128*m}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){t.exports=r(76),t.exports.parser=r(26)},function(t,e,r){var n=r(51),i=r(25),s=r(34)("engine.io-client:socket"),a=r(55),o=r(26),c=r(46),u=r(32);function h(t,e){if(!(this instanceof h))return new h(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=c(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=c(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=h,h.priorWebsocketSuccess=!1,i(h.prototype),h.protocol=o.protocol,h.Socket=h,h.Transport=r(40),h.transports=r(51),h.parser=r(26),h.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}(this.query);e.EIO=o.protocol,e.transport=t;var r=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new n[t]({query:e,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},h.prototype.open=function(){var t;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},h.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},h.prototype.probe=function(t){s('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(s('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",(function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(s('probe transport "%s" pong',t),n.upgrading=!0,n.emit("upgrading",e),!e)return;h.priorWebsocketSuccess="websocket"===e.name,s('pausing current transport "%s"',n.transport.name),n.transport.pause((function(){r||"closed"!==n.readyState&&(s("changing transport and sending upgrade packet"),f(),n.setTransport(e),e.send([{type:"upgrade"}]),n.emit("upgrade",e),e=null,n.upgrading=!1,n.flush())}))}else{s('probe transport "%s" failed',t);var a=new Error("probe error");a.transport=e.name,n.emit("upgradeError",a)}})))}function a(){r||(r=!0,f(),e.close(),e=null)}function o(r){var i=new Error("probe error: "+r);i.transport=e.name,a(),s('probe transport "%s" failed because of error: %s',t,r),n.emit("upgradeError",i)}function c(){o("transport closed")}function u(){o("socket closed")}function l(t){e&&t.name!==e.name&&(s('"%s" works - aborting "%s"',t.name,e.name),a())}function f(){e.removeListener("open",i),e.removeListener("error",o),e.removeListener("close",c),n.removeListener("close",u),n.removeListener("upgrading",l)}h.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",o),e.once("close",c),this.once("close",u),this.once("upgrading",l),e.open()},h.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},h.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else s('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},h.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},h.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(t,e,r){return this.sendPacket("message",t,e,r),this},h.prototype.sendPacket=function(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:t,data:e,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():e()})):this.upgrading?n():e()}function e(){t.onClose("forced close"),s("socket closing - telling transport to close"),t.transport.close()}function r(){t.removeListener("upgrade",r),t.removeListener("upgradeError",r),e()}function n(){t.once("upgrade",r),t.once("upgradeError",r)}return this},h.prototype.onError=function(t){s("socket error %j",t),h.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},h.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(t){for(var e=[],r=0,n=t.length;r<n;r++)~a(this.transports,t[r])&&e.push(t[r]);return e}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,r){var n=r(39),i=r(52),s=r(25),a=r(33),o=r(34)("engine.io-client:polling-xhr");function c(){}function u(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,r=location.port;r||(r=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port,this.xs=t.secure!==e}}function h(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(t.exports=u,t.exports.Request=h,a(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new h(t)},u.prototype.doWrite=function(t,e){var r="string"!=typeof t&&void 0!==t,n=this.request({method:"POST",data:t,isBinary:r}),i=this;n.on("success",e),n.on("error",(function(t){i.onError("xhr post error",t)})),this.sendXhr=n},u.prototype.doPoll=function(){o("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},s(h.prototype),h.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new n(t),r=this;try{o("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&e.setRequestHeader(i,this.extraHeaders[i])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){r.onLoad()},e.onerror=function(){r.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?r.onLoad():setTimeout((function(){r.onError("number"==typeof e.status?e.status:0)}),0))},o("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){r.onError(t)}),0)}"undefined"!=typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},h.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},h.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},h.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",f);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,f,!1)}function f(){for(var t in h.requests)h.requests.hasOwnProperty(t)&&h.requests[t].abort()}},function(t,e){t.exports=Object.keys||function(t){var e=[],r=Object.prototype.hasOwnProperty;for(var n in t)r.call(t,n)&&e.push(n);return e}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e){t.exports=function(t,e,r){var n=t.byteLength;if(e=e||0,r=r||n,t.slice)return t.slice(e,r);if(e<0&&(e+=n),r<0&&(r+=n),r>n&&(r=n),e>=n||e>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(r-e),a=e,o=0;a<r;a++,o++)s[o]=i[a];return s.buffer}},function(t,e){function r(){}t.exports=function(t,e,n){var i=!1;return n=n||r,s.count=t,0===t?e():s;function s(t,r){if(s.count<=0)throw new Error("after called too many times");--s.count,t?(i=!0,e(t),e=n):0!==s.count||i||e(null,r)}}},function(t,e){
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var r,n,i,s=String.fromCharCode;function a(t){for(var e,r,n=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function o(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(t,e){return s(t>>e&63|128)}function u(t,e){if(0==(4294967168&t))return s(t);var r="";return 0==(4294965248&t)?r=s(t>>6&31|192):0==(4294901760&t)?(o(t,e)||(t=65533),r=s(t>>12&15|224),r+=c(t,6)):0==(4292870144&t)&&(r=s(t>>18&7|240),r+=c(t,12),r+=c(t,6)),r+=s(63&t|128)}function h(){if(i>=n)throw Error("Invalid byte index");var t=255&r[i];if(i++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function l(t){var e,s;if(i>n)throw Error("Invalid byte index");if(i==n)return!1;if(e=255&r[i],i++,0==(128&e))return e;if(192==(224&e)){if((s=(31&e)<<6|h())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&e)){if((s=(15&e)<<12|h()<<6|h())>=2048)return o(s,t)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(s=(7&e)<<18|h()<<12|h()<<6|h())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}t.exports={version:"2.1.2",encode:function(t,e){for(var r=!1!==(e=e||{}).strict,n=a(t),i=n.length,s=-1,o="";++s<i;)o+=u(n[s],r);return o},decode:function(t,e){var o=!1!==(e=e||{}).strict;r=a(t),n=r.length,i=0;for(var c,u=[];!1!==(c=l(o));)u.push(c);return function(t){for(var e,r=t.length,n=-1,i="";++n<r;)(e=t[n])>65535&&(i+=s((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=s(e);return i}(u)}}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),i=n.length,s="";for(r=0;r<i;r+=3)s+=t[n[r]>>2],s+=t[(3&n[r])<<4|n[r+1]>>4],s+=t[(15&n[r+1])<<2|n[r+2]>>6],s+=t[63&n[r+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},e.decode=function(t){var e,n,i,s,a,o=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var h=new ArrayBuffer(o),l=new Uint8Array(h);for(e=0;e<c;e+=4)n=r[t.charCodeAt(e)],i=r[t.charCodeAt(e+1)],s=r[t.charCodeAt(e+2)],a=r[t.charCodeAt(e+3)],l[u++]=n<<2|i>>4,l[u++]=(15&i)<<4|s>>2,l[u++]=(3&s)<<6|63&a;return h}}()},function(t,e){var r=void 0!==r?r:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),s=r&&r.prototype.append&&r.prototype.getBlob;function a(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var r=new Uint8Array(t.byteLength);r.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=r.buffer}return e}return t}))}function o(t,e){e=e||{};var n=new r;return a(t).forEach((function(t){n.append(t)})),e.type?n.getBlob(e.type):n.getBlob()}function c(t,e){return new Blob(a(t),e||{})}"undefined"!=typeof Blob&&(o.prototype=Blob.prototype,c.prototype=Blob.prototype),t.exports=n?i?Blob:c:s?o:void 0},function(t,e,r){t.exports=function(t){function e(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let r;function a(...t){if(!a.enabled)return;const e=a,i=Number(new Date),s=i-(r||i);e.diff=s,e.prev=r,e.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,i)=>{if("%%"===r)return r;o++;const s=n.formatters[i];if("function"==typeof s){const n=t[o];r=s.call(e,n),t.splice(o,1),o--}return r}),n.formatArgs.call(e,t),(e.log||n.log).apply(e,t)}return a.namespace=t,a.enabled=n.enabled(t),a.useColors=n.useColors(),a.color=e(t),a.destroy=i,a.extend=s,"function"==typeof n.init&&n.init(a),n.instances.push(a),a}function i(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function s(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function a(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(a),...n.skips.map(a).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(e=0;e<i;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=r(87),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n}},function(t,e){var r=1e3,n=6e4,i=60*n,s=24*i;function a(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}t.exports=function(t,e){e=e||{};var o=typeof t;if("string"===o&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===o&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=s)return a(t,e,s,"day");if(e>=i)return a(t,e,i,"hour");if(e>=n)return a(t,e,n,"minute");if(e>=r)return a(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=s)return Math.round(t/s)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){(function(e){var n=r(52),i=r(33);t.exports=h;var s,a=/\n/g,o=/\\n/g;function c(){}function u(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function h(t){if(n.call(this,t),this.query=this.query||{},!s){var e=u();s=e.___eio=e.___eio||[]}this.index=s.length;var r=this;s.push((function(t){r.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){r.script&&(r.script.onerror=c)}),!1)}i(h,n),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},h.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(e,r):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},h.prototype.doWrite=function(t,e){var r=this;if(!this.form){var n,i=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function u(){h(),e()}function h(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(t)}catch(t){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),h(),t=t.replace(o,"\\\n"),this.area.value=t.replace(a,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,r(49))},function(t,e,r){(function(e){var n,i,s=r(40),a=r(26),o=r(32),c=r(33),u=r(54),h=r(34)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{i=r(90)}catch(t){}var l=n||i;function f(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=n&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(l=i),s.call(this,t)}t.exports=f,c(f,s),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new l(t,e):new l(t):new l(t,e,r)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},f.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},f.prototype.write=function(t){var r=this;this.writable=!1;for(var n=t.length,i=0,s=n;i<s;i++)!function(t){a.encodePacket(t,r.supportsBinary,(function(i){if(!r.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),r.perMessageDeflate)("string"==typeof i?e.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(s.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,s)}catch(t){h("websocket closed before onclose event")}--n||o()}))}(t[i]);function o(){r.emit("flush"),setTimeout((function(){r.writable=!0,r.emit("drain")}),0)}},f.prototype.onClose=function(){s.prototype.onClose.call(this)},f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},f.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",r="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),(t=o.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+t},f.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===f.prototype.name)}}).call(this,r(38).Buffer)},function(t,e){},function(t,e){t.exports=function(t,e){for(var r=[],n=(e=e||0)||0;n<t.length;n++)r[n-e]=t[n];return r}},function(t,e){function r(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-r:t+r}return 0|Math.min(t,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(t){this.ms=t},r.prototype.setMax=function(t){this.max=t},r.prototype.setJitter=function(t){this.jitter=t}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec2 a_pos;out vec3 v_worldPos;uniform float u_gridRadius;uniform mat4 g_viewProj;void main(){v_worldPos=vec3(a_pos.x,0,a_pos.y)*u_gridRadius;gl_Position=g_viewProj*vec4(v_worldPos,1.);}",uniforms:{u_gridRadius:{variableType:"float",variableName:"u_gridRadius"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 300 es\nprecision mediump float;in vec3 v_worldPos;out vec4 o_fragColor;uniform vec4 u_baseColor;uniform vec4 u_lineColor;uniform float u_gridUnit;uniform float u_gridRadius;void main(){vec2 coord=v_worldPos.xz/u_gridUnit;vec2 grid=abs(fract(coord-0.5)-0.5)/fwidth(coord);float line=min(grid.x,grid.y);float lineAmount=1.-min(line,1.);vec4 color=mix(u_baseColor,u_lineColor,lineAmount);float opacity=smoothstep(u_gridRadius*0.7,u_gridRadius,length(v_worldPos));color=mix(color,vec4(0),opacity);o_fragColor=color;}",uniforms:{u_baseColor:{variableType:"vec4",variableName:"u_baseColor"},u_lineColor:{variableType:"vec4",variableName:"u_lineColor"},u_gridUnit:{variableType:"float",variableName:"u_gridUnit"},u_gridRadius:{variableType:"float",variableName:"u_gridRadius"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;attribute vec3 a_normal;attribute vec2 a_uv0;attribute vec4 a_color;uniform vec3 u_baseLightPos;uniform mat4 u_model;uniform mat4 g_viewProj;varying vec2 v_uv;varying vec4 v_color;varying float v_NDotL;void main(){v_uv=a_uv0;v_color=a_color;vec4 pos=u_model*vec4(a_pos,1.);vec3 n=normalize(mat3(u_model)*a_normal);vec3 l=normalize(u_baseLightPos-pos.xyz);v_NDotL=dot(n,l);gl_Position=g_viewProj*pos;}",uniforms:{u_baseLightPos:{variableType:"vec3",variableName:"u_baseLightPos"},u_model:{variableType:"mat4",variableName:"u_model"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_backgroundAmbient;uniform vec4 u_backgroundDiffuse;uniform vec4 u_torchColor;uniform sampler2D u_tex;varying vec2 v_uv;varying vec4 v_color;varying float v_NDotL;void main(){vec4 tap=texture2D(u_tex,v_uv);vec3 amb=u_backgroundAmbient.rgb;vec3 diffuse=u_backgroundDiffuse.rgb*v_NDotL;float torchLight=v_color.r;vec3 torchColor=u_torchColor.rgb;diffuse+=torchColor*torchLight;gl_FragColor=vec4((diffuse+amb)*tap.rgb,1);}",uniforms:{u_backgroundAmbient:{variableType:"vec4",variableName:"u_backgroundAmbient"},u_backgroundDiffuse:{variableType:"vec4",variableName:"u_backgroundDiffuse"},u_torchColor:{variableType:"vec4",variableName:"u_torchColor"},u_tex:{variableType:"sampler2D",variableName:"u_tex"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;attribute vec2 a_uv0;uniform float u_scroll;uniform float u_yOffset;uniform vec3 g_camPos;uniform mat4 g_viewProj;varying vec2 v_uv;void main(){v_uv=a_uv0;v_uv.x+=u_scroll;vec3 pos=a_pos*100.+g_camPos;pos.y+=u_yOffset*100.;gl_Position=g_viewProj*vec4(pos,1.);}",uniforms:{u_scroll:{variableType:"float",variableName:"u_scroll"},u_yOffset:{variableType:"float",variableName:"u_yOffset"},g_camPos:{variableType:"vec3",variableName:"g_camPos"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;uniform float u_scroll;uniform sampler2D u_tex;varying vec2 v_uv;void main(){vec4 tapA=texture2D(u_tex,v_uv);vec4 tapB=texture2D(u_tex,vec2(v_uv.x+0.2,v_uv.y));vec3 cloudTap=u_color.rgb*(tapA.rgb+tapB.rgb-tapA.rgb*tapB.rgb);float cloudAlpha=tapA.a*tapB.a;gl_FragColor=vec4(cloudTap,cloudAlpha);}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"},u_scroll:{variableType:"float",variableName:"u_scroll"},u_tex:{variableType:"sampler2D",variableName:"u_tex"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;uniform mat4 g_viewProj;void main(){gl_Position=g_viewProj*vec4(100.*a_pos,1.);}",uniforms:{g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;uniform float u_height;uniform float u_yOffset;uniform mat4 g_viewProj;varying float v_blend;void main(){v_blend=a_pos.y;vec3 pos=a_pos;pos.y=pos.y*u_height+u_yOffset;gl_Position=g_viewProj*vec4(pos*100.,1.);}",uniforms:{u_height:{variableType:"float",variableName:"u_height"},u_yOffset:{variableType:"float",variableName:"u_yOffset"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_colorA;uniform vec4 u_colorB;varying float v_blend;void main(){vec4 color=mix(u_colorA,u_colorB,v_blend);gl_FragColor=color;}",uniforms:{u_colorA:{variableType:"vec4",variableName:"u_colorA"},u_colorB:{variableType:"vec4",variableName:"u_colorB"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;attribute vec2 a_uv0;uniform mat4 u_modelView;uniform mat4 g_proj;varying vec2 v_uv;void main(){v_uv=a_uv0;vec4 camPos=u_modelView*vec4(a_pos,1.);gl_Position=g_proj*camPos;}",uniforms:{u_modelView:{variableType:"mat4",variableName:"u_modelView"},g_proj:{variableType:"mat4",variableName:"g_proj"}},consts:{}}},function(t,e){t.exports={sourceCode:"#version 100\nprecision mediump float;uniform sampler2D u_tex;uniform vec4 u_colorPrim;uniform vec4 u_colorEnv;varying vec2 v_uv;void main(){vec4 tap=texture2D(u_tex,v_uv);if(tap.a<1.)tap.rgb=vec3(1.);vec3 color=mix(u_colorEnv.rgb,u_colorPrim.rgb,tap.rgb);float alpha=mix(0.,tap.a,u_colorPrim.a);gl_FragColor=vec4(color,alpha);}",uniforms:{u_tex:{variableType:"sampler2D",variableName:"u_tex"},u_colorPrim:{variableType:"vec4",variableName:"u_colorPrim"},u_colorEnv:{variableType:"vec4",variableName:"u_colorEnv"}},consts:{}}},,function(t,e,r){"use strict";r.r(e);var n=r(20),i=r(1);let s;function a(t){switch(t){case s.FLOAT:return i.n.Float;case s.FLOAT_VEC2:return i.n.Float2;case s.FLOAT_VEC3:return i.n.Float3;case s.FLOAT_VEC4:return i.n.Float4;case s.INT:return i.n.Int;case s.INT_VEC2:return i.n.Int2;case s.INT_VEC3:return i.n.Int3;case s.INT_VEC4:return i.n.Int4;case s.FLOAT_MAT3:return i.n.Float3x3;case s.FLOAT_MAT4:return i.n.Float4x4;case s.SAMPLER_2D:return i.n.Texture2D;case s.SAMPLER_3D:return i.n.Texture3D;case s.SAMPLER_CUBE:return i.n.TextureCube;case s.UNSIGNED_INT:return i.n.Uint;case s.UNSIGNED_INT_VEC2:return i.n.Uint2;case s.UNSIGNED_INT_VEC3:return i.n.Uint3;case s.UNSIGNED_INT_VEC4:return i.n.Uint4;default:return w(`Unsupported WebGL type: ${t}`)}}function o(t){switch(255&t){case i.n.Float:return 1;case i.n.Float2:return 2;case i.n.Float3:return 3;case i.n.Float4:return 4;case i.n.Int:return 1;case i.n.Int2:return 2;case i.n.Int3:return 3;case i.n.Int4:return 4;case i.n.Uint:return 1;case i.n.Uint2:return 2;case i.n.Uint3:return 3;case i.n.Uint4:return 4;case i.n.Short:return 1;case i.n.Short2:return 2;case i.n.Short3:return 3;case i.n.Short4:return 4;case i.n.Ushort:return 1;case i.n.Ushort2:return 2;case i.n.Ushort3:return 3;case i.n.Ushort4:return 4;case i.n.Char:return 1;case i.n.Char2:return 2;case i.n.Char3:return 3;case i.n.Char4:return 4;case i.n.Uchar:return 1;case i.n.Uchar2:return 2;case i.n.Uchar3:return 3;case i.n.Uchar4:return 4;case i.n.Half:return 1;case i.n.Half2:return 2;case i.n.Half3:return 3;case i.n.Half4:return 4;default:return w(`Unsupported type: ${t}`)}}function c(t){switch(255&t){case i.n.Float:case i.n.Float2:case i.n.Float3:case i.n.Float4:return s.FLOAT;case i.n.Int:case i.n.Int2:case i.n.Int3:case i.n.Int4:return s.INT;case i.n.Uint:case i.n.Uint2:case i.n.Uint3:case i.n.Uint4:return s.UNSIGNED_INT;case i.n.Short:case i.n.Short2:case i.n.Short3:case i.n.Short4:return s.SHORT;case i.n.Ushort:case i.n.Ushort2:case i.n.Ushort3:case i.n.Ushort4:return s.UNSIGNED_SHORT;case i.n.Char:case i.n.Char2:case i.n.Char3:case i.n.Char4:return s.BYTE;case i.n.Uchar:case i.n.Uchar2:case i.n.Uchar3:case i.n.Uchar4:return s.UNSIGNED_BYTE;case i.n.Half:case i.n.Half2:case i.n.Half3:case i.n.Half4:return s.HALF_FLOAT;default:return w(`Unsupported type: ${t}`)}}function u(t){switch(t){case i.g.Points:return s.POINTS;case i.g.Lines:return s.LINES;case i.g.LineLoop:return s.LINE_LOOP;case i.g.LineStrip:return s.LINE_STRIP;case i.g.Triangles:return s.TRIANGLES;case i.g.TriangleStrip:return s.TRIANGLE_STRIP;case i.g.TriangleFan:return s.TRIANGLE_FAN;default:return w(`Unsupported primitive type: ${t}`)}}function h(t){switch(t){case i.n.Short_Norm:case i.n.Short2_Norm:case i.n.Short3_Norm:case i.n.Short4_Norm:case i.n.Ushort_Norm:case i.n.Ushort2_Norm:case i.n.Ushort3_Norm:case i.n.Ushort4_Norm:case i.n.Char_Norm:case i.n.Char2_Norm:case i.n.Char3_Norm:case i.n.Char4_Norm:case i.n.Uchar_Norm:case i.n.Uchar2_Norm:case i.n.Uchar3_Norm:case i.n.Uchar4_Norm:return!0;default:return!1}}function l(t){switch(t){case i.n.Uchar:return s.UNSIGNED_BYTE;case i.n.Uint:return s.UNSIGNED_INT;case i.n.Ushort:return s.UNSIGNED_SHORT;default:return w(`Unsupported index type: ${t}`)}}function f(t){switch(t){case i.k.Texture2D:return s.TEXTURE_2D;case i.k.Texture3D:return s.TEXTURE_3D;case i.k.TextureCube:return s.TEXTURE_CUBE_MAP;default:return w(`Unsupported texture type: ${t}`)}}function d(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:return s.ALPHA;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA;case i.i.F16:return s.ALPHA;case i.i.F16x4:case i.i.F32x4:return s.RGBA;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function p(t){switch(t){case i.i.U565:return s.RGB;case i.i.U8:case i.i.U8_sRGB:return s.RED;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB;case i.i.U8x4:case i.i.U8x4_sRGB:case i.i.U10_10_10_2:return s.RGBA;case i.i.F16:return s.RED;case i.i.F16x2:return s.RG;case i.i.F16x4:return s.RGBA;case i.i.F32x2:return s.RG;case i.i.F32x4:return s.RGBA;case i.i.F11_11_10:return s.RGB;case i.i.Depth32:return s.DEPTH_COMPONENT;case i.i.Depth24Stencil8:return s.DEPTH_STENCIL;default:return w(`Unsupported texel format: ${t}`)}}function m(t){switch(t){case i.i.U565:return s.RGB565;case i.i.U8:case i.i.U8_sRGB:return s.R8;case i.i.U8x2:case i.i.U8x2_sRGB:return s.RG8;case i.i.U8x3:case i.i.U8x3_sRGB:return s.RGB8;case i.i.U8x4:case i.i.U8x4_sRGB:return s.RGBA8;case i.i.U10_10_10_2:return s.RGB10_A2;case i.i.F16:return s.R16F;case i.i.F16x2:return s.RG16F;case i.i.F16x3:return s.RGB16F;case i.i.F16x4:return s.RGBA16F;case i.i.F32x2:return s.RG32F;case i.i.F32x3:return s.RGB32F;case i.i.F32x4:return s.RGBA32F;case i.i.Depth32:return s.DEPTH_COMPONENT32F;case i.i.Depth24Stencil8:return s.DEPTH24_STENCIL8;default:return w(`Unsupported texel format: ${t}`)}}function g(t){switch(t){case i.i.Undefined:return 0;case i.i.U565:return s.UNSIGNED_SHORT_5_6_5;case i.i.U8:case i.i.U8_sRGB:case i.i.U8x2:case i.i.U8x2_sRGB:case i.i.U8x3:case i.i.U8x3_sRGB:case i.i.U8x4:case i.i.U8x4_sRGB:return s.UNSIGNED_BYTE;case i.i.U10_10_10_2:return s.RGBA;case i.i.F11_11_10:return s.FLOAT;case i.i.F16:case i.i.F16x2:case i.i.F16x4:return s.HALF_FLOAT;case i.i.F32x2:case i.i.F32x4:case i.i.Depth32:return s.FLOAT;case i.i.Depth24Stencil8:return s.UNSIGNED_INT_24_8;default:return w(`Unsupported texel format: ${t}`)}}function b(t){switch(t){case i.j.Nearest:return s.NEAREST;case i.j.Linear:return s.LINEAR;default:return w(`Unsupported texture filter: ${t}`)}}function y(t){switch(t){case i.l.Clamp:return s.CLAMP_TO_EDGE;case i.l.Repeat:return s.REPEAT;default:return w(`Unsupported texture wrap: ${t}`)}}function v(t){switch(t){case i.b.Zero:return s.ZERO;case i.b.One:return s.ONE;case i.b.Source:return s.SRC_ALPHA;case i.b.OneMinusSource:return s.ONE_MINUS_SRC_ALPHA;default:return w(`Unsupported blend factor: ${t}`)}}function x(t,e="Assert failed"){t||w(e)}function w(t){throw console.error(t),new Error(t)}function _(t,e){return void 0!==t?t:e}function M(t){return null!=t}function C(t){return void 0!==t.height}function A(t,e,r){const n=s.createShader(e);if(s.shaderSource(n,r),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){const i=e===s.VERTEX_SHADER?"Vertex":"Fragment",a=r.split("\n").map((t,e)=>`${e+1}: ${t}`).join("\n");console.error(a),w(`${i} compilation failed for shader ${t}:\n  ${s.getShaderInfoLog(n)}. See source above.`)}return n}function S(t,e,r){const n=t.vertexLayout.buffers[r],a=t.shader.reflection,o=Object.keys(n.layout);s.bindBuffer(s.ARRAY_BUFFER,e.buffer.glId);for(let t=0;t<o.length;t++){const r=n.layout[o[t]],u=a.attributes[o[t]];if(M(u))if(e.buffer){const t=c(r.type),a=h(r.type);s.enableVertexAttribArray(u.location),s.vertexAttribPointer(u.location,u.components,t,a,n.stride,r.offset+e.offset),n.stepMode===i.h.Instance&&(s.instancedArrays?s.instancedArrays.vertexAttribDivisorANGLE(u.location,1):s.vertexAttribDivisor(u.location,1))}else s.disableVertexAttribArray(u.location)}}function T(t){return t.type===i.a.Texture}class k{constructor(){this.objects=[],this.freeList=[],this.count=0}get(t){const e=this.objects[t];return x(void 0!==e,"Invalid ID"),e}create(t){if(++this.count,this.freeList.length>0){const e=this.freeList.pop();return this.objects[e]=t,e}return this.objects.push(t),this.objects.length-1}delete(t){--this.count,delete this.objects[t],this.freeList.push(t)}}class F{constructor(){this.debugEnabled=!1,this.buffers=new k,this.textures=new k,this.shaders=new k,this.renderPipelines=new k,this.resourceTables=new k,this.vertexTables=new k,this.renderPasses=new k,this.depthStencilStates=new k}initialize(t){const e={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(s=t.getContext("webgl2",e),s||(s=t.getContext("webgl",e)),!s)return!1;this.webGlVersion=s instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(t){let e,r=0;return(e=s.getExtension("OES_vertex_array_object"))&&(r|=i.f.VertexArrayObject,s.createVertexArray=e.createVertexArrayOES.bind(e),s.deleteVertexArray=e.deleteVertexArrayOES.bind(e),s.bindVertexArray=e.bindVertexArrayOES.bind(e)),(e=s.getExtension("OES_texture_half_float"))&&(r|=i.f.TextureHalf,s.HALF_FLOAT=e.HALF_FLOAT_OES),(e=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(r|=i.f.AnistropicFiltering,s.MAX_TEXTURE_MAX_ANISOTROPY_EXT=e.MAX_TEXTURE_MAX_ANISOTROPY_EXT,s.TEXTURE_MAX_ANISOTROPY_EXT=e.TEXTURE_MAX_ANISOTROPY_EXT),s.getExtension("OES_texture_float")&&(r|=i.f.TextureFloat),s.getExtension("OES_texture_float_linear")&&(r|=i.f.TextureFloatLinearFiltering),s.getExtension("OES_texture_half_float_linear")&&(r|=i.f.TextureHalfLinearFiltering),s.getExtension("OES_standard_derivatives")&&(r|=i.f.ShaderDerivatives),s.texSubImage2D&&(r|=i.f.TextureWrite),(s.instancedArrays=s.getExtension("ANGLE_instanced_arrays"))&&(r|=i.f.Instancing),r|=i.f.ShaderGlsl100,t>=2&&(r|=i.f.VertexArrayObject,r|=i.f.TextureFloat,r|=i.f.TextureHalf,r|=i.f.Instancing,r|=i.f.ShaderGlsl300),r}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:t.width,height:t.height}),x(this.defaultRenderPass===i.p),this.current={},s.clearColor(0,0,0,1);const r=new Uint8Array([0,0,0,1]),n={usage:i.o.Static,type:i.k.Texture2D,format:i.i.U8x4,width:1,height:1},a=this.createTexture("DefaultTexture",n,r);return this.defaultTexture=this.textures.get(a),this.isGfxFeatureSupported(i.f.AnistropicFiltering)&&(this.maxAnisotropy=s.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),!0}isGfxFeatureSupported(t){return!!(this.featureFlags&t)}setDebugEnabled(t){this.debugEnabled=t}resize(t,e){const r=this.renderPasses.get(this.defaultRenderPass);r.width=t,r.height=e}beginFrame(){}endFrame(){}bindRenderPass(t){const e=this.renderPasses.get(t);s.bindFramebuffer(s.FRAMEBUFFER,e.glFramebuffer),s.viewport(0,0,e.width,e.height);const r=s.COLOR_BUFFER_BIT;s.clear(r)}bindPipeline(t){const e=this.renderPipelines.get(t);this.pipeline=e,this.current.shader!==e.shader&&(s.useProgram(e.shader.glProgram),this.current.shader=e.shader),e.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=e.renderFormat.blendingEnabled,e.renderFormat.blendingEnabled?s.enable(s.BLEND):s.disable(s.BLEND)),!this.current.blending||this.current.srcBlendFactor==e.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==e.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=_(e.renderFormat.srcBlendFactor,i.b.One),this.current.dstBlendFactor=_(e.renderFormat.dstBlendFactor,i.b.OneMinusSource),s.blendFunc(v(this.current.srcBlendFactor),v(this.current.dstBlendFactor)))}draw(t,e,r,n,a){const o=u(t),c=l(r),h=i.m(r),f=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,f.glId),s.drawElements(o,a,c,n*h)}drawInstanced(t,e,r,n,a,o){const c=u(t),h=l(r),f=i.m(r),d=this.buffers.get(e);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,d.glId),s.instancedArrays?s.instancedArrays.drawElementsInstancedANGLE(c,a,h,n*f,o):s.drawElementsInstanced(c,a,h,n*f,o)}drawNonIndexed(t,e,r){const n=u(t);s.drawArrays(n,e,r)}setDepthStencilState(t){const e=this.depthStencilStates.get(t),r=this.current.depthStencil;r&&e.depthWriteEnabled==r.depthWriteEnabled||s.depthMask(e.depthWriteEnabled),r&&e.depthCompareFunc==r.depthCompareFunc||s.depthFunc(e.depthCompareFunc),r&&e.depthTestEnabled==r.depthTestEnabled||(e.depthTestEnabled?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST)),this.current.depthStencil=e}setCullMode(t){this.current.cullMode!=t&&(this.current.cullMode=t,t==i.e.None?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(function(t){switch(t){case i.e.None:return s.NONE;case i.e.Back:return s.BACK;case i.e.Front:return s.FRONT;default:return w(`Unsupported culling mode: ${t}`)}}(t))))}createDepthStencilState(t){const e=function(t){switch(t){case i.d.Never:return s.NEVER;case i.d.Less:return s.LESS;case i.d.Equal:return s.EQUAL;case i.d.LessEqual:return s.LEQUAL;case i.d.Greater:return s.GREATER;case i.d.NotEqual:return s.NOTEQUAL;case i.d.GreaterEqual:return s.GEQUAL;case i.d.Always:return s.ALWAYS;default:return w(`Unsupported compare func: ${t}`)}}(_(t.depthCompareFunc,i.d.Less));return this.depthStencilStates.create({depthTestEnabled:t.depthTestEnabled,depthWriteEnabled:t.depthWriteEnabled,depthCompareFunc:e})}createVertexTable(t){const e=this.renderPipelines.get(t);let r=null;return this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(r=s.createVertexArray()),this.vertexTables.create({pipeline:e,vao:r,buffers:[]})}removeVertexTable(t){if(this.isGfxFeatureSupported(i.f.VertexArrayObject)){const e=this.vertexTables.get(t);s.deleteVertexArray(e.vao)}this.vertexTables.delete(t)}createResourceTable(t){return this.resourceTables.create({layout:t,buffers:[],textures:[]})}removeResourceTable(t){this.resourceTables.delete(t)}bindVertices(t){const e=this.vertexTables.get(t);if(this.debugEnabled){const t=e.pipeline.shader.name,r=e.pipeline.vertexLayout.buffers.length;for(let n=0;n<r;n++)x(M(e.buffers[n]),`Shader ${t} expects a vertex buffer bound at slot ${n}`)}if(this.isGfxFeatureSupported(i.f.VertexArrayObject))s.bindVertexArray(e.vao);else for(let t=0;t<e.buffers.length;t++)S(e.pipeline,e.buffers[t],t)}bindResources(t){const e=this.resourceTables.get(t),r=this.pipeline.uniformLayout,n=this.pipeline.shader.reflection,a=this.pipeline.shader.name;for(let t=0;t<n.uniforms.length;t++){const a=n.uniforms[t],o=r[a.name],c=e.buffers[o.index].buffer.cpuBuffer;x(M(c));const u=new Float32Array(c.buffer,o.offset,a.size/4),h=this.pipeline.shader.uniformVals[a.name];if(!u.every((t,e)=>t===h[e]))switch(this.pipeline.shader.uniformVals[a.name].set(u),a.type){case i.n.Float:s.uniform1fv(a.location,u);break;case i.n.Float2:s.uniform2fv(a.location,u);break;case i.n.Float3:s.uniform3fv(a.location,u);break;case i.n.Float4:s.uniform4fv(a.location,u);break;case i.n.Float3x3:s.uniformMatrix3fv(a.location,!1,u);break;case i.n.Float4x4:s.uniformMatrix4fv(a.location,!1,u);break;default:w("Unknown shader uniform type")}}for(let t=0;t<n.textureArray.length;t++){const i=n.textureArray[t],o=r[i.name].index;void 0===e.textures[o]&&console.warn(`Shader ${a} expects texture "${i.name}" (index ${o}) to be bound`);for(let t=0;t<i.count;t++){const r=e.textures[o+t]||this.defaultTexture,n=i.location+t;s.activeTexture(s.TEXTURE0+n),s.bindTexture(r.target,r.glId)}}}setVertexBuffer(t,e,r){const n=this.vertexTables.get(t),a={buffer:this.buffers.get(r.buffer),offset:r.byteOffset||0};x(e<i.s),n.buffers[e]=a,this.isGfxFeatureSupported(i.f.VertexArrayObject)&&(s.bindVertexArray(n.vao),S(n.pipeline,a,e))}setBuffer(t,e,r){const n=this.resourceTables.get(t),i=this.buffers.get(r.buffer);n.buffers[e]={buffer:i,offset:r.byteOffset||0}}setTexture(t,e,r){const n=this.resourceTables.get(t),i=r?this.textures.get(r):null;n.textures[e]=i}setTextures(t,e,r){const n=this.resourceTables.get(t);for(let t=0;t<r.length;t++){const i=r[t]?this.textures.get(r[t]):null;n.textures[e+t]=i}}writeBufferData(t,e,r){const n=this.buffers.get(t);if(n.type===i.c.Uniform){const t=ArrayBuffer.isView(r)?r.buffer:r,i=new Uint8Array(t);M(n.cpuBuffer)?n.cpuBuffer.set(i,e):w("No CPU buffer assigned to uniform buffer")}else s.bindBuffer(n.target,n.glId),s.bufferSubData(n.target,e,r)}createRenderPipeline(t,e,r,n){const s=this.shaders.get(t),a=Object.keys(n),o=a.map(t=>n[t]),c=s.reflection;if(this.debugEnabled){for(const t of a){const e=n[t];e.type===i.a.UniformBuffer&&x(void 0!==e.layout,`A BufferLayout must be provided for UniformBuffer "${t}" in the ResourceLayout passed to createRenderPipeline()`+"to define uniform binding locations. In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader")}for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],r=o.find(t=>!T(t)&&t.layout&&t.layout[e.name]);x(void 0!==r,`Shader '${s.name}' expects uniform '${e.name}' to be set in a uniform buffer`);const n=r.layout[e.name].type;if(x(n===e.type,`Shader '${s.name}' expects uniform '${e.name}' to be type ${e.type} but the ShaderResourceLayout specifies type ${n}`),e.count>1){const t=r.layout[e.name].count;x(void 0!==t,`Shader '${s.name}' expects uniform '${e.name}' to be an array but the ShaderResourceLayout specifies a scalar value`),x(t>=e.count,`Shader '${s.name}' expects uniform '${e.name}' to be an array of length ${e.count} but the ShaderResourceLayout specifies a length of ${t}`)}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],r=o.find((t,r)=>T(t)&&a[r]===e.name);x(void 0!==r,`Shader '${s.name}' expects texture '${e.name}', but it is not defined in the ShaderResourceLayout`),x((r.count||1)===e.count,`Shader '${s.name}' expects texture '${e.name}' to be an array of length ${e.count}, but the ResourceLayout specifies length ${r.count}`)}Object.keys(c.attributes).forEach(t=>{x(void 0!==r.buffers.find(e=>e&&void 0!==e.layout[t]),`VertexLayout does not supply attribute ${t} required by Shader '${s.name}'`)}),this.isGfxFeatureSupported(i.f.Instancing)||r.buffers.forEach(t=>{x(t.stepMode!==i.h.Instance,"Instancing is not supported by this WebGL context")})}const u={};for(let t=0;t<c.uniforms.length;t++){const e=c.uniforms[t],r=o.find(t=>!T(t)&&t.layout&&t.layout[e.name]);u[e.name]={offset:r.layout[e.name].offset,index:r.index}}for(let t=0;t<c.textureArray.length;t++){const e=c.textureArray[t],r=n[e.name];u[e.name]={offset:0,index:r.index}}return this.renderPipelines.create({shader:s,renderFormat:e,vertexLayout:r,resourceLayout:n,uniformLayout:u})}removeRenderPipeline(t){this.renderPipelines.delete(t)}createShader(t){return this._createShader(t.name,t.vertSource,t.fragSource)}_createShader(t,e,r){const n=function(t,e,r){const n=A(t,s.VERTEX_SHADER,e),i=A(t,s.FRAGMENT_SHADER,r),a=s.createProgram();return s.attachShader(a,n),s.attachShader(a,i),s.linkProgram(a),s.deleteShader(n),s.deleteShader(i),s.getProgramParameter(a,s.LINK_STATUS)||w(`Linking failed for shader ${t}:\n  ${s.getProgramInfoLog(a)}`),a}(t,e instanceof Array?e.join("\n#line 0\n"):e,r instanceof Array?r.join("\n#line 0\n"):r),u=function(t){const e={},r=[],n=[],u={};let h=0;const l=s.getProgramParameter(t,s.ACTIVE_ATTRIBUTES);x(l<i.q);for(let e=0;e<l;e++){const r=s.getActiveAttrib(t,e),n=a(r.type);u[r.name]={location:e,count:r.size,components:o(n),glType:c(n),type:n}}const f=s.getProgramParameter(t,s.ACTIVE_UNIFORMS);x(f<i.r);for(let o=0;o<f;o++){const c=s.getActiveUniform(t,o),u=a(c.type),l=c.name.replace("[0]","");if(u>=i.k.Texture2D&&u<=i.k.TextureCube){const n={name:l,count:c.size,type:u,location:h,locationGl:s.getUniformLocation(t,c.name)};h+=c.size,e[l]=n,r.push(n)}else{const e={name:l,count:c.size,type:u,size:i.m(u)*c.size,location:s.getUniformLocation(t,c.name)};n.push(e)}}return{attributes:u,uniforms:n,textures:e,textureArray:r,textureCount:h}}(n),h={};for(let t=0;t<u.uniforms.length;t++){const e=u.uniforms[t];h[e.name]=new Float32Array(e.size/4)}s.useProgram(n);const l=Object.keys(u.textures);for(let t=0;t<l.length;t++){const e=u.textures[l[t]],r=Array.from(Array(e.count).keys()).map((t,r)=>e.location+r);s.uniform1iv(e.locationGl,r)}return this.current.shader=void 0,this.shaders.create({name:t,glProgram:n,reflection:u,uniformVals:h})}removeShader(t){const e=this.shaders.get(t);s.deleteProgram(e.glProgram),this.shaders.delete(t)}createTexture(t,e,r){const n=!r||r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength,a=1===this.webGlVersion?d:p,o={target:f(e.type),format:a(e.format),internalFormat:this.webGlVersion>1?m(e.format):a(e.format),type:g(e.format),usage:e.usage,width:n?_(e.width,1):r.width,height:n?_(e.height,1):r.height,depth:e.depth||1,minFilter:b(void 0!==e.defaultMinFilter?e.defaultMinFilter:i.j.Linear),magFilter:b(void 0!==e.defaultMagFilter?e.defaultMagFilter:i.j.Linear),wrapS:y(void 0!==e.defaultWrapS?e.defaultWrapS:i.l.Repeat),wrapT:y(void 0!==e.defaultWrapT?e.defaultWrapT:i.l.Repeat),glId:s.createTexture()};if(s.bindTexture(o.target,o.glId),s.texParameteri(o.target,s.TEXTURE_MIN_FILTER,o.minFilter),s.texParameteri(o.target,s.TEXTURE_MAG_FILTER,o.magFilter),s.texParameteri(o.target,s.TEXTURE_WRAP_S,o.wrapS),s.texParameteri(o.target,s.TEXTURE_WRAP_T,o.wrapT),M(e.maxAnistropy)&&e.maxAnistropy>1&&this.isGfxFeatureSupported(i.f.AnistropicFiltering)){const t=Math.min(this.maxAnisotropy,e.maxAnistropy);s.texParameterf(s.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,t)}const c=this.webGlVersion>1?o.internalFormat:o.format;if(e.type===i.k.Texture3D)s.texImage3D(o.target,0,c,o.width,o.height,o.depth,0,o.format,o.type,r);else if(n)r instanceof ArrayBuffer&&(r=new Uint8Array(r)),s.texImage2D(o.target,0,c,o.width,o.height,0,o.format,o.type,r);else if(void 0!==r)s.texImage2D(o.target,0,c,o.format,o.type,r);else{x(void 0!==o.width&&void 0!==o.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),s.texImage2D(o.target,0,c,e.width,e.height,0,o.format,o.type,null)}return this.textures.create(o)}writeTextureData(t,e){const r=this.textures.get(t);x(r.target===s.TEXTURE_2D,"Currently only 2D textures may be written to"),s.bindTexture(r.target,r.glId);const n=C(e)?e.width!==r.width:!!C(e)&&e.height!==r.height;this.isGfxFeatureSupported(i.f.TextureWrite)&&!n?C(e)?s.texSubImage2D(r.target,0,0,0,r.format,r.type,e):s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,e):s.texImage2D(r.target,0,r.internalFormat,r.format,r.type,e)}removeTexture(t){const e=this.textures.get(t);s.deleteTexture(e.glId),this.textures.delete(t)}createBuffer(t,e,r,n){let a,o;x(r!=i.o.None);const c=function(t){switch(t){case i.c.Undefined:return 0;case i.c.Uniform:return s.UNIFORM_BUFFER;case i.c.Vertex:return s.ARRAY_BUFFER;case i.c.Index:return s.ELEMENT_ARRAY_BUFFER;case i.c.Readback:return s.TRANSFORM_FEEDBACK_BUFFER}}(e),u=t=>Number.isInteger(t),h=t=>t instanceof ArrayBuffer,l=u(n)?null:n,f=u(n)?n:n.byteLength;if(x(f>0||null!==l,"Either an ArrayBuffer or size must be provided"),e!=i.c.Uniform)o=s.createBuffer(),s.bindBuffer(c,o),s.bufferData(c,n,r==i.o.Dynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW);else if(l){const t=h(l)?l:l.buffer,e=h(l)?0:l.byteOffset;a=new Uint8Array(t,e,f)}else a=new Uint8Array(f);return this.buffers.create({name:t,type:e,target:c,usage:r,size:f,glId:o,cpuBuffer:a})}removeBuffer(t){const e=this.buffers.get(t);e.type!=i.c.Uniform&&s.deleteBuffer(e.glId),this.buffers.delete(t)}readPixels(t,e,r,n,i){s.readPixels(t,e,r,n,s.RGBA,s.UNSIGNED_BYTE,i)}}var O=r(2),E=r(0);class j{constructor(t,e,r=1,n=2e4){this.cameraMatrix=O.b.create(),this.viewMatrix=O.b.create(),this.projectionMatrix=O.b.create(),this.projectionMatrixInverse=O.b.create(),this.viewProjMatrix=O.b.create(),this.viewProjMatrixInverse=O.b.create(),this.forward=O.e.create(),this.up=O.e.create(),this.right=O.e.create(),t=Object(E.d)(t,60/180*Math.PI),r=Object(E.d)(r,1),n=Object(E.d)(n,2e3),e=Object(E.d)(e,1),this.setPerspective(t,e,r,n)}copy(t){this.fov=t.fov,this.near=t.near,this.far=t.far,this.aspect=t.aspect,O.b.copy(this.cameraMatrix,t.cameraMatrix),O.b.copy(this.viewMatrix,t.viewMatrix),O.b.copy(this.projectionMatrix,t.projectionMatrix),O.b.copy(this.projectionMatrixInverse,t.projectionMatrixInverse),O.b.copy(this.viewProjMatrix,t.viewProjMatrix),O.b.copy(this.viewProjMatrixInverse,t.viewProjMatrixInverse),O.e.copy(this.forward,t.forward),O.e.copy(this.up,t.up),O.e.copy(this.right,t.right)}getPos(t){return O.b.getTranslation(t,this.cameraMatrix)}viewMatrixUpdated(){O.b.invert(this.cameraMatrix,this.viewMatrix),O.e.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),O.e.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),O.e.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),O.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),O.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(t,e,r,n=1/0){this.fov=t,this.aspect=e,this.near=r,this.far=n,O.b.perspective(this.projectionMatrix,t,e,r,n),O.b.invert(this.projectionMatrixInverse,this.projectionMatrix),O.b.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),O.b.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}var B=r(41),R=r(29),I=r(5),P=r(9);const U=O.e.create(),D=O.e.create(),L=new P.c(O.e.create()),N=O.e.fromValues(0,1,0);class V{constructor(t){this.camera=t,this.camPos=O.e.create()}initialize(t){const e=window.innerWidth/window.innerHeight;this.resize(e),this.controller=new z,this.controller.camera=this.camera,this.controller.initialize(t)}resize(t){this.camera.setPerspective(this.camera.fov,t,this.camera.near,this.camera.far)}update(t){this.controller.update(t);const e=this.camera.getPos(this.camPos);t.globalUniforms.buffer.setVec3("g_camPos",e),t.globalUniforms.buffer.setMat4("g_proj",this.camera.projectionMatrix),t.globalUniforms.buffer.setMat4("g_viewProj",this.camera.viewProjMatrix)}toJSON(){return this.controller.toJSON()}fromJSON(t){return this.controller.fromJSON(t)}}class z{constructor(){this.minDistance=500,this.maxDistance=800}initialize(t){const e=L.buffer,r=O.e.add(U,e,O.e.set(U,1e3,700,0));O.b.lookAt(this.camera.viewMatrix,r,e,N),this.camera.viewMatrixUpdated(),this.heading=Math.atan2(this.camera.forward[0],this.camera.forward[2]),this.pitch=.5*Math.PI,this.distance=1e3;const n=t.debugMenu.addFolder("FollowCam");n.add(this,"pitch",0,.5*Math.PI,.01*Math.PI),n.add(this,"minDistance",500,2e3,100),n.add(this,"maxDistance",500,3e3,100)}update(t){if(this.follow=t.avatar.localAvatar,!this.follow)return!1;this.follow.getWorldPosition(L);const e=O.e.add(L.buffer,L.buffer,O.e.set(D,0,250,0)),r=this.camera.getPos(U),n=O.e.subtract(U,e,r),i=O.e.length(n),s=Math.atan2(n[2],n[0]);let a=Object(I.b)(this.heading,s);this.heading=(this.heading+a)%6.283,this.distance=Object(I.c)(i,this.minDistance,this.maxDistance);const o=function(t,e,r){const n=Math.sin(r);return t[0]=n*Math.cos(e),t[1]=Math.cos(r),t[2]=n*Math.sin(e),t}(U,this.heading+Math.PI,this.pitch),c=O.e.scale(U,o,this.distance),u=O.e.add(U,e,c);return O.b.lookAt(this.camera.viewMatrix,u,e,N),this.camera.viewMatrixUpdated(),!1}toJSON(){return""}fromJSON(t){}}var q=r(42),W=r(8);class H{constructor(t,e){this.canvas=t,this.gfxDevice=e,this.resolutionScale=1}initialize({debugMenu:t}){for(let t in W.a)W.a[t].defaultDepthStateId=this.gfxDevice.createDepthStencilState(W.a[t].defaultDepthState);t.addFolder("Compositor").add(this,"resolutionScale",1,16,1)}render(){this.width=this.canvas.clientWidth*devicePixelRatio/this.resolutionScale,this.height=this.canvas.clientHeight*devicePixelRatio/this.resolutionScale,this.width===this.canvas.width&&this.height===this.canvas.height||(this.canvas.width=this.width,this.canvas.height=this.height,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)),this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(i.p),Y(this.gfxDevice,W.a.opaque),Y(this.gfxDevice,W.a.skybox),Y(this.gfxDevice,W.a.effects),Y(this.gfxDevice,W.a.debug),this.gfxDevice.endFrame();for(let t in W.a)W.a[t].primitives.length=0}resize(t,e,r){this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`,this.canvas.style.position="absolute"}}function Y(t,e){const r=e.primitives.length;for(let n=0;n<r;n++){const r=e.primitives[n];if(t.bindPipeline(r.renderPipeline),t.bindVertices(r.vertexTable),t.bindResources(r.resourceTable),t.setCullMode(e.defaultCullMode),t.setDepthStencilState(e.defaultDepthStateId),Object(E.e)(r.indexBuffer)){const e=r.indexType===i.n.Ushort?2:4,n=Object(E.d)(r.indexBuffer.byteOffset,0)/e;Object(E.e)(r.instanceCount)?t.drawInstanced(r.type,r.indexBuffer.buffer,Object(E.c)(r.indexType),n,r.elementCount,r.instanceCount):t.draw(r.type,r.indexBuffer.buffer,Object(E.c)(r.indexType),n,r.elementCount)}else t.drawNonIndexed(r.type,0,r.elementCount)}}var G=r(93),X=r.n(G),$=r(94),K=r.n($),J=r(21);class Z{constructor(t,e,r){this.resourceTable=r,this.vertexTable=e,this.renderPipeline=t,this.elementCount=0,this.type=i.g.Triangles}}var Q=r(7);class tt{constructor(){this.name="GridShader",this.vertSource=tt.vert.sourceCode,this.fragSource=tt.frag.sourceCode}}tt.vert=X.a,tt.frag=K.a,tt.UniformLayout=Object(Q.b)({u_baseColor:{type:i.n.Float4},u_lineColor:{type:i.n.Float4},u_gridUnit:{type:i.n.Float},u_gridRadius:{type:i.n.Float}}),tt.resourceLayout={globalUniforms:{index:0,type:i.a.UniformBuffer,layout:J.a.bufferLayout},uniforms:{index:1,type:i.a.UniformBuffer,layout:tt.UniformLayout}};class et{constructor(){this.baseColor=O.f.fromValues(.3,.3,.3,1),this.lineColor=O.f.fromValues(1,1,1,1),this.gridUnit=100,this.gridRadius=5e3,this.enabled=!1}initialize({gfxDevice:t,globalUniforms:e,debugMenu:r}){if(!t.isGfxFeatureSupported(i.f.ShaderGlsl300))return console.warn("GLSL version 300 not supported, disabling DebugGrid"),void(this.enabled=!1);const n=t.createShader(new tt),s=tt.resourceLayout,a={buffers:[{stride:2,layout:{a_pos:{type:i.n.Char2,offset:0}}}]},o=t.createRenderPipeline(n,{blendingEnabled:!1},a,s),c=t.createBuffer("GridVertices",i.c.Vertex,i.o.Static,new Int8Array([-1,-1,1,-1,-1,1,1,1])),u=t.createBuffer("GridIndices",i.c.Index,i.o.Static,new Uint16Array([0,2,1,1,2,3])),h=t.createResourceTable(s);this.uniforms=new Q.a("GridUniforms",t,tt.UniformLayout),t.setBuffer(h,0,e.bufferView),t.setBuffer(h,1,this.uniforms.getBufferView());const l=t.createVertexTable(o);t.setVertexBuffer(l,0,{buffer:c}),this.primitive=new Z(o,l,h),this.primitive.indexBuffer={buffer:u},this.primitive.indexType=i.n.Ushort,this.primitive.elementCount=6;const f=r.addFolder("DebugGrid");f.add(this,"enabled"),f.add(this,"gridUnit",1,100,10),f.add(this,"gridRadius")}render({gfxDevice:t}){this.enabled&&(this.uniforms.setVec4("u_baseColor",this.baseColor),this.uniforms.setVec4("u_lineColor",this.lineColor),this.uniforms.setFloat("u_gridUnit",this.gridUnit),this.uniforms.setFloat("u_gridRadius",this.gridRadius),this.uniforms.write(t),W.a.opaque.push(this.primitive))}}var rt=r(22),nt=r(43),it=r(45);class st{constructor(){this.clearing=!1}initialize(t){t.debugMenu.add(this,"clearState"),this.loadState(t)&&console.log("Loaded state from localStorage")}saveState({cameraSystem:t,debugMenu:e}){const r={version:1,cameraSystem:t,debugMenu:e},n=JSON.stringify(r);this.clearing||window.localStorage.setItem("state",n)}loadState({cameraSystem:t,debugMenu:e}){const r=window.localStorage.getItem("state");if(!Object(E.e)(r))return!1;const n=JSON.parse(r);if(1!==n.version)return!1;try{t.fromJSON(n.cameraSystem),e.fromJSON(n.debugMenu)}catch(t){return console.warn("Failed to load state:",t),!1}return!0}clearState(){window.localStorage.removeItem("state"),this.clearing=!0,location.reload()}update(t){n.b&&this.saveState(t)}}var at=r(15),ot=r(17),ct=r(44),ut=r(24),ht=r(10),lt=r(95),ft=r.n(lt),dt=r(96),pt=r.n(dt),mt=r(11);class gt{constructor(){this.position=O.e.create(),this.color=O.f.create(),this.power=0,this.fluctuation=0}}class bt{constructor(){this.actorColor={diffuse:O.f.create(),ambient:O.f.create()},this.backgroundColor={diffuse:O.f.create(),ambient:O.f.create()},this.hazeColor=O.f.create(),this.cloudCenterColor=O.f.create(),this.cloudColor=O.f.create(),this.skyColor=O.f.create(),this.oceanColor=O.f.create(),this.windVec=O.e.create(),this.baseLight=new gt,this.localLights=[],this.moonPos=O.e.create()}addLocalLight(t){this.localLights.push(t)}}const yt={hazeColor:O.f.fromValues(.23529411764705882,.29411764705882354,.39215686274509803,1),cloudCenterColor:O.f.fromValues(.22745098039215686,.39215686274509803,.5254901960784314,0),cloudColor:O.f.fromValues(.20392156862745098,.33725490196078434,.47058823529411764,.39215686274509803),skyColor:O.f.fromValues(.0392156862745098,.19607843137254902,.3333333333333333,1),oceanColor:O.f.fromValues(0,.19215686274509805,.2901960784313726,1)},vt={blendPaletteAB:.7710301333335425,actorColor:{diffuse:O.f.fromValues(.4666666666666667,.5803921568627451,.6901960784313725,1),ambient:O.f.fromValues(.3176470588235294,.39215686274509803,.5803921568627451,1)},backgroundColor:[{diffuse:O.f.fromValues(.19215686274509805,.30980392156862746,.44313725490196076,1),ambient:O.f.fromValues(.2901960784313726,.5490196078431373,.6627450980392157,1)},{diffuse:O.f.fromValues(0,.4117647058823529,.6078431372549019,1),ambient:O.f.fromValues(.027450980392156862,.23137254901960785,.39215686274509803,1)},{diffuse:O.f.fromValues(1,.8901960784313725,.48627450980392156,1),ambient:O.f.fromValues(.792156862745098,.5686274509803921,.592156862745098,1)},{diffuse:O.f.fromValues(1,.8117647058823529,.12941176470588237,1),ambient:O.f.fromValues(0,0,0,1)}],fogColor:O.f.fromValues(.09019607843137255,.12549019607843137,.20392156862745098,1),fogEndZ:3e4,fogStartZ:1e4},xt=Object(Q.b)({u_actorDiffuse:{type:i.n.Float4},u_actorAmbient:{type:i.n.Float4},u_backgroundDiffuse:{type:i.n.Float4},u_backgroundAmbient:{type:i.n.Float4},u_hazeColor:{type:i.n.Float4},u_cloudColor:{type:i.n.Float4},u_skyColor:{type:i.n.Float4},u_oceanColor:{type:i.n.Float4},u_baseLightPos:{type:i.n.Float3},u_baseLightColor:{type:i.n.Float4}});class wt{constructor(){this.current=new bt,this.moonAzimuth=.25*Math.PI,this.moonPolar=.25*Math.PI}initialize({gfxDevice:t,debugMenu:e}){this.uniforms=new Q.a("EnvUniforms",t,xt);const r=e.addFolder("Environment");r.add(this,"moonAzimuth",.001,2*Math.PI),r.add(this,"moonPolar",.001,.5*Math.PI)}update({gfxDevice:t}){const e=Math.cos(this.moonAzimuth)*Math.cos(this.moonPolar),r=Math.sin(this.moonAzimuth)*Math.cos(this.moonPolar),n=Math.sin(this.moonPolar);O.e.set(this.current.moonPos,1e5*e,1e5*n,1e5*r),this.current.baseLight.position=this.current.moonPos,O.f.set(this.current.baseLight.color,1,1,1,1),this.current.baseLight.power=0,this.current.baseLight.fluctuation=0,Object.assign(this.current,yt),this.current.actorColor=vt.actorColor,this.current.backgroundColor=vt.backgroundColor[0],this.current.windPower=1,O.e.set(this.current.windVec,0,0,1),this.uniforms.setVec4("u_actorDiffuse",this.current.actorColor.diffuse),this.uniforms.setVec4("u_actorAmbient",this.current.actorColor.diffuse),this.uniforms.setVec4("u_backgroundDiffuse",this.current.backgroundColor.diffuse),this.uniforms.setVec4("u_backgroundAmbient",this.current.backgroundColor.ambient),this.uniforms.setVec4("u_hazeColor",this.current.hazeColor),this.uniforms.setVec4("u_cloudColor",this.current.cloudColor),this.uniforms.setVec4("u_skyColor",this.current.skyColor),this.uniforms.setVec4("u_oceanColor",this.current.oceanColor),this.uniforms.setVec3("u_baseLightPos",this.current.baseLight.position),this.uniforms.setVec3("u_baseLightColor",this.current.baseLight.color),this.uniforms.write(t)}static get bufferLayout(){return xt}getUniformBuffer(){return this.uniforms}getCurrentEnvironment(){return this.current}}const _t=O.f.create();class Mt{constructor(){this.name="Stage",this.vertSource=ft.a.sourceCode,this.fragSource=pt.a.sourceCode}}Mt.uniformLayout=Object(Q.b)({u_model:{type:i.n.Float4x4},u_torchColor:{type:i.n.Float4}}),Mt.resourceLayout={model:{index:0,type:i.a.UniformBuffer,layout:Mt.uniformLayout},global:{index:1,type:i.a.UniformBuffer,layout:J.a.bufferLayout},env:{index:2,type:i.a.UniformBuffer,layout:wt.bufferLayout},u_tex:{index:2,type:i.a.Texture}};class Ct{constructor(){this.models=[],this.show=!0,this.torchPower=3e3,this.torchColor=[225,111,10,1],this.torchFlicker=1}initialize({resources:t,gfxDevice:e,globalUniforms:r,environment:n,particles:i,debugMenu:s}){this.shader=e.createShader(new Mt),t.load(Ct.filename,"gltf",(t,s)=>{Object(E.b)(!t,t),this.onResourcesLoaded(e,r,n,s,i)});const a=s.addFolder("Stage");a.add(this,"show"),a.add(this,"torchPower",0,1e4),a.addColor(this,"torchColor")}onResourcesLoaded(t,e,r,n,i){var s,a;const o=n;for(const n of o.nodes)if(Object(E.e)(n.meshId)){const c=o.meshes[n.meshId],u=c.primitives[0],h=o.textures[0].id,l=new mt.a(t,"Arena",this.shader,Mt.resourceLayout),f=new mt.b(t,W.a.opaque,u.mesh,l);null===(s=n)||void 0===s||s.updateMatrixWorld();const d=O.b.fromValues.apply(null,null===(a=n)||void 0===a?void 0:a.matrixWorld.elements),p=O.b.fromScaling(O.b.create(),O.e.fromValues(Ct.outerRadius,Ct.outerRadius,Ct.outerRadius));O.b.multiply(d,p,d),"Sconce"===c.name&&At(d,r.getCurrentEnvironment(),i);const m=new Q.a("ArenaUniforms",t,Mt.uniformLayout);m.setMat4("u_model",d),m.write(t),l.setUniformBuffer(t,"model",m),l.setUniformBuffer(t,"env",r.getUniformBuffer()),l.setUniformBuffer(t,"global",e.buffer),l.setTexture(t,"u_tex",h),this.models.push(f)}}render({environment:t,gfxDevice:e}){if(!this.show)return;const r=t.getCurrentEnvironment(),n=1-.3*Math.random();this.torchFlicker=Object(I.f)(this.torchFlicker,n,.2);for(let t=0;t<r.localLights.length;t++){const e=r.localLights[t];e.power=this.torchPower*this.torchFlicker,O.f.set(e.color,this.torchColor[0]/255,this.torchColor[1]/255,this.torchColor[2]/255,this.torchColor[3]/255)}if(this.models.length>0){const t=this.models[0].material.getUniformBuffer("model");t.setVec4("u_torchColor",O.f.scale(_t,r.localLights[0].color,this.torchFlicker)),t.write(e)}for(let t=0;t<this.models.length;t++)this.models[t]&&this.models[t].renderList.push(this.models[t].primitive)}}function At(t,e,r){e.addLocalLight({position:O.b.getTranslation(O.e.create(),t),color:O.f.fromValues(1,0,0,1),fluctuation:.9,power:400});const n=Object(E.c)(r.createEmitter(0));O.b.getTranslation(n.pos,t),n.pos[1]+=100,O.d.set(n.scale2D,3,3)}Ct.filename="data/Arena.glb",Ct.outerRadius=2e3;var St=r(97),Tt=r.n(St),kt=r(98),Ft=r.n(kt),Ot=r(99),Et=r.n(Ot),jt=r(100),Bt=r.n(jt),Rt=r(101),It=r.n(Rt),Pt=r(102),Ut=r.n(Pt);class Dt{constructor(){this.name="BackgroundCloud",this.vertSource=Tt.a.sourceCode,this.fragSource=Ft.a.sourceCode}}Dt.uniformLayout=Object(Q.b)({u_color:{type:i.n.Float4},u_scroll:{type:i.n.Float},u_yOffset:{type:i.n.Float}}),Dt.resourceLayout={global:{index:0,type:i.a.UniformBuffer,layout:J.a.bufferLayout},model:{index:1,type:i.a.UniformBuffer,layout:Dt.uniformLayout},u_tex:{index:2,type:i.a.Texture}};class Lt{constructor(){this.name="Flat",this.vertSource=Et.a.sourceCode,this.fragSource=Bt.a.sourceCode}}Lt.uniformLayout=Object(Q.b)({u_color:{type:i.n.Float4}}),Lt.resourceLayout={global:{index:0,type:i.a.UniformBuffer,layout:J.a.bufferLayout},model:{index:1,type:i.a.UniformBuffer,layout:Lt.uniformLayout}};class Nt{constructor(){this.name="Fade",this.vertSource=It.a.sourceCode,this.fragSource=Ut.a.sourceCode}}Nt.uniformLayout=Object(Q.b)({u_colorA:{type:i.n.Float4},u_colorB:{type:i.n.Float4},u_height:{type:i.n.Float},u_yOffset:{type:i.n.Float}}),Nt.resourceLayout={global:{index:0,type:i.a.UniformBuffer,layout:J.a.bufferLayout},model:{index:1,type:i.a.UniformBuffer,layout:Nt.uniformLayout}};const Vt={hazeColor:O.f.fromValues(.23529411764705882,.29411764705882354,.39215686274509803,1),cloudCenterColor:O.f.fromValues(.22745098039215686,.39215686274509803,.5254901960784314,0),cloudColor:O.f.fromValues(.20392156862745098,.33725490196078434,.47058823529411764,.39215686274509803),skyColor:O.f.fromValues(.0392156862745098,.19607843137254902,.3333333333333333,1),oceanColor:O.f.fromValues(0,.19215686274509805,.2901960784313726,1)};class zt{constructor(){this.cloudModels=[],this.cloudScrollNear=0,this.cloudScrollMid=0,this.cloudScrollFar=0,this.enableSky=!0,this.enableFarHaze=!0,this.enableFarClouds=!0,this.enableMiddleClouds=!0,this.enableNearClouds=!0,this.enableNearHaze=!0,this.enableOcean=!0,this.yOffset=0,this.cloudYOffset=-3,this.farHazeYOffset=-4.3,this.farHazeHeight=27,this.nearHazeHeight=18,this.nearHazeYOffset=.1}initialize({resources:t,gfxDevice:e,globalUniforms:r,debugMenu:n}){this.bgCloudShader=e.createShader(new Dt),this.flatShader=e.createShader(new Lt),this.fadeShader=e.createShader(new Nt),t.load(zt.filename,"gltf",(t,n)=>{Object(E.b)(!t,t),this.onResourcesLoaded(e,r,n)});const i=n.addFolder("Skybox");i.add(this,"enableSky"),i.add(this,"enableFarHaze"),i.add(this,"enableFarClouds"),i.add(this,"enableMiddleClouds"),i.add(this,"enableNearClouds"),i.add(this,"enableNearHaze"),i.add(this,"enableOcean"),i.add(this,"yOffset",-50,20),i.add(this,"cloudYOffset",-10,20,.25),i.add(this,"farHazeYOffset",-50,50),i.add(this,"farHazeHeight",5,50),i.add(this,"nearHazeYOffset",-50,50),i.add(this,"nearHazeHeight",5,50)}onResourcesLoaded(t,e,r){const n=r,i=r=>{const n=r.primitives[0].mesh,i=new mt.a(t,"BackgroundCloud",this.bgCloudShader,Dt.resourceLayout),s=new mt.b(t,W.a.skybox,n,i);return i.setUniformBuffer(t,"global",e.buffer),i.setUniformBuffer(t,"model",new Q.a("CloudUniforms",t,Dt.uniformLayout)),s},s=Object(E.c)(n.meshes.find(t=>"Sky"===t.name)).primitives[0].mesh,a=new mt.a(t,"Sky",this.flatShader,Lt.resourceLayout);a.setUniformBuffer(t,"global",e.buffer),a.setUniformBuffer(t,"model",new Q.a("SkyUniforms",t,Lt.uniformLayout)),this.skyModel=new mt.b(t,W.a.skybox,s,a);const o=Object(E.c)(n.meshes.find(t=>"Haze"===t.name)).primitives[0].mesh,c=new mt.a(t,"Haze",this.fadeShader,Nt.resourceLayout);c.setUniformBuffer(t,"global",e.buffer),c.setUniformBuffer(t,"model",new Q.a("HazeUniforms",t,Nt.uniformLayout)),this.bgHazeModel=new mt.b(t,W.a.skybox,o,c);const u=new mt.a(t,"Haze",this.fadeShader,Nt.resourceLayout);u.setUniformBuffer(t,"global",e.buffer),u.setUniformBuffer(t,"model",new Q.a("HazeUniforms",t,Nt.uniformLayout)),this.fgHazeModel=new mt.b(t,W.a.skybox,o,u);const h=Object(E.c)(n.meshes.find(t=>"Ocean"===t.name)).primitives[0].mesh,l=new mt.a(t,"Ocean",this.flatShader,Lt.resourceLayout);l.setUniformBuffer(t,"global",e.buffer),l.setUniformBuffer(t,"model",new Q.a("OceanUniforms",t,Lt.uniformLayout)),this.oceanModel=new mt.b(t,W.a.skybox,h,l);const f=n.textures[0].id,d=n.textures[1].id,p=Object(E.c)(n.nodes.find(t=>"CloudNear"===t.name)),m=Object(E.c)(n.nodes.find(t=>"CloudMiddle"===t.name)),g=Object(E.c)(n.nodes.find(t=>"CloudFar"===t.name)),b=i(n.meshes[p.meshId]),y=i(n.meshes[m.meshId]),v=i(n.meshes[g.meshId]);b.material.setTexture(t,"u_tex",f),y.material.setTexture(t,"u_tex",d),v.material.setTexture(t,"u_tex",f),this.cloudModels.push(v,y,b)}update({gfxDevice:t,clock:e,camera:r}){if(0===this.cloudModels.length)return;const n=O.e.fromValues(0,0,1),i=Vt,s=r.forward[0],a=r.forward[2],o=n[0],c=n[2],u=1*e.renderDt*15e-6*(-o*a- -c*s);this.cloudScrollNear=(this.cloudScrollNear+1*u)%1,this.cloudScrollMid=(this.cloudScrollMid+.8*u)%1,this.cloudScrollFar=(this.cloudScrollFar+.6*u)%1;const h=this.cloudModels[0].material.getUniformBuffer("model"),l=this.cloudModels[1].material.getUniformBuffer("model"),f=this.cloudModels[2].material.getUniformBuffer("model");h.setFloat("u_scroll",this.cloudScrollFar),l.setFloat("u_scroll",this.cloudScrollMid),f.setFloat("u_scroll",this.cloudScrollNear),h.setVec4("u_color",i.cloudColor),l.setVec4("u_color",i.cloudColor),f.setVec4("u_color",i.cloudColor),h.setFloat("u_yOffset",this.cloudYOffset+this.yOffset),l.setFloat("u_yOffset",this.cloudYOffset+this.yOffset),f.setFloat("u_yOffset",this.cloudYOffset+this.yOffset),h.write(t),l.write(t),f.write(t);const d=this.skyModel.material.getUniformBuffer("model");d.setVec4("u_color",i.skyColor),d.write(t);const p=this.oceanModel.material.getUniformBuffer("model");p.setVec4("u_color",i.oceanColor),p.write(t);const m=this.bgHazeModel.material.getUniformBuffer("model");m.setVec4("u_colorA",i.hazeColor),m.setVec4("u_colorB",i.skyColor),m.setFloat("u_height",this.farHazeHeight),m.setFloat("u_yOffset",this.farHazeYOffset+this.yOffset),m.write(t);const g=this.fgHazeModel.material.getUniformBuffer("model"),b=O.f.clone(i.hazeColor),y=i.cloudColor[3];b[3]=y,g.setVec4("u_colorA",b),b[3]=0,g.setVec4("u_colorB",b),g.setFloat("u_height",this.nearHazeHeight),g.setFloat("u_yOffset",this.nearHazeYOffset+this.yOffset),g.write(t)}render({}){this.cloudModels.length>0&&(this.enableSky&&this.skyModel.renderList.push(this.skyModel.primitive),this.enableFarHaze&&this.bgHazeModel.renderList.push(this.bgHazeModel.primitive),this.enableFarClouds&&this.cloudModels[0].renderList.push(this.cloudModels[0].primitive),this.enableMiddleClouds&&this.cloudModels[1].renderList.push(this.cloudModels[1].primitive),this.enableNearClouds&&this.cloudModels[2].renderList.push(this.cloudModels[2].primitive),this.enableNearHaze&&this.fgHazeModel.renderList.push(this.fgHazeModel.primitive),this.enableOcean&&this.oceanModel.renderList.push(this.oceanModel.primitive))}}zt.filename="data/Skybox.glb";var qt=r(103),Wt=r.n(qt),Ht=r(104),Yt=r.n(Ht);const Gt=O.b.create(),Xt=O.e.create(),$t=O.f.create();var Kt,Jt,Zt,Qt;!function(t){t[t.Terminating=1]="Terminating",t[t.Terminated=2]="Terminated"}(Kt||(Kt={})),function(t){t[t.Default=0]="Default",t[t.Deferred=1]="Deferred",t[t._Count=2]="_Count"}(Jt||(Jt={})),function(t){t[t.ScaleVelocity=0]="ScaleVelocity"}(Zt||(Zt={})),function(t){t[t.Cube=0]="Cube",t[t.Point=1]="Point"}(Qt||(Qt={}));class te{constructor(){this.maxTime=0,this.flags=Zt.ScaleVelocity,this.forward=O.e.fromValues(0,1,0),this.rotation=O.e.fromValues(0,0,0),this.scale=O.e.fromValues(.5,1,.5),this.pos=O.e.fromValues(0,0,0),this.initialVelAxis=0,this.initialVelOmni=0,this.initialVelDir=100,this.initialVelRatio=0,this.initialVelRndm=0,this.spread=.1,this.lifeTime=.6,this.lifeTimeRndm=.18,this.rate=5,this.rateRndm=0,this.volumeMinRad=0,this.volumeSize=0,this.volumeSweep=0,this.volumeType=Qt.Cube}}class ee{constructor(){this.shapeType=0,this.scale2d=O.d.fromValues(1,1.3),this.colorEnv=O.f.fromValues(1,0,0,.5),this.colorPrm=O.f.fromValues(0,1,0,.5),this.texIdxAnimData=[],this.texIdxAnimRandomMask=-1}}class re{constructor(){this.emitterScale=O.e.create(),this.emitterScaleIncRateX=0,this.emitterScaleIncRateY=0,this.emitterScaleDecRateX=0,this.emitterScaleDecRateY=0,this.emitterAlphaIncRate=0,this.emitterAlphaDecRate=0,this.volumePos=O.e.create(),this.velOmni=O.e.create(),this.velAxis=O.e.create(),this.viewMatrix=O.b.create()}}class ne{constructor(t){this.emitterManager=t,this.drawGroup=Jt.Default,this.pos=O.e.create(),this.scale=O.e.fromValues(1,1,1),this.scale2D=O.d.fromValues(1,1),this.dirMtx=O.b.create(),this.time=-16,this.emitCount=0,this.particles=[],this.textures=[],this.texturesLoaded=!1,this.scaleIncRateX=0,this.scaleIncRateY=0,this.scaleDecRateX=0,this.scaleDecRateY=0,this.alphaDecRate=0,this.alphaIncRate=0}initialize(t){if(this.data=t,t.def.scaling){const e=t.def.scaling;e.scaleInTiming>0&&(this.scaleIncRateX=(1-e.scaleInValueX)/e.scaleInTiming,this.scaleIncRateY=(1-e.scaleInValueY)/e.scaleInTiming),e.scaleOutTiming<1&&(this.scaleDecRateX=(e.scaleOutValueX-1)/(1-e.scaleOutTiming),this.scaleDecRateY=(e.scaleOutValueY-1)/(1-e.scaleOutTiming))}if(t.def.alpha){const e=t.def.alpha;e.alphaInTiming>0&&(this.alphaIncRate=(e.alphaBaseValue-e.alphaInValue)/e.alphaInTiming),e.alphaOutTiming<1&&(this.alphaDecRate=(e.alphaOutValue-e.alphaBaseValue)/(1-e.alphaOutTiming))}!function(t,e){O.e.set(Xt,e[1],-e[0],0);const r=O.e.length(Xt);O.e.normalize(Xt,Xt);const n=Xt[0],i=Xt[1],s=e[2];t[0]=n*n+s*(1-n*n),t[4]=n*i*(1-s),t[8]=-i*r,t[12]=0,t[1]=n*i*(1-s),t[5]=i*i+s*(1-i*i),t[9]=n*r,t[13]=0,t[2]=i*r,t[6]=-n*r,t[10]=s,t[14]=0}(this.dirMtx,this.data.def.spawn.forward)}terminate(){for(let t=0;t<this.particles.length;t++)this.emitterManager.freeParticles.push(this.particles[t]);this.particles.length=0}update(t){if(this.data.def.spawn.maxTime>0&&this.time>=this.data.def.spawn.maxTime&&(this.flags|=Kt.Terminating,0===this.particles.length))return this.flags=Kt.Terminated,!1;if(!this.loadTextures())return!0;t.emitter=this,O.e.mul(t.emitterScale,this.data.def.spawn.scale,this.emitterManager.globalScale),t.emitterDirMatrix=this.dirMtx,t.emitterTextures=this.textures,t.emitterScaleDecRateX=this.scaleDecRateX,t.emitterScaleDecRateY=this.scaleDecRateY,t.emitterScaleIncRateX=this.scaleIncRateX,t.emitterScaleIncRateY=this.scaleIncRateY,t.emitterAlphaDecRate=this.alphaDecRate,t.emitterAlphaIncRate=this.alphaIncRate,this.flags&Kt.Terminating||this.emitIfNecessary();for(let e=0;e<this.particles.length;e++){const r=this.particles[e];r.update(t)||(this.particles.splice(e,1),this.emitterManager.freeParticles.push(r),e--)}return this.time+=t.deltaTime,this.time<0&&(this.time=.01),!0}render(t,e){e.emitter=this;this.data.def.shape;const r=this.particles.length;for(let n=0;n<r;n++)this.particles[n].render(t,e)}loadTextures(){if(!this.texturesLoaded){this.texturesLoaded=!0;for(let t=0;t<this.data.textureIds.length;t++){const e=this.data.textureIds[t],r=this.emitterManager.textures[e];Object(E.e)(r)?this.textures[t]=Object(E.c)(r.texture):this.texturesLoaded=!1}}return this.texturesLoaded}emitIfNecessary(){const t=this.emitterManager.frameData,e=this.data.def.spawn,r=(e.rate+e.rateRndm*(2*Math.random()-1))*t.deltaTime;for(this.emitCount+=r;this.emitCount>=1;)this.createParticle(),this.emitCount--}createParticle(){if(0===this.emitterManager.freeParticles.length)return null;const t=this.emitterManager.freeParticles.pop();return this.particles.push(t),this.calcVolume(this.emitterManager.frameData),t.initialize(this.emitterManager.frameData),t}calcVolume(t){switch(this.data.def.spawn.volumeType){case Qt.Cube:this.calcVolumeCube(t);break;case Qt.Point:this.calcVolumePoint(t)}}calcVolumeCube(t){const e=Math.random()-.5,r=Math.random()-.5,n=Math.random()-.5,i=this.data.def.spawn.volumeSize;O.e.set(t.volumePos,e*i,r*i,n*i),O.e.mul(t.velOmni,t.volumePos,t.emitterScale),O.e.set(t.velAxis,t.volumePos[0],0,t.volumePos[2])}calcVolumePoint(t){const e=Math.random()-.5,r=Math.random()-.5,n=Math.random()-.5;O.e.set(t.volumePos,0,0,0),O.e.set(t.velOmni,e,r,n),O.e.set(t.velAxis,t.velOmni[0],0,t.velOmni[2])}}class ie{constructor(t){this.time=0,this.t=0,this.velocity=O.e.create(),this.pos=O.e.create(),this.alpha=1,this.baseScale=1,this.scale=O.d.create(),this.texAnimIdx=0,this.texAnimRandomPhase=0;const e=t.gfxDevice.createResourceTable(se.resLayout);this.prim=Object.assign(Object.assign({},t.primitive),{resourceTable:e}),this.uniforms=new Q.a("ParticleUniforms",t.gfxDevice,se.uniformLayout),t.gfxDevice.setBuffer(e,1,this.uniforms.getBufferView())}initialize(t){const e=t.emitter,r=e.data.def.spawn,n=e.data.def.shape,i=e.data.def.scaling,s=Math.random();if(this.lifeTime=r.lifeTime*(1-s*r.lifeTimeRndm),this.time=0,O.e.set(this.velocity,0,0,0),0!==r.initialVelOmni&&Object(I.g)(this.velocity,t.velOmni,r.initialVelOmni),0!==r.initialVelAxis&&Object(I.g)(this.velocity,t.velAxis,r.initialVelAxis),0!==r.initialVelDir){const e=Math.random(),n=2*Math.random()-1;O.b.identity(Gt),O.b.rotateZ(Gt,Gt,e*Math.PI),O.b.rotateY(Gt,Gt,r.spread*n*Math.PI),O.b.mul(Gt,t.emitterDirMatrix,Gt),this.velocity[0]+=r.initialVelDir*Gt[8],this.velocity[1]+=r.initialVelDir*Gt[9],this.velocity[2]+=r.initialVelDir*Gt[10]}if(0!==r.initialVelRndm){const t=Math.random()-.5,e=Math.random()-.5,n=Math.random()-.5;this.velocity[0]+=r.initialVelRndm*n,this.velocity[1]+=r.initialVelRndm*e,this.velocity[2]+=r.initialVelRndm*t}const a=1+(2*Math.random()-1)*r.initialVelRatio;this.velocity[0]*=a,this.velocity[1]*=a,this.velocity[2]*=a,r.flags&Zt.ScaleVelocity&&(this.velocity[0]*=r.scale[0],this.velocity[1]*=r.scale[1],this.velocity[2]*=r.scale[2]),O.e.add(this.pos,e.pos,t.volumePos),i&&(this.baseScale=1+i.scaleRandom*(2*Math.random()-1)),this.texAnimRandomPhase=Math.floor(Math.random()*n.texIdxAnimData.length)&n.texIdxAnimRandomMask,this.uniforms.setVec4("u_colorPrim",n.colorPrm),this.uniforms.setVec4("u_colorEnv",n.colorEnv),t.gfxDevice.setBuffer(this.prim.resourceTable,0,t.globalUniforms.bufferView)}update(t){const e=t.emitter.data.def.shape,r=t.emitter.data.def.scaling,n=t.emitter.data.def.alpha;if(this.time+=t.deltaTime,this.t=this.time/this.lifeTime,this.time<0||this.time>=this.lifeTime)return!1;if(null!==e.texIdxAnimData){const t=this.texAnimRandomPhase+Math.floor(30*this.time);this.texAnimIdx=t%e.texIdxAnimData.length}if(Object(E.e)(r)){const e=t.emitterScaleIncRateX,n=t.emitterScaleIncRateY,i=t.emitterScaleDecRateX,s=t.emitterScaleDecRateY;this.scale[0]=this.baseScale*this.calcScaleFade(this.t,r,r.scaleInValueX,e,i),this.scale[1]=this.baseScale*this.calcScaleFade(this.t,r,r.scaleInValueY,n,s)}return Object(E.e)(n)&&(this.t<n.alphaInTiming?this.alpha=n.alphaInValue+this.t*t.emitterAlphaIncRate:this.t>n.alphaOutTiming?this.alpha=n.alphaBaseValue+(this.t-n.alphaOutTiming)*t.emitterAlphaDecRate:this.alpha=n.alphaBaseValue),O.e.scaleAndAdd(this.pos,this.pos,this.velocity,t.deltaTime),!0}render(t,e){const r=e.emitter.data.def.shape;let n;switch(r.shapeType){case 0:{const t=O.e.transformMat4(Xt,this.pos,e.viewMatrix);n=Object(I.d)(Gt,100*this.scale[0]*r.scale2d[0]*e.emitter.scale2D[0],100*this.scale[1]*r.scale2d[1]*e.emitter.scale2D[1],1,0,0,0,t[0],t[1],t[2])}break;default:throw new Error("Whoops")}const i=O.f.copy($t,r.colorPrm);i[3]*=this.alpha,this.uniforms.setVec4("u_colorPrim",i),this.uniforms.setFloats("u_modelView",n),this.uniforms.write(t);const s=r.texIdxAnimData[this.texAnimIdx];t.setTexture(this.prim.resourceTable,0,e.emitterTextures[s]),W.a.effects.push(this.prim)}calcScaleFade(t,e,r,n,i){return t<e.scaleInTiming?t*n+r:t>e.scaleOutTiming?(t-e.scaleOutTiming)*i+1:1}}class se{initialize(t){this.gfxDevice=t;const e={buffers:[{stride:20,layout:{a_pos:{type:i.n.Float3,offset:0},a_uv0:{type:i.n.Float2,offset:12}}}]},r=W.a.effects.renderFormat,n={name:"Particle",vertSource:Wt.a.sourceCode,fragSource:Yt.a.sourceCode};this.shader=t.createShader(n),this.pipeline=t.createRenderPipeline(this.shader,r,e,se.resLayout),this.vertTable=t.createVertexTable(this.pipeline);const s=-.5,a=.5;this.vertBuf=t.createBuffer("ParticleVerts",i.c.Vertex,i.o.Static,new Float32Array([s,s,s,1,1,s,a,s,1,0,a,s,s,0,1,a,a,s,0,0,s,s,s,1,1,s,a,s,1,0,s,s,a,0,1,s,a,a,0,0])),this.indexBuf=t.createBuffer("ParticleIndices",i.c.Index,i.o.Static,new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7]).buffer),t.setVertexBuffer(this.vertTable,0,{buffer:this.vertBuf}),this.primitive={resourceTable:-1,vertexTable:this.vertTable,renderPipeline:this.pipeline,elementCount:6,type:i.g.Triangles,indexBuffer:{buffer:this.indexBuf},indexType:i.n.Ushort}}terminate(t){t.removeShader(this.shader),t.removeRenderPipeline(this.pipeline)}}se.uniformLayout=Object(Q.b)({u_modelView:{type:i.n.Float4x4},u_colorEnv:{type:i.n.Float4},u_colorPrim:{type:i.n.Float4}}),se.resLayout={globals:{index:0,type:i.a.UniformBuffer,layout:J.a.bufferLayout},uniforms:{index:1,type:i.a.UniformBuffer,layout:se.uniformLayout},u_tex:{index:0,type:i.a.Texture}};class ae{constructor(t,e){this.maxEmitters=t,this.maxParticles=e,this.emitters=[],this.frameData=new re,this.gfxResources=new se,this.textures=[],this.freeEmitters=[],this.freeParticles=[],this.globalScale=O.e.fromValues(1,1,1)}initialize(t,e,r){this.gfxResources.initialize(t),this.textures=r;for(let t=0;t<this.maxEmitters;t++)this.freeEmitters[t]=new ne(this);for(let t=0;t<this.maxParticles;t++)this.freeParticles[t]=new ie(this.gfxResources);this.frameData.gfxDevice=t,this.frameData.globalUniforms=e}createEmitter(t){if(0===this.freeEmitters.length)return null;const e=Object(E.c)(this.freeEmitters.pop());return e.initialize(t),this.emitters.push(e),e}update(t){this.frameData.deltaTime=Math.min(t,24);for(let t=0;t<this.emitters.length;t++){const e=this.emitters[t];e.update(this.frameData)||(e.terminate(),this.emitters.splice(t,1),this.freeEmitters.push(e),t--)}}render(t,e){O.b.copy(this.frameData.viewMatrix,e);for(let e=0;e<Jt._Count;e++)for(let r=0;r<this.emitters.length;r++){this.emitters[r].drawGroup===e&&this.emitters[r].render(t,this.frameData)}}}class oe{constructor(){this.emitterManager=new ae(64,256),this.textures=[],this.data=[]}initialize({gfxDevice:t,globalUniforms:e,resources:r}){this.emitterManager.initialize(t,e,this.textures);const n=t=>(e,r)=>{e&&console.error(`Failed to load: ${e}`),r&&(this.textures[t]=r)};r.load("data/flame0.png","texture",n(0)),r.load("data/flame1.png","texture",n(1)),r.load("data/flame2.png","texture",n(2)),r.load("data/flame3.png","texture",n(3)),r.load("data/flame4.png","texture",n(4)),r.load("data/flame5.png","texture",n(5)),r.load("data/flame6.png","texture",n(6)),r.load("data/flame7.png","texture",n(7)),r.load("data/flame8.png","texture",n(8)),r.load("data/flame9.png","texture",n(9)),this.data[0]=ce}update({clock:t}){const e=.001*t.renderDt;this.emitterManager.update(e)}render({gfxDevice:t,camera:e}){this.emitterManager.render(t,e.viewMatrix)}createEmitter(t){const e=this.data[t];return this.emitterManager.createEmitter(e)}}const ce={textureIds:[0,1,2,3,4,5,6,7,8,9],def:{spawn:Object.assign(Object.assign({},new te),{rate:13.5,rateRndm:0,spread:.11649999767541885,volumeType:Qt.Point}),shape:Object.assign(Object.assign({},new ee),{colorEnv:O.f.fromValues(.29411764705882354,.34509803921568627,.1568627450980392,1),colorPrm:O.f.fromValues(.5882352941176471,.09411764705882353,0,1),scale2d:O.d.fromValues(1,1.3),texIdxAnimData:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9]}),scaling:{scaleRandom:.19999998807907104,scaleInTiming:.7910000085830688,scaleInValueX:1.7999999523162842,scaleInValueY:.699999988079071,scaleOutTiming:1,scaleOutValueX:1,scaleOutValueY:1},alpha:{alphaBaseValue:1,alphaInTiming:.10279999673366547,alphaInValue:0,alphaOutTiming:.7294999957084656,alphaOutValue:0}}};class ue{constructor(){this.canvas=document.createElement("canvas"),this.gfxDevice=new F,this.camera=new j,this.displayFrame={frame:-1,entities:[]},this.world=new ht.b,this.debugMenu=new B.a,this.avatar=new R.b,this.clock=new q.a,this.cameraSystem=new V(this.camera),this.compositor=new H(this.canvas,this.gfxDevice),this.debugGrid=new et,this.environment=new wt,this.globalUniforms=new J.a(this.gfxDevice),this.input=new rt.b,this.net=new nt.a,this.particles=new oe,this.resources=new it.a,this.state=new st,this.userCommands=new at.b,this.weapons=new ct.a(this.world),this.stage=new Ct,this.skybox=new zt}async init(){return console.log(`Source for this build available at ${n.a}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(n.b),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),ut.a.setContext(this.gfxDevice,this.globalUniforms),this.onResize(),this.resources.initialize(this.gfxDevice),this.clock.initialize(this),this.input.initialize(this),this.net.initialize(this),this.cameraSystem.initialize(this),this.compositor.initialize(this),this.globalUniforms.initialize(),this.avatar.initialize(this),this.weapons.initialize(this),this.stage.initialize(this),this.environment.initialize(this),this.particles.initialize(this),this.skybox.initialize(this),this.debugGrid.initialize(this),this.state.initialize(this),window.onresize=this.onResize.bind(this),document.onvisibilitychange=this.onVisibility.bind(this),window.onbeforeunload=this.onUnload.bind(this),n.b&&this.debugMenu.show(),window.requestAnimationFrame(this.tick.bind(this)),0):1}onConnect(t){this.net.onConnect(t)}tick(t){this.clock.tick(),this.updateFixed(),this.update(),this.render(),this.input.afterFrame(),this.debugMenu.update(),window.requestAnimationFrame(this.tick.bind(this))}updateFixed(){for(;this.clock.updateFixed();)if(this.input.updateFixed(this),this.net.client.state===ot.c.Active){const t=Object(E.c)(this.userCommands.getUserCommand(this.clock.simFrame));this.net.client.transmitClientFrame(this.clock.simFrame,t)}}update(){if(this.net.client.state===ot.c.Active){let t=this.clock.renderTime/this.clock.simDt;this.net.client.getSimState(t,this.displayFrame)&&this.world.loadState(this.displayFrame)}this.net.update(this),this.resources.update(),this.avatar.update(this),this.cameraSystem.update(this),this.state.update(this),this.environment.update(this),this.particles.update(this),this.skybox.update(this),this.globalUniforms.update()}render(){this.avatar.render(this),this.weapons.render(this),this.stage.render(this),this.particles.render(this),this.skybox.render(this),this.debugGrid.render(this),ut.a.flush(),this.compositor.render()}onResize(){this.cameraSystem.resize(window.innerWidth/window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}onVisibility(){const t=document.hidden;this.net.onVisibility(t)}onUnload(){this.net.terminate()}}var he=r(61),le=r(30);const fe={debug:t=>t.debugMenu.show()};window.config={kSignalServerAddress:n.b?"localhost:8888":"3.23.86.226:8888"},async function(){const t=new ue;window.client=t,t.init(),new URLSearchParams(window.location.search).forEach((e,r)=>{const n=fe[r];n&&n(t,e)});const e=new le.a;if(await e.connect(window.config.kSignalServerAddress),e.serverId===e.clientId){const t=new he.Server;t.onConnect(e),window.server=t}else e.close();t.onConnect(e.serverId)}()}]);