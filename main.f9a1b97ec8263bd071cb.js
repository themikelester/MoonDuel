!function(e){function t(t){for(var r,s,i=t[0],a=t[1],o=0,c=[];o<i.length;o++)s=i[o],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&c.push(n[s][0]),n[s]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);for(u&&u(t);c.length;)c.shift()()}var r={},n={1:0};function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise((function(t,s){r=n[e]=[t,s]}));t.push(r[2]=i);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+""+({2:"vendors~dat-gui"}[e]||e)+"."+{2:"a2e5033f8307393d8ef1"}[e]+".js"}(e);var u=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(c);var r=n[e];if(0!==r){if(r){var s=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+s+": "+i+")",u.name="ChunkLoadError",u.type=s,u.request=i,r[1](u)}n[e]=void 0}};var c=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var o=0;o<i.length;o++)t(i[o]);var u=a;s(s.s=9)}([function(e,t){e.exports={sourceCode:"#version 100\nprecision mediump float;uniform vec4 u_color;void main(){gl_FragColor=u_color;}",uniforms:{u_color:{variableType:"vec4",variableName:"u_color"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 100\nprecision mediump float;attribute vec3 a_pos;uniform mat4 u_model;uniform mat4 g_viewProj;void main(){gl_Position=g_viewProj*u_model*vec4(a_pos,1.);}",uniforms:{u_model:{variableType:"mat4",variableName:"u_model"},g_viewProj:{variableType:"mat4",variableName:"g_viewProj"}},consts:{}}},function(e,t){e.exports={sourceCode:"precision mediump float;\n#ifndef k_MaxBones\n#   defined k_MaxBones 32\n#endif\nattribute vec3 a_pos;attribute vec4 a_joints;attribute vec4 a_weights;uniform mat4 g_viewProj;uniform mat4 u_joints[k_MaxBones];void main(){vec4 pos=vec4(a_pos,1.);vec4 modelPos=(u_joints[int(a_joints.x)]*pos*a_weights.x)+(u_joints[int(a_joints.y)]*pos*a_weights.y)+(u_joints[int(a_joints.z)]*pos*a_weights.z)+(u_joints[int(a_joints.w)]*pos*a_weights.w);gl_Position=g_viewProj*modelPos;}",uniforms:{g_viewProj:{variableType:"mat4",variableName:"g_viewProj"},u_joints:{variableType:"mat4",variableName:"u_joints"}},consts:{}}},function(e,t,r){e.exports=function(){return new Worker(r.p+"ResourceLoading.worker.0385c244acae9f102fbf.js")}},,,,,,function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"create",(function(){return K})),r.d(n,"clone",(function(){return J})),r.d(n,"copy",(function(){return Z})),r.d(n,"fromValues",(function(){return Q})),r.d(n,"set",(function(){return ee})),r.d(n,"identity",(function(){return te})),r.d(n,"transpose",(function(){return re})),r.d(n,"invert",(function(){return ne})),r.d(n,"adjoint",(function(){return se})),r.d(n,"determinant",(function(){return ie})),r.d(n,"multiply",(function(){return ae})),r.d(n,"translate",(function(){return oe})),r.d(n,"scale",(function(){return ue})),r.d(n,"rotate",(function(){return ce})),r.d(n,"rotateX",(function(){return he})),r.d(n,"rotateY",(function(){return fe})),r.d(n,"rotateZ",(function(){return le})),r.d(n,"fromTranslation",(function(){return de})),r.d(n,"fromScaling",(function(){return me})),r.d(n,"fromRotation",(function(){return pe})),r.d(n,"fromXRotation",(function(){return ge})),r.d(n,"fromYRotation",(function(){return xe})),r.d(n,"fromZRotation",(function(){return be})),r.d(n,"fromRotationTranslation",(function(){return ye})),r.d(n,"fromQuat2",(function(){return ve})),r.d(n,"getTranslation",(function(){return Me})),r.d(n,"getScaling",(function(){return we})),r.d(n,"getRotation",(function(){return _e})),r.d(n,"fromRotationTranslationScale",(function(){return Te})),r.d(n,"fromRotationTranslationScaleOrigin",(function(){return Se})),r.d(n,"fromQuat",(function(){return Ue})),r.d(n,"frustum",(function(){return Ee})),r.d(n,"perspective",(function(){return Fe})),r.d(n,"perspectiveFromFieldOfView",(function(){return Ae})),r.d(n,"ortho",(function(){return Le})),r.d(n,"lookAt",(function(){return De})),r.d(n,"targetTo",(function(){return Ie})),r.d(n,"str",(function(){return Be})),r.d(n,"frob",(function(){return Ne})),r.d(n,"add",(function(){return Re})),r.d(n,"subtract",(function(){return Oe})),r.d(n,"multiplyScalar",(function(){return Pe})),r.d(n,"multiplyScalarAndAdd",(function(){return Ve})),r.d(n,"exactEquals",(function(){return Ce})),r.d(n,"equals",(function(){return Ge})),r.d(n,"mul",(function(){return ke})),r.d(n,"sub",(function(){return je}));var s={};r.r(s),r.d(s,"create",(function(){return qe})),r.d(s,"clone",(function(){return ze})),r.d(s,"length",(function(){return $e})),r.d(s,"fromValues",(function(){return He})),r.d(s,"copy",(function(){return Xe})),r.d(s,"set",(function(){return We})),r.d(s,"add",(function(){return Ye})),r.d(s,"subtract",(function(){return Ke})),r.d(s,"multiply",(function(){return Je})),r.d(s,"divide",(function(){return Ze})),r.d(s,"ceil",(function(){return Qe})),r.d(s,"floor",(function(){return et})),r.d(s,"min",(function(){return tt})),r.d(s,"max",(function(){return rt})),r.d(s,"round",(function(){return nt})),r.d(s,"scale",(function(){return st})),r.d(s,"scaleAndAdd",(function(){return it})),r.d(s,"distance",(function(){return at})),r.d(s,"squaredDistance",(function(){return ot})),r.d(s,"squaredLength",(function(){return ut})),r.d(s,"negate",(function(){return ct})),r.d(s,"inverse",(function(){return ht})),r.d(s,"normalize",(function(){return ft})),r.d(s,"dot",(function(){return lt})),r.d(s,"cross",(function(){return dt})),r.d(s,"lerp",(function(){return mt})),r.d(s,"hermite",(function(){return pt})),r.d(s,"bezier",(function(){return gt})),r.d(s,"random",(function(){return xt})),r.d(s,"transformMat4",(function(){return bt})),r.d(s,"transformMat3",(function(){return yt})),r.d(s,"transformQuat",(function(){return vt})),r.d(s,"rotateX",(function(){return Mt})),r.d(s,"rotateY",(function(){return wt})),r.d(s,"rotateZ",(function(){return _t})),r.d(s,"angle",(function(){return Tt})),r.d(s,"zero",(function(){return St})),r.d(s,"str",(function(){return Ut})),r.d(s,"exactEquals",(function(){return Et})),r.d(s,"equals",(function(){return Ft})),r.d(s,"sub",(function(){return Lt})),r.d(s,"mul",(function(){return Dt})),r.d(s,"div",(function(){return It})),r.d(s,"dist",(function(){return Bt})),r.d(s,"sqrDist",(function(){return Nt})),r.d(s,"len",(function(){return Rt})),r.d(s,"sqrLen",(function(){return Ot})),r.d(s,"forEach",(function(){return Pt}));var i={};r.r(i),r.d(i,"create",(function(){return Vt})),r.d(i,"clone",(function(){return Ct})),r.d(i,"fromValues",(function(){return Gt})),r.d(i,"copy",(function(){return kt})),r.d(i,"set",(function(){return jt})),r.d(i,"add",(function(){return qt})),r.d(i,"subtract",(function(){return zt})),r.d(i,"multiply",(function(){return $t})),r.d(i,"divide",(function(){return Ht})),r.d(i,"ceil",(function(){return Xt})),r.d(i,"floor",(function(){return Wt})),r.d(i,"min",(function(){return Yt})),r.d(i,"max",(function(){return Kt})),r.d(i,"round",(function(){return Jt})),r.d(i,"scale",(function(){return Zt})),r.d(i,"scaleAndAdd",(function(){return Qt})),r.d(i,"distance",(function(){return er})),r.d(i,"squaredDistance",(function(){return tr})),r.d(i,"length",(function(){return rr})),r.d(i,"squaredLength",(function(){return nr})),r.d(i,"negate",(function(){return sr})),r.d(i,"inverse",(function(){return ir})),r.d(i,"normalize",(function(){return ar})),r.d(i,"dot",(function(){return or})),r.d(i,"cross",(function(){return ur})),r.d(i,"lerp",(function(){return cr})),r.d(i,"random",(function(){return hr})),r.d(i,"transformMat4",(function(){return fr})),r.d(i,"transformQuat",(function(){return lr})),r.d(i,"zero",(function(){return dr})),r.d(i,"str",(function(){return mr})),r.d(i,"exactEquals",(function(){return pr})),r.d(i,"equals",(function(){return gr})),r.d(i,"sub",(function(){return xr})),r.d(i,"mul",(function(){return br})),r.d(i,"div",(function(){return yr})),r.d(i,"dist",(function(){return vr})),r.d(i,"sqrDist",(function(){return Mr})),r.d(i,"len",(function(){return wr})),r.d(i,"sqrLen",(function(){return _r})),r.d(i,"forEach",(function(){return Tr}));var a={};r.r(a),r.d(a,"create",(function(){return Sr})),r.d(a,"identity",(function(){return Ur})),r.d(a,"setAxisAngle",(function(){return Er})),r.d(a,"getAxisAngle",(function(){return Fr})),r.d(a,"getAngle",(function(){return Ar})),r.d(a,"multiply",(function(){return Lr})),r.d(a,"rotateX",(function(){return Dr})),r.d(a,"rotateY",(function(){return Ir})),r.d(a,"rotateZ",(function(){return Br})),r.d(a,"calculateW",(function(){return Nr})),r.d(a,"exp",(function(){return Rr})),r.d(a,"ln",(function(){return Or})),r.d(a,"pow",(function(){return Pr})),r.d(a,"slerp",(function(){return Vr})),r.d(a,"random",(function(){return Cr})),r.d(a,"invert",(function(){return Gr})),r.d(a,"conjugate",(function(){return kr})),r.d(a,"fromMat3",(function(){return jr})),r.d(a,"fromEuler",(function(){return qr})),r.d(a,"str",(function(){return zr})),r.d(a,"clone",(function(){return Zr})),r.d(a,"fromValues",(function(){return Qr})),r.d(a,"copy",(function(){return en})),r.d(a,"set",(function(){return tn})),r.d(a,"add",(function(){return rn})),r.d(a,"mul",(function(){return nn})),r.d(a,"scale",(function(){return sn})),r.d(a,"dot",(function(){return an})),r.d(a,"lerp",(function(){return on})),r.d(a,"length",(function(){return un})),r.d(a,"len",(function(){return cn})),r.d(a,"squaredLength",(function(){return hn})),r.d(a,"sqrLen",(function(){return fn})),r.d(a,"normalize",(function(){return ln})),r.d(a,"exactEquals",(function(){return dn})),r.d(a,"equals",(function(){return mn})),r.d(a,"rotationTo",(function(){return pn})),r.d(a,"sqlerp",(function(){return gn})),r.d(a,"setAxes",(function(){return xn}));const o="e783d73b97acb01a6e0fa3ed9570034173c816d3",u=(o.slice(0,8),`https://github.com/themikelester/gfx-boilerplate/tree/${o}`);var c,h,f,l,d,m,p,g,x,b,y,v,M;function w(e){switch(e){case h.Float:return 4;case h.Float2:return 8;case h.Float3:return 12;case h.Float4:return 16;case h.Int:return 4;case h.Int2:return 8;case h.Int3:return 12;case h.Int4:return 16;case h.Uint:return 4;case h.Uint2:return 8;case h.Uint3:return 12;case h.Uint4:return 16;case h.Short:return 2;case h.Short2:return 4;case h.Short3:return 6;case h.Short4:return 8;case h.Ushort:return 2;case h.Ushort2:return 4;case h.Ushort3:return 6;case h.Ushort4:return 8;case h.Char:return 1;case h.Char2:return 2;case h.Char3:return 3;case h.Char4:return 4;case h.Uchar:return 1;case h.Uchar2:return 2;case h.Uchar3:return 3;case h.Uchar4:return 4;case h.Half:return 2;case h.Half2:return 4;case h.Half3:return 6;case h.Half4:return 8;case h.Float3x3:return 36;case h.Float4x4:return 64;default:throw new Error(`Unsupported type: ${e}`)}}!function(e){e[e.VertexArrayObject=1]="VertexArrayObject",e[e.TextureFloat=2]="TextureFloat",e[e.TextureHalf=4]="TextureHalf",e[e.TextureFloatLinearFiltering=8]="TextureFloatLinearFiltering",e[e.TextureHalfLinearFiltering=16]="TextureHalfLinearFiltering",e[e.TextureWrite=32]="TextureWrite",e[e.ShaderDerivatives=64]="ShaderDerivatives",e[e.Instancing=128]="Instancing",e[e.AnistropicFiltering=256]="AnistropicFiltering"}(c||(c={})),function(e){e[e.Undefined=0]="Undefined",e[e.Float=1]="Float",e[e.Float2=2]="Float2",e[e.Float3=3]="Float3",e[e.Float4=4]="Float4",e[e.Int=5]="Int",e[e.Int2=6]="Int2",e[e.Int3=7]="Int3",e[e.Int4=8]="Int4",e[e.Uint=9]="Uint",e[e.Uint2=10]="Uint2",e[e.Uint3=11]="Uint3",e[e.Uint4=12]="Uint4",e[e.Short=13]="Short",e[e.Short2=14]="Short2",e[e.Short3=15]="Short3",e[e.Short4=16]="Short4",e[e.Ushort=17]="Ushort",e[e.Ushort2=18]="Ushort2",e[e.Ushort3=19]="Ushort3",e[e.Ushort4=20]="Ushort4",e[e.Char=21]="Char",e[e.Char2=22]="Char2",e[e.Char3=23]="Char3",e[e.Char4=24]="Char4",e[e.Uchar=25]="Uchar",e[e.Uchar2=26]="Uchar2",e[e.Uchar3=27]="Uchar3",e[e.Uchar4=28]="Uchar4",e[e.Half=29]="Half",e[e.Half2=30]="Half2",e[e.Half3=31]="Half3",e[e.Half4=32]="Half4",e[e.Float3x3=33]="Float3x3",e[e.Float3x4=34]="Float3x4",e[e.Float4x4=35]="Float4x4",e[e.Texture2D=240]="Texture2D",e[e.Texture3D=241]="Texture3D",e[e.TextureCube=242]="TextureCube",e[e.Short_Norm=256]="Short_Norm",e[e.Short2_Norm=257]="Short2_Norm",e[e.Short3_Norm=258]="Short3_Norm",e[e.Short4_Norm=259]="Short4_Norm",e[e.Ushort_Norm=260]="Ushort_Norm",e[e.Ushort2_Norm=261]="Ushort2_Norm",e[e.Ushort3_Norm=262]="Ushort3_Norm",e[e.Ushort4_Norm=263]="Ushort4_Norm",e[e.Char_Norm=264]="Char_Norm",e[e.Char2_Norm=265]="Char2_Norm",e[e.Char3_Norm=266]="Char3_Norm",e[e.Char4_Norm=267]="Char4_Norm",e[e.Uchar_Norm=268]="Uchar_Norm",e[e.Uchar2_Norm=269]="Uchar2_Norm",e[e.Uchar3_Norm=270]="Uchar3_Norm",e[e.Uchar4_Norm=271]="Uchar4_Norm"}(h||(h={})),function(e){e[e.Texture2D=240]="Texture2D",e[e.Texture3D=241]="Texture3D",e[e.TextureCube=242]="TextureCube"}(f||(f={})),function(e){e[e.Undefined=0]="Undefined",e[e.U565=1]="U565",e[e.U8=2]="U8",e[e.U8_sRGB=3]="U8_sRGB",e[e.U8x2=4]="U8x2",e[e.U8x2_sRGB=5]="U8x2_sRGB",e[e.U8x3=6]="U8x3",e[e.U8x3_sRGB=7]="U8x3_sRGB",e[e.U8x4=8]="U8x4",e[e.U8x4_sRGB=9]="U8x4_sRGB",e[e.U10_10_10_2=10]="U10_10_10_2",e[e.F11_11_10=11]="F11_11_10",e[e.F16=12]="F16",e[e.F16x2=13]="F16x2",e[e.F16x3=14]="F16x3",e[e.F16x4=15]="F16x4",e[e.F32x2=16]="F32x2",e[e.F32x3=17]="F32x3",e[e.F32x4=18]="F32x4",e[e.Depth32=19]="Depth32",e[e.Depth24Stencil8=20]="Depth24Stencil8"}(l||(l={})),function(e){e[e.Nearest=0]="Nearest",e[e.Linear=1]="Linear"}(d||(d={})),function(e){e[e.Never=0]="Never",e[e.Less=1]="Less",e[e.Equal=2]="Equal",e[e.LessEqual=3]="LessEqual",e[e.Greater=4]="Greater",e[e.NotEqual=5]="NotEqual",e[e.GreaterEqual=6]="GreaterEqual",e[e.Always=7]="Always"}(m||(m={})),function(e){e[e.Points=0]="Points",e[e.Lines=1]="Lines",e[e.LineLoop=2]="LineLoop",e[e.LineStrip=3]="LineStrip",e[e.Triangles=4]="Triangles",e[e.TriangleStrip=5]="TriangleStrip",e[e.TriangleFan=6]="TriangleFan"}(p||(p={})),function(e){e[e.Undefined=0]="Undefined",e[e.Uniform=1]="Uniform",e[e.Vertex=2]="Vertex",e[e.Index=3]="Index",e[e.Readback=4]="Readback"}(g||(g={})),function(e){e[e.Undefined=0]="Undefined",e[e.UniformBuffer=1]="UniformBuffer",e[e.Texture=2]="Texture"}(x||(x={})),function(e){e[e.None=0]="None",e[e.Static=1]="Static",e[e.Dynamic=2]="Dynamic"}(b||(b={})),function(e){e[e.None=0]="None",e[e.Back=1]="Back",e[e.Front=2]="Front"}(y||(y={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Source=2]="Source",e[e.OneMinusSource=3]="OneMinusSource"}(v||(v={})),function(e){e[e.Vertex=0]="Vertex",e[e.Instance=1]="Instance"}(M||(M={}));let _;function T(e){switch(e){case _.FLOAT:return h.Float;case _.FLOAT_VEC2:return h.Float2;case _.FLOAT_VEC3:return h.Float3;case _.FLOAT_VEC4:return h.Float4;case _.INT:return h.Int;case _.INT_VEC2:return h.Int2;case _.INT_VEC3:return h.Int3;case _.INT_VEC4:return h.Int4;case _.FLOAT_MAT3:return h.Float3x3;case _.FLOAT_MAT4:return h.Float4x4;case _.SAMPLER_2D:return h.Texture2D;case _.SAMPLER_3D:return h.Texture3D;case _.SAMPLER_CUBE:return h.TextureCube;case _.UNSIGNED_INT:return h.Uint;case _.UNSIGNED_INT_VEC2:return h.Uint2;case _.UNSIGNED_INT_VEC3:return h.Uint3;case _.UNSIGNED_INT_VEC4:return h.Uint4;default:return V(`Unsupported WebGL type: ${e}`)}}function S(e){switch(255&e){case h.Float:return 1;case h.Float2:return 2;case h.Float3:return 3;case h.Float4:return 4;case h.Int:return 1;case h.Int2:return 2;case h.Int3:return 3;case h.Int4:return 4;case h.Uint:return 1;case h.Uint2:return 2;case h.Uint3:return 3;case h.Uint4:return 4;case h.Short:return 1;case h.Short2:return 2;case h.Short3:return 3;case h.Short4:return 4;case h.Ushort:return 1;case h.Ushort2:return 2;case h.Ushort3:return 3;case h.Ushort4:return 4;case h.Char:return 1;case h.Char2:return 2;case h.Char3:return 3;case h.Char4:return 4;case h.Uchar:return 1;case h.Uchar2:return 2;case h.Uchar3:return 3;case h.Uchar4:return 4;case h.Half:return 1;case h.Half2:return 2;case h.Half3:return 3;case h.Half4:return 4;default:return V(`Unsupported type: ${e}`)}}function U(e){switch(e){case h.Float:case h.Float2:case h.Float3:case h.Float4:return _.FLOAT;case h.Int:case h.Int2:case h.Int3:case h.Int4:return _.INT;case h.Uint:case h.Uint2:case h.Uint3:case h.Uint4:return _.UNSIGNED_INT;case h.Short:case h.Short2:case h.Short3:case h.Short4:return _.SHORT;case h.Ushort:case h.Ushort2:case h.Ushort3:case h.Ushort4:return _.UNSIGNED_SHORT;case h.Char:case h.Char2:case h.Char3:case h.Char4:return _.BYTE;case h.Uchar:case h.Uchar2:case h.Uchar3:case h.Uchar4:return _.UNSIGNED_BYTE;case h.Half:case h.Half2:case h.Half3:case h.Half4:return _.HALF_FLOAT;default:return V(`Unsupported type: ${e}`)}}function E(e){switch(e){case p.Points:return _.POINTS;case p.Lines:return _.LINES;case p.LineLoop:return _.LINE_LOOP;case p.LineStrip:return _.LINE_STRIP;case p.Triangles:return _.TRIANGLES;case p.TriangleStrip:return _.TRIANGLE_STRIP;case p.TriangleFan:return _.TRIANGLE_FAN;default:return V(`Unsupported primitive type: ${e}`)}}function F(e){switch(e){case h.Short_Norm:case h.Short2_Norm:case h.Short3_Norm:case h.Short4_Norm:case h.Ushort_Norm:case h.Ushort2_Norm:case h.Ushort3_Norm:case h.Ushort4_Norm:case h.Char_Norm:case h.Char2_Norm:case h.Char3_Norm:case h.Char4_Norm:case h.Uchar_Norm:case h.Uchar2_Norm:case h.Uchar3_Norm:case h.Uchar4_Norm:return!0;default:return!1}}function A(e){switch(e){case h.Uchar:return _.UNSIGNED_BYTE;case h.Uint:return _.UNSIGNED_INT;case h.Ushort:return _.UNSIGNED_SHORT;default:return V(`Unsupported index type: ${e}`)}}function L(e){switch(e){case f.Texture2D:return _.TEXTURE_2D;case f.Texture3D:return _.TEXTURE_3D;case f.TextureCube:return _.TEXTURE_CUBE_MAP;default:return V(`Unsupported texture type: ${e}`)}}function D(e){switch(e){case l.U565:return _.RGB;case l.U8:return _.ALPHA;case l.U8x3:case l.U8x3_sRGB:return _.RGB;case l.U8x4:case l.U8x4_sRGB:return _.RGBA;case l.F16:return _.ALPHA;case l.F16x4:case l.F32x4:return _.RGBA;case l.Depth32:return _.DEPTH_COMPONENT;case l.Depth24Stencil8:return _.DEPTH_STENCIL;default:return V(`Unsupported texel format: ${e}`)}}function I(e){switch(e){case l.U565:return _.RGB;case l.U8:case l.U8_sRGB:return _.RED;case l.U8x2:case l.U8x2_sRGB:return _.RG;case l.U8x3:case l.U8x3_sRGB:return _.RGB;case l.U8x4:case l.U8x4_sRGB:case l.U10_10_10_2:return _.RGBA;case l.F16:return _.RED;case l.F16x2:return _.RG;case l.F16x4:return _.RGBA;case l.F32x2:return _.RG;case l.F32x4:return _.RGBA;case l.F11_11_10:return _.RGB;case l.Depth32:return _.DEPTH_COMPONENT;case l.Depth24Stencil8:return _.DEPTH_STENCIL;default:return V(`Unsupported texel format: ${e}`)}}function B(e){switch(e){case l.U565:return _.RGB565;case l.U8:case l.U8_sRGB:return _.R8;case l.U8x2:case l.U8x2_sRGB:return _.RG8;case l.U8x3:case l.U8x3_sRGB:return _.RGB8;case l.U8x4:case l.U8x4_sRGB:return _.RGBA8;case l.U10_10_10_2:return _.RGB10_A2;case l.F16:return _.R16F;case l.F16x2:return _.RG16F;case l.F16x3:return _.RGB16F;case l.F16x4:return _.RGBA16F;case l.F32x2:return _.RG32F;case l.F32x3:return _.RGB32F;case l.F32x4:return _.RGBA32F;case l.Depth32:return _.DEPTH_COMPONENT32F;case l.Depth24Stencil8:return _.DEPTH24_STENCIL8;default:return V(`Unsupported texel format: ${e}`)}}function N(e){switch(e){case l.Undefined:return 0;case l.U565:return _.UNSIGNED_SHORT_5_6_5;case l.U8:case l.U8_sRGB:case l.U8x2:case l.U8x2_sRGB:case l.U8x3:case l.U8x3_sRGB:case l.U8x4:case l.U8x4_sRGB:return _.UNSIGNED_BYTE;case l.U10_10_10_2:return _.RGBA;case l.F11_11_10:return _.FLOAT;case l.F16:case l.F16x2:case l.F16x4:return _.HALF_FLOAT;case l.F32x2:case l.F32x4:case l.Depth32:return _.FLOAT;case l.Depth24Stencil8:return _.UNSIGNED_INT_24_8;default:return V(`Unsupported texel format: ${e}`)}}function R(e){switch(e){case d.Nearest:return _.NEAREST;case d.Linear:return _.LINEAR;default:return V(`Unsupported texture filter: ${e}`)}}function O(e){switch(e){case v.Zero:return _.ZERO;case v.One:return _.One;case v.Source:return _.SRC_ALPHA;case v.OneMinusSource:return _.ONE_MINUS_SRC_ALPHA;default:return V(`Unsupported blend factor: ${e}`)}}function P(e,t="Assert failed"){e||V(t)}function V(e){throw console.error(e),new Error(e)}function C(e,t){return void 0!==e?e:t}function G(e){return null!=e}function k(e){return e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap}function j(e,t,r){const n=_.createShader(t);if(_.shaderSource(n,r),_.compileShader(n),!_.getShaderParameter(n,_.COMPILE_STATUS)){const s=t===_.VERTEX_SHADER?"Vertex":"Fragment",i=function(e){return e.split("\n").map((e,t)=>`${t+1}: ${e}`).join("\n")}(r);console.error(i),V(`${s} compilation failed for shader ${e}:\n  ${_.getShaderInfoLog(n)}. See source above.`)}return n}function q(e,t,r){const n=e.vertexLayout.buffers[r],s=e.shader.reflection,i=Object.keys(n.layout);_.bindBuffer(_.ARRAY_BUFFER,t.buffer.glId);for(let e=0;e<i.length;e++){const r=n.layout[i[e]],a=s.attributes[i[e]];if(G(a))if(t.buffer){const e=U(r.type),s=F(r.type);_.enableVertexAttribArray(a.location),_.vertexAttribPointer(a.location,a.components,e,s,n.stride,r.offset+t.offset),n.stepMode===M.Instance&&(_.instancedArrays?_.instancedArrays.vertexAttribDivisorANGLE(a.location,1):_.vertexAttribDivisor(a.location,1))}else _.disableVertexAttribArray(a.location)}}function z(e){return e.type===x.Texture}class ${constructor(){this.objects=[],this.freeList=[],this.count=0}get(e){const t=this.objects[e];return P(void 0!==t,"Invalid ID"),t}create(e){if(++this.count,this.freeList.length>0){const t=this.freeList.pop();return this.objects[t]=e,t}return this.objects.push(e),this.objects.length-1}delete(e){--this.count,delete this.objects[e],this.freeList.push(e)}}class H{constructor(){this.debugEnabled=!1,this.buffers=new $,this.textures=new $,this.shaders=new $,this.renderPipelines=new $,this.resourceTables=new $,this.vertexTables=new $,this.renderPasses=new $,this.depthStencilStates=new $}initialize(e){const t={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};if(_=e.getContext("webgl2",t),_||(_=e.getContext("webgl",t)),!_)return!1;this.webGlVersion=_ instanceof WebGLRenderingContext?1:2,console.debug(`Initialized WebGL${this.webGlVersion} context`),this.featureFlags=function(e){let t,r=0;return(t=_.getExtension("OES_vertex_array_object"))&&(r|=c.VertexArrayObject,_.createVertexArray=t.createVertexArrayOES.bind(t),_.deleteVertexArray=t.deleteVertexArrayOES.bind(t),_.bindVertexArray=t.bindVertexArrayOES.bind(t)),(t=_.getExtension("OES_texture_half_float"))&&(r|=c.TextureHalf,_.HALF_FLOAT=t.HALF_FLOAT_OES),(t=_.getExtension("EXT_texture_filter_anisotropic")||_.getExtension("MOZ_EXT_texture_filter_anisotropic")||_.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))&&(r|=c.AnistropicFiltering,_.MAX_TEXTURE_MAX_ANISOTROPY_EXT=t.MAX_TEXTURE_MAX_ANISOTROPY_EXT,_.TEXTURE_MAX_ANISOTROPY_EXT=t.TEXTURE_MAX_ANISOTROPY_EXT),_.getExtension("OES_texture_float")&&(r|=c.TextureFloat),_.getExtension("OES_texture_float_linear")&&(r|=c.TextureFloatLinearFiltering),_.getExtension("OES_texture_half_float_linear")&&(r|=c.TextureHalfLinearFiltering),_.getExtension("OES_standard_derivatives")&&(r|=c.ShaderDerivatives),_.texSubImage2D&&(r|=c.TextureWrite),(_.instancedArrays=_.getExtension("ANGLE_instanced_arrays"))&&(r|=c.Instancing),e>=2&&(r|=c.VertexArrayObject,r|=c.TextureFloat,r|=c.TextureHalf,r|=c.Instancing),r}(this.webGlVersion),this.defaultRenderPass=this.renderPasses.create({name:"Default",width:e.width,height:e.height}),P(0===this.defaultRenderPass),this.current={},_.clearColor(0,0,0,1);const r=new Uint8Array([0,0,0,1]),n={usage:b.Static,type:f.Texture2D,format:l.U8x4,width:1,height:1},s=this.createTexture("DefaultTexture",n,r);return this.defaultTexture=this.textures.get(s),this.isGfxFeatureSupported(c.AnistropicFiltering)&&(this.maxAnisotropy=_.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.NONE),!0}isGfxFeatureSupported(e){return!!(this.featureFlags&e)}setDebugEnabled(e){this.debugEnabled=e}resize(e,t){const r=this.renderPasses.get(this.defaultRenderPass);r.width=e,r.height=t}beginFrame(){}endFrame(){}bindRenderPass(e){const t=this.renderPasses.get(e);_.bindFramebuffer(_.FRAMEBUFFER,t.glFramebuffer),_.viewport(0,0,t.width,t.height);const r=_.COLOR_BUFFER_BIT;_.clear(r)}bindPipeline(e){const t=this.renderPipelines.get(e);this.pipeline=t,this.current.shader!==t.shader&&(_.useProgram(t.shader.glProgram),this.current.shader=t.shader),t.renderFormat.blendingEnabled!=this.current.blending&&(this.current.blending=t.renderFormat.blendingEnabled,t.renderFormat.blendingEnabled?_.enable(_.BLEND):_.disable(_.BLEND)),!this.current.blending||this.current.srcBlendFactor==t.renderFormat.srcBlendFactor&&this.current.dstBlendFactor==t.renderFormat.dstBlendFactor||(this.current.srcBlendFactor=C(t.renderFormat.srcBlendFactor,v.One),this.current.dstBlendFactor=C(t.renderFormat.dstBlendFactor,v.OneMinusSource),_.blendFunc(O(this.current.srcBlendFactor),O(this.current.dstBlendFactor)))}draw(e,t,r,n,s){const i=E(e),a=A(r),o=w(r),u=this.buffers.get(t);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,u.glId),_.drawElements(i,s,a,n*o)}drawInstanced(e,t,r,n,s,i){const a=E(e),o=A(r),u=w(r),c=this.buffers.get(t);_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,c.glId),_.instancedArrays?_.instancedArrays.drawElementsInstancedANGLE(a,s,o,n*u,i):_.drawElementsInstanced(a,s,o,n*u,i)}drawNonIndexed(e,t,r){const n=E(e);_.drawArrays(n,t,r)}setDepthStencilState(e){const t=this.depthStencilStates.get(e),r=this.current.depthStencil;r&&t.depthWriteEnabled==r.depthWriteEnabled||_.depthMask(t.depthWriteEnabled),r&&t.depthCompareFunc==r.depthCompareFunc||_.depthFunc(t.depthCompareFunc),r&&t.depthTestEnabled==r.depthTestEnabled||(t.depthTestEnabled?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST)),this.current.depthStencil=t}setCullMode(e){this.current.cullMode!=e&&(this.current.cullMode=e,e==y.None?_.disable(_.CULL_FACE):(_.enable(_.CULL_FACE),_.cullFace(function(e){switch(e){case y.None:return _.NONE;case y.Back:return _.BACK;case y.Front:return _.FRONT;default:return V(`Unsupported culling mode: ${e}`)}}(e))))}createDepthStencilState(e){const t=function(e){switch(e){case m.Never:return _.NEVER;case m.Less:return _.LESS;case m.Equal:return _.EQUAL;case m.LessEqual:return _.LEQUAL;case m.Greater:return _.GREATER;case m.NotEqual:return _.NOTEQUAL;case m.GreaterEqual:return _.GEQUAL;case m.Always:return _.ALWAYS;default:return V(`Unsupported compare func: ${e}`)}}(C(e.depthCompareFunc,m.Less));return this.depthStencilStates.create({depthTestEnabled:e.depthTestEnabled,depthWriteEnabled:e.depthWriteEnabled,depthCompareFunc:t})}createVertexTable(e){const t=this.renderPipelines.get(e);let r=null;return this.isGfxFeatureSupported(c.VertexArrayObject)&&(r=_.createVertexArray()),this.vertexTables.create({pipeline:t,vao:r,buffers:[]})}removeVertexTable(e){if(this.isGfxFeatureSupported(c.VertexArrayObject)){const t=this.vertexTables.get(e);_.deleteVertexArray(t.vao)}this.vertexTables.delete(e)}createResourceTable(e){return this.resourceTables.create({layout:e,buffers:[],textures:[]})}removeResourceTable(e){this.resourceTables.delete(e)}bindVertices(e){const t=this.vertexTables.get(e);if(this.isGfxFeatureSupported(c.VertexArrayObject))_.bindVertexArray(t.vao);else for(let e=0;e<t.buffers.length;e++)q(t.pipeline,t.buffers[e],e)}bindResources(e){const t=this.resourceTables.get(e),r=this.pipeline.uniformLayout,n=this.pipeline.shader.reflection,s=this.pipeline.shader.name;for(let e=0;e<n.uniforms.length;e++){const s=n.uniforms[e],i=r[s.name],a=t.buffers[i.index].buffer.cpuBuffer;P(G(a));const o=new Float32Array(a.buffer,i.offset,s.size/4),u=this.pipeline.shader.uniformVals[s.name];if(!o.every((e,t)=>e===u[t]))switch(this.pipeline.shader.uniformVals[s.name].set(o),s.type){case h.Float:_.uniform1fv(s.location,o);break;case h.Float2:_.uniform2fv(s.location,o);break;case h.Float3:_.uniform3fv(s.location,o);break;case h.Float4:_.uniform4fv(s.location,o);break;case h.Float3x3:_.uniformMatrix3fv(s.location,!1,o);break;case h.Float4x4:_.uniformMatrix4fv(s.location,!1,o);break;default:V("Unknown shader uniform type")}}for(let e=0;e<n.textureArray.length;e++){const i=n.textureArray[e],a=r[i.name].index;void 0===t.textures[a]&&console.warn(`Shader ${s} expects texture "${i.name}" (index ${a}) to be bound`);for(let e=0;e<i.count;e++){const r=t.textures[a+e]||this.defaultTexture,n=i.location+e;_.activeTexture(_.TEXTURE0+n),_.bindTexture(r.target,r.glId)}}}setVertexBuffer(e,t,r){const n=this.vertexTables.get(e),s={buffer:this.buffers.get(r.buffer),offset:r.byteOffset||0};P(t<16),n.buffers[t]=s,this.isGfxFeatureSupported(c.VertexArrayObject)&&(_.bindVertexArray(n.vao),q(n.pipeline,s,t))}setBuffer(e,t,r){const n=this.resourceTables.get(e),s=this.buffers.get(r.buffer);n.buffers[t]={buffer:s,offset:r.byteOffset||0}}setTexture(e,t,r){const n=this.resourceTables.get(e),s=r?this.textures.get(r):null;n.textures[t]=s}setTextures(e,t,r){const n=this.resourceTables.get(e);for(let e=0;e<r.length;e++){const s=r[e]?this.textures.get(r[e]):null;n.textures[t+e]=s}}writeBufferData(e,t,r){const n=this.buffers.get(e);if(n.type===g.Uniform){const e=ArrayBuffer.isView(r)?r.buffer:r,s=new Uint8Array(e);G(n.cpuBuffer)?n.cpuBuffer.set(s,t):V("No CPU buffer assigned to uniform buffer")}else _.bindBuffer(n.target,n.glId),_.bufferSubData(n.target,t,r)}createRenderPipeline(e,t,r,n){const s=this.shaders.get(e),i=Object.keys(n),a=i.map(e=>n[e]),o=s.reflection;if(this.debugEnabled){for(const e of i){const t=n[e];t.type===x.UniformBuffer&&P(void 0!==t.layout,`A BufferLayout must be provided for UniformBuffer "${e}" in the ResourceLayout passed to createRenderPipeline()`+"to define uniform binding locations. In WebGL2/GLSL300 it may be possible to define binding locations completely within the shader")}for(let e=0;e<o.uniforms.length;e++){const t=o.uniforms[e],r=a.find(e=>!z(e)&&e.layout&&e.layout[t.name]);P(void 0!==r,`Shader '${name}' expects uniform '${t.name}' to be set in a uniform buffer`);const n=r.layout[t.name].type;if(P(n===t.type,`Shader '${name}' expects uniform '${t.name}' to be type ${t.type} but the ShaderResourceLayout specifies type ${n}`),t.count>1){const e=r.layout[t.name].count;P(void 0!==e,`Shader '${name}' expects uniform '${t.name}' to be an array but the ShaderResourceLayout specifies a scalar value`),P(e>=t.count,`Shader '${name}' expects uniform '${t.name}' to be an array of length ${t.count} but the ShaderResourceLayout specifies a length of ${e}`)}}for(let e=0;e<o.textureArray.length;e++){const t=o.textureArray[e],r=a.find((e,r)=>z(e)&&i[r]===t.name);P(void 0!==r,`Shader '${name}' expects texture '${t.name}', but it is not defined in the ShaderResourceLayout`),P((r.count||1)===t.count,`Shader '${name}' expects texture '${t.name}' to be an array of length ${t.count}, but the ResourceLayout specifies length ${r.count}`)}Object.keys(o.attributes).forEach(e=>{P(void 0!==r.buffers.find(t=>t&&void 0!==t.layout[e]),`VertexLayout does not supply attribute ${e} required by Shader '${s.name}'`)}),this.isGfxFeatureSupported(c.Instancing)||r.buffers.forEach(e=>{P(e.stepMode!==M.Instance,"Instancing is not supported by this WebGL context")})}const u={};for(let e=0;e<o.uniforms.length;e++){const t=o.uniforms[e],r=a.find(e=>!z(e)&&e.layout&&e.layout[t.name]);u[t.name]={offset:r.layout[t.name].offset,index:r.index}}for(let e=0;e<o.textureArray.length;e++){const t=o.textureArray[e],r=n[t.name];u[t.name]={offset:0,index:r.index}}return this.renderPipelines.create({shader:s,renderFormat:t,vertexLayout:r,resourceLayout:n,uniformLayout:u})}removeRenderPipeline(e){this.renderPipelines.delete(e)}createShader(e){return this._createShader(e.name,e.vertSource,e.fragSource)}_createShader(e,t,r){const n=function(e,t,r){const n=j(e,_.VERTEX_SHADER,t),s=j(e,_.FRAGMENT_SHADER,r),i=_.createProgram();return _.attachShader(i,n),_.attachShader(i,s),_.linkProgram(i),_.deleteShader(n),_.deleteShader(s),_.getProgramParameter(i,_.LINK_STATUS)||V(`Linking failed for shader ${e}:\n  ${_.getProgramInfoLog(i)}`),i}(e,t instanceof Array?t.join("\n#line 0\n"):t,r instanceof Array?r.join("\n#line 0\n"):r),s=function(e){const t={},r=[],n=[],s={};let i=0;const a=_.getProgramParameter(e,_.ACTIVE_ATTRIBUTES);P(a<16);for(let t=0;t<a;t++){const r=_.getActiveAttrib(e,t),n=T(r.type);s[r.name]={location:t,count:r.size,components:S(n),glType:U(n),type:n}}const o=_.getProgramParameter(e,_.ACTIVE_UNIFORMS);P(o<64);for(let s=0;s<o;s++){const a=_.getActiveUniform(e,s),o=T(a.type),u=a.name.replace("[0]","");if(o>=f.Texture2D&&o<=f.TextureCube){const n={name:u,count:a.size,type:o,location:i,locationGl:_.getUniformLocation(e,a.name)};i+=a.size,t[u]=n,r.push(n)}else{const t={name:u,count:a.size,type:o,size:w(o)*a.size,location:_.getUniformLocation(e,a.name)};n.push(t)}}return{attributes:s,uniforms:n,textures:t,textureArray:r,textureCount:i}}(n),i={};for(let e=0;e<s.uniforms.length;e++){const t=s.uniforms[e];i[t.name]=new Float32Array(t.size/4)}_.useProgram(n);const a=Object.keys(s.textures);for(let e=0;e<a.length;e++){const t=s.textures[a[e]],r=Array.from(Array(t.count).keys()).map((e,r)=>t.location+r);_.uniform1iv(t.locationGl,r)}return this.current.shader=void 0,this.shaders.create({name:e,glProgram:n,reflection:s,uniformVals:i})}removeShader(e){const t=this.shaders.get(e);_.deleteProgram(t.glProgram),this.shaders.delete(e)}createTexture(e,t,r){const n=!r||r.buffer instanceof ArrayBuffer&&void 0!==r.byteLength,s=1===this.webGlVersion?D:I,i={target:L(t.type),format:s(t.format),internalFormat:this.webGlVersion>1?B(t.format):s(t.format),type:N(t.format),usage:t.usage,width:n?C(t.width,1):r.width,height:n?C(t.height,1):r.height,depth:t.depth||1,minFilter:R(void 0!==t.defaultMinFilter?t.defaultMinFilter:d.Linear),magFilter:R(void 0!==t.defaultMagFilter?t.defaultMagFilter:d.Linear),glId:_.createTexture()};if(_.bindTexture(i.target,i.glId),_.texParameteri(i.target,_.TEXTURE_MIN_FILTER,i.minFilter),_.texParameteri(i.target,_.TEXTURE_MAG_FILTER,i.magFilter),_.texParameteri(i.target,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(i.target,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),G(t.maxAnistropy)&&t.maxAnistropy>1&&this.isGfxFeatureSupported(c.AnistropicFiltering)){const e=Math.min(this.maxAnisotropy,t.maxAnistropy);_.texParameterf(_.TEXTURE_2D,_.TEXTURE_MAX_ANISOTROPY_EXT,e)}const a=this.webGlVersion>1?i.internalFormat:i.format;if(t.type===f.Texture3D)_.texImage3D(i.target,0,a,i.width,i.height,i.depth,0,i.format,i.type,r);else if(n)r instanceof ArrayBuffer&&(r=new Uint8Array(r)),_.texImage2D(i.target,0,a,i.width,i.height,0,i.format,i.type,r);else if(void 0!==r)_.texImage2D(i.target,0,a,i.format,i.type,r);else{P(void 0!==i.width&&void 0!==i.height,"Image is null. If attempting to create an empty texture, width and height must be specified"),_.texImage2D(i.target,0,a,t.width,t.height,0,i.format,i.type,null)}return this.textures.create(i)}writeTextureData(e,t){const r=this.textures.get(e);P(r.target===_.TEXTURE_2D,"Currently only 2D textures may be written to"),_.bindTexture(r.target,r.glId);const n=k(t)?t.width!==r.width:!!k(t)&&t.height!==r.height;this.isGfxFeatureSupported(c.TextureWrite)&&!n?k(t)?_.texSubImage2D(r.target,0,0,0,r.format,r.type,t):_.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,t):_.texImage2D(r.target,0,r.internalFormat,r.format,r.type,t)}removeTexture(e){const t=this.textures.get(e);_.deleteTexture(t.glId),this.textures.delete(e)}createBuffer(e,t,r,n){let s,i;P(r!=b.None);const a=function(e){switch(e){case g.Undefined:return 0;case g.Uniform:return _.UNIFORM_BUFFER;case g.Vertex:return _.ARRAY_BUFFER;case g.Index:return _.ELEMENT_ARRAY_BUFFER;case g.Readback:return _.TRANSFORM_FEEDBACK_BUFFER}}(t),o=e=>Number.isInteger(e),u=e=>e instanceof ArrayBuffer,c=o(n)?null:n,h=o(n)?n:n.byteLength;if(P(h>0||null!==c,"Either an ArrayBuffer or size must be provided"),t!=g.Uniform)i=_.createBuffer(),_.bindBuffer(a,i),_.bufferData(a,n,r==b.Dynamic?_.DYNAMIC_DRAW:_.STATIC_DRAW);else if(c){const e=u(c)?c:c.buffer,t=u(c)?0:c.byteOffset;s=new Uint8Array(e,t,h)}else s=new Uint8Array(h);return this.buffers.create({name:e,type:t,target:a,usage:r,size:h,glId:i,cpuBuffer:s})}removeBuffer(e){const t=this.buffers.get(e);t.type!=g.Uniform&&_.deleteBuffer(t.glId),this.buffers.delete(e)}readPixels(e,t,r,n,s){_.readPixels(e,t,r,n,_.RGBA,_.UNSIGNED_BYTE,s)}}var X=1e-6,W="undefined"!=typeof Float32Array?Float32Array:Array,Y=Math.random;Math.PI;function K(){var e=new W(16);return W!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function J(e){var t=new W(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Q(e,t,r,n,s,i,a,o,u,c,h,f,l,d,m,p){var g=new W(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=s,g[5]=i,g[6]=a,g[7]=o,g[8]=u,g[9]=c,g[10]=h,g[11]=f,g[12]=l,g[13]=d,g[14]=m,g[15]=p,g}function ee(e,t,r,n,s,i,a,o,u,c,h,f,l,d,m,p,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e[4]=i,e[5]=a,e[6]=o,e[7]=u,e[8]=c,e[9]=h,e[10]=f,e[11]=l,e[12]=d,e[13]=m,e[14]=p,e[15]=g,e}function te(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function re(e,t){if(e===t){var r=t[1],n=t[2],s=t[3],i=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ne(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],u=t[6],c=t[7],h=t[8],f=t[9],l=t[10],d=t[11],m=t[12],p=t[13],g=t[14],x=t[15],b=r*o-n*a,y=r*u-s*a,v=r*c-i*a,M=n*u-s*o,w=n*c-i*o,_=s*c-i*u,T=h*p-f*m,S=h*g-l*m,U=h*x-d*m,E=f*g-l*p,F=f*x-d*p,A=l*x-d*g,L=b*A-y*F+v*E+M*U-w*S+_*T;return L?(L=1/L,e[0]=(o*A-u*F+c*E)*L,e[1]=(s*F-n*A-i*E)*L,e[2]=(p*_-g*w+x*M)*L,e[3]=(l*w-f*_-d*M)*L,e[4]=(u*U-a*A-c*S)*L,e[5]=(r*A-s*U+i*S)*L,e[6]=(g*v-m*_-x*y)*L,e[7]=(h*_-l*v+d*y)*L,e[8]=(a*F-o*U+c*T)*L,e[9]=(n*U-r*F-i*T)*L,e[10]=(m*w-p*v+x*b)*L,e[11]=(f*v-h*w-d*b)*L,e[12]=(o*S-a*E-u*T)*L,e[13]=(r*E-n*S+s*T)*L,e[14]=(p*y-m*M-g*b)*L,e[15]=(h*M-f*y+l*b)*L,e):null}function se(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],u=t[6],c=t[7],h=t[8],f=t[9],l=t[10],d=t[11],m=t[12],p=t[13],g=t[14],x=t[15];return e[0]=o*(l*x-d*g)-f*(u*x-c*g)+p*(u*d-c*l),e[1]=-(n*(l*x-d*g)-f*(s*x-i*g)+p*(s*d-i*l)),e[2]=n*(u*x-c*g)-o*(s*x-i*g)+p*(s*c-i*u),e[3]=-(n*(u*d-c*l)-o*(s*d-i*l)+f*(s*c-i*u)),e[4]=-(a*(l*x-d*g)-h*(u*x-c*g)+m*(u*d-c*l)),e[5]=r*(l*x-d*g)-h*(s*x-i*g)+m*(s*d-i*l),e[6]=-(r*(u*x-c*g)-a*(s*x-i*g)+m*(s*c-i*u)),e[7]=r*(u*d-c*l)-a*(s*d-i*l)+h*(s*c-i*u),e[8]=a*(f*x-d*p)-h*(o*x-c*p)+m*(o*d-c*f),e[9]=-(r*(f*x-d*p)-h*(n*x-i*p)+m*(n*d-i*f)),e[10]=r*(o*x-c*p)-a*(n*x-i*p)+m*(n*c-i*o),e[11]=-(r*(o*d-c*f)-a*(n*d-i*f)+h*(n*c-i*o)),e[12]=-(a*(f*g-l*p)-h*(o*g-u*p)+m*(o*l-u*f)),e[13]=r*(f*g-l*p)-h*(n*g-s*p)+m*(n*l-s*f),e[14]=-(r*(o*g-u*p)-a*(n*g-s*p)+m*(n*u-s*o)),e[15]=r*(o*l-u*f)-a*(n*l-s*f)+h*(n*u-s*o),e}function ie(e){var t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],a=e[5],o=e[6],u=e[7],c=e[8],h=e[9],f=e[10],l=e[11],d=e[12],m=e[13],p=e[14],g=e[15];return(t*a-r*i)*(f*g-l*p)-(t*o-n*i)*(h*g-l*m)+(t*u-s*i)*(h*p-f*m)+(r*o-n*a)*(c*g-l*d)-(r*u-s*a)*(c*p-f*d)+(n*u-s*o)*(c*m-h*d)}function ae(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=t[4],u=t[5],c=t[6],h=t[7],f=t[8],l=t[9],d=t[10],m=t[11],p=t[12],g=t[13],x=t[14],b=t[15],y=r[0],v=r[1],M=r[2],w=r[3];return e[0]=y*n+v*o+M*f+w*p,e[1]=y*s+v*u+M*l+w*g,e[2]=y*i+v*c+M*d+w*x,e[3]=y*a+v*h+M*m+w*b,y=r[4],v=r[5],M=r[6],w=r[7],e[4]=y*n+v*o+M*f+w*p,e[5]=y*s+v*u+M*l+w*g,e[6]=y*i+v*c+M*d+w*x,e[7]=y*a+v*h+M*m+w*b,y=r[8],v=r[9],M=r[10],w=r[11],e[8]=y*n+v*o+M*f+w*p,e[9]=y*s+v*u+M*l+w*g,e[10]=y*i+v*c+M*d+w*x,e[11]=y*a+v*h+M*m+w*b,y=r[12],v=r[13],M=r[14],w=r[15],e[12]=y*n+v*o+M*f+w*p,e[13]=y*s+v*u+M*l+w*g,e[14]=y*i+v*c+M*d+w*x,e[15]=y*a+v*h+M*m+w*b,e}function oe(e,t,r){var n,s,i,a,o,u,c,h,f,l,d,m,p=r[0],g=r[1],x=r[2];return t===e?(e[12]=t[0]*p+t[4]*g+t[8]*x+t[12],e[13]=t[1]*p+t[5]*g+t[9]*x+t[13],e[14]=t[2]*p+t[6]*g+t[10]*x+t[14],e[15]=t[3]*p+t[7]*g+t[11]*x+t[15]):(n=t[0],s=t[1],i=t[2],a=t[3],o=t[4],u=t[5],c=t[6],h=t[7],f=t[8],l=t[9],d=t[10],m=t[11],e[0]=n,e[1]=s,e[2]=i,e[3]=a,e[4]=o,e[5]=u,e[6]=c,e[7]=h,e[8]=f,e[9]=l,e[10]=d,e[11]=m,e[12]=n*p+o*g+f*x+t[12],e[13]=s*p+u*g+l*x+t[13],e[14]=i*p+c*g+d*x+t[14],e[15]=a*p+h*g+m*x+t[15]),e}function ue(e,t,r){var n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ce(e,t,r,n){var s,i,a,o,u,c,h,f,l,d,m,p,g,x,b,y,v,M,w,_,T,S,U,E,F=n[0],A=n[1],L=n[2],D=Math.hypot(F,A,L);return D<X?null:(F*=D=1/D,A*=D,L*=D,s=Math.sin(r),a=1-(i=Math.cos(r)),o=t[0],u=t[1],c=t[2],h=t[3],f=t[4],l=t[5],d=t[6],m=t[7],p=t[8],g=t[9],x=t[10],b=t[11],y=F*F*a+i,v=A*F*a+L*s,M=L*F*a-A*s,w=F*A*a-L*s,_=A*A*a+i,T=L*A*a+F*s,S=F*L*a+A*s,U=A*L*a-F*s,E=L*L*a+i,e[0]=o*y+f*v+p*M,e[1]=u*y+l*v+g*M,e[2]=c*y+d*v+x*M,e[3]=h*y+m*v+b*M,e[4]=o*w+f*_+p*T,e[5]=u*w+l*_+g*T,e[6]=c*w+d*_+x*T,e[7]=h*w+m*_+b*T,e[8]=o*S+f*U+p*E,e[9]=u*S+l*U+g*E,e[10]=c*S+d*U+x*E,e[11]=h*S+m*U+b*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function he(e,t,r){var n=Math.sin(r),s=Math.cos(r),i=t[4],a=t[5],o=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+c*n,e[5]=a*s+h*n,e[6]=o*s+f*n,e[7]=u*s+l*n,e[8]=c*s-i*n,e[9]=h*s-a*n,e[10]=f*s-o*n,e[11]=l*s-u*n,e}function fe(e,t,r){var n=Math.sin(r),s=Math.cos(r),i=t[0],a=t[1],o=t[2],u=t[3],c=t[8],h=t[9],f=t[10],l=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-c*n,e[1]=a*s-h*n,e[2]=o*s-f*n,e[3]=u*s-l*n,e[8]=i*n+c*s,e[9]=a*n+h*s,e[10]=o*n+f*s,e[11]=u*n+l*s,e}function le(e,t,r){var n=Math.sin(r),s=Math.cos(r),i=t[0],a=t[1],o=t[2],u=t[3],c=t[4],h=t[5],f=t[6],l=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+c*n,e[1]=a*s+h*n,e[2]=o*s+f*n,e[3]=u*s+l*n,e[4]=c*s-i*n,e[5]=h*s-a*n,e[6]=f*s-o*n,e[7]=l*s-u*n,e}function de(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function me(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,t,r){var n,s,i,a=r[0],o=r[1],u=r[2],c=Math.hypot(a,o,u);return c<X?null:(a*=c=1/c,o*=c,u*=c,n=Math.sin(t),i=1-(s=Math.cos(t)),e[0]=a*a*i+s,e[1]=o*a*i+u*n,e[2]=u*a*i-o*n,e[3]=0,e[4]=a*o*i-u*n,e[5]=o*o*i+s,e[6]=u*o*i+a*n,e[7]=0,e[8]=a*u*i+o*n,e[9]=o*u*i-a*n,e[10]=u*u*i+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ge(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xe(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function be(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ye(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=n+n,u=s+s,c=i+i,h=n*o,f=n*u,l=n*c,d=s*u,m=s*c,p=i*c,g=a*o,x=a*u,b=a*c;return e[0]=1-(d+p),e[1]=f+b,e[2]=l-x,e[3]=0,e[4]=f-b,e[5]=1-(h+p),e[6]=m+g,e[7]=0,e[8]=l+x,e[9]=m-g,e[10]=1-(h+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ve(e,t){var r=new W(3),n=-t[0],s=-t[1],i=-t[2],a=t[3],o=t[4],u=t[5],c=t[6],h=t[7],f=n*n+s*s+i*i+a*a;return f>0?(r[0]=2*(o*a+h*n+u*i-c*s)/f,r[1]=2*(u*a+h*s+c*n-o*i)/f,r[2]=2*(c*a+h*i+o*s-u*n)/f):(r[0]=2*(o*a+h*n+u*i-c*s),r[1]=2*(u*a+h*s+c*n-o*i),r[2]=2*(c*a+h*i+o*s-u*n)),ye(e,t,r),e}function Me(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function we(e,t){var r=t[0],n=t[1],s=t[2],i=t[4],a=t[5],o=t[6],u=t[8],c=t[9],h=t[10];return e[0]=Math.hypot(r,n,s),e[1]=Math.hypot(i,a,o),e[2]=Math.hypot(u,c,h),e}function _e(e,t){var r=new W(3);we(r,t);var n=1/r[0],s=1/r[1],i=1/r[2],a=t[0]*n,o=t[1]*s,u=t[2]*i,c=t[4]*n,h=t[5]*s,f=t[6]*i,l=t[8]*n,d=t[9]*s,m=t[10]*i,p=a+h+m,g=0;return p>0?(g=2*Math.sqrt(p+1),e[3]=.25*g,e[0]=(f-d)/g,e[1]=(l-u)/g,e[2]=(o-c)/g):a>h&&a>m?(g=2*Math.sqrt(1+a-h-m),e[3]=(f-d)/g,e[0]=.25*g,e[1]=(o+c)/g,e[2]=(l+u)/g):h>m?(g=2*Math.sqrt(1+h-a-m),e[3]=(l-u)/g,e[0]=(o+c)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=2*Math.sqrt(1+m-a-h),e[3]=(o-c)/g,e[0]=(l+u)/g,e[1]=(f+d)/g,e[2]=.25*g),e}function Te(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=t[3],u=s+s,c=i+i,h=a+a,f=s*u,l=s*c,d=s*h,m=i*c,p=i*h,g=a*h,x=o*u,b=o*c,y=o*h,v=n[0],M=n[1],w=n[2];return e[0]=(1-(m+g))*v,e[1]=(l+y)*v,e[2]=(d-b)*v,e[3]=0,e[4]=(l-y)*M,e[5]=(1-(f+g))*M,e[6]=(p+x)*M,e[7]=0,e[8]=(d+b)*w,e[9]=(p-x)*w,e[10]=(1-(f+m))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Se(e,t,r,n,s){var i=t[0],a=t[1],o=t[2],u=t[3],c=i+i,h=a+a,f=o+o,l=i*c,d=i*h,m=i*f,p=a*h,g=a*f,x=o*f,b=u*c,y=u*h,v=u*f,M=n[0],w=n[1],_=n[2],T=s[0],S=s[1],U=s[2],E=(1-(p+x))*M,F=(d+v)*M,A=(m-y)*M,L=(d-v)*w,D=(1-(l+x))*w,I=(g+b)*w,B=(m+y)*_,N=(g-b)*_,R=(1-(l+p))*_;return e[0]=E,e[1]=F,e[2]=A,e[3]=0,e[4]=L,e[5]=D,e[6]=I,e[7]=0,e[8]=B,e[9]=N,e[10]=R,e[11]=0,e[12]=r[0]+T-(E*T+L*S+B*U),e[13]=r[1]+S-(F*T+D*S+N*U),e[14]=r[2]+U-(A*T+I*S+R*U),e[15]=1,e}function Ue(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r+r,o=n+n,u=s+s,c=r*a,h=n*a,f=n*o,l=s*a,d=s*o,m=s*u,p=i*a,g=i*o,x=i*u;return e[0]=1-f-m,e[1]=h+x,e[2]=l-g,e[3]=0,e[4]=h-x,e[5]=1-c-m,e[6]=d+p,e[7]=0,e[8]=l+g,e[9]=d-p,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ee(e,t,r,n,s,i,a){var o=1/(r-t),u=1/(s-n),c=1/(i-a);return e[0]=2*i*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*u,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(s+n)*u,e[10]=(a+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*c,e[15]=0,e}function Fe(e,t,r,n,s){var i,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(i=1/(n-s),e[10]=(s+n)*i,e[14]=2*s*n*i):(e[10]=-1,e[14]=-2*n),e}function Ae(e,t,r,n){var s=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+o),c=2/(s+i);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-o)*u*.5,e[9]=(s-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Le(e,t,r,n,s,i,a){var o=1/(t-r),u=1/(n-s),c=1/(i-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(s+n)*u,e[14]=(a+i)*c,e[15]=1,e}function De(e,t,r,n){var s,i,a,o,u,c,h,f,l,d,m=t[0],p=t[1],g=t[2],x=n[0],b=n[1],y=n[2],v=r[0],M=r[1],w=r[2];return Math.abs(m-v)<X&&Math.abs(p-M)<X&&Math.abs(g-w)<X?te(e):(h=m-v,f=p-M,l=g-w,s=b*(l*=d=1/Math.hypot(h,f,l))-y*(f*=d),i=y*(h*=d)-x*l,a=x*f-b*h,(d=Math.hypot(s,i,a))?(s*=d=1/d,i*=d,a*=d):(s=0,i=0,a=0),o=f*a-l*i,u=l*s-h*a,c=h*i-f*s,(d=Math.hypot(o,u,c))?(o*=d=1/d,u*=d,c*=d):(o=0,u=0,c=0),e[0]=s,e[1]=o,e[2]=h,e[3]=0,e[4]=i,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=l,e[11]=0,e[12]=-(s*m+i*p+a*g),e[13]=-(o*m+u*p+c*g),e[14]=-(h*m+f*p+l*g),e[15]=1,e)}function Ie(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=n[0],u=n[1],c=n[2],h=s-r[0],f=i-r[1],l=a-r[2],d=h*h+f*f+l*l;d>0&&(h*=d=1/Math.sqrt(d),f*=d,l*=d);var m=u*l-c*f,p=c*h-o*l,g=o*f-u*h;return(d=m*m+p*p+g*g)>0&&(m*=d=1/Math.sqrt(d),p*=d,g*=d),e[0]=m,e[1]=p,e[2]=g,e[3]=0,e[4]=f*g-l*p,e[5]=l*m-h*g,e[6]=h*p-f*m,e[7]=0,e[8]=h,e[9]=f,e[10]=l,e[11]=0,e[12]=s,e[13]=i,e[14]=a,e[15]=1,e}function Be(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ne(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Re(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Oe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Pe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Ve(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Ce(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Ge(e,t){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],f=e[9],l=e[10],d=e[11],m=e[12],p=e[13],g=e[14],x=e[15],b=t[0],y=t[1],v=t[2],M=t[3],w=t[4],_=t[5],T=t[6],S=t[7],U=t[8],E=t[9],F=t[10],A=t[11],L=t[12],D=t[13],I=t[14],B=t[15];return Math.abs(r-b)<=X*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-y)<=X*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-v)<=X*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(i-M)<=X*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(a-w)<=X*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-_)<=X*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(u-T)<=X*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-S)<=X*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-U)<=X*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(f-E)<=X*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(l-F)<=X*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(d-A)<=X*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(m-L)<=X*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(p-D)<=X*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-I)<=X*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(x-B)<=X*Math.max(1,Math.abs(x),Math.abs(B))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ke=ae,je=Oe;function qe(){var e=new W(3);return W!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ze(e){var t=new W(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $e(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function He(e,t,r){var n=new W(3);return n[0]=e,n[1]=t,n[2]=r,n}function Xe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function We(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Ye(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Ke(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Je(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ze(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Qe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function et(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function tt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function rt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function nt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function st(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function it(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function at(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.hypot(r,n,s)}function ot(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}function ut(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function ct(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ht(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function ft(e,t){var r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function lt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dt(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[0],o=r[1],u=r[2];return e[0]=s*u-i*o,e[1]=i*a-n*u,e[2]=n*o-s*a,e}function mt(e,t,r,n){var s=t[0],i=t[1],a=t[2];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e}function pt(e,t,r,n,s,i){var a=i*i,o=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),h=a*(3-2*i);return e[0]=t[0]*o+r[0]*u+n[0]*c+s[0]*h,e[1]=t[1]*o+r[1]*u+n[1]*c+s[1]*h,e[2]=t[2]*o+r[2]*u+n[2]*c+s[2]*h,e}function gt(e,t,r,n,s,i){var a=1-i,o=a*a,u=i*i,c=o*a,h=3*i*o,f=3*u*a,l=u*i;return e[0]=t[0]*c+r[0]*h+n[0]*f+s[0]*l,e[1]=t[1]*c+r[1]*h+n[1]*f+s[1]*l,e[2]=t[2]*c+r[2]*h+n[2]*f+s[2]*l,e}function xt(e,t){t=t||1;var r=2*Y()*Math.PI,n=2*Y()-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}function bt(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,e}function yt(e,t,r){var n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function vt(e,t,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=t[0],u=t[1],c=t[2],h=s*c-i*u,f=i*o-n*c,l=n*u-s*o,d=s*l-i*f,m=i*h-n*l,p=n*f-s*h,g=2*a;return h*=g,f*=g,l*=g,d*=2,m*=2,p*=2,e[0]=o+h+d,e[1]=u+f+m,e[2]=c+l+p,e}function Mt(e,t,r,n){var s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function wt(e,t,r,n){var s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function _t(e,t,r,n){var s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function Tt(e,t){var r=e[0],n=e[1],s=e[2],i=t[0],a=t[1],o=t[2],u=Math.sqrt(r*r+n*n+s*s)*Math.sqrt(i*i+a*a+o*o),c=u&&lt(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function St(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ut(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ft(e,t){var r=e[0],n=e[1],s=e[2],i=t[0],a=t[1],o=t[2];return Math.abs(r-i)<=X*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=X*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-o)<=X*Math.max(1,Math.abs(s),Math.abs(o))}var At,Lt=Ke,Dt=Je,It=Ze,Bt=at,Nt=ot,Rt=$e,Ot=ut,Pt=(At=qe(),function(e,t,r,n,s,i){var a,o;for(t||(t=3),r||(r=0),o=n?Math.min(n*t+r,e.length):e.length,a=r;a<o;a+=t)At[0]=e[a],At[1]=e[a+1],At[2]=e[a+2],s(At,At,i),e[a]=At[0],e[a+1]=At[1],e[a+2]=At[2];return e});function Vt(){var e=new W(4);return W!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ct(e){var t=new W(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Gt(e,t,r,n){var s=new W(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s}function kt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function jt(e,t,r,n,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e}function qt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function zt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function $t(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Ht(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Xt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Wt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Yt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Kt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Jt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Zt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Qt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function er(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return Math.hypot(r,n,s,i)}function tr(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+s*s+i*i}function rr(e){var t=e[0],r=e[1],n=e[2],s=e[3];return Math.hypot(t,r,n,s)}function nr(e){var t=e[0],r=e[1],n=e[2],s=e[3];return t*t+r*r+n*n+s*s}function sr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ir(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ar(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=s*a,e[3]=i*a,e}function or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ur(e,t,r,n){var s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],h=t[0],f=t[1],l=t[2],d=t[3];return e[0]=f*c-l*u+d*o,e[1]=-h*c+l*a-d*i,e[2]=h*u-f*a+d*s,e[3]=-h*o+f*i-l*s,e}function cr(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=t[3];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e[3]=o+n*(r[3]-o),e}function hr(e,t){var r,n,s,i,a,o;t=t||1;do{a=(r=2*Y()-1)*r+(n=2*Y()-1)*n}while(a>=1);do{o=(s=2*Y()-1)*s+(i=2*Y()-1)*i}while(o>=1);var u=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*n,e[2]=t*s*u,e[3]=t*i*u,e}function fr(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,e}function lr(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[0],o=r[1],u=r[2],c=r[3],h=c*n+o*i-u*s,f=c*s+u*n-a*i,l=c*i+a*s-o*n,d=-a*n-o*s-u*i;return e[0]=h*c+d*-a+f*-u-l*-o,e[1]=f*c+d*-o+l*-a-h*-u,e[2]=l*c+d*-u+h*-o-f*-a,e[3]=t[3],e}function dr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function mr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function pr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function gr(e,t){var r=e[0],n=e[1],s=e[2],i=e[3],a=t[0],o=t[1],u=t[2],c=t[3];return Math.abs(r-a)<=X*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=X*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-u)<=X*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(i-c)<=X*Math.max(1,Math.abs(i),Math.abs(c))}var xr=zt,br=$t,yr=Ht,vr=er,Mr=tr,wr=rr,_r=nr,Tr=function(){var e=Vt();return function(t,r,n,s,i,a){var o,u;for(r||(r=4),n||(n=0),u=s?Math.min(s*r+n,t.length):t.length,o=n;o<u;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],i(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function Sr(){var e=new W(4);return W!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ur(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Er(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Fr(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>X?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function Ar(e,t){var r=an(e,t);return Math.acos(2*r*r-1)}function Lr(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=r[0],u=r[1],c=r[2],h=r[3];return e[0]=n*h+a*o+s*c-i*u,e[1]=s*h+a*u+i*o-n*c,e[2]=i*h+a*c+n*u-s*o,e[3]=a*h-n*o-s*u-i*c,e}function Dr(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*o,e[1]=s*u+i*o,e[2]=i*u-s*o,e[3]=a*u-n*o,e}function Ir(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u-i*o,e[1]=s*u+a*o,e[2]=i*u+n*o,e[3]=a*u-s*o,e}function Br(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*o,e[1]=s*u-n*o,e[2]=i*u+a*o,e[3]=a*u-i*o,e}function Nr(e,t){var r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e}function Rr(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=Math.sqrt(r*r+n*n+s*s),o=Math.exp(i),u=a>0?o*Math.sin(a)/a:0;return e[0]=r*u,e[1]=n*u,e[2]=s*u,e[3]=o*Math.cos(a),e}function Or(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=Math.sqrt(r*r+n*n+s*s),o=a>0?Math.atan2(a,i)/a:0;return e[0]=r*o,e[1]=n*o,e[2]=s*o,e[3]=.5*Math.log(r*r+n*n+s*s+i*i),e}function Pr(e,t,r){return Or(e,t),sn(e,e,r),Rr(e,e),e}function Vr(e,t,r,n){var s,i,a,o,u,c=t[0],h=t[1],f=t[2],l=t[3],d=r[0],m=r[1],p=r[2],g=r[3];return(i=c*d+h*m+f*p+l*g)<0&&(i=-i,d=-d,m=-m,p=-p,g=-g),1-i>X?(s=Math.acos(i),a=Math.sin(s),o=Math.sin((1-n)*s)/a,u=Math.sin(n*s)/a):(o=1-n,u=n),e[0]=o*c+u*d,e[1]=o*h+u*m,e[2]=o*f+u*p,e[3]=o*l+u*g,e}function Cr(e){var t=Y(),r=Y(),n=Y(),s=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*r),e[1]=s*Math.cos(2*Math.PI*r),e[2]=i*Math.sin(2*Math.PI*n),e[3]=i*Math.cos(2*Math.PI*n),e}function Gr(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r*r+n*n+s*s+i*i,o=a?1/a:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-s*o,e[3]=i*o,e}function kr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function jr(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*i+i]-t[3*a+a]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+s]+t[3*s+i])*r,e[a]=(t[3*a+s]+t[3*s+a])*r}return e}function qr(e,t,r,n){var s=.5*Math.PI/180;t*=s,r*=s,n*=s;var i=Math.sin(t),a=Math.cos(t),o=Math.sin(r),u=Math.cos(r),c=Math.sin(n),h=Math.cos(n);return e[0]=i*u*h-a*o*c,e[1]=a*o*h+i*u*c,e[2]=a*u*c-i*o*h,e[3]=a*u*h+i*o*c,e}function zr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var $r,Hr,Xr,Wr,Yr,Kr,Jr,Zr=Ct,Qr=Gt,en=kt,tn=jt,rn=qt,nn=Lr,sn=Zt,an=or,on=cr,un=rr,cn=un,hn=nr,fn=hn,ln=ar,dn=pr,mn=gr,pn=($r=qe(),Hr=He(1,0,0),Xr=He(0,1,0),function(e,t,r){var n=lt(t,r);return n<-.999999?(dt($r,Hr,t),Rt($r)<1e-6&&dt($r,Xr,t),ft($r,$r),Er(e,$r,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(dt($r,t,r),e[0]=$r[0],e[1]=$r[1],e[2]=$r[2],e[3]=1+n,ln(e,e))}),gn=(Wr=Sr(),Yr=Sr(),function(e,t,r,n,s,i){return Vr(Wr,t,s,i),Vr(Yr,r,n,i),Vr(e,Wr,Yr,2*i*(1-i)),e}),xn=(Kr=new W(9),W!=Float32Array&&(Kr[1]=0,Kr[2]=0,Kr[3]=0,Kr[5]=0,Kr[6]=0,Kr[7]=0),Kr[0]=1,Kr[4]=1,Kr[8]=1,Jr=Kr,function(e,t,r,n){return Jr[0]=r[0],Jr[3]=r[1],Jr[6]=r[2],Jr[1]=n[0],Jr[4]=n[1],Jr[7]=n[2],Jr[2]=-t[0],Jr[5]=-t[1],Jr[8]=-t[2],ln(e,jr(e,Jr))});function bn(e,t=""){if(!e){const e=new Error(`Assert fail: ${t}`);throw console.error(e.stack),e}}function yn(e,t){if(null!=e)return e;throw new Error(Mn(t,"Missing object"))}function vn(e){return null!=e}function Mn(e,t){return null!=e?e:t}class wn{constructor(e,t,r,i){this.cameraMatrix=n.create(),this.viewMatrix=n.create(),this.projectionMatrix=n.create(),this.projectionMatrixInverse=n.create(),this.viewProjMatrix=n.create(),this.viewProjMatrixInverse=n.create(),this.forward=s.create(),this.up=s.create(),this.right=s.create(),e=Mn(e,60/180*Math.PI),r=Mn(r,1),i=Mn(i,2e3),t=Mn(t,1),this.setPerspective(e,t,r,i)}copy(e){this.fov=e.fov,this.near=e.near,this.far=e.far,this.aspect=e.aspect,n.copy(this.cameraMatrix,e.cameraMatrix),n.copy(this.viewMatrix,e.viewMatrix),n.copy(this.projectionMatrix,e.projectionMatrix),n.copy(this.projectionMatrixInverse,e.projectionMatrixInverse),n.copy(this.viewProjMatrix,e.viewProjMatrix),n.copy(this.viewProjMatrixInverse,e.viewProjMatrixInverse),s.copy(this.forward,e.forward),s.copy(this.up,e.up),s.copy(this.right,e.right)}getPos(e){return n.getTranslation(e,this.cameraMatrix)}viewMatrixUpdated(){n.invert(this.cameraMatrix,this.viewMatrix),s.set(this.right,this.cameraMatrix[0],this.cameraMatrix[1],this.cameraMatrix[2]),s.set(this.up,this.cameraMatrix[4],this.cameraMatrix[5],this.cameraMatrix[6]),s.set(this.forward,-this.cameraMatrix[8],-this.cameraMatrix[9],-this.cameraMatrix[10]),n.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}setPerspective(e,t,r,s=1/0){this.fov=e,this.aspect=t,this.near=r,this.far=s,n.perspective(this.projectionMatrix,e,t,r,s),n.invert(this.projectionMatrixInverse,this.projectionMatrix),n.multiply(this.viewProjMatrix,this.projectionMatrix,this.viewMatrix),n.multiply(this.viewProjMatrixInverse,this.cameraMatrix,this.projectionMatrixInverse)}}class _n{constructor(){this._add=[],this._folders={}}add(e,t,r,n,s){this._add.push(arguments)}addFolder(e){return this._folders[e]=new _n,this._folders[e]}async show(){var e;if(void 0===this._gui){const e=await r.e(2).then(r.bind(null,10));this._gui=new e.GUI({load:this._saveObject})}(null===(e=this._saveObject)||void 0===e?void 0:e.closed)&&this._gui.close();for(const e of this._add)this._gui.getRoot().remember(e[0]),this._gui.add.apply(this._gui,e);for(const e in this._folders)this._folders[e]._gui=this._gui.addFolder(e),this._folders[e].show();this.add=this._gui.add.bind(this._gui),this.addFolder=this._gui.addFolder.bind(this._gui),this.show=this._gui.show.bind(this._gui),this.hide=this._gui.hide.bind(this._gui)}hide(){}update(){if(this._gui&&!this._gui.closed)for(var e in this._gui.__controllers)this._gui.__controllers[e].updateDisplay()}toJSON(){return this._gui?this._gui.getSaveObject():void 0}fromJSON(e){bn(!vn(this._gui),"State must be loaded before the DebugMenu is shown"),this._saveObject=e}}window.onkeyup=e=>{"KeyT"===e.code&&Tn.show()};let Tn=new _n;class Sn{constructor(){this.matrixWorldDirty=!0,this.matrixDirty=!0,this.name="",this.position=s.create(),this.rotation=a.create(),this.scale=s.fromValues(1,1,1),this.matrix=n.create(),this.matrixWorld=n.create(),this.parent=null,this.children=[]}updateMatrix(){n.fromRotationTranslationScale(this.matrix,this.rotation,this.position,this.scale),this.matrixWorldDirty=!0}updateMatrixWorld(e,t){const r=this.parent;if(!0===e&&vn(r)&&r.updateMatrixWorld(!0,!1),vn(this.parent)?n.multiply(this.matrixWorld,this.parent.matrixWorld,this.matrix):n.copy(this.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateMatrixWorld(!1,!0)}}add(e,...t){yn(e),bn(e!==this,"Object can't be added as a child of itself"),null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(let e=0;e<t.length;e++)this.add(t[e]);return this}remove(e,...t){const r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1)),this}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,s.copy(this.position,e.position),a.copy(this.rotation,e.rotation),s.copy(this.scale,e.scale),this.matrix=n.copy(this.matrix,e.matrix),this.matrixWorld=n.copy(this.matrixWorld,e.matrixWorld),!0===t)for(var r=0;r<e.children.length;r++){const t=e.children[r];this.add(t.clone())}return this}}class Un{constructor(e){this.vertexLayout=e.vertexLayout,this.vertexBuffers=e.vertexBuffers,this.elementCount=e.elementCount,this.primitiveType=Mn(e.primitiveType,p.Triangles),bn(e.vertexBuffers.length===e.vertexLayout.buffers.length),e.indexBuffer&&(this.indexBuffer=e.indexBuffer,this.indexType=Mn(e.indexType,h.Ushort))}}class En{constructor(e,t,r,n){this.shader=r,this.name=t,this.layout=n,this.resources=e.createResourceTable(this.layout),this.bindings={}}assertReady(){for(const e of Object.keys(this.layout))yn(this.bindings[e],`Material expects a binding for ${e}`)}getUniformBuffer(e){const t=this.bindings[e];return yn(t,`Uniform buffer "${e}" is not bound to material "${this.name}"`),t}setUniformBuffer(e,t,r){const n=yn(this.layout[t],"Invalid resource name");bn(n.type===x.UniformBuffer,"Mismatching resource type"),this.bindings[t]=r,e.setBuffer(this.resources,n.index,r.getBufferView())}setTexture(e,t,r){const n=yn(this.layout[t],"Invalid resource name");bn(n.type===x.Texture,"Mismatching resource type"),bn(!vn(n.count),"Use Material.setTextureArray"),this.bindings[t]=r,e.setTexture(this.resources,n.index,r)}setTextureArray(e,t,r){const n=yn(this.layout[t],"Invalid resource name");bn(n.type===x.Texture,"Mismatching resource type"),bn(vn(n.count),"Use Material.setTextureArray"),this.bindings[t]=r,e.setTextures(this.resources,n.index,r)}}class Fn extends Sn{constructor(e,t,r,n){super(),this.renderList=t,this.mesh=r,this.material=n,this.pipeline=e.createRenderPipeline(n.shader,t.renderFormat,r.vertexLayout,n.layout),this.vertexTable=e.createVertexTable(this.pipeline),r.vertexBuffers.forEach((t,r)=>{e.setVertexBuffer(this.vertexTable,r,t)}),this._primitive={renderPipeline:this.pipeline,resourceTable:this.material.resources,vertexTable:this.vertexTable,elementCount:this.mesh.elementCount,type:this.mesh.primitiveType,indexBuffer:this.mesh.indexBuffer,indexType:this.mesh.indexType}}get primitive(){return this.material.assertReady(),this._primitive}}class An extends Fn{constructor(e,t,r,n){super(e,t,r,n)}bindSkeleton(e){this.skeleton=e}}const Ln={opaque:new class{constructor(e,t,r){this.defaultCullMode=e,this.defaultDepthState=t,this.renderFormat=r,this.primitives=[]}push(e){this.primitives.push(e)}}(y.Back,{depthWriteEnabled:!0,depthTestEnabled:!0},{blendingEnabled:!1})};function Dn(e){const t={};let r=0;const n=Object.keys(e);for(let s=0;s<n.length;s++){const i=e[n[s]];t[n[s]]=Object.assign(Object.assign({},i),{offset:r}),r+=w(i.type)*Mn(i.count,1)}return t}class In{constructor(e,t,r){this.bufferSize=0,this.bufferLayout=r;const n=Object.keys(this.bufferLayout);let s=this.bufferLayout[n[0]];for(let e=1;e<n.length;e++){const t=this.bufferLayout[n[e]];t.offset>s.offset&&(s=t)}this.bufferSize=s.offset+Bn(s),this.bufferData=new ArrayBuffer(this.bufferSize),this.bufferBytes=new Uint8Array(this.bufferData),this.bufferFloats=new Float32Array(this.bufferData),this.buffer=t.createBuffer(e,g.Uniform,b.Dynamic,this.bufferSize)}getBufferView(){return{buffer:this.buffer,byteOffset:0}}getBufferLayout(){return this.bufferLayout}setFloat(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferFloats[r.offset/4]=t}setVec2(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferFloats.set(t,r.offset/4)}setVec3(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferFloats.set(t,r.offset/4)}setVec4(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferFloats.set(t,r.offset/4)}setMat4(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);this.bufferFloats.set(t,r.offset/4)}setBytes(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);if(t.length!==Bn(r))throw new Error("Invalid size");this.bufferBytes.set(t,r.offset)}setFloats(e,t){const r=yn(this.bufferLayout[e],`Attempted to set unknown uniform ${e}`);if(t.length!==Bn(r)/4)throw new Error("Invalid size");this.bufferFloats.set(t,r.offset/4)}getFloatArray(e){const t=this.bufferLayout[e];if(!t)throw new Error(`Attempted to set unknown uniform ${e}`);return new Float32Array(this.bufferData,t.offset,Bn(t)/4)}write(e){e.writeBufferData(this.buffer,0,this.bufferBytes)}terminate(e){e.removeBuffer(this.buffer)}}function Bn(e){return w(e.type)*Mn(e.count,1)}class Nn{constructor(e){this.renderer=e}initialize(){this.buffer=new In("GlobalUniforms",this.renderer,Nn.bufferLayout)}update(){this.buffer.write(this.renderer)}}Nn.bufferLayout=Dn({g_camPos:{type:h.Float3},g_proj:{type:h.Float4x4},g_viewProj:{type:h.Float4x4}});var Rn=r(2),On=r.n(Rn),Pn=r(1),Vn=r.n(Pn),Cn=r(0),Gn=r.n(Cn);const kn=n.create();function jn(e,t,r){return(r-e)/(t-e)}function qn(e,t,r){return Math.max(Math.min(e,r),t)}class zn{constructor(e,t){this.bones=[],this.bones=e,this.boneBuffer=new Float32Array(16*e.length),this.inverseBindMatrices=t,bn(!vn(this.inverseBindMatrices)||this.bones.length===this.inverseBindMatrices.length)}evaluate(e){const t=this.bones[0];this.evaluateBone(t,Mn(e,kn))}evaluateBone(e,t){n.fromRotationTranslationScale(e.matrix,e.rotation,e.position,e.scale);const r=n.multiply(e.matrixWorld,t,e.matrix);if(e.children)for(const t of e.children)this.evaluateBone(t,r)}writeToBuffer(e){if(vn(this.inverseBindMatrices))for(let t=0;t<this.bones.length;t++){const r=this.bones[t];n.multiply(e.subarray(16*t,16*t+16),r.matrixWorld,this.inverseBindMatrices[t])}else e.set(this.boneBuffer)}}class $n{constructor(){this.name="AvatarShader",this.defines="#define k_MaxBones 32\n",this.vertSource=[this.defines,$n.vert.sourceCode],this.fragSource=$n.frag.sourceCode}}$n.vert=On.a,$n.frag=Gn.a,$n.uniformLayout=Dn({u_color:{type:h.Float4},u_joints:{type:h.Float4x4,count:32}}),$n.resourceLayout={uniforms:{index:0,type:x.UniformBuffer,layout:$n.uniformLayout},globalUniforms:{index:1,type:x.UniformBuffer,layout:Nn.bufferLayout}};class Hn{constructor(){this.name="ModelShader",this.vertSource=Hn.vert.sourceCode,this.fragSource=Hn.frag.sourceCode}}Hn.vert=Vn.a,Hn.frag=Gn.a,Hn.uniformLayout=Dn({u_color:{type:h.Float4},u_model:{type:h.Float4x4}}),Hn.resourceLayout={uniforms:{index:0,type:x.UniformBuffer,layout:Hn.uniformLayout},globalUniforms:{index:1,type:x.UniformBuffer,layout:Nn.bufferLayout}};class Xn{constructor(){this.models=[],this.skinnedModels=[],this.rootNodes=[],this.animations=[]}initialize({gfxDevice:e,resources:t,globalUniforms:r}){this.gfxDevice=e,this.globalUniforms=r,this.shader=e.createShader(new $n),this.modelShader=e.createShader(new Hn),t.load("data/Avatar.glb","gltf",(e,t)=>{if(e)return console.error("Failed to load resource",e);const r=t;this.animations=r.animations,this.nodes=this.loadNodes(r),this.skeletons=r.skins.map(e=>{const t=e.joints.map(e=>this.nodes[e]);return new zn(t,e.inverseBindMatrices)});for(let e=0;e<r.nodes.length;e++){const t=r.nodes[e],n=this.nodes[e];if(vn(t.skinId)){const e=yn(t.meshId);this.loadSkinnedModel(r,n,e,t.skinId)}else vn(t.meshId)&&this.loadModel(r,n,t.meshId)}this.rootNodes=r.rootNodeIds.map(e=>this.nodes[e]),this.rootNodes.forEach(e=>{e.updateMatrix(),e.updateMatrixWorld(!1,!0)})})}loadNodes(e){const t=e.nodes.map((e,t)=>{const r=new Sn;return r.name=Mn(e.name,`Node${t}`),s.copy(r.position,e.translation),a.copy(r.rotation,e.rotation),s.copy(r.scale,e.scale),r.updateMatrix(),r});for(let r=0;r<e.nodes.length;r++){const n=e.nodes[r],s=t[r];if(n.children)for(const e of n.children){const r=t[e];s.add(r)}}return t}createMaterial(e,t){const r=e.material.technique,n=r?r.shader.id:this.shader,s=r?function(e){const t={},r=[];for(const n of Object.keys(e.uniforms)){const s=e.uniforms[n];s.type===h.Texture2D?r.push(n):t[n]=s}const n=Dn(t),s={uniforms:{index:0,type:x.UniformBuffer,layout:n}};for(let e=0;e<r.length;e++){s[r[e]]={index:e,type:x.Texture}}return s}(r):$n.resourceLayout,a=new En(this.gfxDevice,e.material.name,n,s),o=s.uniforms.layout,u=new In(e.material.name,this.gfxDevice,o);if(a.setUniformBuffer(this.gfxDevice,"uniforms",u),vn(s.globalUniforms)&&a.setUniformBuffer(this.gfxDevice,"globalUniforms",this.globalUniforms.buffer),r){const n=yn(e.material.values);for(const e of Object.keys(r.uniforms)){const s=r.uniforms[e],i=Mn(n[e],s.value);if(vn(i))if(s.type===h.Texture2D){const r=t.textures[i.index].id;a.setTexture(this.gfxDevice,e,r)}else u.setFloats(e,i)}u.setVec4("u_Color0",i.fromValues(.4266,.4171,.5057,1))}else u.setVec4("u_color",i.fromValues(0,1,0,1));return a}loadSkinnedModel(e,t,r,n){const s=e.meshes[r];for(let r of s.primitives){const s=this.createMaterial(r,e),i=new An(this.gfxDevice,Ln.opaque,r.mesh,s);i.bindSkeleton(this.skeletons[n]),this.skinnedModels.push(i),t.add(i)}}loadModel(e,t,r){const n=e.meshes[r];for(let r of n.primitives){const n=this.createMaterial(r,e),s=new Fn(this.gfxDevice,Ln.opaque,r.mesh,n);this.models.push(s),t.add(s)}}update({clock:e}){const t=this.animations[0];if(t){const r=e.time/1e3%t.maxTime;for(let e=0;e<t.rotations.length;e++){const n=t.rotations[e];Wn(r,n,this.nodes[n.nodeId].rotation)}for(let e=0;e<t.translations.length;e++){const n=t.translations[e];Yn(r,n,this.nodes[n.nodeId].position)}for(let e=0;e<t.scales.length;e++){const n=t.scales[e];Yn(r,n,this.nodes[n.nodeId].scale)}}}render({gfxDevice:e,camera:t,clock:r}){for(const e of this.rootNodes)e.updateMatrixWorld(!0,!0);for(let r=0;r<this.skinnedModels.length;r++){const s=this.skinnedModels[r],i=s.material.getUniformBuffer("uniforms");s.updateMatrixWorld(!0,!0),s.skeleton.evaluate(s.matrixWorld);const a=i.getFloatArray("u_joints");s.skeleton.writeToBuffer(a),vn(i.getBufferLayout().u_modelViewProjection)&&i.setMat4("u_modelViewProjection",n.multiply(n.create(),t.viewProjMatrix,s.matrixWorld)),vn(i.getBufferLayout().u_modelViewProjection)&&i.setMat4("u_model",s.matrixWorld),i.write(e),s.renderList.push(s.primitive)}for(let r=0;r<this.models.length;r++){const s=this.models[r];s.updateMatrixWorld(!0,!0);const i=s.material.getUniformBuffer("uniforms");i.setMat4("u_modelViewProjection",n.multiply(n.create(),t.viewProjMatrix,s.matrixWorld)),i.write(e),s.renderList.push(s.primitive)}}}function Wn(e,t,r){const n=t.times.length;let s=1,i=n-1,o=n-1;e=qn(e,t.times[0],t.times[n-1]);for(let r=0;r<n;r++){const n=t.times[r];if(n>e){s=jn(t.times[Math.max(r-1,0)],n,e),o=r,i=Math.max(r-1,0);break}}let u=t.values.subarray(4*i,4*i+4),c=t.values.subarray(4*o,4*o+4);return a.lerp(r,u,c,s)}function Yn(e,t,r){const n=t.times.length;let i=1,a=n-1,o=n-1;e=qn(e,t.times[0],t.times[n-1]);for(let r=1;r<n;r++){const n=t.times[r];if(n>e){i=jn(t.times[Math.max(r-1,0)],n,e),o=r,a=Math.max(r-1,0);break}}let u=t.values.subarray(3*a,3*a+3),c=t.values.subarray(3*o,3*o+3);return s.lerp(r,u,c,i)}const Kn=s.create();s.create(),s.create();class Jn{constructor(e){this.camera=e,this.camPos=s.create()}initialize(){this.resize(window.innerWidth,window.innerHeight),this.controller=new Qn,this.controller.camera=this.camera}resize(e,t){const r=e/t;this.camera.setPerspective(this.camera.fov,r,this.camera.near,this.camera.far)}update({globalUniforms:e,input:t,clock:r}){this.controller.update(t,r.dt);const n=this.camera.getPos(this.camPos);e.buffer.setVec3("g_camPos",n),e.buffer.setMat4("g_proj",this.camera.projectionMatrix),e.buffer.setMat4("g_viewProj",this.camera.viewProjMatrix)}toJSON(){return this.controller.toJSON()}fromJSON(e){return this.controller.fromJSON(e)}}const Zn=s.fromValues(0,1,0);class Qn{constructor(){this.x=-Math.PI/2,this.y=2,this.z=-4,this.orbitSpeed=-.05,this.xVel=0,this.yVel=0,this.zVel=0,this.translation=s.create(),this.txVel=0,this.tyVel=0,this.shouldOrbit=!0;const e=Tn.addFolder("OrbitCamera");e.add(this,"orbitSpeed",-1,1),e.add(this,"shouldOrbit",-1,1)}update(e,t){const r=this.shouldOrbit,i=e.invertX?-1:1,a=e.invertY?-1:1;1===e.button?(this.txVel+=e.dx*(-10-Math.min(this.z,.01))/-5e3,this.tyVel+=e.dy*(-10-Math.min(this.z,.01))/5e3):e.isDragging()?(this.xVel+=e.dx/-200*i,this.yVel+=e.dy/-200*a):r&&Math.abs(this.xVel)<Math.abs(this.orbitSpeed)&&(this.xVel+=1*this.orbitSpeed/50),this.zVel+=e.dz;let o=0,u=0;e.isKeyDown("KeyA")&&(o+=.02),e.isKeyDown("KeyD")&&(o-=.02),e.isKeyDown("KeyW")&&(u+=.02),e.isKeyDown("KeyS")&&(u-=.02);const c=e.isKeyDown("ShiftLeft")||e.isKeyDown("ShiftRight");if(c?(this.xVel+=-o,this.yVel+=-u):(this.txVel+=o,this.tyVel+=-u),this.xVel=es(this.xVel,2),this.yVel=es(this.yVel,2),0!==this.xVel||0!==this.yVel||0!==this.zVel||0!==this.txVel||0!==this.tyVel){const t=e.isDragging()||c?.92:.96;this.x+=-this.xVel/10,this.xVel*=t,this.y+=-this.yVel/10,this.yVel*=t,this.txVel*=t,this.tyVel*=t,this.z+=4*Math.max(Math.log(Math.abs(this.zVel)),0)*Math.sign(this.zVel),0===e.dz&&(this.zVel*=.85),this.z>-10&&(this.z=-10,this.zVel=0),s.set(Kn,this.camera.cameraMatrix[0],this.camera.cameraMatrix[1],this.camera.cameraMatrix[2]),s.scaleAndAdd(this.translation,this.translation,Kn,this.txVel),s.set(Kn,this.camera.cameraMatrix[4],this.camera.cameraMatrix[5],this.camera.cameraMatrix[6]),s.scaleAndAdd(this.translation,this.translation,Kn,this.tyVel);const r=Kn;!function(e,t,r){const n=Math.sin(r);e[0]=n*Math.cos(t),e[1]=Math.cos(r),e[2]=n*Math.sin(t)}(r,this.x,this.y),s.scale(r,r,this.z),s.add(r,r,this.translation),n.lookAt(this.camera.viewMatrix,r,this.translation,Zn),n.invert(this.camera.cameraMatrix,this.camera.viewMatrix),this.camera.viewMatrixUpdated()}return!1}toJSON(){const e=new Float32Array([this.x,this.y,this.z,this.translation[0],this.translation[1],this.translation[2]]);return btoa(String.fromCharCode.apply(null,new Uint8Array(e.buffer)))}fromJSON(e){const t=atob(e),r=new Uint8Array(24);for(let e=0,n=t.length;e<n;e++)r[e]=t.charCodeAt(e);const n=new Float32Array(r.buffer);this.x=n[0],this.y=n[1],this.z=n[2],s.copy(this.translation,n.subarray(3))}}function es(e,t){return Math.max(-t,Math.min(e,t))}class ts{constructor(){this.dt=0,this.time=0,this.realDt=0,this.realTime=0,this.startTime=performance.now(),this.paused=!1,this.speed=1,this.stepDt=0}initialize(){Tn.add(this,"paused"),Tn.add(this,"speed",.001,8),Tn.add(this,"step")}update(e){this.realDt=e-this.realTime,this.realTime=e,this.dt=this.paused?this.stepDt:this.realDt*this.speed,this.time=this.time+this.dt,this.stepDt=0}step(e=1e3/60){this.paused=!0,this.stepDt=e}}class rs{constructor(e,t){this.canvas=e,this.gfxDevice=t}initialize(){for(let e in Ln)Ln[e].defaultDepthStateId=this.gfxDevice.createDepthStencilState(Ln[e].defaultDepthState)}render(){this.gfxDevice.beginFrame(),this.gfxDevice.bindRenderPass(0),function(e,t){const r=t.primitives.length;for(let n=0;n<r;n++){const r=t.primitives[n];if(e.bindPipeline(r.renderPipeline),e.bindVertices(r.vertexTable),e.bindResources(r.resourceTable),e.setCullMode(t.defaultCullMode),e.setDepthStencilState(t.defaultDepthStateId),vn(r.indexBuffer)){const t=r.indexType===h.Ushort?2:4,n=Mn(r.indexBuffer.byteOffset,0)/t;e.draw(r.type,r.indexBuffer.buffer,yn(r.indexType),n,r.elementCount)}else e.drawNonIndexed(r.type,0,r.elementCount)}}(this.gfxDevice,Ln.opaque),this.gfxDevice.endFrame();for(let e in Ln)Ln[e].primitives.length=0}resize(e,t,r){this.canvas.setAttribute("style",`width: ${e}px; height: ${t}px;`),this.canvas.width=e*r,this.canvas.height=t*r,this.gfxDevice&&this.gfxDevice.resize(this.canvas.width,this.canvas.height)}}class ns{constructor(){this.name="SimpleShader",this.vertSource=ns.vert.sourceCode,this.fragSource=ns.frag.sourceCode,this.resourceLayout=ns.resourceLayout}}ns.vert=Vn.a,ns.frag=Gn.a,ns.uniformLayout=Dn({u_color:{type:h.Float4},u_model:{type:h.Float4x4}}),ns.resourceLayout={uniforms:{index:0,type:x.UniformBuffer,layout:ns.uniformLayout},globalUniforms:{index:1,type:x.UniformBuffer,layout:Nn.bufferLayout}};class ss{initialize({gfxDevice:e,globalUniforms:t,resources:r}){const n={buffers:[{stride:12,layout:{a_pos:{type:h.Float3,offset:0}}}]};r.load("data/Duck.glb","gltf",(e,t)=>{e&&console.error("Failed to load resource",e)}),this.shader=e.createShader(new ns),this.uniformBuffer=new In("PlaneUniforms",e,ns.uniformLayout),this.uniformBuffer.setFloats("u_color",new Float32Array([0,0,1,1])),this.uniformBuffer.setMat4("u_model",kn),this.uniformBuffer.write(e),this.material=new En(e,"simple",this.shader,ns.resourceLayout),this.material.setUniformBuffer(e,"uniforms",this.uniformBuffer),this.material.setUniformBuffer(e,"globalUniforms",t.buffer);const s=new Float32Array([-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0]);this.vertexBuffer=e.createBuffer("PlaneVertices",g.Vertex,b.Static,s),this.indexBuffer=e.createBuffer("PlaneIndices",g.Index,b.Static,new Uint16Array([0,1,2,2,1,3]).buffer),this.mesh=new Un({vertexLayout:n,vertexBuffers:[{buffer:this.vertexBuffer}],elementCount:6,indexBuffer:{buffer:this.indexBuffer},primitiveType:p.Triangles}),this.model=new Fn(e,Ln.opaque,this.mesh,this.material)}update({}){}render({}){Ln.opaque.push(this.model.primitive)}}class is{constructor(){this.invertY=!1,this.invertX=!1,this.button=-1,this.onisdraggingchanged=null,this.listeners=[],this.scrollListeners=[],this.usePointerLock=!0,this.isInteractive=!0,this.touchGesture=0,this.prevTouchX=0,this.prevTouchY=0,this.prevPinchDist=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this._onKeyDown=e=>{if(function(e){switch(e){case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":return!0;default:return!1}}(e.code))e.preventDefault();else if(!this._hasFocus())return;this.keysDown.set(e.code,!e.repeat),this.callListeners()},this._onKeyUp=e=>{this.keysDown.delete(e.code),this.callListeners()},this._onBlur=()=>{this.keysDown.clear(),this.callListeners()},this._onWheel=e=>{e.preventDefault(),this.dz+=-4*Math.sign(e.deltaY),this.callScrollListeners()},this._onTouchChange=e=>{if(this.isInteractive)if(e.preventDefault(),1==e.touches.length){const t=this._getScaledTouches(e.touches);this.touchGesture=1,this.prevTouchX=t[0].x,this.prevTouchY=t[0].y,this.dTouchX=0,this.dTouchY=0}else if(2==e.touches.length){const t=this._getPinchValues(e.touches);this.touchGesture=2,this.prevTouchX=t.x,this.prevTouchY=t.y,this.prevPinchDist=t.dist,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0}else this.touchGesture=0},this._onTouchMove=e=>{if(this.isInteractive)if(e.preventDefault(),1==e.touches.length){const t=this._getScaledTouches(e.touches);this.touchGesture=1,this.dTouchX=t[0].x-this.prevTouchX,this.dTouchY=t[0].y-this.prevTouchY,this.onMotion(this.dTouchX,this.dTouchY),this.prevTouchX=t[0].x,this.prevTouchY=t[0].y}else if(2==e.touches.length){const t=this._getPinchValues(e.touches);this.touchGesture=2,this.dTouchX=t.x-this.prevTouchX,this.dTouchY=t.y-this.prevTouchY,this.dPinchDist=t.dist-this.prevPinchDist,this.prevTouchX=t.x,this.prevTouchY=t.y,this.prevPinchDist=t.dist}else this.touchGesture=0}}initialize({toplevel:e}){document.body.tabIndex=-1,this.toplevel=e,this.toplevel.tabIndex=-1,this.keysDown=new Map,document.addEventListener("keydown",this._onKeyDown,{capture:!0}),document.addEventListener("keyup",this._onKeyUp,{capture:!0}),window.addEventListener("blur",this._onBlur),this.toplevel.addEventListener("wheel",this._onWheel,{passive:!1}),this.toplevel.addEventListener("mousedown",e=>{this.isInteractive&&(this.button=e.button,os.takeGrab(this,e,{takePointerLock:this.usePointerLock,useGrabbingCursor:!0,releaseOnMouseUp:!0}),null!==this.onisdraggingchanged&&this.onisdraggingchanged())}),this.toplevel.addEventListener("touchstart",this._onTouchChange),this.toplevel.addEventListener("touchend",this._onTouchChange),this.toplevel.addEventListener("touchcancel",this._onTouchChange),this.toplevel.addEventListener("touchmove",this._onTouchMove),this.afterFrame()}addListener(e){this.listeners.push(e)}addScrollListener(e){this.scrollListeners.push(e)}getMouseDeltaX(){return this.dx}getMouseDeltaY(){return this.dy}getTouchDeltaX(){return 2==this.touchGesture?this.dTouchX:0}getTouchDeltaY(){return 2==this.touchGesture?this.dTouchY:0}getPinchDeltaDist(){return 2==this.touchGesture?this.dPinchDist:0}isKeyDownEventTriggered(e){return!!this.keysDown.get(e)}isKeyDown(e){return this.keysDown.has(e)}isDragging(){return 0!=this.touchGesture||os.hasGrabListener(this)}afterFrame(){this.dx=0,this.dy=0,this.dz=0,this.dTouchX=0,this.dTouchY=0,this.dPinchDist=0,this.keysDown.forEach((e,t)=>{this.keysDown.set(t,!1)})}focusViewer(){this.toplevel.focus()}_hasFocus(){return document.activeElement===document.body||document.activeElement===this.toplevel}callListeners(){for(let e=0;e<this.listeners.length;e++)this.listeners[e](this)}callScrollListeners(){for(let e=0;e<this.scrollListeners.length;e++)this.scrollListeners[e](this)}_getScaledTouches(e){const t=[],r=1e3/Math.max(1,Math.min(this.toplevel.clientWidth,this.toplevel.clientHeight));for(let n=0;n<e.length;n++)t.push({x:e[n].clientX*r,y:e[n].clientY*r});return t}_getPinchValues(e){const t=this._getScaledTouches(e);return{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2,dist:Math.hypot(t[0].x-t[1].x,t[0].y-t[1].y)}}onMotion(e,t){this.dx+=e,this.dy+=t}onGrabReleased(){this.button=-1,null!==this.onisdraggingchanged&&this.onisdraggingchanged()}}const as=new class{constructor(){this.styleElem=document.createElement("style"),document.head.appendChild(this.styleElem),this.style=this.styleElem.sheet}setCursor(e){if(this.style.cssRules.length&&this.style.deleteRule(0),e){const t=`* { ${e.map(e=>`cursor: ${e} !important;`).join(" ")} }`;this.style.insertRule(t,0)}}};const os=new class{constructor(){this.grabListener=null,this.grabOptions=null,this.lastX=-1,this.lastY=-1,this._onMouseMove=e=>{if(null===this.grabListener)return;let t,r;void 0!==e.movementX?(t=e.movementX,r=e.movementY):(t=e.pageX-this.lastX,r=e.pageY-this.lastY,this.lastX=e.pageX,this.lastY=e.pageY),this.grabListener.onMotion(t,r)},this._onMouseDown=e=>{const t=this.grabOptions.grabElement;t&&!function(e,t){let r=e;for(;null!==r;){if(r===t)return!0;r=r.parentElement}return!1}(e.target,t)&&this.releaseGrab()},this._onMouseUp=e=>{this.releaseGrab()}}hasGrabListener(e){return this.grabListener===e}isGrabbed(){return null!==this.grabListener}takeGrab(e,t,r){if(null!==this.grabListener)return;this.grabListener=e,this.grabOptions=r,r.useGrabbingCursor&&as.setCursor(["grabbing","-webkit-grabbing"]),this.lastX=t.pageX,this.lastY=t.pageY,document.body.focus(),t.preventDefault();const n=t.target;r.takePointerLock&&void 0!==n.requestPointerLock&&n.requestPointerLock(),document.addEventListener("mousemove",this._onMouseMove),r.releaseOnMouseUp?document.addEventListener("mouseup",this._onMouseUp):document.addEventListener("mousedown",this._onMouseDown,{capture:!0})}releaseGrab(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousedown",this._onMouseDown,{capture:!0}),void 0!==document.exitPointerLock&&document.exitPointerLock(),as.setCursor(null);const e=this.grabListener;this.grabListener=null,e.onGrabReleased(),this.grabOptions=null}};var us,cs=r(3),hs=r.n(cs);!function(e){e[e.LoadingAsync=0]="LoadingAsync",e[e.LoadingSync=1]="LoadingSync",e[e.Loaded=2]="Loaded",e[e.Unloaded=3]="Unloaded",e[e.Failed=4]="Failed"}(us||(us={}));const fs=1313821514,ls=5130562;let ds=new TextDecoder;function ms(e){return ds.decode(e)}class ps{constructor(e){const t=new DataView(e,0,12),r=new DataView(e,12),n=ms(new Uint8Array(e,0,4)),s=t.getUint32(4,!0);t.getUint32(8,!0);if("glTF"!==n)throw new Error("Unsupported glTF-Binary header.");if(s<2)throw new Error("Unsupported legacy binary file detected.");let i=0;for(;i<r.byteLength;){const t=r.getUint32(i,!0);i+=4;const n=r.getUint32(i,!0);switch(i+=4,n){case fs:{const r=new Uint8Array(e,12+i,t);this.json=ms(r)}break;case ls:{const r=12+i;this.binaryChunk=new Uint8Array(e,r,t)}break;default:console.warn("Skipping unexpected glTF-Binary chunk type:",n)}i+=t}bn(!!this.json,"glTF-Binary: JSON content not found.")}}class gs{constructor(e,t){this.gltf=e,this.bufferData=t}bufferViewData(e){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const t=this.gltf.bufferViews[e],r=yn(this.bufferData[t.buffer],`No data for buffer ${t.buffer}`),n=t.byteLength||0,s=t.byteOffset||0,i=r.buffer,a=r.byteOffset;return new Uint8Array(i,a+s,n)}accessorData(e){if(!this.gltf.accessors)throw new Error("No accessors views found.");const t=this.gltf.accessors[e],r=_s[t.type];let n;const s=ws[t.componentType],i=s.BYTES_PER_ELEMENT*r*t.count;if(void 0!==t.bufferView){const e=this.bufferViewData(t.bufferView);n=new s(e.buffer,e.byteOffset+Mn(t.byteOffset,0),t.count*r)}else n=new s(i);if(t.sparse){const{count:e,indices:s,values:i}=t.sparse;let a=ws[s.componentType],o=this.bufferViewData(s.bufferView);const u=new a(o.buffer,o.byteOffset+(s.byteOffset||0),e);a=ws[t.componentType],o=this.bufferViewData(i.bufferView);const c=new a(this.bufferViewData(i.bufferView).buffer,o.byteOffset+(i.byteOffset||0),e*r);t.bufferView&&(n=new Uint8Array(n));const h=new ws[t.componentType](n.buffer);for(let t=0;t<e;t++)for(let e=0;e<r;e++)h[r*u[t]+e]=c[r*t+e]}return n}}function xs(e,t){let r;switch(t){case 5120:r=h.Char;break;case 5121:r=h.Uchar;break;case 5122:r=h.Short;break;case 5123:r=h.Ushort;break;case 5125:r=h.Uint;break;case 5126:r=h.Float;break;default:throw new Error("Invalid GLTF component type")}switch(e){case"SCALAR":r+=0;break;case"VEC2":r+=1;break;case"VEC3":r+=2;break;case"VEC4":r+=3;break;case"MAT2":throw new Error("2x2 Matrice not yet supported");case"MAT3":r=h.Float3x3;break;case"MAT4":r=h.Float4x4}return r}function bs(e){switch(e){case 5124:return h.Int;case 5126:return h.Float;case 35664:return h.Float2;case 35665:return h.Float3;case 35666:return h.Float4;case 35667:return h.Int2;case 35668:return h.Int3;case 35669:return h.Int4;case 35675:return h.Float3x3;case 35676:return h.Float4x4;case 35678:return h.Texture2D;default:throw new Error("Invalid GLTF component type")}}function ys(e){switch(e){case 0:return p.Points;case 1:return p.Lines;case 2:return p.LineLoop;case 3:return p.LineStrip;case 4:return p.Triangles;case 5:return p.TriangleStrip;case 6:return p.TriangleFan;default:throw new Error("Invalid GLTF primitive mode")}}const vs={9728:d.Nearest,9729:d.Linear},Ms={9728:d.Nearest,9729:d.Linear},ws={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_s={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ts={POSITION:"a_pos",NORMAL:"a_normal",TANGENT:"a_tangent",JOINTS_0:"a_joints",WEIGHTS_0:"a_weights",COLOR_0:"a_color",TEXCOORD_0:"a_uv0",TEXCOORD_1:"a_uv1",MORPH0_POSITION:"a_posMorph0"},Ss={NORMAL:"HAS_NORMALS 1",TANGENT:"HAS_TANGENT 1",JOINTS_0:"HAS_JOINT_SET0 1",WEIGHTS_0:"HAS_WEIGHT_SET0 1",COLOR_0:"HAS_COLOR0 1",TEXCOORD_0:"HAS_UV_SET0 1",TEXCOORD_1:"HAS_UV_SET1 1"};function Us(e,t,r){const n=r,s=t.gltf;let i;if(!vn(r.material))throw new Error("Default material not yet supported");i=yn(e.materials[r.material]);const a=[];let o=void 0;const u=[];if(vn(n.indices)){const r=yn(s.accessors)[n.indices];o=Es(e,t,yn(r.bufferView),g.Index)}let c;if(vn(i.technique)){c={};const e=Object.keys(i.technique.attributes);for(const t of e){c[i.technique.attributes[t].semantic]=t}}else c=Ts;const h={buffers:[]},f={};for(let r in n.attributes){const i=yn(s.accessors)[n.attributes[r]],o=yn(i.bufferView,"Undefined accessor buffers are not yet implemented"),l=f[o];let d;if(vn(l))d=h.buffers[l];else{f[o]=u.length;const r=Es(e,t,o,g.Vertex);d={stride:Mn(yn(s.bufferViews)[o].byteStride,0),layout:{}},u.push(r),h.buffers.push(d)}const m=Ss[r];vn(m)&&a.push(m);const p=yn(c[r],`Unknown vertex attribute semantic: ${r}`);d.layout[p]={type:xs(i.type,i.componentType),offset:i.byteOffset||0}}if(n.targets){a.push("HAS_MORPH0 1"),bn(1===n.targets.length,"Only 1 morph target is currently supported");const r=n.targets[0];for(let n in r)if("POSITION"===n){const i=yn(s.accessors)[r[n]],a=yn(i.bufferView,"Undefined accessor buffers are not yet implemented"),o=yn(s.bufferViews)[a];let f=h.buffers[a];const l=Es(e,t,a,g.Vertex);vn(f)||(u[a]=l,f=h.buffers[a]={stride:Mn(o.byteStride,0),layout:{}});const d=c[`MORPH0_${n}`];f.layout[d]={type:xs(i.type,i.componentType),offset:i.byteOffset||0}}}const l=s.accessors[yn(n.indices,"Only indexed primitives are currently supported")],d=yn(o,"Only indexed primitives are currently supported");return{mesh:{elementCount:l.count,vertexBuffers:u,primitiveType:ys(Mn(n.mode,4)),indexType:xs(l.type,l.componentType),indexBuffer:d,vertexLayout:h},material:i}}function Es(e,t,r,n){if(vn(e.bufferViews[r]))return e.bufferViews[r];const s=yn(t.gltf.bufferViews)[r].name||`buffer${r}`;e.bufferData[r]=new Uint8Array(t.bufferViewData(r)).buffer,bn(!e.transferList.includes(e.bufferData[r])),e.transferList.push(e.bufferData[r]);const i={name:s,type:n,buffer:-1};return e.bufferViews[r]=i,i}const Fs={texture:new class{async loadAsync(e){const t=await fetch(e.source.uri);if(200!=t.status)throw new Error("Failed to download image");const r=e.source.uri.match(/.*\/(.+?)\./);e.name=r&&r.length>1?r[1]:"Unknown",self.createImageBitmap?(e.imageBitmap=await createImageBitmap(await t.blob()),e.transferList.push(e.imageBitmap),e.status=us.LoadingSync):(e.imageBuffer=await t.arrayBuffer(),e.transferList.push(e.imageBuffer),e.status=us.LoadingSync)}loadSync(e,t){if(t.imageBitmap)t.texture=e.renderer.createTexture(t.name,{usage:b.Static,type:f.Texture2D,format:l.U8x3,maxAnistropy:16},t.imageBitmap),t.imageBitmap.close(),delete t.imageBitmap,t.status=us.Loaded;else{if(t.imageBuffer){var r=new Blob([t.imageBuffer],{type:"image/jpeg"});let e=window.URL.createObjectURL(r);delete t.imageBuffer,t.imageElement=new Image,t.imageElement.src=e,t.status=us.LoadingSync}vn(t.imageElement)&&t.imageElement.complete&&(t.texture=e.renderer.createTexture(t.name,{usage:b.Static,type:f.Texture2D,format:l.U8x3,maxAnistropy:16},t.imageElement),delete t.imageElement,t.status=us.Loaded)}}unloadSync(e,t){vn(t.texture)&&e.renderer.removeTexture(t.texture),vn(t.imageBitmap)&&t.imageBitmap.close()}},gltf:new class{async loadAsync(e){const t=await fetch(e.source.uri);if(200!=t.status)throw new Error("Failed to download GLTF");const r=await t.arrayBuffer(),i=new ps(r),o=JSON.parse(i.json),u=new gs(o,[i.binaryChunk]);e.nodes=[],e.meshes=[],e.materials=[],e.textures=[],e.bufferViews=[],e.animations=[],e.rootNodeIds=[],e.imageData=[],e.bufferData=[];const c=function(e,t){const r=Mn(t.gltf.images,[]),n=Mn(t.gltf.textures,[]),s=Mn(t.gltf.samplers,[]),i=[];e.textures=[],e.imageData=[];const a={type:f.Texture2D,format:l.U8x4,usage:b.Static},o={wrapS:10497,wrapT:10497};for(let n=0;n<r.length;n++){const s=yn(r[n]),a=yn(s.bufferView,"Image loading from a URI is not yet supported"),o=t.bufferViewData(a);let u;if(vn(self.createImageBitmap)){const e=new Blob([o],{type:yn(s.mimeType)});u=createImageBitmap(e)}else u=Promise.resolve(o.buffer);i.push(u.then(t=>{bn(!e.transferList.includes(t)),e.transferList.push(t),e.imageData[n]=t}))}return e.textures=n.map(e=>{const t=Mn(s[e.sampler],o),r=Object.assign({},a);return vn(t.magFilter)&&(r.defaultMagFilter=vs[t.magFilter],vn(r.defaultMagFilter)||console.warn(`Unsupported texture mag filter: ${t.magFilter}`)),vn(t.minFilter)&&(r.defaultMagFilter=Ms[t.minFilter],vn(r.defaultMagFilter)||console.warn(`Unsupported texture min filter: ${t.magFilter}`)),(vn(t.wrapS)||vn(t.wrapT))&&(vn(r.defaultMagFilter)||console.warn(`Texture wrapping not yet supported: ${t.magFilter}`)),{name:e.name,desc:r,imageIndex:yn(e.source),id:-1}}),i}(e,u);!function(e,t){var r;if(!(null===(r=t.gltf.extensionsUsed)||void 0===r?void 0:r.includes("KHR_techniques_webgl")))return;const n=yn(t.gltf.extensions.KHR_techniques_webgl);e.shaderData=n.shaders.map((r,n)=>{const s=yn(r.bufferView,"Shader loading from URI not yet supported"),i=new Uint8Array(t.bufferViewData(s)).buffer;return bn(!e.transferList.includes(i)),e.transferList.push(i),i}),e.shaders=n.programs.map(e=>({id:-1,name:e.name,fsIndex:e.fragmentShader,vsIndex:e.vertexShader})),e.techniques=n.techniques.map((t,r)=>{const n={};for(const e in Mn(t.uniforms,{})){const r=t.uniforms[e];n[e]=Object.assign(Object.assign({},r),{type:bs(r.type)})}return{shader:e.shaders[t.program],attributes:Mn(t.attributes,{}),uniforms:n}})}(e,u),function(e,t){const r=Mn(t.gltf.materials,[]);e.materials=[],e.materials=r.map((t,r)=>{var n;const s={name:Mn(t.name,`Material${r}`),renderFormat:{blendingEnabled:!1},cullMode:t.doubleSided?y.None:y.Back},i=null===(n=t.extensions)||void 0===n?void 0:n.KHR_techniques_webgl;return vn(i)&&(s.technique=e.techniques[i.technique],s.values=i.values),s})}(e,u),function(e,t){const r=Mn(t.gltf.meshes,[]);e.meshes=[];for(let n=0;n<r.length;n++){const s=yn(r[n]),i=[];for(let r of s.primitives)i.push(Us(e,t,r));const a={name:s.name,id:n,primitives:i};e.meshes[n]=a}}(e,u),function(e,t){const r=Mn(t.gltf.nodes,[]);e.nodes=[];for(let i=0;i<r.length;i++){const o=yn(r[i]),u=Mn(o.scale,[1,1,1]),c=Mn(o.rotation,[0,0,0,1]),h=Mn(o.translation,[0,0,0]),f={name:o.name,scale:s.fromValues(u[0],u[1],u[2]),rotation:a.fromValues(c[0],c[1],c[2],c[3]),translation:s.fromValues(h[0],h[1],h[2]),morphWeight:Mn(o.weights,[0])[0]};if(vn(o.matrix)?(f.transform=new Float32Array(o.matrix),n.getRotation(f.rotation,f.transform),n.getTranslation(f.translation,f.transform),n.getScaling(f.scale,f.transform)):f.transform=n.fromRotationTranslationScale(n.create(),f.rotation,f.translation,f.scale),vn(o.mesh)&&(f.meshId=o.mesh),vn(o.skin)&&(f.skinId=o.skin),vn(o.children)){f.children=[];for(let e=0;e<o.children.length;e++){const r=o.children[e];yn(t.gltf.nodes)[r];f.children.push(r)}}e.nodes.push(f)}}(e,u),function(e,t){const r=Mn(t.gltf.skins,[]);e.skins=[];for(let n=0;n<r.length;n++){const s=r[n];let i=void 0;if(vn(s.inverseBindMatrices)){const r=new Float32Array(t.accessorData(s.inverseBindMatrices));bn(!e.transferList.includes(r.buffer)),e.transferList.push(r.buffer),i=[];for(let e=0;e<s.joints.length;e++)i[e]=r.subarray(16*e,16*e+16)}e.skins[n]={name:s.name,skeleton:s.skeleton,joints:s.joints,inverseBindMatrices:i}}}(e,u),function(e,t){const r=Mn(t.gltf.scene,0);if(vn(r)){const n=yn(t.gltf.scenes),s=yn(n[r]);e.rootNodeIds=Mn(s.nodes,[])}}(e,u),function(e,t){const r=Mn(t.gltf.animations,[]);e.animations=[];for(let n=0;n<r.length;n++){const s=r[n],i=s.samplers.map(e=>(bn(5126===t.gltf.accessors[e.input].componentType,"Non-float animation time type unsupported"),bn(5126===t.gltf.accessors[e.output].componentType,"Non-float animation time type unsupported"),{times:t.accessorData(e.input),floats:t.accessorData(e.output)})),a=[],o=[],u=[],c=[];s.channels.forEach(e=>{const t={nodeId:yn(e.target.node),times:i[e.sampler].times,values:i[e.sampler].floats};switch(e.target.path){case"translation":a.push(t);break;case"rotation":o.push(t);break;case"scale":u.push(t);break;case"weight":c.push(t)}});const h=Math.max(...s.samplers.map(e=>yn(t.gltf.accessors[e.input].max)[0]));e.animations.push({name:s.name,maxTime:h,scales:u,rotations:o,translations:a,weights:c})}}(e,u),await Promise.all(c),bn(!e.transferList.includes(r)),e.status=us.LoadingSync}loadSync(e,t){for(let r in t.bufferData){const n=t.bufferViews[r],s=t.bufferData[r];n.buffer=e.renderer.createBuffer(n.name,n.type,b.Static,s)}for(const r of Mn(t.shaders,[])){const n=t.shaderData[r.vsIndex],s=t.shaderData[r.fsIndex],i={name:r.name,vertSource:ms(n),fragSource:ms(s)};r.id=e.renderer.createShader(i)}if(vn(self.createImageBitmap)){for(const r of t.textures){const n=t.imageData[r.imageIndex];bn(n instanceof ImageBitmap),r.id=e.renderer.createTexture(r.name,r.desc,n)}for(const e of t.imageData)e.close();delete t.imageData,t.status=us.Loaded}else{let n=0;for(const s of t.textures){const i=t.imageData[s.imageIndex];if(-1===s.id){if(i instanceof ArrayBuffer){var r=new Blob([i],{type:"image/jpeg"});let e=window.URL.createObjectURL(r);t.imageData[s.imageIndex]=new Image,t.imageData[s.imageIndex].src=e,t.status=us.LoadingSync}t.imageData[s.imageIndex].complete&&(s.id=e.renderer.createTexture(s.name,{usage:b.Static,type:f.Texture2D,format:l.U8x3,maxAnistropy:16},t.imageData[s.imageIndex]))}else n+=1}n===t.textures.length&&(delete t.imageData,t.status=us.Loaded)}}unloadSync(e,t){}}};class As{constructor(){this.messages=[],this.pending=[],this.finished=[],this.unloaded=[],this.loadingAsync=[],this.loadingSync=[],this.cache={},this.requests={}}initialize(e){this.worker=new hs.a,this.worker.onmessage=e=>this.onMessage(e),this.context={renderer:e}}onMessage(e){this.messages.push(e)}load(e,t,r){if(!vn(Fs[t]))return void r("Invalid resource type",void 0);const n="string"==typeof e?e:e.uri,s="string"==typeof e?void 0:e.headers,i=n+t;if(vn(this.cache[i]))r(void 0,this.cache[i]);else if(this.requests[i])this.requests[i].push(r);else{this.requests[i]=[r];const e={source:{uri:n,headers:s,type:t},status:us.LoadingAsync,transferList:[]};this.worker.postMessage([e])}}unload(e,t){const r=("string"==typeof e?e:e.uri)+t;if(vn(this.cache[r])){const e=this.cache[r];Fs[e.source.type].unloadSync(this.context,e),delete this.cache[r]}else{if(!this.requests[r])throw new Error(`Attempted to unload a resource that was never loaded: ${r}`);delete this.requests[r]}}update(){for(let e of this.messages)Array.prototype.push.apply(this.pending,e.data);for(let e of this.pending){const t=e.source.uri+e.source.type;if(vn(this.requests[t])||(e.status=us.Unloaded),e.status===us.LoadingSync){Fs[e.source.type].loadSync(this.context,e)}switch(e.status){case us.Loaded:case us.Failed:this.finished.push(e);break;case us.Unloaded:this.unloaded.push(e);break;case us.LoadingAsync:this.loadingAsync.push(e);break;case us.LoadingSync:this.loadingSync.push(e)}}this.pending.length=0;for(let e of this.finished){const t=e.source.uri+e.source.type,r=yn(this.requests[t]).length;bn(r>=1),this.cache[t]=e;for(let n=0;n<r;n++)e.status===us.Failed?this.requests[t][n](e.error,void 0):this.requests[t][n](void 0,e);delete this.requests[t]}const e=[];for(let t of this.loadingAsync)Array.prototype.push.apply(e,t.transferList);this.worker.postMessage(this.loadingAsync,e);for(let e of this.unloaded){Fs[e.source.type].unloadSync(this.context,e)}Array.prototype.push.apply(this.pending,this.loadingSync),this.finished.length=0,this.unloaded.length=0,this.loadingAsync.length=0,this.loadingSync.length=0,this.messages.length=0}}class Ls{constructor(){this.clearing=!1}initialize(e){Tn.add(this,"clearState"),this.loadState(e)&&console.log("Loaded state from localStorage")}saveState({cameraSystem:e}){const t={version:1,cameraSystem:e,DebugMenu:Tn},r=JSON.stringify(t);this.clearing||window.localStorage.setItem("state",r)}loadState({cameraSystem:e}){const t=window.localStorage.getItem("state");if(!vn(t))return!1;const r=JSON.parse(t);if(1!==r.version)return!1;try{e.fromJSON(r.cameraSystem),Tn.fromJSON(r.DebugMenu)}catch(e){return console.warn("Failed to load state:",e),!1}return!0}clearState(){window.localStorage.removeItem("state"),this.clearing=!0,location.reload()}update(e){0}}window.main=new class{constructor(){this.canvas=document.createElement("canvas"),this.gfxDevice=new H,this.camera=new wn,this.clock=new ts,this.cameraSystem=new Jn(this.camera),this.compositor=new rs(this.canvas,this.gfxDevice),this.globalUniforms=new Nn(this.gfxDevice),this.demo=new ss,this.input=new is,this.resources=new As,this.avatars=new Xn,this.state=new Ls,this.init()}async init(){return console.log(`Source for this build available at ${u}`),this.toplevel=document.createElement("div"),document.body.appendChild(this.toplevel),this.toplevel.appendChild(this.canvas),this.gfxDevice.setDebugEnabled(!1),this.gfxDevice.initialize(this.canvas)?(this.gfxDevice.resize(this.canvas.width,this.canvas.height),this.resources.initialize(this.gfxDevice),this.clock.initialize(),this.input.initialize(this),this.cameraSystem.initialize(),this.compositor.initialize(),this.globalUniforms.initialize(),this.demo.initialize(this),this.avatars.initialize(this),this.state.initialize(this),window.onresize=this.onResize.bind(this),this.onResize(),this.update(window.performance.now()),0):1}update(e){this.clock.update(e),this.resources.update(),this.cameraSystem.update(this),this.demo.update(this),this.avatars.update(this),this.state.update(this),this.globalUniforms.update(),this.compositor.render(),this.demo.render(this),this.avatars.render(this),this.input.afterFrame(),Tn.update(),window.requestAnimationFrame(this.update.bind(this))}onResize(){this.cameraSystem.resize(window.innerWidth,window.innerHeight),this.compositor.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)}}}]);